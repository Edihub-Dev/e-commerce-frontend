import{j as e,r as m,m as P,A as ve}from"./vendor-2d1PFKo4.js";import{S as de}from"./Sidebar-Blgfai62.js";import{N as Se}from"./Navbar-K_t1OsQh.js";import{c as je,aa as o,u as we,a as X,J as ee,I as Ce}from"./index-Bpx0OnSg.js";import{C as ke,M as Oe}from"./MetricCard-szS2nYje.js";import{S as Ae}from"./shopping-bag-Dv9EZFsL.js";import{D as _e}from"./download-D5r73ZfU.js";import{F as Le}from"./funnel-DrRYs2Xk.js";import{C as me}from"./calendar-jUZ4havw.js";import{E as xe}from"./eye-DjBlpBi-.js";import{L as te}from"./loader-circle-DRAKHMK_.js";import{T as ue}from"./trash-2-Chc1geHF.js";import{A as Ee}from"./AdminUsersTable-44eNCRRk.js";import"./react-BzrpNAyj.js";import"./house-Bx4yg0fx.js";import"./ticket-percent-OJlGKFU7.js";import"./package-C_UWcLgd.js";import"./arrow-left-fjWLrcm4.js";import"./log-out-BEyQjTNl.js";import"./shield-check-ZginSkgb.js";import"./shield-alert-l_ssT4iu.js";import"./pencil-line-CoX3LYzN.js";import"./info-GXZN73e0.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],Ue=je("users-round",Ie);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M17 14h.01",key:"7oqj8z"}],["path",{d:"M7 7h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14",key:"u1rqew"}]],ze=je("wallet-minimal",Re),pe=a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(a||0),he=a=>new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(a||0),le=({metrics:a,isLoading:l})=>{const h=[{label:"Sales",value:pe(a==null?void 0:a.sales),icon:e.jsx(ke,{size:22}),accent:"bg-blue-50 text-blue-600"},{label:"Orders",value:he(a==null?void 0:a.orders),icon:e.jsx(Ae,{size:22}),accent:"bg-purple-50 text-purple-600"},{label:"Profit",value:pe(a==null?void 0:a.profit),icon:e.jsx(ze,{size:22}),accent:"bg-emerald-50 text-emerald-600"},{label:"Customer",value:he(a==null?void 0:a.customers),icon:e.jsx(Ue,{size:22}),accent:"bg-orange-50 text-orange-600"}];return e.jsx("section",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4",children:h.map(D=>e.jsx("div",{className:"min-w-0",children:e.jsx(Oe,{...D,isLoading:l})},D.label))})};le.propTypes={metrics:o.shape({sales:o.number,orders:o.number,profit:o.number,customers:o.number}),isLoading:o.bool};le.defaultProps={metrics:{sales:0,orders:0,profit:0,customers:0},isLoading:!1};const $e=[{label:"All Statuses",value:""},{label:"Processing",value:"processing"},{label:"Shipped",value:"shipped"},{label:"Delivered",value:"delivered"},{label:"Return / Replace",value:"returned"}],fe=a=>`â‚¹${(typeof a=="number"&&!Number.isNaN(a)?a:0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,be={processing:"bg-orange-100 text-orange-600",shipped:"bg-blue-100 text-blue-600",out_for_delivery:"bg-blue-100 text-blue-600",delivered:"bg-green-100 text-green-600",returned:"bg-slate-100 text-slate-500"},ge={paid:"bg-emerald-100 text-emerald-600",pending:"bg-amber-100 text-amber-600",failed:"bg-rose-100 text-rose-600"},se={paid:"Successful",pending:"Pending",failed:"Failed"},ae={cod:"Cash on Delivery",upi:"UPI",qr:"QR Code",card:"Card",netbanking:"Net Banking"},ne=(a="")=>{const l=String(a).toLowerCase();return l==="confirmed"?"processing":l},re=(a="")=>ne(a).replace(/_/g," ").replace(/\b\w/g,h=>h.toUpperCase()),Pe=a=>{if(a==null)return"";const l=String(a);return/[",\n]/.test(l)?`"${l.replace(/"/g,'""')}"`:l},ie=({orders:a,isLoading:l,error:h,totalOrders:D,statusBreakdown:F,filters:q,appliedFilters:x,onFiltersChange:U,onApplyFilters:K,onClearFilters:T,onOrderDeleted:E,onOrderUpdated:oe,onViewAll:Y})=>{const M=we(),[$,H]=m.useState(new Set),V=m.useCallback(t=>{t&&M(`/admin/orders/${t}`)},[M]),J=m.useCallback(async t=>{var p,b;if(window.confirm("Are you sure you want to delete this order?")){H(f=>new Set(f).add(t));try{await X.delete(`/orders/${t}`),ee.success("Order deleted"),E==null||E(t)}catch(f){console.error("Failed to delete order",f);const N=((b=(p=f.response)==null?void 0:p.data)==null?void 0:b.message)||"Failed to delete order. Please try again.";ee.error(N)}finally{H(f=>{const N=new Set(f);return N.delete(t),N})}}},[E]),B=m.useCallback(()=>{if(!a.length){ee.error("No orders to export yet");return}const t=["Order ID","Placed At","Customer","Email","Items","Total","Order Status","Payment Method","Payment Status"],p=a.map(c=>{var S,C,k,O,A,_,L,s;const w=c.customerName||((S=c.shippingAddress)==null?void 0:S.fullName)||"Customer",R=c.customerEmail||((C=c.shippingAddress)==null?void 0:C.email)||"--",y=(c.items||[]).map(n=>{const r=[n.quantity?`x${n.quantity}`:null,n.size?`Size ${n.size}`:null].filter(Boolean).join(" ");return r?`${n.name} (${r})`:n.name}).join(" | "),d=c.totalAmount??((k=c.pricing)==null?void 0:k.total)??0,v=(A=(O=c.payment)==null?void 0:O.status)==null?void 0:A.toLowerCase(),j=(L=(_=c.payment)==null?void 0:_.method)==null?void 0:L.toLowerCase();return[c._id,c.createdAt?new Date(c.createdAt).toISOString():"",w,R,y,Number(d).toFixed(2),re(c.status),ae[j]||((s=j==null?void 0:j.toUpperCase)==null?void 0:s.call(j))||"",se[v]||v||""]}),b=[t,...p].map(c=>c.map(Pe).join(",")).join(`\r
`),f=new Blob(["\uFEFF"+b],{type:"text/csv;charset=utf-8;"}),N=URL.createObjectURL(f),g=document.createElement("a");g.href=N,g.download=`recent-orders-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(N)},[a]),G=typeof D=="number"?D:a.length,Q=[{key:"processing",label:"Processing",className:"bg-orange-100 text-orange-600"},{key:"shipped",label:"Shipped",className:"bg-blue-100 text-blue-600"},{key:"delivered",label:"Delivered",className:"bg-green-100 text-green-600"},{key:"returned",label:"Return/Replace",className:"bg-slate-100 text-slate-500"}];return e.jsxs(P.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.45,delay:.1},className:"bg-white border border-slate-100 rounded-2xl shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 px-6 py-4 border-b border-slate-100",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Recent Orders"}),e.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Showing ",a.length," of ",G," orders"]}),((x==null?void 0:x.status)||(x==null?void 0:x.startDate)||(x==null?void 0:x.endDate))&&e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-slate-500",children:[x.status&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 px-2 py-1",children:["Status: ",x.status]}),x.startDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 px-2 py-1",children:["From: ",x.startDate]}),x.endDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 px-2 py-1",children:["To: ",x.endDate]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-xl border border-blue-200 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 transition",onClick:B,children:[e.jsx(_e,{size:18})," Download CSV"]}),Y&&e.jsx("button",{type:"button",className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:border-blue-200 hover:text-blue-600 transition",onClick:Y,children:"View more"}),e.jsxs("form",{className:"flex flex-wrap items-center gap-3",onSubmit:t=>{t.preventDefault(),K()},children:[e.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600",children:[e.jsx(Le,{size:18}),e.jsx("select",{value:q.status,onChange:t=>U({status:t.target.value}),className:"bg-transparent focus:outline-none",children:$e.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600",children:[e.jsx(me,{size:18}),e.jsx("input",{type:"date",value:q.startDate,onChange:t=>U({startDate:t.target.value}),className:"bg-transparent focus:outline-none"})]}),e.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600",children:[e.jsx(me,{size:18}),e.jsx("input",{type:"date",value:q.endDate,onChange:t=>U({endDate:t.target.value}),className:"bg-transparent focus:outline-none"})]}),e.jsx("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 transition",children:"Apply"}),e.jsx("button",{type:"button",className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600 hover:border-blue-200 hover:text-blue-600 transition",onClick:T,children:"Clear"})]})]})]}),e.jsx("div",{className:"hidden overflow-x-auto md:block",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100",children:[e.jsx("thead",{className:"bg-slate-50/80",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Payment"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-slate-100",children:l?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-12 text-center text-slate-400",children:"Loading recent orders..."})}):h?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-12 text-center text-red-400",children:h})}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-12 text-center text-slate-400",children:"No orders found."})}):a.map(t=>{var S,C,k,O,A,_,L,s,n,r;const p=((S=t.items)==null?void 0:S[0])||{},b=t.productName||p.name||"Unknown product",f=t.productImage||p.image||"https://placehold.co/80x80/f8fafc/e2e8f0?text=IMG",N=t.customerName||((C=t.shippingAddress)==null?void 0:C.fullName)||"Customer",g=t.customerEmail||((k=t.shippingAddress)==null?void 0:k.email)||"--",c=t.totalAmount??((O=t.pricing)==null?void 0:O.total)??0,w=t.status||"processing",R=ne(w),y=be[R]||"bg-slate-100 text-slate-500",d=(_=(A=t.payment)==null?void 0:A.status)==null?void 0:_.toLowerCase(),v=(s=(L=t.payment)==null?void 0:L.method)==null?void 0:s.toLowerCase(),j=ge[d]||"bg-slate-100 text-slate-500";return e.jsxs("tr",{className:"hover:bg-slate-50/60 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:f,alt:b,className:"h-10 w-10 rounded-xl object-cover",onError:i=>{i.target.onerror=null,i.target.src="https://placehold.co/80x80/f8fafc/e2e8f0?text=IMG"}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:b}),e.jsx("p",{className:"text-xs text-slate-400",children:((n=t.items)==null?void 0:n.length)>1?`+${t.items.length-1} other item${t.items.length-1>1?"s":""}`:p.size?`Size: ${p.size}`:"Single item"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-600",children:N}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-400",children:g}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-slate-900",children:fe(c)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-600",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"font-medium text-slate-700",children:ae[v]||((r=v==null?void 0:v.toUpperCase)==null?void 0:r.call(v))||"--"}),e.jsx("span",{className:`inline-flex w-fit items-center rounded-full px-3 py-1 text-xs font-medium ${j}`,children:se[d]||(d==null?void 0:d.replace(/_/g," "))||"--"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${y}`,children:re(w)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-slate-400",children:e.jsxs("div",{className:"inline-flex items-center gap-3",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-blue-50 text-blue-600 transition","aria-label":"View order",onClick:()=>V(t._id),children:e.jsx(xe,{size:18})}),e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-red-50 text-red-500 transition disabled:opacity-50","aria-label":"Delete order",onClick:()=>J(t._id),disabled:$.has(t._id),children:$.has(t._id)?e.jsx(te,{size:18,className:"animate-spin"}):e.jsx(ue,{size:18})})]})})]},t._id)})})]})}),e.jsx("div",{className:"space-y-3 px-4 md:hidden",children:e.jsxs(ve,{children:[l&&e.jsx(P.div,{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-slate-500",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx(te,{className:"h-4 w-4 animate-spin"}),"Loading recent orders..."]})}),!l&&h&&e.jsx(P.div,{className:"rounded-2xl border border-rose-200 bg-white p-6 text-center text-rose-600",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:h}),!l&&!h&&a.length===0&&e.jsx(P.div,{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-slate-500",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:"No orders found."}),!l&&!h&&a.map(t=>{var j,S,C,k,O,A,_,L;const p=((j=t.items)==null?void 0:j[0])||{},b=t.productName||p.name||"Unknown product",f=t.productImage||p.image||"https://placehold.co/80x80/f8fafc/e2e8f0?text=IMG",N=t.customerName||((S=t.shippingAddress)==null?void 0:S.fullName)||"Customer",g=t.totalAmount??((C=t.pricing)==null?void 0:C.total)??0,c=t.status||"processing",w=ne(c),R=be[w]||"bg-slate-100 text-slate-500",y=(O=(k=t.payment)==null?void 0:k.status)==null?void 0:O.toLowerCase(),d=(_=(A=t.payment)==null?void 0:A.method)==null?void 0:_.toLowerCase(),v=ge[y]||"bg-slate-100 text-slate-500";return e.jsx(P.div,{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("img",{src:f,alt:b,className:"h-14 w-14 flex-shrink-0 rounded-xl object-cover",onError:s=>{s.currentTarget.src="https://placehold.co/80x80/f8fafc/e2e8f0?text=IMG"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:b}),e.jsx("span",{className:"text-xs text-slate-500",children:N}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Order ID: ",t._id]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-xs text-slate-500",children:[e.jsxs("div",{className:"rounded-xl bg-slate-50 p-2",children:[e.jsx("p",{className:"uppercase text-[10px] tracking-wide text-slate-400",children:"Total"}),e.jsx("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:fe(g)})]}),e.jsxs("div",{className:"rounded-xl bg-slate-50 p-2",children:[e.jsx("p",{className:"uppercase text-[10px] tracking-wide text-slate-400",children:"Payment"}),e.jsx("p",{className:"mt-1 text-xs font-medium text-slate-700",children:ae[d]||((L=d==null?void 0:d.toUpperCase)==null?void 0:L.call(d))||"--"}),e.jsx("span",{className:`mt-1 inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${v}`,children:se[y]||(y==null?void 0:y.replace(/_/g," "))||"--"})]}),e.jsxs("div",{className:"rounded-xl bg-slate-50 p-2",children:[e.jsx("p",{className:"uppercase text-[10px] tracking-wide text-slate-400",children:"Status"}),e.jsx("span",{className:`mt-1 inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${R}`,children:re(c)})]}),e.jsxs("div",{className:"rounded-xl bg-slate-50 p-2",children:[e.jsx("p",{className:"uppercase text-[10px] tracking-wide text-slate-400",children:"Placed on"}),e.jsx("p",{className:"mt-1 text-xs font-medium text-slate-700",children:t.createdAt?new Date(t.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"--"})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>V(t._id),className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600",children:[e.jsx(xe,{size:14})," View"]}),e.jsxs("button",{type:"button",onClick:()=>J(t._id),disabled:$.has(t._id),className:"inline-flex items-center gap-2 rounded-full border border-rose-200 px-3 py-1.5 text-xs font-semibold text-rose-500 hover:border-rose-300 disabled:opacity-60",children:[$.has(t._id)?e.jsx(te,{size:14,className:"animate-spin"}):e.jsx(ue,{size:14}),"Delete"]})]})]})]})},t._id)})]})}),e.jsxs("div",{className:"flex flex-col gap-3 border-t border-slate-100 px-4 py-4 text-sm text-slate-500 md:flex-row md:items-center md:justify-between md:px-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("p",{children:["Showing ",a.length," ",a.length===1?"order":"orders",G>a.length?` of ${G}`:""]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:Q.map(({key:t,label:p,className:b})=>e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium ${b}`,children:[p,": ",(F==null?void 0:F[t])??0]},t))})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[[1,2,3].map(t=>e.jsx("button",{type:"button",className:`h-9 w-9 rounded-full border text-sm font-medium transition ${t===1?"border-slate-900 bg-slate-900 text-white":"border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`,children:t},t)),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-full border border-slate-200 text-slate-400","aria-label":"Next page",children:"..."})]})]})]})};ie.propTypes={orders:o.arrayOf(o.shape({_id:o.string.isRequired,productName:o.string,productImage:o.string,customerName:o.string,customerEmail:o.string,items:o.array,shippingAddress:o.shape({fullName:o.string,email:o.string}),pricing:o.shape({total:o.number}),totalAmount:o.number,status:o.string})),isLoading:o.bool,error:o.string,totalOrders:o.number,statusBreakdown:o.shape({processing:o.number,shipped:o.number,delivered:o.number,cancelled:o.number}),onOrderDeleted:o.func,onOrderUpdated:o.func,onViewAll:o.func};ie.defaultProps={orders:[],isLoading:!1,error:"",totalOrders:0,statusBreakdown:{processing:0,shipped:0,delivered:0,cancelled:0},filters:{status:"",startDate:"",endDate:""},appliedFilters:{status:"",startDate:"",endDate:""},onFiltersChange:()=>{},onApplyFilters:()=>{},onClearFilters:()=>{},onOrderDeleted:()=>{},onOrderUpdated:()=>{}};const ye={status:"",startDate:"",endDate:""},Ne=()=>{const a=new Date,l=new Date(a);return l.setDate(l.getDate()-1),{status:"",startDate:Z(l),endDate:Z(a)}},Z=a=>a.toISOString().slice(0,10),Fe=(a="processing")=>{const l=String(a).toLowerCase();return["confirmed"].includes(l)?"processing":["shipped","out_for_delivery"].includes(l)?"shipped":["delivered"].includes(l)?"delivered":["returned"].includes(l)?"returned":"processing"},W=(a=[])=>{const l={processing:0,shipped:0,delivered:0,returned:0};return a.forEach(h=>{const D=Fe(h.status);l[D]!==void 0&&(l[D]+=1)}),l},ct=()=>{const a=we(),[l,h]=m.useState([]),[D,F]=m.useState(!0),[q,x]=m.useState(""),[U,K]=m.useState({sales:0,orders:0,profit:0,customers:0}),[T,E]=m.useState({processing:0,shipped:0,delivered:0,returned:0}),[oe,Y]=m.useState({pendingOrders:0,shippedOrders:0,deliveredOrders:0}),[M,$]=m.useState(!0),[H,V]=m.useState(""),[J,B]=m.useState([]),[G,Q]=m.useState(!0),[t,p]=m.useState(""),[b,f]=m.useState("24 Hour"),[N,g]=m.useState(!1),[c,w]=m.useState(()=>Ne()),[R,y]=m.useState(()=>Ne()),{user:d,logout:v}=Ce(),j=m.useMemo(()=>({...c}),[c]),S=s=>{if(s.__delete){B(n=>n.filter(r=>r._id!==s._id));return}if(s.__bulkDelete&&Array.isArray(s.deletedIds)){B(n=>n.filter(r=>!s.deletedIds.includes(r._id)));return}B(n=>n.map(r=>r._id===s._id?{...r,...s}:r))},C=s=>{y(n=>({...n,...s}))},k=()=>{w({...R})},O=()=>{y({...ye}),w({...ye}),f("All Date")},A=s=>{if(f(s),s==="All Date"){y(u=>({...u,startDate:"",endDate:""})),w(u=>({...u,startDate:"",endDate:""}));return}const n=new Date;let r;switch(s){case"12 Months":r=new Date(n),r.setFullYear(r.getFullYear()-1);break;case"30 Days":r=new Date(n),r.setDate(r.getDate()-30);break;case"7 Days":r=new Date(n),r.setDate(r.getDate()-7);break;case"24 Hour":r=new Date(n),r.setDate(r.getDate()-1);break;default:r=null;break}const i={startDate:r?Z(r):"",endDate:Z(n)};y(u=>({...u,...i})),w(u=>({...u,...i}))};m.useEffect(()=>{let s=!0;const n=async()=>{var i,u;if(s){$(!0);try{const I=await X.get("/admin/overview");if(!s)return;if((i=I.data)!=null&&i.success){const z=I.data.data||{};K(z.metrics||{}),Y(z.notifications||{}),E({...W(z.recentOrders||[]),...z.statusBreakdown||{}}),V("")}else V(((u=I.data)==null?void 0:u.message)||"Unable to load admin overview.")}catch(I){if(!s)return;console.error("Failed to load admin overview",I),V("Unable to load admin overview. Please try again.")}finally{s&&$(!1)}}},r=async()=>{var i;if(s){Q(!0);try{const u=await X.get("/admin/users");if(!s)return;const z=(((i=u.data)==null?void 0:i.data)||[]).filter(De=>{const ce=String(De.role).toLowerCase();return ce==="customer"||ce==="admin"});B(z),p("")}catch(u){if(!s)return;console.error("Failed to load users",u),p("Unable to load users. Please try again.")}finally{s&&Q(!1)}}};return n(),r(),()=>{s=!1}},[]),m.useEffect(()=>{let s=!0;return(async()=>{var r;if(s){F(!0);try{const i={excludeSellerOrders:!0};c.status&&(i.status=c.status),c.startDate&&(i.startDate=c.startDate),c.endDate&&(i.endDate=c.endDate);const u=await X.get("/orders",{params:i});if(!s)return;const I=((r=u.data)==null?void 0:r.data)||[];h(I),E(z=>({...z,...W(I)})),x("")}catch(i){if(!s)return;console.error("Failed to fetch orders",i),x("Unable to load orders. Please try again shortly.")}finally{s&&F(!1)}}})(),()=>{s=!1}},[c]),m.useEffect(()=>{const s=document.documentElement,n=document.body.style.overflow,r=s.style.overflow,i=document.body.style.height,u=s.style.height;return document.body.style.overflow="hidden",document.body.style.height="100vh",s.style.overflow="hidden",s.style.height="100vh",()=>{document.body.style.overflow=n,document.body.style.height=i,s.style.overflow=r,s.style.height=u}},[]);const _=m.useCallback(s=>{h(n=>{const r=n.filter(i=>i._id!==s);return E(i=>({...i,...W(r)})),K(i=>({...i,orders:r.length})),r})},[]),L=m.useCallback(s=>{h(n=>{const r=n.map(i=>i._id===s._id?{...i,...s}:i);return E(i=>({...i,...W(r)})),r})},[]);return e.jsx("div",{className:"h-screen bg-slate-50 text-slate-900 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx(de,{active:"Dashboard",className:"hidden md:flex md:w-64 md:flex-none",onNavigate:()=>g(!1)}),e.jsx(ve,{children:N&&e.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx(P.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(de,{active:"Dashboard",className:"flex w-full",onNavigate:()=>g(!1)})}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"flex-1 bg-black/30","aria-label":"Close sidebar"})]})}),e.jsxs("div",{className:"flex flex-1 flex-col h-full overflow-hidden",children:[e.jsx(Se,{onToggleSidebar:()=>g(s=>!s),activeRange:b,onSelectRange:A,adminName:(d==null?void 0:d.name)||(d==null?void 0:d.username),adminRole:(d==null?void 0:d.role)==="admin"?"Administrator":d==null?void 0:d.role,notifications:oe,onLogout:v}),e.jsxs("main",{className:"flex-1 h-full overflow-y-auto overflow-x-hidden scrollbar-hidden px-4 py-6 md:px-8 space-y-6",children:[e.jsx(le,{metrics:U,isLoading:M}),H&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-600",children:H}),!M&&!H&&e.jsx("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 xl:grid-cols-4",children:[{key:"processing",label:"Processing",chipClass:"bg-orange-50 text-orange-600"},{key:"shipped",label:"Shipped",chipClass:"bg-blue-50 text-blue-600"},{key:"delivered",label:"Delivered",chipClass:"bg-emerald-50 text-emerald-600"},{key:"returned",label:"Return/Replace",chipClass:"bg-slate-100 text-slate-600"}].map(({key:s,label:n,chipClass:r})=>e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-slate-500",children:n}),e.jsx("p",{className:`mt-2 inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm font-semibold ${r}`,children:(T==null?void 0:T[s])??0})]},s))}),e.jsx(ie,{orders:l,isLoading:D,error:q,totalOrders:(U==null?void 0:U.orders)||l.length,statusBreakdown:T,filters:R,appliedFilters:j,onFiltersChange:C,onApplyFilters:k,onClearFilters:O,onOrderDeleted:_,onOrderUpdated:L,onViewAll:()=>a("/admin/orders")}),e.jsx(Ee,{users:J,isLoading:G,error:t,onUserUpdated:S})]})]})]})})};export{ct as default};
