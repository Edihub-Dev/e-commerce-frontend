import{r as o,j as e,A as K,m as P}from"./vendor-2d1PFKo4.js";import{I as W,X as Y,C as x}from"./index-Bpx0OnSg.js";import{S as Q}from"./Sidebar-Blgfai62.js";import{N as Z}from"./Navbar-K_t1OsQh.js";import{a as ee,d as se,u as te,c as le}from"./helpSupportApi-BN0kerT7.js";import{P as F}from"./plus-BZuZgauU.js";import{L as q}from"./loader-circle-DRAKHMK_.js";import{P as ae}from"./pencil-BZnjNrx9.js";import{T as L}from"./trash-2-Chc1geHF.js";import{S as re}from"./save-DdNriqD8.js";import"./react-BzrpNAyj.js";import"./house-Bx4yg0fx.js";import"./ticket-percent-OJlGKFU7.js";import"./package-C_UWcLgd.js";import"./shopping-bag-Dv9EZFsL.js";import"./arrow-left-fjWLrcm4.js";import"./log-out-BEyQjTNl.js";const b={title:"",description:"",slug:"",order:0,isActive:!0,responseDelayMs:2e3,questions:[{question:"",answer:"",order:0}]},we=()=>{var H;const[g,v]=o.useState([]),[m,j]=o.useState(null),[I,N]=o.useState(!1),[C,S]=o.useState(!1),[k,A]=o.useState(""),[T,_]=o.useState(!1),[D,z]=o.useState(!1),[R,E]=o.useState(!1),[r,c]=o.useState(b),{user:p,logout:B}=W(),i=o.useMemo(()=>g.find(s=>s._id===m)||null,[g,m]),V=async()=>{S(!0);try{const s=await ee(),t=Array.isArray(s.data)?s.data:[];v(t.sort((l,a)=>{const n=l.order??0,d=a.order??0;return n===d?l.title.localeCompare(a.title):n-d})),A(""),t.length&&!m&&j(t[0]._id)}catch(s){console.error("Failed to load help topics",s),A(s.message||"Failed to load help topics")}finally{S(!1)}};o.useEffect(()=>{V()},[]);const M=s=>{var t;c(s?{_id:s._id,title:s.title||"",description:s.description||"",slug:s.slug||"",order:s.order??0,isActive:s.isActive!==!1,responseDelayMs:s.responseDelayMs??2e3,questions:(t=s.questions)!=null&&t.length?s.questions.map((l,a)=>({_id:l._id,question:l.question||"",answer:l.answer||"",order:l.order??a})):[...b.questions]}:{...b,questions:[...b.questions]}),E(!0)},y=()=>{E(!1),c(b)},u=s=>{c(t=>({...t,...s}))},w=(s,t)=>{c(l=>{const a=[...l.questions];return a[s]={...a[s],...t},{...l,questions:a}})},$=()=>{c(s=>({...s,questions:[...s.questions,{question:"",answer:"",order:s.questions.length}]}))},U=s=>{c(t=>({...t,questions:t.questions.filter((l,a)=>a!==s)}))},X=s=>{var t,l,a;return{title:(t=s.title)==null?void 0:t.trim(),description:(l=s.description)==null?void 0:l.trim(),slug:((a=s.slug)==null?void 0:a.trim())||void 0,order:Number(s.order)||0,isActive:!!s.isActive,responseDelayMs:Math.max(0,Number(s.responseDelayMs)||0),questions:s.questions.map((n,d)=>{var h,f;return{_id:n._id,question:(h=n.question)==null?void 0:h.trim(),answer:(f=n.answer)==null?void 0:f.trim(),order:Number.isFinite(Number(n.order))?Number(n.order):d}}).filter(n=>n.question&&n.answer)}},G=async()=>{if(!r.title.trim()){x.error("Topic title is required");return}const s=X(r);if(!s.questions.length){x.error("Add at least one question with an answer");return}_(!0);try{let t;r._id?(t=await te(r._id,s),x.success("Topic updated")):(t=await le(s),x.success("Topic created"));const l=t.data||t;v(a=>[...a.filter(d=>d._id!==l._id),l].sort((d,h)=>{const f=d.order??0,O=h.order??0;return f===O?d.title.localeCompare(h.title):f-O})),j(l._id),y()}catch(t){console.error("Failed to save topic",t),x.error(t.message||"Failed to save topic")}finally{_(!1)}},J=async s=>{z(!0);try{await se(s),x.success("Topic deleted"),v(t=>t.filter(l=>l._id!==s)),m===s&&j(null)}catch(t){console.error("Failed to delete topic",t),x.error(t.message||"Failed to delete topic")}finally{z(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:[e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(Q,{active:"Help & Support",className:"hidden lg:flex lg:w-64 lg:flex-none",onNavigate:()=>N(!1)}),e.jsx(K,{children:I&&e.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx(P.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(Q,{active:"Help & Support",className:"flex w-full",onNavigate:()=>N(!1)})}),e.jsx("button",{type:"button",onClick:()=>N(!1),className:"flex-1 bg-black/30","aria-label":"Close sidebar"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Z,{onToggleSidebar:()=>N(s=>!s),adminName:p==null?void 0:p.name,adminRole:p==null?void 0:p.role,onLogout:B}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Help & Support Manager"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Create, update, and organise chatbot topics and quick answers."})]}),e.jsxs("button",{onClick:()=>M(null),className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-semibold shadow-sm hover:bg-blue-700 transition",children:[e.jsx(F,{size:16}),"Add Topic"]})]}),e.jsxs("div",{className:"grid lg:grid-cols-[320px_1fr] gap-6",children:[e.jsxs("section",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm",children:[e.jsxs("header",{className:"px-5 py-4 border-b border-slate-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-700 uppercase tracking-wide",children:"Topics"}),C&&e.jsx(q,{size:16,className:"animate-spin text-slate-400"})]}),e.jsx("div",{className:"max-h-[520px] overflow-y-auto divide-y divide-slate-100",children:k?e.jsx("p",{className:"px-5 py-6 text-sm text-rose-500",children:k}):g.length?g.map(s=>{const t=s._id===m;return e.jsxs("button",{onClick:()=>j(s._id),className:`w-full text-left px-5 py-4 transition ${t?"bg-blue-50 border-l-4 border-blue-500":"hover:bg-slate-50"}`,children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-800 flex items-center gap-2",children:[s.title,s.isActive===!1?e.jsx("span",{className:"text-[10px] uppercase tracking-wide bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full",children:"Hidden"}):null]}),s.description?e.jsx("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:s.description}):null]},s._id)}):e.jsx("div",{className:"px-5 py-6 text-sm text-slate-500",children:C?"Loading topicsâ€¦":"No topics yet. Create the first one."})})]}),e.jsx("section",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6 space-y-6",children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:i.title}),i.description?e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:i.description}):null,e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3 text-xs text-slate-500",children:[e.jsxs("span",{className:"px-3 py-1 border border-slate-200 rounded-full",children:["Order: ",i.order??0]}),e.jsx("span",{className:`px-3 py-1 rounded-full border ${i.isActive===!1?"bg-slate-100 text-slate-600 border-slate-200":"bg-emerald-50 text-emerald-600 border-emerald-100"}`,children:i.isActive===!1?"Hidden":"Visible"}),i.slug?e.jsxs("span",{className:"px-3 py-1 border border-slate-200 rounded-full",children:["Slug: ",i.slug]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>M(i),className:"inline-flex items-center gap-1 px-3 py-2 text-xs font-semibold text-blue-600 border border-blue-100 rounded-lg hover:bg-blue-50 transition",children:[e.jsx(ae,{size:14})," Edit"]}),e.jsxs("button",{onClick:()=>J(i._id),disabled:D,className:"inline-flex items-center gap-1 px-3 py-2 text-xs font-semibold text-rose-600 border border-rose-100 rounded-lg hover:bg-rose-50 transition disabled:opacity-50",children:[D?e.jsx(q,{size:14,className:"animate-spin"}):e.jsx(L,{size:14}),"Delete"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase text-slate-600 tracking-wide",children:"Questions & Answers"}),e.jsx("div",{className:"space-y-3",children:(H=i.questions)!=null&&H.length?i.questions.slice().sort((s,t)=>(s.order??0)-(t.order??0)).map(s=>e.jsxs("div",{className:"border border-slate-200 rounded-xl p-4 bg-slate-50",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:s.question}),e.jsx("p",{className:"text-sm text-slate-600 mt-2 whitespace-pre-line",children:s.answer})]},s._id)):e.jsx("p",{className:"text-sm text-slate-500",children:"No questions added yet."})})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center text-center py-12 gap-3 text-slate-500",children:e.jsx("p",{className:"text-sm",children:"Select a topic on the left to preview its content."})})})]})]})]})]}),R&&e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-slate-900/30 backdrop-blur-sm px-4",children:e.jsxs("div",{className:"w-full max-w-3xl bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:r._id?"Edit Topic":"Create Topic"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Update the category details and associated questions."})]}),e.jsx("button",{onClick:y,className:"p-2 rounded-full text-slate-500 hover:bg-slate-100","aria-label":"Close",children:e.jsx(Y,{size:18})})]}),e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Title"}),e.jsx("input",{type:"text",value:r.title,onChange:s=>u({title:s.target.value}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"E.g. Orders & Delivery"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Slug (optional)"}),e.jsx("input",{type:"text",value:r.slug,onChange:s=>u({slug:s.target.value}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"orders-delivery"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Display Order"}),e.jsx("input",{type:"number",value:r.order,onChange:s=>u({order:Number(s.target.value)}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",min:0})]}),e.jsxs("label",{className:"flex items-center gap-3 mt-6",children:[e.jsx("input",{type:"checkbox",checked:r.isActive,onChange:s=>u({isActive:s.target.checked}),className:"h-4 w-4 text-blue-600 border-slate-300 rounded"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Visible to customers"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Response Delay (seconds)"}),e.jsx("input",{type:"number",min:0,step:.5,value:Number((r.responseDelayMs??0)/1e3).toString(),onChange:s=>u({responseDelayMs:Math.max(0,Number(s.target.value)*1e3)}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"e.g. 2"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:"Time the assistant waits before replying. Defaults to 2 seconds."})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Description (optional)"}),e.jsx("textarea",{value:r.description,onChange:s=>u({description:s.target.value}),rows:3,className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"Short summary to help admins identify the topic"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-600",children:"Questions"}),e.jsxs("button",{onClick:$,className:"inline-flex items-center gap-2 text-xs font-semibold px-3 py-2 border border-dashed border-slate-300 rounded-lg hover:border-blue-400 hover:text-blue-600 transition",children:[e.jsx(F,{size:14})," Add Question"]})]}),e.jsx("div",{className:"space-y-4",children:r.questions.map((s,t)=>e.jsxs("div",{className:"border border-slate-200 rounded-xl p-4 space-y-3 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase text-slate-500",children:["Question #",t+1]}),r.questions.length>1&&e.jsxs("button",{onClick:()=>U(t),className:"text-xs text-rose-500 inline-flex items-center gap-1",children:[e.jsx(L,{size:14})," Remove"]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Question"}),e.jsx("input",{type:"text",value:s.question,onChange:l=>w(t,{question:l.target.value}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"Enter the customer's question"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Answer"}),e.jsx("textarea",{value:s.answer,onChange:l=>w(t,{answer:l.target.value}),rows:3,className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"Provide the assistant's response"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Display Order"}),e.jsx("input",{type:"number",value:s.order??t,onChange:l=>w(t,{order:Number(l.target.value)}),min:0,className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200"})]})]},s._id||t))})]})]}),e.jsxs("footer",{className:"px-6 py-4 border-t border-slate-100 flex items-center justify-end gap-3 bg-slate-50",children:[e.jsx("button",{onClick:y,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold text-slate-600 border border-slate-200 hover:bg-white",children:"Cancel"}),e.jsxs("button",{onClick:G,disabled:T,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:[T?e.jsx(q,{size:16,className:"animate-spin"}):e.jsx(re,{size:16})," ","Save Changes"]})]})]})})]})};export{we as default};
