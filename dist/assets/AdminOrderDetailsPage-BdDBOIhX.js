import{r as c,j as e,m as me}from"./vendor-2d1PFKo4.js";import{S as xe}from"./Sidebar-Blgfai62.js";import{N as Ae}from"./Navbar-K_t1OsQh.js";import{i as Ce,u as Ie,I as De,_ as _e,J as f,as as Pe,a3 as Te,a as Oe,aD as Ue}from"./index-Bpx0OnSg.js";import{u as Le}from"./useSocket-CVoj3p5S.js";import{L as C}from"./loader-circle-DRAKHMK_.js";import{A as pe}from"./arrow-left-fjWLrcm4.js";import{D as Ee}from"./download-D5r73ZfU.js";import{P as $e}from"./package-check-Bzx6Kak-.js";import{C as ze}from"./credit-card-BgETEGky.js";import{R as Fe,C as Be}from"./receipt-DMCEhblB.js";import"./react-BzrpNAyj.js";import"./house-Bx4yg0fx.js";import"./ticket-percent-OJlGKFU7.js";import"./package-C_UWcLgd.js";import"./shopping-bag-Dv9EZFsL.js";import"./log-out-BEyQjTNl.js";const Me={processing:{label:"Processing",badge:"bg-amber-100 text-amber-700"},confirmed:{label:"Confirmed",badge:"bg-blue-100 text-blue-700"},shipped:{label:"Shipped",badge:"bg-sky-100 text-sky-700"},out_for_delivery:{label:"Out for Delivery",badge:"bg-indigo-100 text-indigo-700"},delivered:{label:"Delivered",badge:"bg-emerald-100 text-emerald-700"},returned:{label:"Return/Replace",badge:"bg-rose-100 text-rose-700"}},Qe=[{value:"approved",label:"Approved"},{value:"pickup_completed",label:"Pickup completed"},{value:"replacement_processing",label:"Replacement processing"},{value:"replacement_shipped",label:"Replacement shipped"},{value:"replacement_out_for_delivery",label:"Out for delivery"},{value:"replacement_delivered",label:"Replacement delivered"},{value:"rejected",label:"Rejected"},{value:"cancelled",label:"Cancelled"}],u=new Set(["rejected"]),b=d=>(Number.isFinite(Number(d))?Number(d):0).toLocaleString("en-IN",{style:"currency",currency:"INR"}),I=(d,h="--")=>{if(!d)return h;const i=new Date(d);return Number.isNaN(i.getTime())?h:i.toLocaleString()},Ge=(d,h="--")=>{if(!d)return h;const i=new Date(d);return Number.isNaN(i.getTime())?h:i.toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},ds=()=>{var M,Q,G,J,W,H,K,V,k,X,Y,Z,ee,se,te,ae,le,re,ne,ie,ce,de,oe;const{orderId:d}=Ce(),h=Ie(),{user:i,logout:ue}=De(),[he,j]=c.useState(!1),[s,fe]=c.useState(null),[be,D]=c.useState(!0),[_,P]=c.useState(null),[T,O]=c.useState(!1),[n,y]=c.useState({status:"approved",notes:"",courier:"",trackingId:""}),[U,L]=c.useState(!1),w=c.useRef(null),ge=c.useMemo(()=>"http://localhost:5001/api".replace(/\/?api\/?$/,""),[]),je=c.useMemo(()=>!1,[]),E=Le(ge,{withCredentials:!0,enabled:je}),N=c.useCallback(async()=>{var t,a;try{D(!0),P(null);const l=await _e(d),r=l==null?void 0:l.data;if(!r)throw new Error("Order not found");fe(r),r.replacementRequest&&r.replacementRequest.status!=="none"&&y(o=>{var g,p;return{...o,status:"approved",notes:"",courier:((g=r.replacementRequest.replacementShipment)==null?void 0:g.courier)||"",trackingId:((p=r.replacementRequest.replacementShipment)==null?void 0:p.trackingId)||""}})}catch(l){console.error("Failed to load order",l);const r=((a=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:a.message)||l.message||"Failed to load order";P(r),f.error(r)}finally{D(!1)}},[d]);c.useEffect(()=>{N()},[N]),c.useEffect(()=>{const t=E.current;if(!t||!d)return;const a="admin:orders",l=(r={})=>{const o=r.id||r._id;o&&String(o)===String(d)&&N()};return t.emit("joinRoom",a),t.on("order:updated",l),t.on("order:created",l),t.on("order:deleted",l),()=>{t.emit("leaveRoom",a),t.off("order:updated",l),t.off("order:created",l),t.off("order:deleted",l)}},[E,d,N]);const $=()=>{h("/admin/orders")},R=(t,a)=>{y(l=>({...l,[t]:a}))};c.useEffect(()=>{var t;u.has(n.status)&&(y(a=>({...a,notes:a.notes||""})),(t=w.current)==null||t.focus())},[n.status]);const z=t=>{y(a=>({...a,status:t,notes:u.has(t)?"":a.notes})),u.has(t)&&setTimeout(()=>{var a;(a=w.current)==null||a.focus(),f("Add a reason before submitting your decision.")},0)},Ne=async t=>{var a,l,r,o,g,p;if(t.preventDefault(),!!(s!=null&&s._id)){if(u.has(n.status)&&!(n.notes&&n.notes.trim())){f.error("Please provide a reason for rejecting this request."),(a=w.current)==null||a.focus();return}try{L(!0);const m={status:n.status,notes:((l=n.notes)==null?void 0:l.trim())||void 0,courier:((r=n.courier)==null?void 0:r.trim())||void 0,trackingId:((o=n.trackingId)==null?void 0:o.trim())||void 0},x=await Ue(s._id,m);if(!(x!=null&&x.success))throw new Error((x==null?void 0:x.message)||"Failed to update request");f.success("Replacement request updated"),await N()}catch(m){console.error("Failed to update replacement request",m);const x=((p=(g=m==null?void 0:m.response)==null?void 0:g.data)==null?void 0:p.message)||(m==null?void 0:m.message)||"Unable to update replacement request";f.error(x)}finally{L(!1)}}},S=(((M=s==null?void 0:s.payment)==null?void 0:M.status)||"pending").toLowerCase()==="paid",ve=async()=>{var t,a,l;if(!(s!=null&&s._id)){f.error("Order details unavailable");return}if(!S){f.error("Invoice will be available once the payment is successful.");return}O(!0);try{const r=await Oe.get(`/orders/${s._id}/invoice`,{responseType:"blob",headers:{Accept:"application/pdf"}}),o=r.data,p=(((t=r.headers)==null?void 0:t["content-disposition"])||"").match(/filename="?([^";]+)"?/i),m=(p==null?void 0:p[1])||`invoice-${s._id}.pdf`,x=window.URL.createObjectURL(o),v=document.createElement("a");v.href=x,v.download=m,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(x)}catch(r){console.error("Invoice download failed",r);const o=((l=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:l.message)||(r==null?void 0:r.message)||"Unable to download invoice. Please try again.";f.error(o)}finally{O(!1)}},ye=c.useMemo(()=>{const t=String((s==null?void 0:s.status)||"").toLowerCase(),a=Me[t];return a?e.jsx("span",{className:`inline-flex rounded-full px-3 py-1 text-xs font-medium ${a.badge}`,children:a.label}):e.jsx("span",{className:"inline-flex rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-600",children:"Unknown"})},[s==null?void 0:s.status]),we=c.useMemo(()=>Ge(s==null?void 0:s.estimatedDeliveryDate),[s==null?void 0:s.estimatedDeliveryDate]),Re=((Q=s==null?void 0:s.pricing)==null?void 0:Q.subtotal)??0,Se=((G=s==null?void 0:s.pricing)==null?void 0:G.shippingFee)??0,qe=((J=s==null?void 0:s.pricing)==null?void 0:J.taxAmount)??0,ke=((W=s==null?void 0:s.pricing)==null?void 0:W.discount)??0,F=((H=s==null?void 0:s.pricing)==null?void 0:H.total)??0,q=s==null?void 0:s.coupon,B=typeof(q==null?void 0:q.code)=="string"?q.code.trim():"",A=Array.isArray(s==null?void 0:s.items)?s.items:[];return be?e.jsxs("div",{className:"flex h-screen items-center justify-center bg-slate-50 text-slate-500",children:[e.jsx(C,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-3 text-sm",children:"Loading order details..."})]}):_||!s?e.jsx("div",{className:"flex h-screen flex-col items-center justify-center bg-slate-50 text-center text-slate-600",children:e.jsxs("div",{className:"rounded-3xl bg-white px-8 py-10 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Order not available"}),e.jsx("p",{className:"mt-2 text-sm text-slate-500",children:_||"The requested order could not be found."}),e.jsxs("button",{type:"button",onClick:$,className:"mt-6 inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700",children:[e.jsx(pe,{className:"h-4 w-4"}),"Back to orders"]})]})}):e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:e.jsxs("div",{className:"flex min-h-screen flex-col md:flex-row",children:[e.jsx(xe,{active:"Orders",className:"hidden md:flex md:w-64",onNavigate:()=>j(!1)}),he&&e.jsxs("div",{className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx("button",{type:"button","aria-label":"Close sidebar",onClick:()=>j(!1),className:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm"}),e.jsx("div",{className:"relative z-50 h-full w-72 max-w-[85%] origin-left animate-slide-in bg-white shadow-2xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-6 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Navigation"}),e.jsx("button",{type:"button",onClick:()=>j(!1),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600","aria-label":"Close navigation",children:"✕"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(xe,{active:"Orders",className:"flex w-full md:hidden",onNavigate:()=>j(!1)})})]})})]}),e.jsxs("div",{className:"flex w-full flex-1 flex-col",children:[e.jsx(Ae,{onToggleSidebar:()=>j(t=>!t),showRangeSelector:!1,showNotifications:!1,adminName:(i==null?void 0:i.name)||(i==null?void 0:i.username)||"Admin",adminRole:(i==null?void 0:i.role)==="admin"?"Administrator":i==null?void 0:i.role,onLogout:ue}),e.jsx("main",{className:"flex-1 overflow-y-auto px-4 py-6 sm:px-8 sm:py-8",children:e.jsxs("div",{className:"mx-auto max-w-5xl space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("button",{type:"button",onClick:$,className:"inline-flex items-center gap-2 text-sm text-slate-500 transition hover:text-slate-700",children:[e.jsx(pe,{className:"h-4 w-4"})," Back to orders"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:ve,disabled:T||!S,className:"inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",title:S?void 0:"Invoice will be available once the payment is successful.",children:[T?e.jsx(C,{className:"h-4 w-4 animate-spin"}):e.jsx(Ee,{className:"h-4 w-4"}),S?"Download invoice":"Invoice locked"]}),s.replacementRequest&&s.replacementRequest.status&&s.replacementRequest.status!=="none"&&e.jsx(me.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"rounded-3xl border border-primary/20 bg-primary/5 p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-primary",children:"Return & Replace request"}),e.jsxs("p",{className:"text-xs text-primary/70",children:["Requested on"," ",I(s.replacementRequest.requestedAt)]})]}),e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-primary/30 bg-white px-3 py-1 text-xs font-medium text-primary",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-primary"}),s.replacementRequest.status.replace(/_/g," ")]})]})})]})]}),e.jsxs(me.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-slate-500",children:["Order #",s._id]}),e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:((K=s.shippingAddress)==null?void 0:K.fullName)||"Customer"}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Placed on ",I(s.createdAt)]})]}),ye]}),e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx($e,{className:"h-5 w-5"})," Items"]}),e.jsx("p",{className:"mt-2 text-xl font-semibold text-slate-900",children:A.length||0})]}),e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx(ze,{className:"h-5 w-5"})," Payment"]}),e.jsx("p",{className:"mt-2 text-xl font-semibold text-slate-900",children:((X=(k=(V=s.payment)==null?void 0:V.method)==null?void 0:k.toUpperCase)==null?void 0:X.call(k))||"--"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Status: ",((Y=s.payment)==null?void 0:Y.status)||"--"]})]}),e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx(Pe,{className:"h-5 w-5"})," Delivery"]}),e.jsx("p",{className:"mt-2 text-base font-semibold text-slate-900",children:we})]}),e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx(Fe,{className:"h-5 w-5"})," Total"]}),e.jsx("p",{className:"mt-2 text-xl font-semibold text-slate-900",children:b(F)})]})]})]}),e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Order items"}),e.jsxs("div",{className:"mt-4 divide-y divide-slate-200",children:[A.map((t,a)=>e.jsxs("div",{className:"flex flex-col gap-4 py-4 sm:flex-row",children:[e.jsxs("div",{className:"flex items-center gap-4 sm:w-1/2",children:[e.jsx("div",{className:"h-16 w-16 overflow-hidden rounded-xl bg-slate-100",children:t.image?e.jsx("img",{src:t.image,alt:t.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs text-slate-400",children:"No image"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:t.name}),t.size&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Size: ",t.size]})]})]}),e.jsxs("div",{className:"flex flex-1 flex-wrap items-center gap-3 text-sm text-slate-600",children:[e.jsxs("span",{children:["Qty: ",t.quantity]}),e.jsxs("span",{children:["Price: ",b(t.price)]}),e.jsxs("span",{children:["Total: ",b(t.price*t.quantity)]}),t.ratedAt&&e.jsxs("span",{className:"rounded-full bg-emerald-100 px-3 py-1 text-xs text-emerald-700",children:["Rated ",t.rating??0,"/5"]})]})]},`${t.product||t.name}-${a}`)),A.length===0&&e.jsx("div",{className:"py-8 text-center text-sm text-slate-500",children:"No items recorded for this order."})]})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Delivery address"}),e.jsx("div",{className:"mt-4 space-y-2 text-sm text-slate-600",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 rounded-full bg-blue-50 p-2 text-blue-600",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:(Z=s.shippingAddress)==null?void 0:Z.fullName}),e.jsx("p",{children:(ee=s.shippingAddress)==null?void 0:ee.addressLine}),e.jsxs("p",{children:[(se=s.shippingAddress)==null?void 0:se.city,","," ",(te=s.shippingAddress)==null?void 0:te.state," -"," ",(ae=s.shippingAddress)==null?void 0:ae.pincode]}),e.jsxs("p",{children:["Mobile: ",(le=s.shippingAddress)==null?void 0:le.mobile]}),((re=s.shippingAddress)==null?void 0:re.alternatePhone)&&e.jsxs("p",{children:["Alternate: ",s.shippingAddress.alternatePhone]}),e.jsxs("p",{children:["Email: ",(ne=s.shippingAddress)==null?void 0:ne.email]})]})]})})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Payment summary"}),B&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-600",children:["Coupon: ",B]})]}),e.jsxs("div",{className:"mt-4 space-y-3 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:b(Re)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:b(Se)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:b(qe)})]}),e.jsxs("div",{className:"flex items-center justify-between text-emerald-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-",b(ke)]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-200 pt-3 text-base font-semibold text-slate-900",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:b(F)})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Transaction ID: ",((ie=s.payment)==null?void 0:ie.transactionId)||"--"]})]})]})]}),s.replacementRequest&&s.replacementRequest.status&&s.replacementRequest.status!=="none"&&e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Return & Replace request"}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>z("approved"),className:"inline-flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs font-semibold text-emerald-700 hover:bg-emerald-100",children:"Approve request"}),e.jsx("button",{type:"button",onClick:()=>z("rejected"),className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs font-semibold text-rose-700 hover:bg-rose-100",children:"Reject request"})]}),e.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsx("h3",{className:"text-sm font-semibold text-primary",children:"Item details"}),e.jsxs("p",{className:"font-medium text-slate-900",children:[s.replacementRequest.itemName,s.replacementRequest.itemSize&&` • Size ${s.replacementRequest.itemSize}`]}),e.jsxs("p",{children:["Quantity: ",s.replacementRequest.quantity||1]}),s.replacementRequest.issueDescription&&e.jsx("p",{className:"rounded-xl border border-primary/20 bg-white p-3 text-sm text-slate-700",children:s.replacementRequest.issueDescription})]}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsx("h3",{className:"text-sm font-semibold text-primary",children:"Replacement preferences"}),e.jsxs("p",{children:["Size:"," ",((ce=s.replacementRequest.replacementPreferences)==null?void 0:ce.size)||"--"]}),e.jsxs("p",{children:["Color:"," ",((de=s.replacementRequest.replacementPreferences)==null?void 0:de.color)||"--"]}),e.jsxs("p",{children:["Notes:"," ",((oe=s.replacementRequest.replacementPreferences)==null?void 0:oe.remarks)||"--"]}),s.replacementRequest.adminNotes&&e.jsxs("p",{className:"rounded-xl border border-emerald-200 bg-emerald-50 p-3 text-sm text-emerald-700",children:["Admin notes: ",s.replacementRequest.adminNotes]})]})]}),e.jsxs("form",{className:"mt-6 grid gap-4 md:grid-cols-[1fr_1fr]",onSubmit:Ne,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:"Update status"}),e.jsx("select",{value:n.status,onChange:t=>R("status",t.target.value),className:"w-full rounded-xl border border-primary/30 px-3 py-2 text-sm focus:border-primary focus:outline-none",required:!0,children:Qe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:"Courier (optional)"}),e.jsx("input",{value:n.courier,onChange:t=>R("courier",t.target.value),className:"w-full rounded-xl border border-primary/30 px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"e.g. Delhivery"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:"Tracking ID (optional)"}),e.jsx("input",{value:n.trackingId,onChange:t=>R("trackingId",t.target.value),className:"w-full rounded-xl border border-primary/30 px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"e.g. AWB123456"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:"Notes for customer"}),e.jsx("textarea",{value:n.notes,onChange:t=>R("notes",t.target.value),rows:3,ref:w,required:u.has(n.status),className:`w-full rounded-xl border px-3 py-2 text-sm focus:border-primary focus:outline-none ${u.has(n.status)?"border-rose-200":"border-primary/30"}`,placeholder:u.has(n.status)?"Explain why you are rejecting this request.":"Share updates or next actions (optional)."}),u.has(n.status)?e.jsx("p",{className:"text-xs text-rose-500",children:"A reason is required when rejecting."}):e.jsx("p",{className:"text-xs text-slate-500",children:"Optional message shared with the customer."})]}),e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-3 md:col-span-2",children:e.jsx("button",{type:"submit",disabled:U||u.has(n.status)&&!(n.notes&&n.notes.trim()),className:"inline-flex items-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-primary-dark disabled:cursor-not-allowed disabled:opacity-60",children:U?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4 animate-spin"})," ","Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-4 w-4"})," Update request"]})})})]})]}),Array.isArray(s.replacementRequest.history)&&s.replacementRequest.history.length>0&&e.jsxs("div",{className:"mt-6 rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-slate-800",children:"Activity log"}),e.jsx("ul",{className:"space-y-2 text-xs text-slate-600",children:s.replacementRequest.history.slice().reverse().map((t,a)=>{var l;return e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-0.5 inline-flex h-2 w-2 rounded-full bg-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-800",children:((l=t.status)==null?void 0:l.replace(/_/g," "))||"Update"}),e.jsx("p",{children:t.note||"Status updated"}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:[I(t.at),t.actor?` • by ${t.actor}`:""]})]})]},`${t.at||a}-${t.status}`)})})]})]})})]})]})})};export{ds as default};
