import{r,j as e,m as me}from"./vendor-2d1PFKo4.js";import{c as Z,i as xe,k as pe,u as he,z as ue,w as ge,J as d,_ as je}from"./index-Bpx0OnSg.js";import{P as fe}from"./package-check-Bzx6Kak-.js";import{D as ye}from"./download-D5r73ZfU.js";import"./react-BzrpNAyj.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ne=Z("circle-check-big",be);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],ve=Z("timer",we),Ae=()=>{var S,D,L,I,C,A,O,E,$,T,P,_,R,U,z,m,F,M,x,B,q,p,G,J,h,Q,V,u,W,Y,g,H,K;const{orderId:n}=xe(),o=pe(),c=he(),f=ue(),[s,ee]=r.useState(((S=o.state)==null?void 0:S.order)||null),[se,y]=r.useState(!((D=o.state)!=null&&D.order)&&!!n),[b,te]=r.useState(null),[N,w]=r.useState(!1),[ae,re]=r.useState(8),ie=r.useMemo(()=>{const t="http://localhost:5001/api";{const a=t.replace(/\/$/,"");return a.endsWith("/api")?a:`${a}/api`}},[]);r.useEffect(()=>{f(ge("confirmation"))},[f]),r.useEffect(()=>{(async()=>{if(!(!n||s))try{y(!0);const a=await je(n),i=a==null?void 0:a.data;if(!i)throw new Error("Order not found");ee(i)}catch(a){console.error("Failed to load order",a),te(a.message||"Failed to load order"),d.error(a.message||"Failed to load order")}finally{y(!1)}})()},[n,s]),r.useEffect(()=>{var t;!n&&!((t=o.state)!=null&&t.order)&&d("Showing your latest order",{icon:"ℹ️"})},[n,(L=o.state)==null?void 0:L.order]),r.useEffect(()=>{if(!s)return;const t=window.setInterval(()=>{re(a=>a<=1?(c("/",{replace:!0}),0):a-1)},1e3);return()=>window.clearInterval(t)},[s,c]);const v=()=>c("/orders"),ne=()=>c("/shop"),de=async()=>{if(!(s!=null&&s._id)){d.error("Order details unavailable");return}w(!0);let t=null;try{t=d.loading("Downloading invoice...",{duration:1e4,position:"top-center"});const a=localStorage.getItem("authToken"),i=await fetch(`${ie}/orders/${s._id}/invoice`,{method:"GET",headers:{...a?{Authorization:`Bearer ${a}`}:{}},credentials:"include"});if(!i.ok){const ce=await i.text();throw new Error(ce||"Failed to download invoice")}const le=await i.blob(),j=(i.headers.get("content-disposition")||"").match(/filename="?([^";]+)"?/i),oe=(j==null?void 0:j[1])||`invoice-${s._id}.pdf`,X=window.URL.createObjectURL(le),l=document.createElement("a");l.href=X,l.download=oe,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(X),d.success("Invoice downloaded.",{id:t,duration:4e3,position:"top-center"})}catch(a){console.error("Invoice download failed",a),d.error((a==null?void 0:a.message)||"Invoice download failed.",{id:t||void 0,duration:4e3,position:"top-center"})}finally{w(!1)}};if(se)return e.jsx("div",{className:"p-10 text-center text-medium-text",children:"Fetching your order details..."});if(b)return e.jsxs("div",{className:"p-10 text-center space-y-4",children:[e.jsx("p",{className:"text-lg text-secondary font-semibold",children:"Unable to load order"}),e.jsx("p",{className:"text-medium-text",children:b}),e.jsx("button",{onClick:v,className:"px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary-dark",children:"View My Orders"})]});if(!s)return null;const k=s.estimatedDeliveryDate?new Date(s.estimatedDeliveryDate).toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"To be updated";return e.jsxs("div",{className:"grid lg:grid-cols-[2fr,1fr] gap-0",children:[e.jsxs("div",{className:"p-6 lg:p-10 space-y-8",children:[e.jsxs(me.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-3xl border border-green-200 bg-green-50 p-6 flex gap-4 items-start",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-white text-green-600 flex items-center justify-center shadow-md",children:e.jsx(Ne,{className:"h-7 w-7"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Order placed successfully!"}),e.jsxs("p",{className:"text-sm text-medium-text mt-1",children:["Your order ID is ",e.jsxs("span",{className:"font-medium",children:["#",s._id]}),". A confirmation email has been sent to"," ",(I=s.shippingAddress)==null?void 0:I.email,"."]}),e.jsxs("p",{className:"text-xs text-emerald-600 mt-2",children:["Redirecting you to the home page in ",ae," seconds."]})]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("section",{className:"border border-slate-200 rounded-3xl p-6",children:[e.jsxs("header",{className:"flex items-center gap-3 mb-4 text-secondary",children:[e.jsx(fe,{className:"h-5 w-5"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Order Timeline"})]}),e.jsxs("ul",{className:"space-y-3 text-sm text-medium-text",children:[(C=s.statusTimeline)==null?void 0:C.map((t,a)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 h-2 w-2 rounded-full bg-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary",children:t.label}),t.description&&e.jsx("p",{children:t.description}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:t.at?new Date(t.at).toLocaleString():"--"})]})]},`${t.label}-${a}`)),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 h-2 w-2 rounded-full bg-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary",children:"Estimated delivery"}),e.jsx("p",{children:k})]})]})]})]}),e.jsxs("section",{className:"border border-slate-200 rounded-3xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary mb-4",children:"Items in this order"}),e.jsx("div",{className:"space-y-4",children:(A=s.items)==null?void 0:A.map((t,a)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-20 w-20 rounded-xl bg-slate-100 flex items-center justify-center overflow-hidden border border-slate-200",children:e.jsx("img",{src:t.image,alt:t.name,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-secondary",children:t.name}),e.jsxs("p",{className:"text-sm text-medium-text mt-1",children:["Qty: ",t.quantity,t.size&&` • Size: ${t.size}`]}),e.jsxs("p",{className:"text-sm text-medium-text mt-1",children:["Price: ₹",t.price.toLocaleString()," • Line Total: ₹",(t.price*t.quantity).toLocaleString()]})]})]},`${t.name}-${a}`))})]}),e.jsxs("section",{className:"border border-slate-200 rounded-3xl p-6 grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary mb-3",children:"Delivery Address"}),e.jsxs("div",{className:"space-y-1 text-sm text-medium-text",children:[e.jsx("p",{className:"font-medium text-secondary",children:(O=s.shippingAddress)==null?void 0:O.fullName}),e.jsx("p",{children:(E=s.shippingAddress)==null?void 0:E.addressLine}),e.jsxs("p",{children:[($=s.shippingAddress)==null?void 0:$.city,", ",(T=s.shippingAddress)==null?void 0:T.state," ","- ",(P=s.shippingAddress)==null?void 0:P.pincode]}),e.jsxs("p",{children:["Mobile: ",(_=s.shippingAddress)==null?void 0:_.mobile]}),((R=s.shippingAddress)==null?void 0:R.alternatePhone)&&e.jsxs("p",{children:["Alternate: ",s.shippingAddress.alternatePhone]}),e.jsxs("p",{children:["Email: ",(U=s.shippingAddress)==null?void 0:U.email]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary mb-3",children:"Payment Summary"}),e.jsxs("ul",{className:"space-y-2 text-sm text-medium-text",children:[e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",(F=(m=(z=s.pricing)==null?void 0:z.subtotal)==null?void 0:m.toLocaleString)==null?void 0:F.call(m)]})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",(B=(x=(M=s.pricing)==null?void 0:M.shippingFee)==null?void 0:x.toLocaleString)==null?void 0:B.call(x)]})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsxs("span",{children:["₹",(G=(p=(q=s.pricing)==null?void 0:q.taxAmount)==null?void 0:p.toLocaleString)==null?void 0:G.call(p)]})]}),e.jsxs("li",{className:"flex justify-between text-success font-medium",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",(Q=(h=(J=s.pricing)==null?void 0:J.discount)==null?void 0:h.toLocaleString)==null?void 0:Q.call(h)]})]}),e.jsxs("li",{className:"flex justify-between text-base font-semibold text-secondary border-t border-slate-200 pt-3",children:[e.jsx("span",{children:"Total Paid"}),e.jsxs("span",{children:["₹",(W=(u=(V=s.pricing)==null?void 0:V.total)==null?void 0:u.toLocaleString)==null?void 0:W.call(u)]})]}),e.jsxs("li",{className:"text-xs text-slate-400 pt-1",children:["Method: ",(H=(g=(Y=s.payment)==null?void 0:Y.method)==null?void 0:g.toUpperCase)==null?void 0:H.call(g)," • Status:"," ",(K=s.payment)==null?void 0:K.status]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-end",children:[e.jsx("button",{onClick:ne,className:"px-5 py-3 rounded-xl border border-slate-200 text-secondary hover:bg-slate-50",children:"Continue Shopping"}),e.jsx("button",{onClick:v,className:"px-5 py-3 rounded-xl bg-secondary text-white hover:bg-secondary/90",children:"Go to My Orders"}),e.jsxs("button",{type:"button",onClick:de,disabled:N,className:"px-5 py-3 rounded-xl bg-primary text-white hover:bg-primary-dark disabled:opacity-60 disabled:cursor-not-allowed inline-flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),N?"Preparing Invoice...":"Download Invoice"]})]})]}),e.jsxs("aside",{className:"bg-white border-l border-slate-100 p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-secondary",children:[e.jsx(ve,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Estimated Delivery"}),e.jsx("p",{className:"text-sm text-medium-text",children:k})]})]}),e.jsx("div",{className:"rounded-2xl bg-primary/5 border border-primary/20 p-4 text-sm text-medium-text",children:"Need help with your order? Our support team is available 24/7 at support@p2pdeal.net."})]})]})};export{Ae as default};
