import{r as x,j as e,m as ee}from"./vendor-2d1PFKo4.js";import{u as le,k as de,z as xe,B as F,n as z,C as _,D as fe,E as ue,F as k,o as D,G as s,m as me,H as se,s as pe,w as he}from"./index-Bpx0OnSg.js";import{L as M}from"./loader-circle-DRAKHMK_.js";import"./react-BzrpNAyj.js";const we=()=>{var K,X;const te=le(),$=de(),n=xe(),{items:a,totals:m,appliedCoupon:r,qrfolioUpload:i}=F(t=>t.checkout),G=F(t=>t.checkout.qrfolioRequired),W=F(t=>t.checkout.couponRequired),H=F(t=>t.coupon),[v]=x.useState(0),[I,N]=x.useState((r==null?void 0:r.code)||""),[R,Q]=x.useState(()=>i?i.previewUrl?i.previewUrl:i.imageUrl?i.imageUrl:null:null),[L,p]=x.useState(""),[V,C]=x.useState(!1),j=!!(r!=null&&r.isQrfolioCoupon);r!=null&&r.isQrfolioCoupon&&((K=r==null?void 0:r.code)!=null&&K.trim());const Y=!!((X=r==null?void 0:r.code)!=null&&X.trim()),y=x.useMemo(()=>z(a,{shippingFee:v,discount:m.discount,currency:m.currency}),[a,v,m.discount,m.currency]),S=x.useMemo(()=>a.reduce((t,o)=>t+Number(o.price||0)*Number(o.quantity||0),0),[a]),U=H.status==="loading",q=H.error,P=x.useCallback(async(t,{silent:o=!1,itemsOverride:d}={})=>{const f=String(t||"").trim().toUpperCase();if(!f){o||_.error("Enter a coupon code");return}const u=Array.isArray(d)?d:a,w=u.reduce((b,g)=>b+Number(g.price||0)*Number(g.quantity||0),0),A=u.map(b=>({product:b.product||b.id||b._id,price:Number(b.price)||0,quantity:Number(b.quantity)||0})),c=await n(fe({code:f,orderAmount:w,items:A})).unwrap();n(ue({code:c.code,type:c.type,discountType:c.discountType,discountValue:c.discountValue,discountAmount:c.discountAmount,isQrfolioCoupon:!!c.isQrfolioCoupon})),c.isQrfolioCoupon&&c.qrfolio?n(k({imageUrl:c.qrfolio.imageUrl||c.qrfolio.link||null,link:c.qrfolio.link||null,name:c.qrfolio.name||null})):n(k(null));const h=z(u,{shippingFee:v,discount:c.discountAmount,currency:m.currency}),E=w+h.shippingFee+h.taxAmount;n(D({...h,baseSubtotal:w,baseTotal:E})),o||_.success("Coupon applied")},[n,a,v,m.currency]);x.useEffect(()=>{N((r==null?void 0:r.code)||"")},[r==null?void 0:r.code]),x.useEffect(()=>{if(!i){Q(null);return}const t=i.previewUrl||i.imageUrl||null;Q(t),t&&p("")},[i]);const re=()=>{if(W&&!Y){_.error("Please apply a valid coupon code before continuing.");return}if(G&&!(i&&!!(typeof i.dataUrl=="string"&&i.dataUrl.trim()||typeof i.imageUrl=="string"&&i.imageUrl.trim()))){const o="Please upload your QRfolio QR code before continuing.";p(o),_.error(o);return}n(D({...y,baseSubtotal:S,baseTotal:S+y.shippingFee+y.taxAmount})),n(he("address")),te("/checkout/address")},J=x.useCallback(()=>{Q(null),p(""),n(k(null))},[n]),oe=x.useCallback(t=>{var f;const o=(f=t.target.files)==null?void 0:f[0];if(!o)return;if(!o.type.startsWith("image/")){p("Please upload a valid image file");return}if(o.size>3*1024*1024){p("Image must be smaller than 3MB");return}C(!0),p("");const d=new FileReader;d.onload=()=>{const u=d.result;if(typeof u!="string"){p("Failed to read image. Please try again."),C(!1);return}Q(u),n(k({fileName:o.name,mimeType:o.type,dataUrl:u,previewUrl:u})),C(!1)},d.onerror=()=>{p("Unable to read the selected file"),C(!1)},d.readAsDataURL(o)},[n]),ae=x.useCallback(()=>{J()},[J]),ne=async()=>{try{await P(I,{silent:!1})}catch(t){const o=(t==null?void 0:t.message)||q||"Unable to apply coupon";_.error(o)}};x.useEffect(()=>{const t=new URLSearchParams($.search||""),o=(t.get("productId")||"").trim(),d=(t.get("coupon")||"").trim();if(!o)return;let f=!1;return(async()=>{var w,A,c;try{const h=((w=a==null?void 0:a[0])==null?void 0:w.product)||((A=a==null?void 0:a[0])==null?void 0:A.id)||((c=a==null?void 0:a[0])==null?void 0:c._id)||null,E=h?String(h).trim():"";if(!a.length||a.length!==1||E!==o){const g=await me(o),l=(g==null?void 0:g.data)||null;if(!l)return;const Z={id:l._id||l.mongoId||l.productId||o,product:l._id||l.mongoId||l.productId||o,name:l.name,image:l.image,price:Number(l.price)||0,quantity:1,gstRate:l.gstRate,hsnCode:l.hsnCode};if(f||(n(se()),n(k(null)),n(pe([Z]))),d){const ce=r!=null&&r.code?String(r.code).trim().toUpperCase():"",B=d.toUpperCase();ce!==B&&(f||N(B),await P(B,{silent:!0,itemsOverride:[Z]}))}return}if(d){const g=r!=null&&r.code?String(r.code).trim().toUpperCase():"",l=d.toUpperCase();g!==l&&(f||N(l),await P(l,{silent:!0}))}}catch(h){console.error("Failed to seed checkout from deep link",h)}})(),()=>{f=!0}},[P,r==null?void 0:r.code,n,a.length,$.search]);const ie=()=>{N(""),n(se());const t=z(a,{shippingFee:v,discount:0,currency:m.currency}),o=S+t.shippingFee+t.taxAmount;n(D({...t,baseSubtotal:S,baseTotal:o}))};if(!a.length)return e.jsx("div",{className:"p-8",children:e.jsx("p",{className:s("text-center","text-gray-500"),children:"No items in checkout."})});const O="rounded-3xl border border-[#dbe6ff] bg-white/90 p-6 sm:p-7 lg:p-8 shadow-[0_34px_80px_-48px_rgba(59,130,246,0.45)] backdrop-blur-sm",T="rounded-2xl border border-[#e5edff] bg-white/80 p-5 sm:p-6 shadow-[0_22px_40px_-28px_rgba(59,130,246,0.25)]";return e.jsx("div",{className:s("min-h-screen","overflow-x-hidden","bg-gradient-to-br","from-[#f2f7ff]","via-[#eef3ff]","to-[#f8fbff]","py-10","sm:py-12"),children:e.jsx("div",{className:s("mx-auto","w-full","max-w-6xl","px-3","sm:px-5","lg:px-8"),children:e.jsxs("div",{className:s("grid","grid-cols-1","gap-6","sm:gap-8","lg:grid-cols-[1.05fr,1fr]"),children:[e.jsxs("section",{className:`${O} space-y-6`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:s("text-xl","font-semibold","text-secondary"),children:"Redeem Coupon"}),e.jsx("p",{className:s("mt-1","text-sm","text-[#7b8bb4]"),children:"Confirm product details and pricing before continuing."})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:T,children:[e.jsx("h3",{className:s("text-sm","font-semibold","uppercase","tracking-wide","text-[#274287]"),children:"Price Details"}),e.jsx("p",{className:s("mt-1","text-xs","text-[#7b8bb4]"),children:"Apply your QRfolio referral code as a coupon code."}),e.jsxs("div",{className:s("mt-4","flex","flex-col","gap-3","sm:flex-row","sm:flex-wrap","sm:items-center","sm:gap-4"),children:[e.jsxs("div",{className:s("w-full","flex-1","min-w-0","sm:min-w-[200px]"),children:[e.jsx("label",{htmlFor:"checkout-order-coupon",className:"sr-only",children:"Coupon code"}),e.jsx("input",{id:"checkout-order-coupon",type:"text",value:I,onChange:t=>N(t.target.value.toUpperCase()),placeholder:"MEGA50",className:s("w-full","rounded-2xl","border","border-[#cfdcff]","bg-white","px-4","py-2.5","text-sm","font-semibold","uppercase","tracking-wide","text-[#1c2f63]","shadow-[0_8px_22px_-18px_rgba(37,99,235,0.65)]","transition","focus:border-[#4c7dff]","focus:outline-none","disabled:cursor-not-allowed","disabled:opacity-60"),disabled:U})]}),r!=null&&r.code?e.jsx("button",{type:"button",onClick:ie,className:s("inline-flex","w-full","items-center","justify-center","gap-2","rounded-2xl","border","border-[#fecdd3]","bg-[#fff1f2]","px-4","py-2.5","text-sm","font-semibold","text-[#d53f6a]","shadow-[0_12px_26px_-20px_rgba(225,29,72,0.55)]","transition","hover:bg-[#ffe4e6]","disabled:cursor-not-allowed","disabled:opacity-60","sm:w-auto"),disabled:U,children:"Remove"}):e.jsx("button",{type:"button",onClick:ne,className:s("inline-flex","w-full","items-center","justify-center","gap-2","rounded-2xl","bg-gradient-to-r","from-[#4c7dff]","via-[#3d6bed]","to-[#2451d8]","px-5","py-2.5","text-sm","font-semibold","text-white","shadow-[0_12px_30px_-16px_rgba(37,99,235,0.65)]","transition","hover:from-[#547fff]","hover:via-[#3b69ea]","hover:to-[#1f47c5]","disabled:cursor-not-allowed","disabled:opacity-60","sm:w-auto"),disabled:U||!I.trim(),children:U?e.jsx(M,{size:16,className:"animate-spin"}):"Apply"})]}),q&&!(r!=null&&r.code)&&e.jsx("p",{className:s("mt-3","text-xs","font-medium","text-[#d53f6a]"),children:q}),(r==null?void 0:r.code)&&e.jsxs("div",{className:s("mt-4","rounded-2xl","border","border-[#bbf7d0]","bg-[#f0fdf4]","px-4","py-3","text-xs","font-medium","text-[#047857]"),children:["Coupon applied successfully. Savings: ₹",Number(r.discountAmount||0).toLocaleString()]}),W&&!Y&&!q&&e.jsx("p",{className:s("mt-3","text-xs","font-medium","text-[#d97706]"),children:"Coupon code is required before continuing."})]}),G&&e.jsxs("div",{className:T,children:[e.jsx("h3",{className:s("text-sm","font-semibold","uppercase","tracking-wide","text-[#274287]"),children:"QRfolio QR Code"}),e.jsx("p",{className:s("mt-1","text-xs","text-[#7b8bb4]"),children:j?"Your QRfolio QR code is linked automatically from your QRfolio account.":"Upload your QRfolio QR code image."}),e.jsxs("div",{className:s("mt-5","space-y-4"),children:[!j&&e.jsxs("label",{htmlFor:"checkout-qrfolio-upload",className:s("flex","cursor-pointer","flex-col","items-center","justify-center","gap-3","rounded-3xl","border-2","border-dashed","border-[#ccdbff]","bg-[#f5f8ff]","p-6","sm:p-8","text-center","transition","hover:border-[#4c7dff]","hover:bg-[#ecf2ff]"),children:[e.jsx("div",{className:s("rounded-full","bg-white","p-4","shadow-[0_15px_35px_-20px_rgba(37,99,235,0.45)]"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:s("h-10","w-10","text-[#4c7dff]"),children:e.jsx("path",{d:"M12 5v14M5 12h14",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsxs("div",{children:[e.jsx("p",{className:s("text-sm","font-semibold","text-[#1b2f62]"),children:R?"Replace QR code":"Upload QR code"}),e.jsx("p",{className:s("mt-1","text-xs","text-[#7b8bb4]"),children:"PNG, JPG, or WEBP up to 3MB."})]}),e.jsx("input",{id:"checkout-qrfolio-upload",type:"file",accept:"image/*",className:"hidden",onChange:oe,disabled:V})]}),V&&e.jsxs("div",{className:s("flex","items-center","justify-center","gap-2","text-sm","text-[#1b2f62]"),children:[e.jsx(M,{className:s("h-4","w-4","animate-spin")}),e.jsx("span",{children:"Processing image…"})]}),L&&e.jsx("p",{className:s("text-center","text-xs","font-medium","text-[#d53f6a]"),children:L}),R&&e.jsxs("div",{className:s("flex","flex-col","gap-3","rounded-2xl","border","border-[#cfdcff]","bg-white/90","p-4","shadow-[0_18px_32px_-30px_rgba(37,99,235,0.35)]"),children:[e.jsxs("div",{className:s("flex","items-center","justify-between"),children:[e.jsx("div",{children:j?e.jsx("p",{className:s("text-sm","font-extrabold","tracking-tight","text-[#111827]"),children:"Your QRfolio QR Code"}):e.jsx("p",{className:s("text-xs","font-semibold","uppercase","tracking-wide","text-[#4c7dff]"),children:"Preview"})}),!j&&e.jsx("button",{type:"button",onClick:ae,className:s("text-xs","font-semibold","text-[#d53f6a]","hover:underline"),children:"Remove"})]}),e.jsx("div",{className:s("mt-2","flex","items-center","justify-center"),children:e.jsxs("div",{className:s("relative","inline-flex","flex-col","items-center"),children:[j&&e.jsx("p",{className:s("mb-3","text-base","font-extrabold","text-[#111827]"),children:(i==null?void 0:i.name)||"QRfolio Profile"}),e.jsxs("div",{className:s("relative","rounded-2xl","bg-white","p-3","shadow-[0_20px_45px_-26px_rgba(15,23,42,0.45)]"),children:[e.jsx("img",{src:R,alt:"QRfolio preview",className:s("h-56","w-56","rounded-2xl","border","border-[#dbe6ff]","bg-white","object-contain")}),j&&e.jsx("div",{className:s("pointer-events-none","absolute","left-1/2","top-1/2","-translate-x-1/2","-translate-y-1/2"),children:e.jsx("div",{className:s("flex","h-12","w-12","items-center","justify-center","rounded-2xl","border-2","border-white","bg-gradient-to-b","from-[#2563eb]","to-[#1d4ed8]","shadow-[0_18px_40px_-20px_rgba(37,99,235,0.9)]"),children:e.jsxs("span",{className:s("text-[10px]","font-semibold","leading-tight","tracking-wide","text-white","text-center"),children:["Qr",e.jsx("br",{}),"Folio"]})})})]})]})})]}),j&&!R&&!L&&e.jsxs("div",{className:s("flex","items-center","justify-center","gap-2","text-sm","text-[#1b2f62]"),children:[e.jsx(M,{className:s("h-4","w-4","animate-spin")}),e.jsx("span",{children:"Fetching your QRfolio QR code…"})]})]})]})]})]}),e.jsxs("section",{className:`${O} space-y-6`,children:[e.jsxs("div",{className:s("flex","flex-wrap","items-start","justify-between","gap-3"),children:[e.jsxs("div",{children:[e.jsx("h2",{className:s("text-xl","font-semibold","text-secondary"),children:"Review your order"}),e.jsx("p",{className:s("mt-1","text-sm","text-[#7b8bb4]"),children:"Confirm product details and pricing before continuing."})]}),e.jsx("span",{className:s("rounded-full","bg-[#eef3ff]","px-4","py-1","text-xs","font-semibold","uppercase","tracking-wide","text-[#3b5b99]"),children:"Step 1 of 4"})]}),e.jsx("div",{className:"space-y-5",children:a.map((t,o)=>e.jsxs(ee.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{delay:o*.05},className:s("flex","w-full","flex-col","gap-5","rounded-2xl","border","border-[#e3ebff]","bg-white/85","p-5","shadow-[0_18px_34px_-30px_rgba(37,99,235,0.35)]","md:flex-row"),children:[e.jsx("div",{className:s("flex","h-40","w-full","items-center","justify-center","overflow-hidden","rounded-2xl","border","border-[#e3ebff]","bg-[#f5f8ff]","md:w-40","lg:w-44"),children:e.jsx("img",{src:t.image,alt:t.name,className:s("max-h-full","max-w-full","object-contain"),onError:d=>{d.target.onerror=null,d.target.src="https://placehold.co/200x200/f1f5ff/d0d9ff?text=Image"}})}),e.jsxs("div",{className:s("flex-1","space-y-3"),children:[e.jsxs("div",{children:[e.jsx("h3",{className:s("text-lg","font-semibold","text-secondary"),children:t.name}),t.size&&e.jsxs("p",{className:s("mt-1","text-sm","uppercase","tracking-wide","text-[#7b8bb4]"),children:["Size: ",t.size]})]}),e.jsxs("div",{className:s("flex","flex-wrap","items-center","gap-3","text-sm","text-[#7b8bb4]"),children:[e.jsxs("span",{children:["Qty: ",t.quantity]}),e.jsx("span",{className:"text-[#c3ccea]",children:"|"}),e.jsxs("span",{children:["Unit Price: ₹",t.price.toLocaleString()]}),e.jsx("span",{className:"text-[#c3ccea]",children:"|"}),e.jsxs("span",{children:["Line Total: ₹",(t.price*t.quantity).toLocaleString()]})]}),e.jsx("p",{className:s("text-sm","text-[#a4b1d3]"),children:"returns within 7 days of delivery"})]})]},`${t.id}-${t.size||"default"}-${o}`))}),e.jsxs("div",{className:T,children:[e.jsx("h3",{className:s("text-sm","font-semibold","uppercase","tracking-wide","text-[#274287]"),children:"Price Details"}),e.jsxs("div",{className:s("mt-4","space-y-4","text-sm","text-[#516497]"),children:[e.jsxs("div",{className:s("flex","justify-between"),children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",y.subtotal.toLocaleString()]})]}),e.jsxs("div",{className:s("flex","justify-between"),children:[e.jsx("span",{children:"Shipping Fee"}),e.jsxs("span",{children:["₹",y.shippingFee.toLocaleString()]})]}),e.jsxs("div",{className:s("flex","justify-between"),children:[e.jsx("span",{children:"Tax"}),e.jsxs("span",{children:["₹",y.taxAmount.toLocaleString()]})]}),e.jsxs("div",{className:s("flex","justify-between"),children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",Number(m.discount||0).toLocaleString(void 0,{minimumFractionDigits:0})]})]}),e.jsxs("div",{className:s("flex","items-center","justify-between","border-t","border-[#dbe6ff]","pt-4","text-base","font-semibold","text-secondary"),children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",y.total.toLocaleString()]})]})]})]}),e.jsx(ee.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:re,className:s("w-full","rounded-2xl","bg-gradient-to-r","from-[#4c7dff]","via-[#3d6bed]","to-[#2451d8]","py-3","text-sm","font-semibold","text-white","shadow-[0_20px_45px_-22px_rgba(37,99,235,0.65)]","transition","hover:from-[#547fff]","hover:via-[#3b69ea]","hover:to-[#1f47c5]"),children:"Continue to Address"})]})]})})})};export{we as default};
