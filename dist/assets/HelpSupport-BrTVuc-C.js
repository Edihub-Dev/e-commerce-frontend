import{r as o,j as t}from"./vendor-2d1PFKo4.js";import{f as L}from"./helpSupportApi-BN0kerT7.js";import"./react-BzrpNAyj.js";import"./index-Bpx0OnSg.js";const R={sender:"bot",text:"Hi! I'm the p2pdeal assistant. Choose a topic below and I'll share the answers you need."},q=()=>{const[w,d]=o.useState([R]),[n,C]=o.useState([]),[p,m]=o.useState(null),[A,c]=o.useState(null),[H,x]=o.useState(0),[b,j]=o.useState(!1),[y,v]=o.useState(""),g=o.useRef(null),u=o.useRef([]),N=o.useMemo(()=>{const e=new Map;return n.forEach(a=>{e.set(a.id,a)}),e},[n]),i=p&&N.get(p)||null,$=o.useMemo(()=>i?[...i.items.map(e=>({type:"question",id:e.id,label:e.question,item:e})),{type:"back",id:"back-to-topics",label:"Back to all topics"}]:n.map(e=>({type:"category",id:e.id,label:e.category})),[i,n]);o.useEffect(()=>{g.current&&g.current.scrollTo({top:g.current.scrollHeight,behavior:"smooth"})},[w]),o.useEffect(()=>{let e=!0;return(async()=>{j(!0);try{const l=await L();if(!e)return;const f=(Array.isArray(l.data)?l.data:[]).filter(r=>r&&r.isActive!==!1).map(r=>({id:r.slug||r._id,category:r.title,description:r.description,items:Array.isArray(r.questions)?r.questions.filter(s=>(s==null?void 0:s.question)&&(s==null?void 0:s.answer)).map(s=>({id:s._id||s.question,question:s.question,answer:s.answer,order:s.order??0})):[],order:r.order??0,isActive:r.isActive!==!1,responseDelayMs:typeof r.responseDelayMs=="number"?Math.max(0,r.responseDelayMs):2e3})).filter(r=>{var s;return((s=r.category)==null?void 0:s.trim())&&r.items.length}).sort((r,s)=>{const h=r.order??0,I=s.order??0;return h-I});C(f),v("")}catch(l){if(console.error("Failed to load help topics",l),!e)return;v(l.message||"Failed to load help topics"),C([])}finally{e&&j(!1)}})(),()=>{e=!1}},[]);const k=e=>{const a=N.get(e);a&&(d(l=>[...l,{sender:"user",text:a.category},{sender:"bot",text:`Here are the top questions about ${a.category}. Pick one to learn more.`}]),m(a.id),c(null),x(0))};o.useEffect(()=>()=>{u.current.forEach(e=>clearTimeout(e)),u.current=[]},[]);const E=e=>{if(!i)return;const a=A===e.id,l=a?H+1:1,T=Math.max(0,i.responseDelayMs??2e3),f=`typing-${Date.now()}-${Math.random()}`;d(s=>[...s,{sender:"user",text:e.question},{sender:"bot",text:"Thinking...",tempId:f}]);const r=setTimeout(()=>{d(s=>{const h=s.findIndex(D=>D.tempId===f),M=[...h!==-1?[...s.slice(0,h),...s.slice(h+1)]:[...s],{sender:"bot",text:e.answer}];return a&&l>=2&&M.push({sender:"bot",text:"Let's revisit the main topics. Choose what you'd like help with."}),M}),a&&l>=2?(m(null),c(null),x(0)):(c(e.id),x(l)),u.current=u.current.filter(s=>s!==r)},T);u.current.push(r)},S=()=>{d(e=>[...e,{sender:"bot",text:"Sure, here are all the topics again. What can I help you with?"}]),m(null),c(null),x(0)},B=()=>{d([R]),m(null),c(null),x(0)};return t.jsx("div",{className:"min-h-[70vh] bg-gradient-to-b from-gray-50 via-white to-gray-100 py-12 md:py-16",children:t.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-10",children:t.jsxs("div",{className:"bg-white/95 backdrop-blur rounded-3xl shadow-2xl border border-gray-100 overflow-hidden",children:[t.jsxs("div",{className:"bg-[#008ECC] text-white px-6 sm:px-10 py-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold",children:"Help & Support"}),t.jsx("p",{className:"text-sm sm:text-base opacity-90 mt-1",children:"Your one-stop assistant for orders, returns, and payments."})]}),t.jsx("button",{onClick:B,className:"bg-white/15 hover:bg-white/25 transition-colors text-white text-xs sm:text-sm font-medium px-4 py-2 rounded-full",children:"Reset Chat"})]}),t.jsxs("div",{className:"grid lg:grid-cols-[1.8fr_1fr]",children:[t.jsxs("div",{className:"flex flex-col border-r border-gray-100 bg-white",children:[t.jsx("div",{ref:g,className:"h-[420px] md:h-[460px] overflow-y-auto px-6 sm:px-8 py-6 space-y-4 bg-gradient-to-b from-gray-50 to-white",children:w.map((e,a)=>t.jsx("div",{className:`flex ${e.sender==="user"?"justify-end":"justify-start"}`,children:t.jsx("div",{className:`max-w-[85%] rounded-2xl px-4 py-3 text-sm leading-relaxed shadow-sm ${e.sender==="user"?"bg-[#008ECC] text-white rounded-br-none":"bg-gray-100 text-gray-900 rounded-bl-none"}`,children:e.text})},a))}),t.jsxs("div",{className:"border-t border-gray-100 px-6 sm:px-8 py-5 bg-white",children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-400 mb-3",children:i?"Select a question":"Choose a topic"}),y&&!b&&!n.length?t.jsx("p",{className:"text-sm text-rose-500",children:y}):null,!y&&!b&&!n.length?t.jsx("p",{className:"text-sm text-gray-500",children:"Help topics will appear here once the admin adds them."}):null,t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[b&&!i?t.jsx("span",{className:"text-xs text-gray-500",children:"Loading topicsâ€¦"}):null,$.map(e=>e.type==="category"?t.jsx("button",{onClick:()=>k(e.id),className:"w-full text-xs sm:text-sm border border-[#008ECC] text-[#008ECC] hover:bg-[#008ECC] hover:text-white transition-all px-4 py-2 rounded-full shadow-sm",children:e.label},e.id):e.type==="question"&&e.item?t.jsx("button",{onClick:()=>E(e.item),className:"w-full text-xs sm:text-sm border border-[#008ECC] text-[#008ECC] hover:bg-[#008ECC] hover:text-white transition-all px-4 py-2 rounded-full shadow-sm",children:e.label},e.id):t.jsx("button",{onClick:S,className:"w-full text-xs sm:text-sm border border-gray-300 text-gray-600 hover:bg-gray-100 transition-all px-4 py-2 rounded-full shadow-sm",children:e.label},e.id))]})]})]}),t.jsx("aside",{className:"hidden lg:block bg-gradient-to-b from-white to-gray-50 px-6 py-8 space-y-8",children:n.map(e=>t.jsxs("div",{children:[t.jsx("button",{onClick:()=>k(e.id),className:`text-sm font-semibold uppercase tracking-wide mb-3 transition-colors ${p===e.id?"text-[#008ECC]":"text-gray-700 hover:text-[#008ECC]"}`,children:e.category}),p===e.id&&t.jsxs("ul",{className:"space-y-2 pl-1",children:[e.items.map(a=>t.jsx("li",{children:t.jsx("button",{onClick:()=>E(a),className:"text-sm text-left text-gray-600 hover:text-[#008ECC] transition-colors",children:a.question})},a.id)),t.jsx("li",{children:t.jsx("button",{onClick:S,className:"text-sm text-left text-gray-500 hover:text-gray-700 transition-colors",children:"Back to all topics"})})]})]},e.id))})]})]})})})};export{q as default};
