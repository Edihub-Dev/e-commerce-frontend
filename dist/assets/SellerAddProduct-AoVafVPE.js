import{r as b,j as e,m as J}from"./vendor-2d1PFKo4.js";import{C as p,aa as k,i as V,u as ee,bj as se,bk as te,bl as ae}from"./index-Bpx0OnSg.js";import{L as B}from"./loader-circle-DRAKHMK_.js";import{I as le}from"./image-o7Bv0ro0.js";import{C as I}from"./cloud-upload-CshyEAzQ.js";import{P as re}from"./plus-BZuZgauU.js";import"./react-BzrpNAyj.js";const oe=["S","M","L","XL","XXL"],ne=[{matcher:/keychain/i,hsnCode:"8305",gstRate:18},{matcher:/ceramic\s+coffee\s+mug|coffee\s+mug|mug/i,hsnCode:"6912",gstRate:12},{matcher:/executive\s+diary|pen\s+set/i,hsnCode:"4820",gstRate:18},{matcher:/white\s+logo\s+cap|cap/i,hsnCode:"6501",gstRate:18},{matcher:/diary/i,hsnCode:"4820",gstRate:18},{matcher:/\bpen\b/i,hsnCode:"9608",gstRate:18},{matcher:/t\s*-?shirt|polo/i,hsnCode:"6109",gstRate:5}],ie=[{label:"In Stock",value:"in_stock"},{label:"Low Stock",value:"low_stock"},{label:"Out of Stock",value:"out_of_stock"},{label:"Preorder",value:"preorder"}],ce=[{label:"Published",value:"published"},{label:"Archived",value:"archived"}],M=2*1024*1024,T=()=>oe.map(l=>({label:l,isAvailable:!0,stock:"0"})),de=(l=[])=>l.reduce((o,m)=>{if(!m||!m.isAvailable)return o;const x=Number(m.stock??0);return Number.isFinite(x)?o+Math.max(x,0):o},0),C={name:"",sku:"",description:"",category:"",brand:"",status:"published",availabilityStatus:"in_stock",price:"",originalPrice:"",discountPercentage:"",saveAmount:"",stock:"",maxPurchaseQuantity:"",lowStockThreshold:"",thumbnail:"",gallery:[],keyFeatures:[""],categoryPriority:"",showSizes:!1,sizes:T(),hsnCode:"",gstRate:"",isFeatured:!1},E=l=>new Promise((o,m)=>{const x=new FileReader;x.onload=()=>o(x.result),x.onerror=()=>m(new Error("Failed to read file")),x.readAsDataURL(l)}),z=({mode:l,initialValues:o,onSubmit:m,onCancel:x,onSuccess:c})=>{const[s,d]=b.useState(()=>({...C,...o||{}})),[w,P]=b.useState(!1),[j,N]=b.useState(""),[h,f]=b.useState({thumbnail:!1,gallery:!1}),[g,y]=b.useState(!!(o!=null&&o.hsnCode)),[_,A]=b.useState(!!(o!=null&&o.gstRate));b.useEffect(()=>{o&&(d({...C,...o,sizes:Array.isArray(o.sizes)?o.sizes:T()}),y(!!o.hsnCode),A(!!o.gstRate))},[o]);const F=b.useMemo(()=>de(s.sizes),[s.sizes]),D=t=>{const a=Number(t.price),r=Number(t.originalPrice);if(Number.isFinite(a)&&Number.isFinite(r)&&r>0&&r>=a){const n=r-a;t.discountPercentage=Math.round(n/r*100).toString(),t.saveAmount=n.toFixed(2)}else t.discountPercentage="",t.saveAmount="";return t},U=(t,a,r)=>{if(!t)return a;const n=ne.find(i=>i.matcher.test(t));return n&&(!g&&!r.hsnCode&&(a.hsnCode=n.hsnCode.toString()),!_&&!r.gstRate&&(a.gstRate=n.gstRate.toString())),a},u=t=>{const{name:a,value:r,type:n,checked:i}=t.target;d(S=>{let v={...S,[a]:n==="checkbox"?i:r};return a==="showSizes"||((a==="price"||a==="originalPrice")&&(v=D(v)),a==="name"&&(v=U(r,v,S))),v})},R=t=>{const{name:a,value:r}=t.target;a==="hsnCode"&&y(!!r.trim()),a==="gstRate"&&A(!!r.trim()),d(n=>({...n,[a]:r}))},Q=(t,a)=>{d(r=>{const n=[...r.keyFeatures];return n[t]=a,{...r,keyFeatures:n}})},q=()=>{d(t=>({...t,keyFeatures:[...t.keyFeatures,""]}))},G=t=>{d(a=>({...a,keyFeatures:a.keyFeatures.filter((r,n)=>n!==t)}))},$=(t,a)=>{d(r=>({...r,sizes:r.sizes.map((n,i)=>i===t?{...n,isAvailable:a}:n)}))},O=(t,a)=>{d(r=>({...r,sizes:r.sizes.map((n,i)=>i===t?{...n,stock:a}:n)}))},H=()=>{d(t=>({...t,sizes:T()}))},K=async t=>{var r;const a=(r=t.target.files)==null?void 0:r[0];if(a){if(!a.type.startsWith("image/")){p.error("Thumbnail must be an image file"),t.target.value="";return}if(a.size>M){p.error("Thumbnail must be under 2MB"),t.target.value="";return}f(n=>({...n,thumbnail:!0}));try{const n=await E(a);d(i=>({...i,thumbnail:n})),N("")}catch(n){console.error(n),p.error("Failed to load thumbnail")}finally{f(n=>({...n,thumbnail:!1})),t.target.value=""}}},X=async t=>{const a=Array.from(t.target.files||[]);if(a.length){if(a.some(r=>!r.type.startsWith("image/"))){p.error("All gallery files must be images"),t.target.value="";return}if(a.some(r=>r.size>M)){p.error("Each gallery image must be under 2MB"),t.target.value="";return}f(r=>({...r,gallery:!0}));try{const r=await Promise.all(a.map(E));d(n=>({...n,gallery:[...n.gallery,...r].slice(0,8)}))}catch(r){console.error(r),p.error("Failed to load gallery images")}finally{f(r=>({...r,gallery:!1})),t.target.value=""}}},Y=t=>{d(a=>({...a,gallery:a.gallery.filter((r,n)=>n!==t)}))},W=()=>{if(!s.name.trim())return"Product name is required";if(!s.sku.trim())return"SKU is required";if(!s.category.trim())return"Category is required";if(!s.price||Number(s.price)<=0)return"Price must be greater than zero";if(!s.originalPrice||Number(s.originalPrice)<=0)return"Original price must be greater than zero";if(!s.thumbnail)return"Thumbnail is required";if(s.showSizes&&!s.sizes.some(a=>a.isAvailable?Number(a.stock)>0:!1))return"Please set stock for at least one available size";if(s.maxPurchaseQuantity){const t=Number(s.maxPurchaseQuantity);if(!Number.isFinite(t)||t<=0)return"Max units per customer must be a positive number"}return""},Z=async t=>{t.preventDefault();const a=W();if(a){N(a),p.error(a);return}N(""),P(!0);const r=Number(s.stock||0),n={name:s.name.trim(),sku:s.sku.trim(),description:s.description.trim(),category:s.category.trim(),brand:s.brand.trim(),price:Number(s.price),originalPrice:Number(s.originalPrice),stock:r,availabilityStatus:s.availabilityStatus,status:s.status,thumbnail:s.thumbnail,gallery:s.gallery,keyFeatures:s.keyFeatures.filter(i=>i.trim()),lowStockThreshold:Number(s.lowStockThreshold||0),categoryPriority:s.categoryPriority.trim(),showSizes:!!s.showSizes,sizes:s.showSizes?s.sizes.map(i=>({...i,stock:Number(i.stock||0)})):[],hsnCode:s.hsnCode.trim(),gstRate:s.gstRate?Number(s.gstRate):void 0,isFeatured:!!s.isFeatured};if(s.maxPurchaseQuantity){const i=Number(s.maxPurchaseQuantity);Number.isFinite(i)&&i>0&&(n.maxPurchaseQuantity=Math.floor(i))}s.discountPercentage&&(n.discountPercentage=Number(s.discountPercentage)),s.saveAmount&&(n.saveAmount=Number(s.saveAmount));try{await m(n,s),typeof c=="function"&&c(),l==="create"&&(d(C),A(!1),y(!1))}catch(i){const S=(i==null?void 0:i.message)||"Failed to save product";N(S),p.error(S)}finally{P(!1)}};return e.jsx(J.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.35},className:"space-y-6",children:e.jsx("div",{className:"rounded-3xl border border-slate-200 bg-white shadow-sm",children:e.jsxs("form",{onSubmit:Z,className:"grid grid-cols-1 gap-6 p-6 xl:grid-cols-[2fr_1fr] xl:gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Product Name",e.jsx("input",{name:"name",value:s.name,onChange:u,placeholder:"Premium Polo T-Shirt",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["SKU",e.jsx("input",{name:"sku",value:s.sku,onChange:u,placeholder:"SKU-001",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Category",e.jsx("input",{name:"category",value:s.category,onChange:u,placeholder:"Apparel",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Brand",e.jsx("input",{name:"brand",value:s.brand,onChange:u,placeholder:"p2pdeal",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Price (₹)",e.jsx("input",{name:"price",type:"number",min:"0",step:"0.01",value:s.price,onChange:u,placeholder:"599",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Original Price (₹)",e.jsx("input",{name:"originalPrice",type:"number",min:"0",step:"0.01",value:s.originalPrice,onChange:u,placeholder:"799",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Discount (%)",e.jsx("input",{name:"discountPercentage",type:"number",min:"0",step:"1",value:s.discountPercentage,onChange:u,placeholder:"Auto",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["You Save (₹)",e.jsx("input",{name:"saveAmount",type:"number",min:"0",step:"0.01",value:s.saveAmount,onChange:u,placeholder:"Auto",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Stock",e.jsx("input",{name:"stock",type:"number",min:"0",step:"1",value:s.stock,onChange:u,className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"40"}),s.showSizes&&e.jsxs("span",{className:"text-[11px] text-slate-500",children:["Total from size quantities: ",F]})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Max units per customer",e.jsx("input",{name:"maxPurchaseQuantity",type:"number",min:"1",step:"1",value:s.maxPurchaseQuantity,onChange:u,placeholder:"5",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:"Leave blank to use the global default limit."})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Status",e.jsx("select",{name:"status",value:s.status,onChange:u,className:"rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:outline-none",children:ce.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Stock Status",e.jsx("select",{name:"availabilityStatus",value:s.availabilityStatus,onChange:u,className:"rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:outline-none",children:ie.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Category Priority",e.jsx("input",{name:"categoryPriority",value:s.categoryPriority,onChange:u,placeholder:"P1",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Low Stock Threshold",e.jsx("input",{name:"lowStockThreshold",type:"number",min:"0",step:"1",value:s.lowStockThreshold,onChange:u,placeholder:"10",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Featured Product",e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-slate-200 bg-slate-50 px-3 py-2",children:[e.jsx("span",{className:"text-xs text-slate-600",children:"Highlight in storefront collections"}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"isFeatured",checked:!!s.isFeatured,onChange:u,className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-slate-600",children:s.isFeatured?"Yes":"No"})]})]})]})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Description",e.jsx("textarea",{name:"description",value:s.description,onChange:u,rows:4,placeholder:"Add a short product description",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 bg-slate-50/60 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-slate-500",children:"Size Availability"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Toggle sizes to manage per-size stock."})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",name:"showSizes",checked:!!s.showSizes,onChange:u,className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),s.showSizes?"Shown on product page":"Hidden on product page"]})]}),s.showSizes?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-500",children:[e.jsxs("span",{className:"font-medium text-slate-600",children:["Total size stock: ",F]}),e.jsx("button",{type:"button",onClick:H,className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-1.5 text-[11px] font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600",children:"Reset sizes"})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:s.sizes.map((t,a)=>{const r=!!t.isAvailable;return e.jsxs("div",{className:"flex flex-col gap-2 rounded-xl border border-slate-200 bg-white p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>$(a,!r),className:`inline-flex items-center gap-2 rounded-lg border px-3 py-1.5 text-xs font-semibold transition focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 ${r?"border-blue-600 bg-blue-50 text-blue-600 hover:border-blue-700 hover:bg-blue-100":"border-rose-200 bg-rose-50 text-rose-500 hover:border-rose-300 hover:bg-rose-100"}`,children:[e.jsx("span",{children:t.label}),!r&&e.jsx("span",{className:"rounded-full bg-white px-2 py-0.5 text-[9px] font-semibold uppercase text-rose-500 shadow-sm",children:"Blocked"})]}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:"0",value:r?t.stock:"",onFocus:n=>n.target.select(),onChange:n=>O(a,n.target.value),disabled:!r,placeholder:"0",className:`w-24 rounded-lg border px-2 py-1 text-xs font-semibold focus:border-blue-400 focus:outline-none ${r?"border-slate-200 bg-white text-slate-700":"cursor-not-allowed border-slate-100 bg-slate-100 text-slate-400"}`,"aria-label":`${t.label} stock quantity`})]}),e.jsx("p",{className:"text-[11px] text-slate-500",children:r?"Adjust units for this size when available.":"Blocked sizes stay hidden."})]},`${t.label}-${a}`)})}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Tip: Total stock equals the sum of enabled size quantities."})]}):e.jsx("p",{className:"rounded-lg border border-dashed border-slate-200 bg-white px-3 py-2 text-[11px] text-slate-500",children:"Enable the toggle to manage per-size availability for this listing."})]}),e.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 bg-slate-50/60 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-slate-500",children:"Thumbnail"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload a primary image (max 2MB)."})]}),e.jsxs("div",{className:`flex flex-col items-center justify-center rounded-2xl border-2 border-dashed px-4 py-8 text-center ${s.thumbnail?"border-blue-200 bg-white":"border-slate-200 bg-white"}`,children:[s.thumbnail?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.thumbnail,alt:"Thumbnail preview",className:"h-28 w-28 rounded-2xl object-cover shadow-sm"}),e.jsx("button",{type:"button",onClick:()=>d(t=>({...t,thumbnail:""})),className:"absolute -right-2 -top-2 inline-flex items-center justify-center rounded-full bg-white px-2 py-1 text-[10px] font-semibold shadow-sm",children:"Remove"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-white shadow-sm",children:h.thumbnail?e.jsx(B,{className:"h-5 w-5 animate-spin text-blue-600"}):e.jsx(le,{className:"h-5 w-5 text-blue-500"})}),e.jsx("p",{className:"mt-3 text-xs text-slate-500",children:"Drag and drop image here, or click add image"})]}),e.jsxs("label",{className:"mt-4 inline-flex items-center gap-2 rounded-xl bg-blue-600 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-blue-700",children:[e.jsx(I,{size:14}),s.thumbnail?"Replace Image":"Add Image",e.jsx("input",{type:"file",accept:"image/*",onChange:K,className:"hidden"})]})]})]}),e.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 bg-slate-50/60 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-slate-500",children:"Gallery Images"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload multiple images (under 2MB each)."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:s.gallery.map((t,a)=>e.jsxs("div",{className:"group relative overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm",children:[e.jsx("img",{src:t,alt:`Gallery ${a+1}`,className:"h-24 w-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>Y(a),className:"absolute inset-x-2 bottom-2 rounded-lg bg-white/90 px-2 py-1 text-[10px] font-semibold text-slate-600 opacity-0 shadow-sm transition group-hover:opacity-100",children:"Remove"})]},`${t}-${a}`))}),e.jsxs("label",{className:"inline-flex items-center gap-2 rounded-xl border border-dashed border-blue-300 px-3 py-2 text-xs font-semibold text-blue-600 hover:bg-blue-50",children:[e.jsx(I,{size:14}),h.gallery?"Uploading...":"Add Gallery Images",e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:X,className:"hidden"})]})]}),e.jsxs("section",{className:"space-y-4 rounded-xl border border-slate-200 bg-slate-50/60 p-4",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-slate-500",children:"Key Features"}),e.jsxs("div",{className:"space-y-2",children:[s.keyFeatures.map((t,a)=>e.jsxs("div",{className:"flex gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2",children:[e.jsx("input",{value:t,onChange:r=>Q(a,r.target.value),placeholder:"E.g. Premium breathable fabric",className:"flex-1 rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"}),e.jsx("button",{type:"button",onClick:()=>G(a),className:"inline-flex items-center rounded-xl border border-slate-200 px-3 py-2 text-xs font-medium text-slate-500 hover:border-rose-200 hover:text-rose-500",disabled:s.keyFeatures.length===1,children:"Remove"})]},`feature-${a}`)),e.jsxs("button",{type:"button",onClick:q,className:"inline-flex items-center gap-2 rounded-xl border border-dashed border-blue-300 px-3 py-2 text-xs font-semibold text-blue-600 hover:bg-blue-50",children:[e.jsx(re,{size:14})," Add Feature"]})]})]}),e.jsxs("section",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["HSN Code",e.jsx("input",{name:"hsnCode",value:s.hsnCode,onChange:R,placeholder:"6109",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:"Auto-suggested from product name; edit if required."})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["GST Rate (%)",e.jsx("input",{name:"gstRate",type:"number",min:"0",max:"100",step:"0.01",value:s.gstRate,onChange:R,placeholder:"18",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:"Leave blank to auto-fill from presets."})]})]}),(j||!j)&&j&&e.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-600",children:j}),e.jsxs("div",{className:"flex flex-col-reverse gap-3 sm:flex-row sm:justify-end",children:[e.jsx("button",{type:"button",onClick:x,className:"inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:border-slate-300",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:w,className:"inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 disabled:opacity-70",children:w?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 animate-spin"})," Saving..."]}):l==="edit"?"Save Changes":"Create Product"})]})]}),e.jsxs("aside",{className:"space-y-6 rounded-2xl border border-slate-200 bg-slate-50/60 p-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-700",children:"Summary"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Double-check pricing, inventory, and tax information before saving."})]}),e.jsx("div",{className:"rounded-xl border border-slate-200 bg-white p-4 text-sm text-slate-600",children:e.jsxs("dl",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"Name"}),e.jsx("dd",{className:"font-medium text-slate-900",children:s.name||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"SKU"}),e.jsx("dd",{className:"font-medium text-slate-900",children:s.sku||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"Price"}),e.jsxs("dd",{className:"font-medium text-emerald-600",children:["₹",Number(s.price||0).toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"Stock"}),e.jsx("dd",{className:"font-medium text-slate-900",children:s.showSizes?F:s.stock||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"HSN"}),e.jsx("dd",{className:"font-medium text-slate-900",children:s.hsnCode||"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{children:"GST"}),e.jsxs("dd",{className:"font-medium text-slate-900",children:[s.gstRate||"-","%"]})]})]})})]})]})})})};z.propTypes={mode:k.oneOf(["create","edit"]),initialValues:k.object,onSubmit:k.func.isRequired,onCancel:k.func,onSuccess:k.func};z.defaultProps={mode:"create",initialValues:null,onCancel:()=>{},onSuccess:()=>{}};const L=()=>({...C}),ue=(l={})=>{const o=L(),m=c=>Array.isArray(c)&&c.length?c:[""],x=Array.isArray(l.sizes)?l.sizes.map(c=>({label:(c==null?void 0:c.label)??"",isAvailable:!!((c==null?void 0:c.isAvailable)??!0),stock:(c==null?void 0:c.stock)!=null?String(c.stock):"0"})):o.sizes;return{...o,name:l.name||o.name,sku:l.sku||o.sku,description:l.description||o.description,category:l.category||o.category,brand:l.brand||o.brand,status:l.status||o.status,availabilityStatus:l.availabilityStatus||o.availabilityStatus,price:l.price!==void 0&&l.price!==null?String(l.price):o.price,originalPrice:l.originalPrice!==void 0&&l.originalPrice!==null?String(l.originalPrice):o.originalPrice,discountPercentage:l.discountPercentage!==void 0&&l.discountPercentage!==null?String(l.discountPercentage):o.discountPercentage,saveAmount:l.saveAmount!==void 0&&l.saveAmount!==null?String(l.saveAmount):o.saveAmount,stock:l.stock!==void 0&&l.stock!==null?String(l.stock):o.stock,maxPurchaseQuantity:l.maxPurchaseQuantity!==void 0&&l.maxPurchaseQuantity!==null?String(l.maxPurchaseQuantity):o.maxPurchaseQuantity,lowStockThreshold:l.lowStockThreshold!==void 0&&l.lowStockThreshold!==null?String(l.lowStockThreshold):o.lowStockThreshold,thumbnail:l.thumbnail||o.thumbnail,gallery:Array.isArray(l.gallery)?l.gallery:o.gallery,keyFeatures:m(l.keyFeatures),categoryPriority:l.categoryPriority||o.categoryPriority,showSizes:!!l.showSizes,sizes:x,hsnCode:l.hsnCode||o.hsnCode,gstRate:l.gstRate!==void 0&&l.gstRate!==null?String(l.gstRate):o.gstRate,isFeatured:!!l.isFeatured}},ye=()=>{const{id:l}=V(),o=ee(),m=!!l,[x,c]=b.useState(()=>L()),[s,d]=b.useState(m);b.useEffect(()=>{if(!m)return;let h=!0;return(async()=>{d(!0);try{const g=await se(l),y=g==null?void 0:g.data;if(!h)return;c(ue(y))}catch(g){if(!h)return;const y=(g==null?void 0:g.message)||"Failed to load product";p.error(y),o("/seller/products")}finally{h&&d(!1)}})(),()=>{h=!1}},[l,m,o]);const w=async h=>{m?(await te(l,h),p.success("Product updated successfully")):(await ae(h),p.success("Product created successfully")),o("/seller/products")},P=()=>{o("/seller/products")},j=m?"Edit Product":"Add Product",N=b.useMemo(()=>x,[x]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.32em] text-slate-400",children:"Dashboard / Products"}),e.jsx("h1",{className:"mt-2 text-2xl font-semibold text-slate-900",children:j})]})}),s?e.jsx("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:e.jsx("div",{className:"space-y-4",children:Array.from({length:6}).map((h,f)=>e.jsx("div",{className:"h-12 w-full animate-pulse rounded-xl bg-slate-100"},f))})}):e.jsx(z,{mode:m?"edit":"create",initialValues:N,onSubmit:w,onCancel:P})]})};export{ye as default};
