import{r as o,j as e,m as Se,A as qt,au as Ht,ar as $,as as at}from"./vendor-2d1PFKo4.js";import{r as Kt}from"./index-Byfn92Ni.js";import{ba as nt,bb as Jt,bc as ne,C as m,b5 as Qt,d as Zt,X as es,bd as ts,be as it,bf as ot,ae as ss,bg as rs,bh as ls,bi as as}from"./index-Bpx0OnSg.js";import{u as ns,a as is}from"./hooks-W65Onizy.js";import{T as os}from"./tag-B5IXzVZU.js";import{S as ds}from"./shield-check-ZginSkgb.js";import{L as cs}from"./layers-C-GEjimE.js";import{C as ms}from"./calendar-jUZ4havw.js";import{T as dt}from"./triangle-alert-C_xSVBCC.js";import{C as us}from"./circle-check-CZUF0pO-.js";import{C as xs}from"./circle-dashed-pAKzQiuZ.js";import{D as Ae}from"./download-D5r73ZfU.js";import{U as ie}from"./upload-B-EAmLLf.js";import{R as ps}from"./refresh-cw-DQoxs3YL.js";import{L as F}from"./loader-circle-DRAKHMK_.js";import{P as ct}from"./plus-BZuZgauU.js";import{T as De}from"./trash-2-Chc1geHF.js";import{P as mt}from"./pencil-BZnjNrx9.js";import"./react-BzrpNAyj.js";const bs=[{value:"all",label:"All types"},{value:"single",label:"Single use"},{value:"multi",label:"Multi use"}],hs=[{value:"all",label:"All statuses"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"redeemed",label:"Redeemed"},{value:"not-redeemed",label:"Not redeemed"}],Nt=[{key:"code",label:"code",helper:"Optional. Leave empty to auto-generate unique code."},{key:"description",label:"description",helper:"Short text shown to sellers for context."},{key:"discountType",label:"discountType",helper:"Use 'percentage' or 'flat'. Defaults to percentage."},{key:"discountValue",label:"discountValue",helper:"Required. Positive number representing % or INR value."},{key:"maxDiscountAmount",label:"maxDiscountAmount",helper:"Optional. Cap flat or percentage discount (INR)."},{key:"minOrderAmount",label:"minOrderAmount",helper:"Optional. Minimum order total to apply coupon (INR)."},{key:"maxRedemptions",label:"maxRedemptions",helper:"Optional. Total times coupon can be redeemed. Leave blank for unlimited (multi-use)."},{key:"maxRedemptionsPerUser",label:"maxRedemptionsPerUser",helper:"Optional. Times a single customer can redeem. Leave blank for unlimited (multi-use)."},{key:"startDate",label:"startDate",helper:"Optional. Use YYYY-MM-DD or Excel date."},{key:"endDate",label:"endDate",helper:"Optional. Use YYYY-MM-DD or Excel date."},{key:"isActive",label:"isActive",helper:"Optional. true/false, yes/no, 1/0 to control activation."},{key:"type",label:"type",helper:"Optional. 'single' for one-time coupons, otherwise treated as multi use."}],fs=Nt.reduce((r,l)=>(r[l.key]=l.label,r),{}),ut=5,oe={code:"code","coupon code":"code",couponcode:"code",description:"description",details:"description","discount type":"discountType",discounttype:"discountType","discount category":"discountType","discount value":"discountValue",discountvalue:"discountValue","discount amount":"discountValue",discount:"discountValue","max discount amount":"maxDiscountAmount","max discount":"maxDiscountAmount",maxdiscountamount:"maxDiscountAmount","min order amount":"minOrderAmount","minimum order":"minOrderAmount",minorderamount:"minOrderAmount","max redemptions":"maxRedemptions",maxredemptions:"maxRedemptions","total redemptions":"maxRedemptions","max redemptions per user":"maxRedemptionsPerUser",maxredemptionsperuser:"maxRedemptionsPerUser","per user limit":"maxRedemptionsPerUser","start date":"startDate",startdate:"startDate","valid from":"startDate","end date":"endDate",enddate:"endDate","valid to":"endDate","is active":"isActive",active:"isActive",status:"isActive",isactive:"isActive",type:"type","coupon type":"type"},Re=Nt.map(({key:r})=>r),gs=new Set(Re),ys=r=>{const l=String(r??"").trim();if(!l)return null;if(gs.has(l))return l;const d=l.toLowerCase();if(oe[d])return oe[d];const f=d.replace(/[\s._-]+/g," ").trim();if(oe[f])return oe[f];const p=f.replace(/\s+/g,"");for(const g of Re){const b=g.toLowerCase();if(b===d||b===f||b.replace(/\s+/g,"")===p)return g}return null},Ns=r=>typeof r=="string"?r.trim():r instanceof Date?Number.isNaN(r.getTime())?"":r.toISOString().slice(0,10):r,vs=(r=[])=>{if(!Array.isArray(r))return{rows:[],ignoredHeaders:[]};const l=[],d=new Set;return r.forEach(f=>{if(!f||typeof f!="object")return;const p={};Object.entries(f).forEach(([g,b])=>{const N=ys(g);if(!N){if(b!=null&&String(b).trim()!==""){const x=String(g||"").trim();x&&d.add(x)}return}const A=Ns(b);A===""||A===null||A===void 0||(p[N]=A)}),Object.keys(p).length>0&&l.push(p)}),{rows:l,ignoredHeaders:Array.from(d)}},V=r=>{if(r==null||r==="")return"--";const l=Number(r);return Number.isFinite(l)?new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(l):"--"},G=r=>{if(!r)return"--";const l=new Date(r);return Number.isNaN(l.getTime())?"--":l.toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})},xt=r=>{const l=Number(r.maxRedemptions||0),d=Number(r.usageCount||0);return l?`${Math.max(l-d,0)} of ${l}`:"Unlimited"},O=(r={})=>{const l=Number(r.maxRedemptions||0),d=Number(r.maxRedemptionsPerUser||0);return l===1&&d===1?"single":"multi"},Y=(r={})=>{const l=Number(r.maxRedemptions||0),d=Number(r.usageCount||0);return l?d>=l:!1},pt=r=>{if(r==null||r==="")return null;const l=Number(r);return Number.isFinite(l)?Math.min(Math.max(l,0),100):null},js=r=>r?"Yes":"No",bt=r=>{if(r==null||r==="")return"Unlimited";const l=Number(r);return!Number.isFinite(l)||l<=0?"Unlimited":l},ws=r=>{const l=Number(r);if(!Number.isFinite(l)||l<=0)return"0 B";const d=["B","KB","MB","GB","TB"],f=Math.min(Math.floor(Math.log(l)/Math.log(1024)),d.length-1),p=l/1024**f;return`${p%1===0?p:p.toFixed(1)} ${d[f]}`},ht=r=>{if(!r)return"--";const l=new Date(r);return Number.isNaN(l.getTime())?"--":l.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},Cs=r=>(Array.isArray(r)?r:[]).map((l,d)=>{const f=O(l),p=l.isActive!==!1,g=Y(l),b=l.maxRedemptions!==void 0&&l.maxRedemptions!==null?l.maxRedemptions:null,N=b===null?"Unlimited":Math.max(b-(l.usageCount||0),0);return{"#":d+1,Code:l.code||"",Type:f==="single"?"Single use":"Multi use","Discount Type":l.discountType==="flat"?"Flat":"Percentage","Discount Value":Number(l.discountValue)||0,"Max Discount Amount":V(l.maxDiscountAmount),"Min Order Amount":V(l.minOrderAmount),"Total Redemptions":bt(b),"Per User Limit":bt(l.maxRedemptionsPerUser),"Usage Count":Number(l.usageCount)||0,"Remaining Redemptions":N,Status:p?g?"Redeemed":"Active":"Inactive","Start Date":G(l.startDate),"End Date":G(l.endDate),Active:js(p),"Created At":ht(l.createdAt),"Updated At":ht(l.updatedAt)}}),ft=({value:r,onValueChange:l,options:d,ariaLabel:f})=>{const[p,g]=o.useState(!1),b=o.useRef(null);o.useEffect(()=>{const x=I=>{var y;(y=b.current)!=null&&y.contains(I.target)||g(!1)};return document.addEventListener("mousedown",x),document.addEventListener("touchstart",x),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("touchstart",x)}},[]);const N=d.find(x=>x.value===r)??d[0],A=x=>{l(x),g(!1)};return e.jsxs("div",{ref:b,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>g(x=>!x),className:`inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-xs font-semibold transition focus:outline-none focus:ring-2 focus:ring-blue-100 ${p?"border-blue-400 bg-white text-blue-600":"border-slate-200 bg-white text-slate-600 hover:border-blue-300"}`,"aria-label":f,"aria-haspopup":"listbox","aria-expanded":p,children:[e.jsx("span",{children:N==null?void 0:N.label}),e.jsx(ss,{size:14,className:`transition ${p?"rotate-180 text-blue-500":"text-slate-400"}`})]}),p&&e.jsx("div",{className:"absolute left-0 top-[calc(100%+0.35rem)] z-30 w-40 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-lg",children:e.jsx("ul",{className:"max-h-48 overflow-y-auto py-1",role:"listbox",children:d.map(x=>{const I=x.value===r;return e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>A(x.value),className:`flex w-full items-center justify-between px-3 py-2 text-xs font-semibold transition ${I?"bg-blue-50 text-blue-600":"text-slate-600 hover:bg-slate-50"}`,role:"option","aria-selected":I,children:[x.label,I&&e.jsx("span",{className:"text-[10px] font-bold uppercase text-blue-500",children:"Selected"})]})},x.value)})})})]})},gt=()=>({code:"",description:"",discountType:"percentage",discountValue:"",maxDiscountAmount:"",minOrderAmount:"",type:"single",maxRedemptions:"1",maxRedemptionsPerUser:"1",startDate:"",endDate:"",isActive:!0,count:"1",appliesTo:"all",productIds:[]}),yt=r=>{if(!r)return"";try{return r.slice(0,10)}catch{const d=new Date(r);return Number.isNaN(d.getTime())?"":d.toISOString().slice(0,10)}},Gs=()=>{var lt;const r=ns(),{items:l,meta:d,status:f,error:p,mutationStatus:g,mutationError:b,importStatus:N,importErrors:A,importSummary:x,importMessage:I,stats:y}=is(t=>t.sellerCoupons),[n,T]=o.useState(gt()),[P,ke]=o.useState(null),[de,Ie]=o.useState(!1),[ce,vt]=o.useState(""),[me,jt]=o.useState(""),[R,Te]=o.useState("all"),[X,Pe]=o.useState("all"),[te,Me]=o.useState(""),[se,Ue]=o.useState(""),[M,B]=o.useState([]),W=o.useRef(null),[Ee,ue]=o.useState([]),[wt,xe]=o.useState([]),[Fe,pe]=o.useState([]),[Oe,be]=o.useState(""),[L,he]=o.useState({name:"",size:0,lastModified:0,totalRows:0,processedRows:0}),[Le,q]=o.useState(""),[Ct,ze]=o.useState(!1),[fe,_e]=o.useState(!1),[$e,ge]=o.useState([]),[Ve,St]=o.useState([]),[ye,Be]=o.useState(!1),[Ye,Ge]=o.useState(""),j=f==="loading",k=g==="loading",w=d.page||1,H=d.limit||20,Xe=d.totalPages||1,We=!!P,z=Number(n.count||"1"),U=!We&&Number.isFinite(z)&&z>1,K=Ct||N==="loading",J=n.appliesTo==="product"&&((lt=n.productIds)==null?void 0:lt[0])||"",At=J&&Ve.some(t=>t.value===J),Q=Ee.length,Ne=o.useMemo(()=>Array.isArray(A)?A:[],[A]),re=o.useCallback(()=>{r(nt({page:w,limit:H,search:me||void 0,isActive:R==="active"?"true":R==="inactive"?"false":void 0}))},[r,w,H,me,R]),Z=o.useCallback(()=>{ue([]),xe([]),pe([]),be(""),he({name:"",size:0,lastModified:0,totalRows:0,processedRows:0}),q(""),ge([]),W.current&&(W.current.value=""),r(Jt())},[r]),Dt=o.useCallback(()=>{Z(),_e(!0)},[Z]),le=o.useCallback(()=>{_e(!1),q(""),Z()},[Z]),Rt=o.useMemo(()=>{const t=(()=>{const i=l.length,c=l.filter(v=>v.isActive!==!1).length,u=l.filter(v=>O(v)==="single").length,h=i-u,E=l.filter(v=>O(v)==="single"&&v.isActive===!1).length,_=l.filter(v=>O(v)==="multi"&&v.isActive===!1).length,D=l.filter(v=>Y(v)).length,ae=i-D;return{total:i,active:c,single:u,multi:h,expiredSingle:E,expiredMulti:_,redeemed:D,notRedeemed:ae}})(),a=y&&typeof y=="object"&&"total"in y?{total:Number(y.total)||0,active:Number(y.active)||0,single:Number(y.single)||0,multi:Number(y.multi)||0,expiredSingle:Number(y.expiredSingle)||0,expiredMulti:Number(y.expiredMulti)||0,redeemed:Number(y.redeemed)||0,notRedeemed:Number(y.notRedeemed)||0}:t;return[{key:"total",label:"Total Coupons",value:a.total,icon:os,badgeClass:"bg-blue-50 text-blue-600"},{key:"active",label:"Active",value:a.active,icon:ds,badgeClass:"bg-emerald-50 text-emerald-600"},{key:"single",label:"Single Use",value:a.single,icon:cs,badgeClass:"bg-violet-50 text-violet-600"},{key:"multi",label:"Multi Use",value:a.multi,icon:ms,badgeClass:"bg-amber-50 text-amber-600"},{key:"expired-single",label:"Expired Single Use",value:a.expiredSingle,icon:dt,badgeClass:"bg-slate-100 text-slate-600"},{key:"expired-multi",label:"Expired Multi Use",value:a.expiredMulti,icon:dt,badgeClass:"bg-orange-50 text-orange-600"},{key:"redeemed",label:"Redeemed Coupons",value:a.redeemed,icon:us,badgeClass:"bg-emerald-50 text-emerald-600"},{key:"not-redeemed",label:"Not Redeemed",value:a.notRedeemed,icon:xs,badgeClass:"bg-blue-50 text-blue-600"}]},[l,y]),C=o.useMemo(()=>{const t=pt(te),s=pt(se);return l.filter(a=>{const i=O(a);if(X!=="all"&&i!==X||!(()=>{switch(R){case"active":return a.isActive!==!1;case"inactive":return a.isActive===!1;case"redeemed":return Y(a);case"not-redeemed":return!Y(a);default:return!0}})())return!1;const u=Number(a.discountValue)||0;return!(t!==null&&u<t||s!==null&&u>s)})},[l,se,te,X,R]),ee=o.useMemo(()=>C.map(t=>t!=null&&t._id?String(t._id):null).filter(Boolean),[C]),ve=ee.length>0&&ee.every(t=>M.includes(t)),qe=M.length>0,kt=X!=="all"||R!=="all"||te!==""||se!=="",He=C.length===0?l.length===0?"No coupons found. Create a coupon to get started.":"No coupons match the selected filters.":"";o.useEffect(()=>{const t=setTimeout(()=>{jt(ce.trim()),r(ne(1))},400);return()=>clearTimeout(t)},[ce,r]),o.useEffect(()=>{re()},[re]),o.useEffect(()=>{B(t=>t.filter(s=>ee.includes(s)))},[ee]),o.useEffect(()=>{g==="failed"&&b&&m.error(b)},[g,b]),o.useEffect(()=>{if(!fe||typeof document>"u")return;const{body:t}=document,s=t.style.overflow;return t.style.overflow="hidden",()=>{t.style.overflow=s}},[fe]),o.useEffect(()=>{if(N==="succeeded"){const t=x||{},s=Number(t.createdCount),a=Number.isFinite(s)?s:Array.isArray(t.created)?t.created.length:Q,i=Number(t.errorCount),c=Number.isFinite(i)?i:Array.isArray(t.errors)?t.errors.length:0,u=Number(t.totalRows),h=Number.isFinite(u)?u:a+c,E=[];E.push(`${a} coupon${a===1?"":"s"} imported successfully`),c>0&&E.push(`${c} row${c===1?"":"s"} skipped due to validation`),h>a&&h>0&&E.push(`Processed ${a}/${h} rows`),m.success(E.join(". ")),re(),le()}else N==="failed"&&m.error(I||"Failed to import coupons")},[N,x,I,Q,le,re]);const It=()=>{B(ve?[]:ee)},Ke=t=>{const s=String(t);B(a=>a.includes(s)?a.filter(i=>i!==s):[...a,s])},Tt=t=>{Te(t),r(ne(1))},Pt=()=>{Pe("all"),Te("all"),Me(""),Ue(""),r(ne(1))},Je=t=>{t<1||t>Xe||t===w||r(ne(t))},Mt=async()=>{Ie(!0);try{const t=await it();T(s=>({...s,code:t})),m.success("Generated coupon code")}catch(t){m.error(t.message||"Unable to generate code")}finally{Ie(!1)}},je=()=>{T(gt()),ke(null)},Ut=()=>{W.current&&W.current.click()},Qe=()=>{const t=[{code:"WELCOME100",description:"₹100 off on first order",discountType:"flat",discountValue:100,minOrderAmount:999,maxRedemptions:1,maxRedemptionsPerUser:1,startDate:new Date().toISOString().slice(0,10),endDate:"",isActive:!0,type:"single"},{code:"FESTIVE20",description:"20% off on festive collection",discountType:"percentage",discountValue:20,maxDiscountAmount:500,minOrderAmount:1500,maxRedemptions:200,maxRedemptionsPerUser:2,startDate:"",endDate:"",isActive:!0,type:"multi"}];try{const s=$.json_to_sheet(t),a=$.book_new();$.book_append_sheet(a,s,"Coupons"),at(a,"seller-coupons-template.xlsx"),m.success("Downloaded template")}catch(s){console.error("Failed to download template",s),m.error("Unable to download template")}},Et=async t=>{var a,i;const s=(a=t.target.files)==null?void 0:a[0];if(s){ze(!0),q(""),ge([]),ue([]),xe([]),pe([]),be(""),he(c=>({...c,name:s.name,size:s.size,lastModified:s.lastModified||Date.now(),totalRows:0,processedRows:0}));try{const c=await s.arrayBuffer(),u=Ht(c,{type:"array",cellDates:!0,cellText:!1}),h=(i=u.SheetNames)==null?void 0:i[0];if(!h)throw new Error("No worksheets found in file");const E=u.Sheets[h],_=$.sheet_to_json(E,{defval:"",raw:!1});if(!_.length)throw new Error("The selected sheet does not contain any rows");const{rows:D,ignoredHeaders:ae}=vs(_);if(!D.length)throw new Error("No valid coupon rows were detected. Check required fields and try again.");const v=Re.filter(Ce=>D.some(Wt=>Wt[Ce]!==void 0)),we=[];ae.length&&we.push(`Ignored columns: ${ae.map(Ce=>`"${Ce}"`).join(", ")}`),D.length<_.length&&we.push(`${_.length-D.length} row(s) were skipped because they were empty or missing values.`),ue(D),xe(D.slice(0,ut)),pe(v),be(h),ge(we),he({name:s.name,size:s.size,lastModified:s.lastModified||Date.now(),totalRows:_.length,processedRows:D.length})}catch(c){console.error("Failed to parse import file",c),q(c.message||"Unable to read the selected file")}finally{ze(!1)}}},Ft=()=>{q(""),Z()},Ot=async t=>{if(t.preventDefault(),!Q){m.error("Upload a valid coupon sheet before importing");return}try{await r(as(Ee)).unwrap()}catch(s){console.error("Failed to import seller coupons",s)}},Ze=t=>{T(s=>({...s,type:t==="multi"?"multi":"single",maxRedemptions:t==="single"?"1":s.maxRedemptions||"",maxRedemptionsPerUser:t==="single"?"1":s.maxRedemptionsPerUser||""}))},et=o.useCallback(async()=>{Be(!0),Ge("");try{const t=await Qt({page:1,limit:200}),a=(Array.isArray(t==null?void 0:t.data)?t.data:[]).map(i=>{var c,u;return{value:(i==null?void 0:i._id)||(i==null?void 0:i.id)||(i==null?void 0:i.productId)||"",label:((c=i==null?void 0:i.name)==null?void 0:c.trim())||((u=i==null?void 0:i.title)==null?void 0:u.trim())||"Untitled product"}});St(a)}catch(t){const s=(t==null?void 0:t.message)||"Failed to load products";Ge(s),m.error(s)}finally{Be(!1)}},[]);o.useEffect(()=>{et()},[et]);const S=t=>s=>{const{value:a}=s.target;T(i=>({...i,[t]:a}))},Lt=t=>s=>{const{checked:a}=s.target;T(i=>({...i,[t]:a}))},zt=t=>{T(s=>t==="product"?{...s,appliesTo:"product",productIds:Array.isArray(s.productIds)?s.productIds:[]}:{...s,appliesTo:"all",productIds:[]})},_t=t=>{const{value:s}=t.target;T(a=>({...a,productIds:s?[s]:[]}))},$t=()=>{if(!Number.isFinite(z)||z<1)return m.error("Count must be at least 1"),!1;if(U&&z>200)return m.error("You can generate up to 200 coupons at a time"),!1;if(!U&&!n.code.trim())return m.error("Coupon code is required"),!1;const t=Number(n.discountValue);if(!Number.isFinite(t)||t<=0)return m.error("Discount must be a positive number"),!1;if(n.discountType==="percentage"&&(t<1||t>100))return m.error("Percentage discount must be between 1 and 100"),!1;if(n.type==="multi"){if(n.maxRedemptions.trim()){const s=Number(n.maxRedemptions);if(!Number.isInteger(s)||s<1)return m.error("Total redemptions must be at least 1"),!1}if(n.maxRedemptionsPerUser.trim()){const s=Number(n.maxRedemptionsPerUser);if(!Number.isInteger(s)||s<1)return m.error("Per customer limit must be at least 1"),!1}}if(n.startDate&&n.endDate){const s=new Date(n.startDate),a=new Date(n.endDate);if(!Number.isNaN(s.getTime())&&!Number.isNaN(a.getTime())&&s>a)return m.error("End date must be after start date"),!1}return n.appliesTo==="product"&&!(Array.isArray(n.productIds)?n.productIds.filter(a=>a&&a.toString().trim()):[]).length?(m.error("Select at least one product for this coupon"),!1):!0},Vt=()=>{const t=n.type==="single",s=n.maxDiscountAmount.trim()===""?void 0:Number(n.maxDiscountAmount),a=n.minOrderAmount.trim()===""?void 0:Number(n.minOrderAmount),i=t?1:n.maxRedemptions.trim()===""?void 0:Number(n.maxRedemptions),c=t?1:n.maxRedemptionsPerUser.trim()===""?void 0:Number(n.maxRedemptionsPerUser);return{code:n.code?n.code.trim().toUpperCase():"",description:n.description.trim()||void 0,discountType:n.discountType==="flat"?"flat":"percentage",discountValue:Number(n.discountValue),maxDiscountAmount:s,minOrderAmount:a,maxRedemptions:i,maxRedemptionsPerUser:c,startDate:n.startDate||void 0,endDate:n.endDate||void 0,isActive:!!n.isActive,appliesTo:n.appliesTo==="product"?"product":"all",productIds:n.appliesTo==="product"?Array.from(new Set((Array.isArray(n.productIds)?n.productIds:[]).map(h=>h&&typeof h.toString=="function"?h.toString():String(h||"").trim()).filter(Boolean))):[]}},Bt=async t=>{if(t.preventDefault(),k||!$t())return;const s=Vt();try{if(P!=null&&P._id)await r(ts({id:P._id,payload:s})).unwrap(),m.success("Coupon updated successfully");else if(U){for(let a=0;a<z;a+=1){const i=await it(),c={...s,code:i.trim().toUpperCase()};await r(ot(c)).unwrap()}m.success(`Created ${z} coupons`)}else await r(ot(s)).unwrap(),m.success("Coupon created successfully");je()}catch(a){m.error(a.message||"Unable to save coupon")}},tt=t=>{t&&(ke(t),T({code:t.code||"",description:t.description||"",discountType:t.discountType||"percentage",discountValue:t.discountValue!==void 0?String(t.discountValue):"",maxDiscountAmount:t.maxDiscountAmount!==void 0&&t.maxDiscountAmount!==null?String(t.maxDiscountAmount):"",minOrderAmount:t.minOrderAmount!==void 0&&t.minOrderAmount!==null?String(t.minOrderAmount):"",type:O(t),maxRedemptions:t.maxRedemptions!==void 0&&t.maxRedemptions!==null?String(t.maxRedemptions):"",maxRedemptionsPerUser:t.maxRedemptionsPerUser!==void 0&&t.maxRedemptionsPerUser!==null?String(t.maxRedemptionsPerUser):"",startDate:yt(t.startDate),endDate:yt(t.endDate),isActive:t.isActive!==!1,count:"1",appliesTo:t.appliesTo==="product"?"product":"all",productIds:Array.isArray(t.productIds)?t.productIds.map(s=>{var a;return((a=s==null?void 0:s.toString)==null?void 0:a.call(s))||String(s||"")}).filter(Boolean):[]}),window.scrollTo({top:0,behavior:"smooth"}))},st=async t=>{if(!(!(t!=null&&t._id)||!window.confirm(`Delete coupon "${t.code}"? This action cannot be undone.`)))try{await r(ls(t._id)).unwrap(),m.success("Coupon deleted"),B(a=>a.filter(i=>i!==String(t._id)))}catch(a){m.error(a.message||"Unable to delete coupon")}},Yt=async()=>{if(!(!M.length||!window.confirm(`Delete ${M.length} selected coupon${M.length>1?"s":""}? This action cannot be undone.`)))try{await r(rs(M)).unwrap(),m.success("Selected coupons deleted"),B([])}catch(s){m.error(s.message||"Failed to delete selected coupons. Please retry.")}},Gt=()=>{if(!Array.isArray(C)||C.length===0){m.error("No coupons available to export");return}try{const t=Cs(C);if(!t.length){m.error("No coupons available to export");return}const s=$.json_to_sheet(t),a=$.book_new();$.book_append_sheet(a,s,"Coupons");const i=new Date,c=i.toISOString().slice(0,10),u=i.toISOString().slice(11,19).replace(/:/g,""),h=`seller-coupons-${c}-${u}.xlsx`;at(a,h),m.success("Coupons exported successfully")}catch(t){console.error("Failed to export seller coupons",t),m.error("Unable to export coupons. Please try again.")}},Xt=()=>{r(nt({page:w,limit:H,search:me||void 0,isActive:R==="active"?"true":R==="inactive"?"false":void 0}))},rt=typeof document<"u"?document.body:void 0;return e.jsxs(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{type:"spring",stiffness:120,damping:18},className:"space-y-6 text-slate-900",children:[e.jsx("input",{ref:W,type:"file",accept:".xlsx,.xls",onChange:Et,className:"hidden"}),e.jsxs("header",{className:"flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.32em] text-slate-500",children:"Promotions"}),e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Coupons"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Manage discount codes for your products."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:Qe,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-700",children:[e.jsx(Ae,{size:14})," Template"]}),e.jsxs("button",{type:"button",onClick:Dt,className:"inline-flex items-center gap-2 rounded-xl border border-blue-200 bg-blue-50 px-3 py-2 text-xs font-semibold text-blue-600 transition hover:border-blue-300 hover:bg-blue-100",children:[e.jsx(ie,{size:14})," Import XLSX"]})]})]}),e.jsx("section",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-4",children:Rt.map(({key:t,label:s,value:a,icon:i,badgeClass:c})=>e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-slate-500",children:s}),e.jsx("span",{className:`inline-flex items-center justify-center rounded-full px-3 py-1 text-xs font-semibold ${c}`,children:e.jsx(i,{size:16})})]}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:a})]},t))}),e.jsx("section",{className:"rounded-3xl border border-slate-200 bg-white p-5 shadow-sm",children:e.jsxs("form",{onSubmit:Bt,className:"space-y-5",noValidate:!0,children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3 sm:items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:P?"Update Coupon":"Create Coupon"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Configure single-use and multi-use coupons for promotions."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:Xt,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",disabled:j,children:[e.jsx(ps,{size:16,className:j?"animate-spin":""}),"Refresh"]}),P&&e.jsx("button",{type:"button",onClick:je,className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-medium text-rose-600 transition hover:bg-rose-100",disabled:k,children:"Cancel edit"})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("button",{type:"button",onClick:()=>Ze("single"),className:`w-full rounded-xl border px-3 py-2 text-sm font-medium transition sm:flex-1 ${n.type==="single"?"border-blue-500 bg-blue-50 text-blue-600":"border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`,children:"Single use"}),e.jsx("button",{type:"button",onClick:()=>Ze("multi"),className:`w-full rounded-xl border px-3 py-2 text-sm font-medium transition sm:flex-1 ${n.type==="multi"?"border-blue-500 bg-blue-50 text-blue-600":"border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`,children:"Multi use"})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Coupon applies to"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:["all","product"].map(t=>{const s=n.appliesTo===t,a=t==="all"?"All products":"Specific product";return e.jsx("button",{type:"button",onClick:()=>zt(t),className:`inline-flex items-center rounded-xl border px-3 py-1.5 text-xs font-semibold transition focus:outline-none focus:ring-2 focus:ring-blue-100 ${s?"border-blue-500 bg-blue-50 text-blue-600":"border-slate-200 bg-white text-slate-600 hover:border-blue-300"}`,children:a},t)})}),n.appliesTo==="product"?e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{htmlFor:"coupon-product-select",className:"text-xs font-medium uppercase tracking-wide text-slate-500",children:"Eligible product"}),e.jsxs("select",{id:"coupon-product-select",value:J,onChange:_t,className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",disabled:ye,children:[e.jsx("option",{value:"",children:"Select a product"}),!At&&J&&e.jsx("option",{value:J,children:"Selected product (no longer listed)"}),Ve.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),ye&&e.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(F,{size:14,className:"animate-spin"}),"Loading products…"]}),Ye&&!ye&&e.jsx("p",{className:"mt-2 text-xs text-amber-600",children:Ye}),e.jsx("p",{className:"mt-2 text-xs text-slate-500",children:"Customers can redeem this coupon only when the selected product is in their cart."})]}):e.jsx("p",{className:"mt-2 text-xs text-slate-500",children:"Coupon will apply to every published product you sell."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-code",className:"text-sm font-medium text-slate-600",children:"Coupon Code"}),e.jsxs("div",{className:"mt-1 flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("input",{id:"coupon-code",name:"code",type:"text",value:n.code,onChange:S("code"),className:"flex-1 rounded-xl border border-slate-200 px-3 py-2 text-sm uppercase tracking-wider text-slate-700 focus:border-blue-500 focus:outline-none disabled:cursor-not-allowed disabled:bg-slate-100",placeholder:U?"Auto-generated":"MEGA50",maxLength:20,required:!U,disabled:U}),e.jsxs("button",{type:"button",onClick:Mt,className:"inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600 disabled:cursor-not-allowed disabled:bg-slate-100",disabled:de||k||U,children:[de?e.jsx(F,{size:16,className:"animate-spin"}):e.jsx(ct,{size:16}),"Generate"]})]}),U&&e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Codes will be generated automatically for bulk creation."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-description",className:"text-sm font-medium text-slate-600",children:"Description"}),e.jsx("textarea",{id:"coupon-description",name:"description",value:n.description,onChange:S("description"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",rows:2,placeholder:"E.g. 15% off on prepaid orders"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"coupon-discount-value",className:"text-sm font-medium text-slate-600",children:["Discount (",n.discountType==="percentage"?"%":"INR",")"]}),e.jsx("input",{id:"coupon-discount-value",name:"discountValue",type:"number",min:1,value:n.discountValue,onChange:S("discountValue"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:n.discountType==="percentage"?"10":"100",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-discount-type",className:"text-sm font-medium text-slate-600",children:"Discount Type"}),e.jsxs("select",{id:"coupon-discount-type",name:"discountType",value:n.discountType,onChange:S("discountType"),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"percentage",children:"Percentage (%)"}),e.jsx("option",{value:"flat",children:"Flat (INR)"})]})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-max-discount",className:"text-sm font-medium text-slate-600",children:"Max Discount Amount (optional)"}),e.jsx("input",{id:"coupon-max-discount",name:"maxDiscountAmount",type:"number",min:0,value:n.maxDiscountAmount,onChange:S("maxDiscountAmount"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:"500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-min-order",className:"text-sm font-medium text-slate-600",children:"Minimum Order Amount"}),e.jsx("input",{id:"coupon-min-order",name:"minOrderAmount",type:"number",min:0,value:n.minOrderAmount,onChange:S("minOrderAmount"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:"1000"})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("input",{id:"coupon-active",type:"checkbox",checked:n.isActive,onChange:Lt("isActive"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"coupon-active",className:"text-sm text-slate-600",children:"Mark as active immediately"})]})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Usage limits"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Configure how many times the coupon can be redeemed overall and per customer."}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-count",className:"text-sm font-medium text-slate-600",children:"Number of coupons to generate"}),e.jsx("input",{id:"coupon-count",name:"count",type:"number",min:1,value:n.count,onChange:S("count"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:"1",disabled:We}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Enter how many codes to generate (max 200 per batch)."})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"coupon-max-redemptions",className:"text-sm font-medium text-slate-600",children:["Total Redemptions",n.type==="multi"?" (leave blank for unlimited)":""]}),e.jsx("input",{id:"coupon-max-redemptions",name:"maxRedemptions",type:"number",min:n.type==="single"?1:0,value:n.maxRedemptions,onChange:S("maxRedemptions"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:n.type==="single"?"1":"Unlimited",disabled:n.type==="single"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"coupon-max-redemptions-per-user",className:"text-sm font-medium text-slate-600",children:["Per Customer Limit",n.type==="multi"?" (leave blank for unlimited)":""]}),e.jsx("input",{id:"coupon-max-redemptions-per-user",name:"maxRedemptionsPerUser",type:"number",min:n.type==="single"?1:0,value:n.maxRedemptionsPerUser,onChange:S("maxRedemptionsPerUser"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:n.type==="single"?"1":"Unlimited",disabled:n.type==="single"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-start-date",className:"text-sm font-medium text-slate-600",children:"Start Date"}),e.jsx("input",{id:"coupon-start-date",name:"startDate",type:"date",value:n.startDate,onChange:S("startDate"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-end-date",className:"text-sm font-medium text-slate-600",children:"End Date"}),e.jsx("input",{id:"coupon-end-date",name:"endDate",type:"date",value:n.endDate,onChange:S("endDate"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:k||de,children:[k?e.jsx(F,{size:16,className:"animate-spin"}):e.jsx(ct,{size:16}),P?"Update Coupon":"Create Coupon"]}),e.jsx("button",{type:"button",onClick:je,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",disabled:k,children:"Reset"})]})]})]})]})]})}),e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-100 px-4 py-4 sm:flex-row sm:flex-wrap sm:items-center sm:justify-between sm:px-5",children:[e.jsxs("div",{className:"flex w-full flex-col gap-3 sm:w-auto sm:flex-row sm:flex-wrap sm:items-center",children:[e.jsxs("div",{className:"flex w-full items-center gap-3 rounded-full border border-slate-200 bg-white px-4 py-2 text-sm text-slate-500 shadow-sm sm:w-auto",children:[e.jsx(Zt,{size:18,className:"text-slate-400"}),e.jsx("input",{value:ce,onChange:t=>vt(t.target.value),placeholder:"Search by code or description",className:"h-10 flex-1 bg-transparent text-sm placeholder:text-slate-400 focus:outline-none sm:h-8 sm:w-52 sm:flex-none"})]}),e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 shadow-sm sm:w-auto",children:[e.jsx(ft,{value:X,onValueChange:Pe,options:bs,ariaLabel:"Filter coupons by type"}),e.jsx(ft,{value:R,onValueChange:Tt,options:hs,ariaLabel:"Filter coupons by status"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{htmlFor:"seller-filter-discount-min",className:"sr-only",children:"Minimum discount percentage"}),e.jsx("input",{id:"seller-filter-discount-min",name:"filterDiscountMin",type:"number",min:0,max:100,value:te,onChange:t=>Me(t.target.value),className:"w-20 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-600 transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100",placeholder:"Min %","aria-label":"Minimum discount percentage"}),e.jsx("span",{className:"text-xs font-medium text-slate-400",children:"-"}),e.jsx("label",{htmlFor:"seller-filter-discount-max",className:"sr-only",children:"Maximum discount percentage"}),e.jsx("input",{id:"seller-filter-discount-max",name:"filterDiscountMax",type:"number",min:0,max:100,value:se,onChange:t=>Ue(t.target.value),className:"w-20 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-600 transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100",placeholder:"Max %","aria-label":"Maximum discount percentage"})]}),e.jsx("button",{type:"button",onClick:Pt,className:"text-xs font-semibold text-slate-500 transition hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-50",disabled:!kt,children:"Reset"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:Yt,className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs font-medium text-rose-600 transition hover:bg-rose-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:!qe||k,children:[e.jsx(De,{size:14})," Delete selected"]}),e.jsxs("button",{type:"button",onClick:Gt,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-60",disabled:j||l.length===0,children:[e.jsx(Ae,{size:14})," Export"]})]})]}),p&&e.jsx("div",{className:"border-b border-amber-100 bg-amber-50 px-4 py-3 text-sm text-amber-700 sm:px-5",children:p}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500",checked:ve&&qe,onChange:It,"aria-label":ve?"Deselect all coupons":"Select all coupons"})}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Code"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Discount"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Usage"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Validity"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[j&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-6 text-center text-slate-500 sm:px-5",children:e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-500",children:[e.jsx(F,{size:16,className:"animate-spin text-blue-500"}),"Loading coupons..."]})})}),!j&&C.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-slate-500 sm:px-5",children:He})}),!j&&C.map(t=>{const s=t.discountType==="percentage"?`${t.discountValue||0}%`:V(t.discountValue),a=t.startDate||t.endDate?`${G(t.startDate)} - ${G(t.endDate)}`:"No expiry",i=O(t),c=t.isActive!==!1,u=Y(t);return e.jsxs("tr",{className:"hover:bg-slate-50/60",children:[e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500",checked:M.includes(String(t._id)),onChange:()=>Ke(t._id),"aria-label":`Select coupon ${t.code}`})}),e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:t.code}),t.description&&e.jsx("p",{className:"text-xs text-slate-500",children:t.description})]})}),e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${i==="single"?"bg-violet-50 text-violet-600":"bg-amber-50 text-amber-600"}`,children:i==="single"?"Single Use":"Multi Use"}),e.jsx("p",{className:"text-xs text-slate-500",children:i==="single"?"One-time use":"Reusable with limits"})]})}),e.jsxs("td",{className:"px-4 py-4 align-top sm:px-5",children:[e.jsx("p",{className:"font-medium text-slate-900",children:s}),t.maxDiscountAmount!==void 0&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Cap: ",V(t.maxDiscountAmount)]})]}),e.jsxs("td",{className:"px-4 py-4 align-top sm:px-5",children:[e.jsx("p",{className:"font-medium text-slate-900",children:xt(t)}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Used ",t.usageCount||0," times"]})]}),e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsx("p",{className:"font-medium text-slate-900",children:a})}),e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${c?"bg-emerald-50 text-emerald-600":"bg-slate-200 text-slate-600"}`,children:c?"Active":"Inactive"}),e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${u?"bg-rose-50 text-rose-600":"bg-blue-50 text-blue-600"}`,children:u?"Redeemed":"Not Redeemed"})]})}),e.jsx("td",{className:"px-4 py-4 align-top text-right sm:px-5",children:e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>tt(t),className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",children:[e.jsx(mt,{size:14}),"Edit"]}),e.jsxs("button",{type:"button",onClick:()=>st(t),className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs font-medium text-rose-600 transition hover:bg-rose-100",disabled:k,children:[e.jsx(De,{size:14}),"Delete"]})]})})]},t._id)})]})]})})}),e.jsxs("div",{className:"border-t border-slate-100 px-4 py-4 lg:hidden sm:px-5",children:[j&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm text-slate-500",children:[e.jsx(F,{size:16,className:"animate-spin text-blue-500"}),"Loading coupons..."]})}),!j&&C.length===0&&e.jsx("p",{className:"py-8 text-center text-sm text-slate-500",children:He}),!j&&C.length>0&&e.jsx("div",{className:"space-y-4",children:C.map(t=>{const s=t.discountType==="percentage"?`${t.discountValue||0}%`:V(t.discountValue),a=t.startDate||t.endDate?`${G(t.startDate)} - ${G(t.endDate)}`:"No expiry",i=O(t),c=t.isActive!==!1,u=Y(t),h=i==="single"?"bg-violet-50 text-violet-600":"bg-amber-50 text-amber-600";return e.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-base font-semibold text-slate-900",children:t.code}),t.description&&e.jsx("p",{className:"text-xs text-slate-500",children:t.description})]}),e.jsx("input",{type:"checkbox",className:"h-5 w-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500",checked:M.includes(String(t._id)),onChange:()=>Ke(t._id),"aria-label":`Select coupon ${t.code}`})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${c?"bg-emerald-50 text-emerald-600":"bg-slate-200 text-slate-600"}`,children:c?"Active":"Inactive"}),e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${u?"bg-rose-50 text-rose-600":"bg-blue-50 text-blue-600"}`,children:u?"Redeemed":"Not Redeemed"}),e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${h}`,children:i==="single"?"Single Use":"Multi Use"})]}),e.jsxs("div",{className:"grid gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:"Discount"}),e.jsx("p",{className:"mt-1 font-semibold text-slate-900",children:s}),t.maxDiscountAmount!==void 0&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Cap: ",V(t.maxDiscountAmount)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:"Usage"}),e.jsx("p",{className:"mt-1 font-semibold text-slate-900",children:xt(t)}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Used ",t.usageCount||0," times"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:"Validity"}),e.jsx("p",{className:"mt-1 font-semibold text-slate-900",children:a})]}),t.minOrderAmount!==void 0&&t.minOrderAmount!==null&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:"Minimum Order"}),e.jsx("p",{className:"mt-1 font-semibold text-slate-900",children:V(t.minOrderAmount)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>tt(t),className:"inline-flex flex-1 items-center justify-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600 sm:flex-none sm:px-4",children:[e.jsx(mt,{size:14}),"Edit"]}),e.jsxs("button",{type:"button",onClick:()=>st(t),className:"inline-flex flex-1 items-center justify-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs font-medium text-rose-600 transition hover:bg-rose-100 sm:flex-none sm:px-4",disabled:k,children:[e.jsx(De,{size:14}),"Delete"]})]})]},t._id)})})]}),e.jsxs("footer",{className:"flex flex-col justify-between gap-3 border-t border-slate-200 bg-slate-50 px-5 py-4 text-xs text-slate-500 sm:flex-row sm:items-center",children:[e.jsx("span",{children:d.total>0?`Showing ${(w-1)*H+(l.length?1:0)||1}-${(w-1)*H+l.length} of ${d.total}`:"No coupons to display"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Je(w-1),disabled:w<=1||j,className:"rounded-full border border-slate-300 px-3 py-1 text-xs font-semibold text-slate-600 transition enabled:hover:border-blue-200 enabled:hover:bg-blue-50 enabled:hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-40",children:"Previous"}),e.jsx("span",{className:"font-semibold text-slate-700",children:j?e.jsx(F,{className:"h-3 w-3 animate-spin"}):w}),e.jsx("button",{type:"button",onClick:()=>Je(w+1),disabled:w>=Xe||j,className:"rounded-full border border-slate-300 px-3 py-1 text-xs font-semibold text-slate-600 transition enabled:hover:border-blue-200 enabled:hover:bg-blue-50 enabled:hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-40",children:"Next"})]})]})]}),rt&&Kt.createPortal(e.jsx(qt,{children:fe&&e.jsx(Se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[999] flex items-center justify-center bg-slate-900/60 px-4 py-8",children:e.jsxs(Se.form,{onSubmit:Ot,initial:{scale:.95,opacity:0,y:16},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:16},transition:{type:"spring",stiffness:240,damping:28},className:"relative flex w-full max-w-5xl max-h-[calc(100vh-3rem)] flex-col gap-5 overflow-hidden rounded-3xl border border-slate-200 bg-white p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Import coupons from spreadsheet"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Upload an XLSX file with coupon details. You can download the template for the exact column structure."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:Qe,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-700",children:[e.jsx(Ae,{size:14})," Template"]}),e.jsx("button",{type:"button",onClick:le,className:"inline-flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 text-slate-500 transition hover:border-slate-300 hover:text-slate-700","aria-label":"Close import modal",children:e.jsx(es,{size:18})})]})]}),e.jsx("div",{className:"flex flex-1 flex-col gap-4 overflow-y-auto",children:e.jsx("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/60 p-4 text-sm text-slate-600",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs font-semibold uppercase tracking-wide text-slate-500",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-white px-3 py-1 text-[11px] font-semibold text-slate-600",children:[e.jsx(ie,{size:14,className:"text-blue-500"}),L.name?L.name:"No file selected"]}),L.size>0&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-white px-3 py-1 text-[11px] font-semibold text-slate-500",children:ws(L.size)}),Oe&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-white px-2.5 py-1 text-[11px] font-semibold text-slate-500",children:["Sheet: ",Oe]}),L.totalRows>0&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-white px-3 py-1 text-[11px] font-semibold text-slate-500",children:["Rows: ",L.processedRows,"/",L.totalRows]})]}),Le&&e.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600",children:Le}),!!$e.length&&e.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-700",children:[e.jsx("p",{className:"font-semibold uppercase tracking-wide",children:"Warnings"}),e.jsx("ul",{className:"mt-2 space-y-1",children:$e.map((t,s)=>e.jsxs("li",{children:["● ",t]},s))})]}),Ne.length>0&&e.jsxs("div",{className:"rounded-2xl border border-rose-200 bg-white px-4 py-3 text-xs text-rose-600",children:[e.jsx("p",{className:"font-semibold uppercase tracking-wide",children:"Backend validation issues"}),e.jsx("ul",{className:"mt-2 space-y-1",children:Ne.slice(0,10).map((t,s)=>e.jsxs("li",{children:["Row"," ",typeof t.index=="number"?t.index+1:"?",": ",t.message||"Invalid data"]},s))}),Ne.length>10&&e.jsx("p",{className:"mt-2 text-[11px] text-slate-500",children:"Showing first 10 errors. Check the downloaded error log for the full list."})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Preview"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Showing up to ",ut," rows from the file"]})]}),K?e.jsxs("div",{className:"mt-6 flex items-center justify-center text-sm text-slate-500",children:[e.jsx(F,{size:18,className:"mr-2 animate-spin text-blue-500"}),"Reading file..."]}):Q>0?e.jsx("div",{className:"mt-4 overflow-hidden rounded-2xl border border-slate-100",children:e.jsx("div",{className:"max-h-72 overflow-auto",children:e.jsxs("table",{className:"w-full table-fixed divide-y divide-slate-100 text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500",children:e.jsx("tr",{children:Fe.map(t=>e.jsx("th",{className:"break-words px-4 py-3 text-left align-top",children:fs[t]||t},t))})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white text-xs text-slate-600",children:wt.map((t,s)=>e.jsx("tr",{children:Fe.map(a=>e.jsx("td",{className:"break-words px-4 py-2 align-top",children:t[a]!==void 0&&t[a]!==""?String(t[a]):"--"},a))},s))})]})})}):e.jsx("div",{className:"mt-6 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-center text-sm text-slate-500",children:"Upload an XLSX file to preview coupon rows."})]})]})})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-500",children:[e.jsxs("button",{type:"button",onClick:Ut,disabled:K,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:[e.jsx(ie,{size:14})," Choose file"]}),e.jsx("button",{type:"button",onClick:Ft,disabled:K,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 font-semibold text-slate-600 transition hover:border-rose-200 hover:text-rose-600 disabled:cursor-not-allowed disabled:opacity-60",children:"Clear"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:le,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-700",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:K||Q===0,className:"inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",children:[K?e.jsx(F,{size:16,className:"animate-spin"}):e.jsx(ie,{size:16}),"Import coupons"]})]})]})]})},"import-modal")}),rt)]})};export{Gs as default};
