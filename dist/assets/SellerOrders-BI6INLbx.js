import{r as p,j as e,m as ne,A as Te}from"./vendor-2d1PFKo4.js";import{r as gs}from"./index-Byfn92Ni.js";import{c as qt,u as bs,k as fs,J as b,d as ys,X as js,b7 as vs,b8 as ws,b2 as Ns,_ as Ss,aB as ks,a as zt,b9 as Is}from"./index-Bpx0OnSg.js";import{E as Cs}from"./exceljs.min-DtRa7M71.js";import{E as Ps}from"./jspdf.es.min-BhhWDGe6.js";import{d as $e,Q as At}from"./downloadQr-DEmKiViM.js";import{C as Ds}from"./circle-alert-tOb1bCg-.js";import{D as Me}from"./download-D5r73ZfU.js";import{T as Be}from"./trash-2-Chc1geHF.js";import{L as te}from"./loader-circle-DRAKHMK_.js";import{E as Ft}from"./eye-DjBlpBi-.js";import{P as Tt}from"./pencil-line-CoX3LYzN.js";import{C as Ls}from"./circle-check-CZUF0pO-.js";import{C as Os}from"./circle-8xuaZdaz.js";import{P as Es}from"./package-C_UWcLgd.js";import"./react-BzrpNAyj.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Us=qt("mail",Rs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],As=qt("phone",zs),Fs=[{value:"",label:"All statuses"},{value:"processing",label:"Processing"},{value:"shipped",label:"Shipped"},{value:"delivered",label:"Delivered"},{value:"returned",label:"Returned"},{value:"rejected",label:"Rejected"}],Ts=[{value:"",label:"All payments"},{value:"pending",label:"Payment pending"},{value:"paid",label:"Paid"},{value:"failed",label:"Failed"}],$s=[{value:"desc",label:"Newest first"},{value:"asc",label:"Oldest first"}],Ms=[{value:"Triupati",label:"Triupati"},{value:"Xpressbees Logistics",label:"Xpressbees Logistics"},{value:"Delhivery Courier",label:"Delhivery Courier"},{value:"India Post",label:"India Post"}],Bs=[{key:"processing",label:"Processing Orders"},{key:"shipped",label:"Shipped Orders"},{key:"paid",label:"Paid Orders"},{key:"delivered",label:"Delivered Orders"},{key:"returned",label:"Return/Replace"}],$t={processing:"bg-amber-50 text-amber-600 border border-amber-200",shipped:"bg-sky-50 text-sky-600 border border-sky-200",delivered:"bg-emerald-50 text-emerald-600 border border-emerald-200",returned:"bg-rose-50 text-rose-600 border border-rose-200"},se=E=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(Number(E)||0),s=(...E)=>E.filter(Boolean).join(" "),Mt=E=>{var J,U,ie;if(!E||typeof E!="string")return null;const M=E.trim();if(!M||M.startsWith("data:")||M.startsWith("blob:"))return null;try{const B=new URL(M,((J=window.location)==null?void 0:J.origin)||void 0);if(!/^https?:$/i.test(B.protocol)||new Set(["localhost",""]).has(B.hostname.toLowerCase()))return null;const A=typeof((ie=(U=zt)==null?void 0:U.defaults)==null?void 0:ie.baseURL)=="string"?zt.defaults.baseURL:"",oe=A?A.replace(/\/+$/,""):"";return oe?`${oe}/sellers/image-proxy?url=${encodeURIComponent(B.toString())}`:null}catch{return null}},Bt=()=>{var E;try{const M=(E=window.localStorage)==null?void 0:E.getItem("authToken");if(M)return{Authorization:`Bearer ${M}`}}catch{}return{}},ae=E=>E?new Date(E).toLocaleString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",_t=E=>{if(!E)return"";const M=new Date(E);if(Number.isNaN(M.getTime()))return"";const J=M.getTimezoneOffset()*60*1e3;return new Date(M.getTime()-J).toISOString().slice(0,10)},ia=()=>{var jt,vt,wt,Nt,St,kt,It,Ct,Pt,Dt,Lt,Ot,Et;const E=bs(),M=fs(),J=p.useMemo(()=>M.state||{},[M.state]),[U,ie]=p.useState([]),[B,Se]=p.useState({page:1,limit:10,total:0,totalPages:1,statusCounts:{}}),[A,oe]=p.useState(!0),[Y,_e]=p.useState(""),[Z,de]=p.useState(()=>Number(J.page)||1),[qe,We]=p.useState(""),[Qe,He]=p.useState(""),[ce,Ve]=p.useState(()=>J.status||""),[ue,Xe]=p.useState(()=>J.paymentStatus||""),[ke,Ke]=p.useState(""),[Ie,Ge]=p.useState(""),[Ce,Ye]=p.useState(""),[Pe,Je]=p.useState(""),[De,Ze]=p.useState("desc"),[me,Wt]=p.useState(10),[W,xe]=p.useState([]),[ge,et]=p.useState(null),[be,tt]=p.useState(null),[Qt,st]=p.useState(!1),[Ht,Le]=p.useState(0),[F,Oe]=p.useState(null),[O,fe]=p.useState({status:"",paymentStatus:"",paymentMethod:"",estimatedDeliveryDate:"",rejectionPermanent:!1,courier:"Triupati",trackingId:""}),Vt=p.useMemo(()=>_t(new Date),[]),[pe,at]=p.useState(!1),ee=p.useRef(""),[D,Xt]=p.useState(null),[le,_s]=p.useState(!1),[ye,Kt]=p.useState(""),[Gt,je]=p.useState(!1),[lt,Yt]=p.useState(null),[ve,we]=p.useState(null),rt=!!(le||ye||D)||!!F;p.useEffect(()=>{let t=!0;return(async()=>{oe(!0),_e("");try{const r=await vs({page:Z,limit:me,status:ce||void 0,paymentStatus:ue||void 0,search:Qe||void 0,startDate:ke||void 0,endDate:Ie||void 0,minAmount:Ce||void 0,maxAmount:Pe||void 0,sortOrder:De||void 0});if(!t)return;ie((r==null?void 0:r.data)||[]),Se((r==null?void 0:r.meta)||B),xe([])}catch(r){if(!t)return;_e(r.message||"Failed to load orders"),ie([]),Se(a=>({...a,total:0,totalPages:1,limit:me})),xe([])}finally{t&&oe(!1)}})(),()=>{t=!1}},[Z,ce,ue,Qe,ke,Ie,Ce,Pe,De,me,Ht]),p.useEffect(()=>{E(M.pathname,{replace:!0,state:{...J,status:ce,paymentStatus:ue,page:Z}})},[ce,ue,Z,E,M.pathname]),p.useEffect(()=>{typeof document>"u"||Yt(document.body)},[]),p.useEffect(()=>{if(!rt||typeof document>"u"||typeof window>"u")return;const{body:t,documentElement:l}=document,r=t.style.overflow,a=t.style.paddingRight,i=window.innerWidth-l.clientWidth;return i>0&&(t.style.paddingRight=`${i}px`),t.style.overflow="hidden",()=>{t.style.overflow=r,t.style.paddingRight=a}},[rt]);const Jt=p.useMemo(()=>{const t=B.statusCounts||{};let l=0;return U.forEach(r=>{String(r.paymentStatus||"").toLowerCase()==="paid"&&(l+=1)}),Bs.map(({key:r,label:a})=>{const i=r==="paid"?l:t[r]!=null?t[r]:0;return{key:r,label:a,value:i}})},[B.statusCounts,U]),re=p.useCallback(()=>{const t=Array.isArray(U)?W.length?U.filter(a=>{const i=(a==null?void 0:a.orderId)??(a==null?void 0:a.id)??(a==null?void 0:a._id);return i!=null&&W.includes(String(i))}):U:[];if(!t.length)return[];const l=(a={})=>{const i=[a.fullName,a.mobile].filter(Boolean).join(" • "),d=a.email?`Email: ${a.email}`:"",m=[a.addressLine,a.landmark].filter(Boolean).join(", "),c=[a.city,a.district].filter(Boolean).join(", "),N=[a.state,a.pincode].filter(Boolean).join(" - ");return[i,d,m,c,N].filter(Boolean).join(`
`)},r=a=>{var d,m;const i=typeof a=="string"?a.trim():"";if(!i)return"";if(/^https?:\/\//i.test(i))return i;if(i.startsWith("//"))return typeof window<"u"&&((d=window.location)!=null&&d.protocol)?`${window.location.protocol}${i}`:`https:${i}`;try{const c=typeof window<"u"&&((m=window.location)!=null&&m.origin)?window.location.origin:void 0;return c?new URL(i,c).href:i}catch{return i}};return t.map(a=>{var j,g,L,S;const i=Array.isArray(a.items)?a.items:[],d=i[0]||{},m=a.shippingAddress||{},c=a.qrfolio||{},N=()=>{if(c.imageKey)return c.imageKey;const Q=c.imageUrl||"";if(!Q)return"";try{const X=new URL(Q,window.location.origin).pathname||"",$=(X.endsWith("/")?X.slice(0,-1):X).split("/").filter(Boolean);return $.length?$[$.length-1]:""}catch{const X=Q.split("?")[0],T=X.split("/").filter(Boolean);return T.length?T[T.length-1]:X}},h=typeof c.imageUrl=="string"?c.imageUrl.trim():"",x=a.invoice||{},I=r(x.url||a.invoiceUrl||""),u={};return u["Order ID"]=a.orderId||a.id||a._id,u.Status=a.orderStatus||a.status||"processing",u["Payment Status"]=a.paymentStatus||((j=a.payment)==null?void 0:j.status)||"pending",u["Payment Method"]=a.paymentMethod||((g=a.payment)==null?void 0:g.method)||"",u["Total Amount"]=a.total??a.totalAmount??((L=a.pricing)==null?void 0:L.total)??0,u["Item Count"]=i.length,u["Primary Item"]=d.name||d.productName||"",u["Primary SKU"]=d.sku||"",u["Primary Size"]=d.size||d.selectedSize||"",u["Buyer Name"]=a.buyerName||a.customerName||m.fullName||"",u["Buyer Email"]=a.buyerEmail||a.customerEmail||m.email||"",u["Buyer Phone"]=a.buyerPhone||m.mobile||"",u["Created At"]=ae(a.createdAt),u["Estimated Delivery"]=a.estimatedDeliveryDate?ae(a.estimatedDeliveryDate):"--",u["Shipping Address"]=l(m),u["QR Folio Image"]=h||N(),u["Invoice Number"]=x.number||a.invoiceNumber||"",u["Invoice Date"]=x.generatedAt?ae(x.generatedAt):a.invoiceDate?ae(a.invoiceDate):"--",u.Invoice=I,Object.defineProperty(u,"__qrfolioLink",{value:h,enumerable:!1}),Object.defineProperty(u,"__invoiceLink",{value:I,enumerable:!1}),Object.defineProperty(u,"__qrPdfLink",{value:((S=a.qrfolio)==null?void 0:S.pdfUrl)||"",enumerable:!1}),u})},[U,W]),Zt=p.useCallback(()=>{const t=re();if(!t.length){b.error("No orders to export");return}const l=Object.keys(t[0]),r=[l.join(","),...t.map(m=>l.map(c=>`"${String(m[c]??"").replace(/"/g,'""')}"`).join(","))].join(`
`),a=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),i=window.URL.createObjectURL(a),d=document.createElement("a");d.href=i,d.download=`seller-orders-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(i),b.success("CSV exported")},[re]),es=p.useCallback(async()=>{const t=re();if(!t.length){b.error("No orders to export");return}const l=Object.keys(t[0]),r=l.indexOf("QR Folio Image"),a=l.indexOf("Invoice"),i=new Cs.Workbook,d=i.addWorksheet("Orders");d.addRow(l),r!==-1&&(d.getColumn(r+1).width=16),a!==-1&&(d.getColumn(a+1).width=24);const m=h=>{var I;if(!h||typeof h!="string")return null;const x=h.trim();if(!x)return null;try{return new URL(x).toString()}catch{try{const j=((I=window.location)==null?void 0:I.origin)||"";return j?new URL(x.replace(/^\/+/,""),j).toString():x}catch{return x}}},c=new Map,N=async h=>{var j;const x=m(h);if(!x)return null;const I=Mt(x),u=I||x;if(c.has(u))return c.get(u);try{if(I){const X=await fetch(I,{credentials:"include",headers:Bt()});if(!X.ok)throw new Error(`Unexpected status ${X.status}`);const T=await X.json(),$=(j=T==null?void 0:T.data)==null?void 0:j.dataUrl;if(!$||typeof $!="string")return c.set(u,null),null;const Ae=$.startsWith("data:image/jpeg")||$.startsWith("data:image/jpg")?"jpeg":$.startsWith("data:image/webp")?"webp":"png",Ne={dataUrl:$,extension:Ae};return c.set(u,Ne),Ne}const g=await fetch(x,{credentials:"include"});if(!g.ok)throw new Error(`Unexpected status ${g.status}`);const L=await g.blob();if(!L.type||!L.type.startsWith("image/"))return c.set(u,null),null;const S=await new Promise((X,T)=>{const $=new FileReader;$.onloadend=()=>X($.result),$.onerror=T,$.readAsDataURL(L)}),Q=L.type.includes("png")?"png":L.type.includes("jpeg")||L.type.includes("jpg")?"jpeg":L.type.includes("webp")?"webp":"png",G={dataUrl:S,extension:Q};return c.set(u,G),G}catch(g){return console.error("Failed to load QR image for XLSX export",x,g),c.set(u,null),null}};for(let h=0;h<t.length;h+=1){const x=t[h],I=h+2,u=x.__qrfolioLink||x["QR Folio Image"],j=r!==-1&&u?await N(u):null,g=l.map(S=>S==="QR Folio Image"?j?"":x[S]||"":x[S]),L=d.addRow(g);if(j&&j.dataUrl&&r!==-1){const S=typeof j.dataUrl=="string"&&j.dataUrl.split(",")[1]||j.dataUrl,Q=i.addImage({base64:S,extension:j.extension||"png"});L.height=70,d.addImage(Q,{tl:{col:r,row:I-1},ext:{width:72,height:72}})}if(a!==-1){const S=x.__invoiceLink;if(S){const Q=L.getCell(a+1),G=x.Invoice||S;Q.value={text:G,hyperlink:S}}}}try{const h=await i.xlsx.writeBuffer(),x=new Blob([h],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),I=window.URL.createObjectURL(x),u=document.createElement("a");u.href=I,u.download=`seller-orders-${new Date().toISOString().slice(0,10)}.xlsx`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(I),b.success("XLSX exported")}catch(h){console.error("Failed to export XLSX with QR images",h),b.error("Failed to export XLSX. Please try again.")}},[re]),ts=p.useCallback(async()=>{const t=re();if(!t.length){b.error("No orders to export");return}const l=new Ps({orientation:"landscape",unit:"pt",format:"a4"}),r=[{key:"orderId",label:"Order ID",width:65},{key:"status",label:"Status",width:45},{key:"payment",label:"Payment",width:72},{key:"total",label:"Total (INR)",width:65,align:"right"},{key:"item",label:"Primary Item",width:112},{key:"size",label:"Size",width:36,align:"center"},{key:"buyer",label:"Buyer",width:80},{key:"qty",label:"Qty",width:30,align:"center"},{key:"ship",label:"Ship To",width:102},{key:"qr",label:"QR Code",width:120,type:"image",imageWidth:108,imageHeight:108},{key:"qrPdf",label:"QR PDF",width:70,align:"center"},{key:"invoice",label:"Invoice",width:70,type:"image",imageWidth:56,imageHeight:52}],a=32,i=72,d=48,m=26,c=r.reduce((n,o)=>n+o.width,0),N=9,h=12;let x=i,I=l.internal.pageSize.getWidth(),u=l.internal.pageSize.getHeight();const j=()=>{I=l.internal.pageSize.getWidth(),u=l.internal.pageSize.getHeight()},g=n=>n==null?"--":(Array.isArray(n)?n.join(" "):String(n)).replace(/\u00a0/g," ").trim()||"--",L=n=>{var v;if(!n||typeof n!="string")return null;const o=n.trim();if(!o||o==="--")return null;try{return new URL(o).toString()}catch{try{const C=((v=window.location)==null?void 0:v.origin)||"";return C?new URL(o.replace(/^\/+/,""),C).toString():o}catch{return o}}},S=n=>{if(!n||typeof n!="string")return"";const v=n.split("?")[0].split("#")[0].split("/").filter(Boolean);if(!v.length)return"";const R=v[v.length-1],C=R.lastIndexOf(".");return C===-1||C===R.length-1?"":R.slice(C+1).toLowerCase()},Q=n=>{var o;if(!n||typeof n!="string")return"";try{const v=new URL(n,((o=window.location)==null?void 0:o.origin)||void 0);return S(v.pathname||"")}catch{return S(n)}},G=n=>{const o=Q(n);return o?["png","jpg","jpeg","gif","bmp","webp","svg"].includes(o):!1},X=(n,o)=>{if(!n)return"Invoice unavailable";if(o)return"Invoice image unavailable";const v=Q(n);return v?v==="pdf"?"Invoice ":`Invoice ${v.toUpperCase()}`:"Invoice file"},T=new Map,$=async n=>{var C,k;if(typeof n=="string"&&n.trim().startsWith("data:")){const z=n.trim(),f=z.startsWith("data:image/jpeg")||z.startsWith("data:image/jpg")?"JPEG":z.startsWith("data:image/webp")?"WEBP":"PNG";return{dataUrl:z,format:f}}const o=L(n);if(!o)return null;const v=Mt(o),R=v||o;if(T.has(R))return T.get(R);try{if(v){const w=await fetch(v,{credentials:"include",headers:Bt()});if(!w.ok)throw new Error(`Unexpected status ${w.status}`);const P=await w.json(),y=(C=P==null?void 0:P.data)==null?void 0:C.dataUrl;if(!y||typeof y!="string")return T.set(R,null),null;const K=(k=P==null?void 0:P.data)==null?void 0:k.format,V={dataUrl:y,format:typeof K=="string"&&K.trim()?K.trim().toUpperCase():y.startsWith("data:image/jpeg")?"JPEG":y.startsWith("data:image/webp")?"WEBP":"PNG"};return T.set(R,V),V}const z=await fetch(o,{credentials:"include"});if(!z.ok)throw new Error(`Unexpected status ${z.status}`);const f=await z.blob();if(!f.type||!f.type.startsWith("image/"))return T.set(R,null),null;const H=await new Promise((w,P)=>{const y=new FileReader;y.onloadend=()=>w(y.result),y.onerror=P,y.readAsDataURL(f)}),_=f.type.includes("png")?"PNG":f.type.includes("jpeg")||f.type.includes("jpg")?"JPEG":f.type.includes("webp")?"WEBP":void 0,q={dataUrl:H,format:_};return T.set(R,q),q}catch(z){return console.error("Failed to load image for PDF export",o,z),T.set(R,null),null}},Ae=n=>{const o=Number.isFinite(Number(n))?Number(n):0;return`INR ${new Intl.NumberFormat("en-IN",{minimumFractionDigits:0,maximumFractionDigits:0}).format(o)}`},Ne=n=>n&&typeof n=="object"&&!Array.isArray(n)?{text:n.text!==void 0?n.text:"--",link:L(n.link||n.url)}:{text:n,link:null},xs=()=>{l.setFont("Helvetica","bold"),l.setFontSize(10),l.setTextColor(255,255,255),l.setFillColor(15,23,42),l.setDrawColor(15,23,42);let n=a;r.forEach(o=>{l.setFillColor(15,23,42),l.setTextColor(255,255,255),l.rect(n,x,o.width,m,"FD");const v=x+m/2+1;l.text(o.label,n+o.width/2,v,{align:"center",baseline:"middle"}),n+=o.width}),x+=m,l.setDrawColor(221,226,233),l.setFont("Helvetica","normal"),l.setFontSize(N),l.setTextColor(30,41,59)},Rt=n=>{j();const o=n?"Seller Orders":"Seller Orders (cont.)",v=n?32:24;l.setFont("Helvetica","bold"),l.setFontSize(n?16:12),l.setTextColor(30,41,59),l.text(o,I/2,i-v,{align:"center"}),x=i,xs()},ps=(n,o)=>{const v=r.map(k=>{if(k.type==="image"){const q=n[k.key]||{},w=!!(q.image&&q.image.dataUrl),P=typeof q.url=="string"&&q.url.trim()?q.url.trim():null,y=w?[]:l.splitTextToSize(g(q.fallback||"Image unavailable"),k.width-12),K=k.imageHeight||52,V=Math.max(w?K+16:(y.length||1)*h+16,26);return{type:"image",hasImage:w,image:q.image||null,url:P,fallbackLines:y,requiredHeight:V,imageWidth:k.imageWidth||52,imageHeight:K}}const{text:z,link:f}=Ne(n[k.key]),H=g(typeof z=="string"?z.replace(/\r?\n/g,`
`):z),_=l.splitTextToSize(H||"--",k.width-12);return{type:"text",lines:_.length?_:["--"],link:f,requiredHeight:Math.max(_.length*h+16,26)}}),R=Math.max(...v.map(k=>k.requiredHeight||26));x+R>u-d&&(l.addPage({orientation:"landscape",unit:"pt",format:"a4"}),Rt(!1)),o%2===0&&(l.setFillColor(248,250,252),l.setDrawColor(248,250,252),l.rect(a,x,c,R,"F")),l.setDrawColor(221,226,233),l.setFont("Helvetica","normal"),l.setFontSize(N),l.setTextColor(30,41,59);let C=a;r.forEach((k,z)=>{var q;const f=v[z];if(l.rect(C,x,k.width,R),k.type==="image"){if(f.hasImage&&((q=f.image)!=null&&q.dataUrl)){const w=Math.min(f.imageWidth,k.width-8),P=f.imageHeight,y=C+(k.width-w)/2,K=x+(R-P)/2;try{l.addImage(f.image.dataUrl,f.image.format||"PNG",y,K,w,P),f.url&&l.link(y,K,w,P,{url:f.url})}catch(V){console.error("Failed to add image to PDF",V)}}else f.fallbackLines.length&&f.fallbackLines.forEach((w,P)=>{const y=x+12+P*h;f.url&&P===0?(l.setTextColor(37,99,235),l.textWithLink(w,C+6,y,{url:f.url}),l.setTextColor(30,41,59)):l.text(w,C+6,y,{baseline:"top"})});C+=k.width;return}const{lines:H,link:_}=f;H.forEach((w,P)=>{const y=x+12+P*h,K=k.align||"left",V={baseline:"top"};K==="center"?(V.align="center",_&&H.length===1&&P===0?(l.setTextColor(37,99,235),l.textWithLink(w,C+k.width/2,y,{align:"center",url:_}),l.setTextColor(30,41,59)):l.text(w,C+k.width/2,y,V)):K==="right"?(V.align="right",_&&H.length===1&&P===0?(l.setTextColor(37,99,235),l.textWithLink(w,C+k.width-6,y,{align:"right",url:_}),l.setTextColor(30,41,59)):l.text(w,C+k.width-6,y,V)):_&&H.length===1&&P===0?(l.setTextColor(37,99,235),l.textWithLink(w,C+6,y,{url:_}),l.setTextColor(30,41,59)):l.text(w,C+6,y,V)}),C+=k.width}),x+=R};Rt(!0);for(let n=0;n<t.length;n+=1){const o=t[n],v=o["Payment Method"]?` (${o["Payment Method"]})`:"",R=`${o["Payment Status"]||""}${v}`,C=[o["Buyer Name"],o["Buyer Email"],o["Buyer Phone"]].filter(Boolean).join(" • "),k=(o["Shipping Address"]||"").split(`
`).map(Fe=>Fe.trim()).filter(Boolean).join(", "),z=o.__qrfolioLink||o["QR Folio Image"],f=o.__invoiceLink||o.Invoice,H=L(z),_=L(f),q=_||f,w=G(q),P=o.__qrPdfLink,[y,K,V]=await Promise.all([$(z),w?$(f):Promise.resolve(null),P?Promise.resolve(P):H?$e({qrUrl:H,orderId:o["Order ID"],filePrefix:"order-qr",returnDataUri:!0}).catch(Fe=>(console.error("Failed to build QR PDF for export",Fe),null)):Promise.resolve(null)]),Ut=w?K:null,hs={orderId:g(o["Order ID"]),status:g(o.Status),payment:g(R),total:Ae(o["Total Amount"]),item:g(`${o["Primary Item"]||"--"}${o["Primary SKU"]?` (SKU: ${o["Primary SKU"]})`:""}`),size:g(o["Primary Size"]||"--"),buyer:g(C),qty:g(o["Item Count"]??0),ship:g(k),qr:y?{image:y,url:H}:{fallback:"QR image unavailable",url:H},qrPdf:V?{text:"Download",link:V}:H?{text:"Open QR",link:H}:"--",invoice:Ut?{image:Ut,url:_}:{fallback:X(q,w),url:_}};ps(hs,n)}l.save(`seller-orders-${new Date().toISOString().slice(0,10)}.pdf`),b.success("PDF exported")},[re]),ss=t=>{t.preventDefault(),He(qe.trim()),de(1)},as=()=>{We(""),He(""),Ve(""),Xe(""),Ke(""),Ge(""),Ye(""),Je(""),Ze("desc"),de(1)},nt=(t,l)=>{const r=l.replace(/[^0-9.]/g,"");t==="min"?Ye(r):Je(r)},it=B.limit||me,ls=B.total>0?(Z-1)*it+(U.length?1:0):0,rs=B.total>0?(Z-1)*it+U.length:0,ot=U.length>0&&W.length===U.length,ns=()=>{if(ot)xe([]);else{const t=U.map(l=>l.orderId?String(l.orderId):null).filter(Boolean);xe(t)}},dt=t=>{const l=t?String(t):"";l&&xe(r=>r.includes(l)?r.filter(a=>a!==l):[...r,l])},ct=t=>{if(!(t!=null&&t.orderId)){b.error("Order reference unavailable");return}E(`/seller/orders/${t.orderId}`)},ut=async t=>{var a,i,d,m,c;if(!(t!=null&&t.orderId)){b.error("Order reference unavailable");return}const l=String(t.paymentStatus||"pending").toLowerCase();if(!!!((a=t==null?void 0:t.invoice)!=null&&a.url||t!=null&&t.invoiceUrl||(i=t==null?void 0:t.invoice)!=null&&i.number)&&l!=="paid"){b.error("Invoice will be available once payment succeeds or the seller updates it manually.");return}try{et(t.orderId);const N=await Ns(t.orderId),h=N.data,I=(((d=N.headers)==null?void 0:d["content-disposition"])||"").match(/filename="?([^";]+)"?/i),u=(I==null?void 0:I[1])||`invoice-${t.orderId}.pdf`,j=window.URL.createObjectURL(h),g=document.createElement("a");g.href=j,g.download=u,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(j),b.success("Invoice downloaded")}catch(N){const h=((c=(m=N==null?void 0:N.response)==null?void 0:m.data)==null?void 0:c.message)||(N==null?void 0:N.message)||"Unable to download invoice. Please try again.";b.error(h)}finally{et(null)}},mt=t=>{if(!(t!=null&&t.orderId)){b.error("Order reference unavailable");return}if(!window.confirm("Are you sure you want to delete this order?"))return;(async()=>{var a,i;try{tt(t.orderId);const d=await Is(t.orderId),m=(d==null?void 0:d.message)||"Order deleted";b.success(m),Le(c=>c+1)}catch(d){const m=((i=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:i.message)||(d==null?void 0:d.message)||"Failed to delete order";b.error(m)}finally{tt(null)}})()},is=async()=>{var l,r;if(!W.length){b.error("Select at least one order to delete");return}if(window.confirm(`Delete ${W.length} selected order${W.length>1?"s":""}? This cannot be undone.`)){st(!0);try{const a=await ws(W),i=(a==null?void 0:a.message)||`${W.length} order${W.length>1?"s":""} deleted`;b.success(i),Le(d=>d+1)}catch(a){const i=((r=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:r.message)||(a==null?void 0:a.message)||"Failed to delete selected orders";b.error(i)}finally{st(!1)}}},xt=async t=>{var l,r,a,i,d;if(!(t!=null&&t.orderId)){b.error("Order reference unavailable");return}try{const m=await Ss(t.orderId),c=m==null?void 0:m.data;if(!c)throw new Error("Order details not found");const N=c.shipping&&c.shipping.courier||"Triupati",h={status:c.status||"processing",paymentStatus:((l=c.payment)==null?void 0:l.status)||"",paymentMethod:((r=c.payment)==null?void 0:r.method)||"",estimatedDeliveryDate:_t(c.estimatedDeliveryDate)||"",rejectionPermanent:!!c.rejectionPermanent,courier:N,trackingId:((a=c.shipping)==null?void 0:a.trackingId)||""};Oe(c),fe(h);const x=String(h.status||"").toLowerCase()==="delivered"?"":h.estimatedDeliveryDate;ee.current=x}catch(m){const c=((d=(i=m==null?void 0:m.response)==null?void 0:i.data)==null?void 0:d.message)||(m==null?void 0:m.message)||"Failed to load order for editing";b.error(c)}},Ee=()=>{pe||Oe(null)},he=(t,l)=>{fe(r=>({...r,[t]:l}))},os=t=>{const l=t.target.value;fe(r=>{const a=String(r.status||"").toLowerCase(),i=String(l||"").toLowerCase(),d=i==="delivered",m=a==="delivered";let c=r.estimatedDeliveryDate;return d&&!m?(!r.estimatedDeliveryDate&&ee.current||(ee.current=r.estimatedDeliveryDate||ee.current||""),c=Vt):!d&&m&&(c=ee.current||""),d||(ee.current=c||ee.current||""),{...r,status:l,estimatedDeliveryDate:c,rejectionPermanent:i==="rejected"?r.rejectionPermanent:!1}})},pt=(((jt=F==null?void 0:F.payment)==null?void 0:jt.status)||"").toString().toLowerCase(),ht=(O.paymentStatus||"").toString().toLowerCase(),ds=ht||pt,gt=(O.status||"").toString().toLowerCase(),Re=F?["delivered","returned"].includes((F.status||"").toString().toLowerCase()):!1,bt=pt==="paid"||ht==="paid",Ue=["paid","success","successful","completed"].includes(ds),ze=gt==="delivered",cs=!ze||Ue,ft=gt==="rejected"&&!!O.rejectionPermanent,us=t=>{const{value:l}=t.target;if(Re){b.error("Estimated delivery date cannot be changed after delivery.");return}fe(r=>(String(r.status||"").toLowerCase()==="delivered"||(ee.current=l),{...r,estimatedDeliveryDate:l}))},ms=async()=>{var t,l;if(F){if(ze&&!Ue){b.error("Payment must be successful before marking an order as delivered.");return}at(!0);try{const r={status:O.status||void 0,paymentStatus:O.paymentStatus||void 0,paymentMethod:O.paymentMethod||void 0,estimatedDeliveryDate:O.estimatedDeliveryDate||null};O.courier&&(r.courier=O.courier),O.trackingId&&(r.trackingId=O.trackingId),(O.status||"").toString().toLowerCase()==="rejected"?r.rejectionPermanent=!!O.rejectionPermanent:F!=null&&F.rejectionPermanent&&String(F.status||"").toLowerCase()==="rejected"&&(r.rejectionPermanent=!1);const i=F.orderId||F._id;await ks(i,r),b.success("Order updated successfully"),Le(d=>d+1),Oe(null)}catch(r){const a=(r==null?void 0:r.message)||((l=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to update order";b.error(a)}finally{at(!1)}}},yt=()=>{le||(Xt(null),Kt(""))};return e.jsxs(ne.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.4},className:"space-y-6",children:[e.jsx("header",{className:s("flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between"),children:e.jsxs("div",{children:[e.jsx("p",{className:s("text-xs","uppercase","tracking-[0.32em]","text-slate-400"),children:"Dashboard / Orders"}),e.jsx("h1",{className:s("mt-1","text-2xl","font-semibold","text-slate-900"),children:"Orders"})]})}),e.jsx("section",{className:s("grid","grid-cols-1","gap-4","md:grid-cols-2","xl:grid-cols-5"),children:Jt.map(t=>e.jsxs("div",{className:s("rounded-2xl","border","border-slate-200","bg-white","p-4","shadow-sm"),children:[e.jsx("p",{className:s("text-xs","font-semibold","uppercase","tracking-[0.18em]","text-slate-400"),children:t.label}),e.jsx("p",{className:s("mt-3","text-2xl","font-semibold","text-slate-900"),children:t.value})]},t.key))}),e.jsxs("section",{className:s("space-y-3","rounded-2xl","border","border-slate-200","bg-white","p-4","shadow-sm"),children:[e.jsxs("form",{onSubmit:ss,className:s("flex","flex-col","gap-3","lg:flex-row","lg:items-center"),children:[e.jsxs("div",{className:s("relative","flex-1"),children:[e.jsx("div",{className:s("pointer-events-none","absolute","inset-y-0","left-0","flex","items-center","pl-3"),children:e.jsx(ys,{size:16,className:"text-slate-400"})}),e.jsx("input",{type:"text",value:qe,onChange:t=>We(t.target.value),placeholder:"Search by order ID, product, or customer",className:s("w-full","rounded-xl","border","border-slate-200","bg-white","py-2","pl-9","pr-3","text-sm","text-slate-700","placeholder:text-slate-400","focus:border-blue-400","focus:outline-none")})]}),e.jsxs("div",{className:s("flex","gap-2"),children:[e.jsx("button",{type:"submit",className:s("rounded-xl","bg-blue-600","px-4","py-2","text-sm","font-semibold","text-white","shadow-sm","hover:bg-blue-700"),children:"Search"}),e.jsx("button",{type:"button",onClick:as,className:s("rounded-xl","border","border-slate-200","px-4","py-2","text-sm","font-semibold","text-slate-600","hover:border-blue-300","hover:text-blue-700"),children:"Reset"})]})]}),e.jsxs("div",{className:s("grid","gap-3","text-xs","text-slate-600","md:grid-cols-2","lg:grid-cols-4","xl:grid-cols-5"),children:[e.jsxs("label",{className:s("flex","flex-col","gap-1"),children:[e.jsx("span",{className:s("font-medium","text-slate-500"),children:"Status"}),e.jsx("select",{value:ce,onChange:t=>Ve(t.target.value),className:s("rounded-lg","border","border-slate-200","px-3","py-1.5","text-sm","text-slate-700","focus:border-blue-400","focus:outline-none"),children:Fs.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:s("flex","flex-col","gap-1"),children:[e.jsx("span",{className:s("font-medium","text-slate-500"),children:"Payment"}),e.jsx("select",{value:ue,onChange:t=>Xe(t.target.value),className:s("rounded-lg","border","border-slate-200","px-3","py-1.5","text-sm","text-slate-700","focus:border-blue-400","focus:outline-none"),children:Ts.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:s("grid","grid-cols-2","gap-3"),children:[e.jsxs("label",{className:s("flex","flex-col","gap-1"),children:[e.jsx("span",{className:s("font-medium","text-slate-500"),children:"Start date"}),e.jsx("input",{type:"date",value:ke,onChange:t=>Ke(t.target.value),className:s("rounded-lg","border","border-slate-200","px-3","py-1.5","text-sm","text-slate-700","focus:border-blue-400","focus:outline-none")})]}),e.jsxs("label",{className:s("flex","flex-col","gap-1"),children:[e.jsx("span",{className:s("font-medium","text-slate-500"),children:"End date"}),e.jsx("input",{type:"date",value:Ie,onChange:t=>Ge(t.target.value),className:s("rounded-lg","border","border-slate-200","px-3","py-1.5","text-sm","text-slate-700","focus:border-blue-400","focus:outline-none")})]})]}),e.jsxs("div",{className:s("grid","grid-cols-2","gap-3"),children:[e.jsxs("label",{className:s("flex","flex-col","gap-1"),children:[e.jsx("span",{className:s("font-medium","text-slate-500"),children:"Amount min"}),e.jsx("input",{type:"text",inputMode:"decimal",value:Ce,onChange:t=>nt("min",t.target.value),className:s("rounded-lg","border","border-slate-200","px-3","py-1.5","text-sm","text-slate-700","focus:border-blue-400","focus:outline-none"),placeholder:"Min"})]}),e.jsxs("label",{className:s("flex","flex-col","gap-1"),children:[e.jsx("span",{className:s("font-medium","text-slate-500"),children:"Amount max"}),e.jsx("input",{type:"text",inputMode:"decimal",value:Pe,onChange:t=>nt("max",t.target.value),className:s("rounded-lg","border","border-slate-200","px-3","py-1.5","text-sm","text-slate-700","focus:border-blue-400","focus:outline-none"),placeholder:"Max"})]})]}),e.jsxs("label",{className:s("flex","flex-col","gap-1"),children:[e.jsx("span",{className:s("font-medium","text-slate-500"),children:"Sort"}),e.jsx("select",{value:De,onChange:t=>Ze(t.target.value),className:s("rounded-lg","border","border-slate-200","px-3","py-1.5","text-sm","text-slate-700","focus:border-blue-400","focus:outline-none"),children:$s.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]})]}),Y&&e.jsxs("div",{className:s("flex","items-center","gap-3","rounded-2xl","border","border-rose-200","bg-rose-50","px-4","py-3","text-sm","text-rose-600"),children:[e.jsx(Ds,{size:16}),Y]}),e.jsxs("section",{className:s("overflow-visible","md:overflow-hidden","rounded-3xl","border","border-slate-200","bg-white","shadow-sm"),children:[e.jsxs("div",{className:s("pb-2","flex","flex-wrap","items-center","justify-between","gap-3","border-b","border-slate-100","px-4","py-3","text-sm","text-slate-500"),children:[e.jsx("div",{children:B.total>0?e.jsxs(e.Fragment,{children:["Showing",e.jsx("span",{className:s("font-semibold","text-slate-700"),children:ls}),"-",e.jsx("span",{className:s("font-semibold","text-slate-700"),children:rs})," ","of",e.jsxs("span",{className:s("font-semibold","text-slate-700"),children:[" ",B.total]})]}):"Showing 0 of 0"}),e.jsxs("div",{className:s("flex","flex-wrap","items-center","gap-3"),children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>je(t=>!t),className:s("inline-flex","items-center","gap-2","rounded-full","border","border-slate-200","px-3","py-1.5","text-xs","font-semibold","text-slate-600","transition","hover:border-blue-200","hover:text-blue-600"),children:[e.jsx(Me,{size:14})," Export"]}),e.jsx(Te,{children:Gt&&e.jsxs(ne.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.18},className:s("absolute","left-0","top-full","z-20","mt-2","w-44","rounded-xl","border","border-slate-200","bg-white","text-left","shadow-xl","origin-top-left","sm:left-auto","sm:right-0","sm:origin-top-right"),children:[e.jsx("button",{type:"button",onClick:()=>{Zt(),je(!1)},className:s("block","w-full","px-4","py-2","text-xs","text-slate-600","hover:bg-slate-50"),children:"Export as CSV"}),e.jsx("button",{type:"button",onClick:()=>{es(),je(!1)},className:s("block","w-full","px-4","py-2","text-xs","text-slate-600","hover:bg-slate-50"),children:"Export as XLSX"}),e.jsx("button",{type:"button",onClick:()=>{ts(),je(!1)},className:s("block","w-full","px-4","py-2","text-xs","text-slate-600","hover:bg-slate-50"),children:"Export as PDF"})]})})]}),e.jsxs("button",{type:"button",onClick:is,disabled:!W.length||Qt||A,className:s("inline-flex","items-center","gap-2","rounded-full","border","border-rose-100","px-3","py-1.5","text-xs","font-semibold","text-rose-600","transition","hover:border-rose-200","hover:bg-rose-50","disabled:cursor-not-allowed","disabled:opacity-60"),children:[e.jsx(Be,{size:14}),e.jsxs("span",{children:["Delete selected",W.length?` (${W.length})`:""]})]})]})]}),e.jsx("div",{className:s("hidden","overflow-x-auto","md:block"),children:e.jsxs("table",{className:s("min-w-full","divide-y","divide-slate-100","text-sm"),children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{className:s("text-left","text-xs","font-medium","uppercase","text-slate-500"),children:[e.jsx("th",{className:s("px-4","py-3"),children:e.jsx("input",{type:"checkbox",checked:ot,onChange:ns,className:s("h-4","w-4","rounded","border-slate-300","text-blue-600","focus:ring-blue-500"),"aria-label":"Select all orders"})}),e.jsx("th",{className:s("px-4","py-3"),children:"Order ID"}),e.jsx("th",{className:s("px-4","py-3"),children:"Product"}),e.jsx("th",{className:s("px-4","py-3"),children:"Date"}),e.jsx("th",{className:s("px-4","py-3"),children:"Customer"}),e.jsx("th",{className:s("px-4","py-3","text-center"),children:"QR"}),e.jsx("th",{className:s("px-4","py-3"),children:"Total"}),e.jsx("th",{className:s("px-4","py-3"),children:"Status"}),e.jsx("th",{className:s("px-4","py-3","text-right"),children:"Action"})]})}),e.jsxs("tbody",{className:s("divide-y","divide-slate-100","bg-white","text-sm","text-slate-600"),children:[A&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:s("px-4","py-8","text-center","text-slate-400"),children:"Loading orders..."})}),Y&&!A&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:s("px-4","py-8","text-center","text-rose-500"),children:Y})}),!A&&!Y&&U.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:s("px-4","py-8","text-center","text-slate-400"),children:"No orders found for the selected filters."})}),!A&&!Y&&U.map(t=>{var g,L,S,Q;const l=String(t.orderId||t.id||t._id||""),r=t.orderId?String(t.orderId):l,a=((g=t.items)==null?void 0:g[0])||{},i=a.image||null,d=Math.max((((L=t.items)==null?void 0:L.length)||0)-1,0),m=((S=t.qrfolio)==null?void 0:S.imageUrl)||((Q=t.qrfolio)==null?void 0:Q.image)||"",c=t.buyerName||"Customer",N=t.buyerEmail||"",h=W.includes(r),x=String(t.paymentStatus||"pending").toLowerCase(),I=x==="paid",u=String(t.status||"").toLowerCase(),j=$t[u]||"bg-slate-50 text-slate-600 border border-slate-200";return e.jsxs("tr",{className:h?"bg-slate-50":void 0,children:[e.jsx("td",{className:s("px-4","py-3","align-middle"),children:e.jsx("input",{type:"checkbox",checked:h,onChange:()=>dt(t.orderId),className:s("h-4","w-4","rounded","border-slate-300","text-blue-600","focus:ring-blue-500"),"aria-label":`Select order ${t.orderId}`})}),e.jsxs("td",{className:s("px-4","py-3","font-semibold","text-slate-700"),children:["#",t.orderId]}),e.jsx("td",{className:s("px-4","py-3"),children:e.jsxs("div",{className:s("flex","items-center","gap-3"),children:[e.jsx("div",{className:s("h-10","w-10","overflow-hidden","rounded-xl","bg-slate-100"),children:i?e.jsx("img",{src:i,alt:a.productName||a.itemName||"Product",className:s("h-full","w-full","object-cover")}):e.jsx("div",{className:s("grid","h-full","w-full","place-items-center","text-xs","text-slate-400"),children:"Img"})}),e.jsxs("div",{className:s("text-sm","text-slate-600"),children:[e.jsx("p",{className:s("font-medium","text-slate-800"),children:a.productName||a.itemName||"Product"}),d>0&&e.jsxs("p",{className:s("text-xs","text-slate-400"),children:["+ ",d," other items"]})]})]})}),e.jsx("td",{className:s("px-4","py-3","text-slate-500"),children:ae(t.createdAt)}),e.jsx("td",{className:s("px-4","py-3"),children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:s("font-medium","text-slate-700"),children:c}),N?e.jsx("p",{className:s("break-all","text-xs","text-slate-500"),children:N}):null]})}),e.jsx("td",{className:s("px-4","py-3","text-center"),children:e.jsx("button",{type:"button",onClick:async()=>{if(!r){b.error("Order reference unavailable");return}if(!m){b.error("QR code not available for this order yet.");return}try{we(r),await $e({qrUrl:m,orderId:t.orderId||r,filePrefix:"order-qr",title:c}),b.success("QR code saved as PDF")}catch(G){b.error((G==null?void 0:G.message)||"Failed to download QR code")}finally{we(null)}},disabled:!m||ve===r,className:s("inline-flex","h-8","w-8","items-center","justify-center","rounded-full","border","border-slate-200","text-slate-500","transition","hover:border-blue-200","hover:bg-blue-50","disabled:cursor-not-allowed","disabled:opacity-60"),"aria-label":`Download QR for order ${t.orderId}`,children:ve===r?e.jsx(te,{size:16,className:"animate-spin"}):e.jsx(At,{size:16})})}),e.jsx("td",{className:s("px-4","py-3","font-semibold","text-slate-700"),children:se(t.total)}),e.jsx("td",{className:s("px-4","py-3"),children:e.jsxs("div",{className:s("flex","flex-col","items-start","gap-1"),children:[e.jsx("span",{className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium ${j}`,children:t.status}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium ${I?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:["Payment: ",x]})]})}),e.jsx("td",{className:s("px-4","py-3","text-right"),children:e.jsxs("div",{className:s("flex","justify-end","gap-2","text-sm"),children:[e.jsx("button",{type:"button",onClick:()=>ct(t),className:s("inline-flex","h-8","w-8","items-center","justify-center","rounded-full","border","border-blue-100","text-blue-600","transition","hover:border-blue-200","hover:bg-blue-50"),"aria-label":`View order ${t.orderId}`,children:e.jsx(Ft,{size:16})}),e.jsx("button",{type:"button",onClick:()=>ut(t),disabled:ge===t.orderId||A,className:s("inline-flex","h-8","w-8","items-center","justify-center","rounded-full","border","border-slate-200","text-slate-500","transition","hover:border-slate-300","hover:bg-slate-50"),"aria-label":`Download invoice for order ${t.orderId}`,children:ge===t.orderId?e.jsx(te,{size:16,className:"animate-spin"}):e.jsx(Me,{size:16})}),e.jsx("button",{type:"button",onClick:()=>mt(t),disabled:be===t.orderId||A,className:s("inline-flex","h-8","w-8","items-center","justify-center","rounded-full","border","border-rose-100","text-rose-600","transition","hover:border-rose-200","hover:bg-rose-50"),"aria-label":`Delete order ${t.orderId}`,children:be===t.orderId?e.jsx(te,{size:16,className:"animate-spin"}):e.jsx(Be,{size:16})}),e.jsx("button",{type:"button",onClick:()=>xt(t),className:s("inline-flex","h-8","w-8","items-center","justify-center","rounded-full","border","border-purple-100","text-purple-600","transition","hover:border-purple-200","hover:bg-purple-50"),"aria-label":`Edit order ${t.orderId}`,children:e.jsx(Tt,{size:16})})]})})]},l)})]})]})}),e.jsxs("div",{className:s("space-y-3","border-t","border-slate-100","px-4","py-4","md:hidden"),children:[A&&e.jsx("div",{className:s("rounded-3xl","border","border-slate-200","bg-white","p-5","text-center","text-slate-500"),children:e.jsxs("div",{className:s("inline-flex","items-center","gap-2","text-sm"),children:[e.jsx(te,{className:s("h-4","w-4","animate-spin")})," Loading orders..."]})}),!A&&Y&&e.jsx("div",{className:s("rounded-3xl","border","border-rose-200","bg-white","p-5","text-center","text-rose-600"),children:Y}),!A&&!Y&&U.length===0&&e.jsx("div",{className:s("rounded-3xl","border","border-slate-200","bg-white","p-5","text-center","text-slate-500"),children:"No orders found for the selected filters."}),!A&&!Y&&U.map(t=>{var j,g,L;const l=String(t.orderId||t.id||t._id||""),r=t.orderId?String(t.orderId):l,a=((j=t.items)==null?void 0:j[0])||{},i=a.image||null,d=a.productName||a.itemName||a.name||"Product",m=t.buyerName||"Customer",c=((g=t.qrfolio)==null?void 0:g.imageUrl)||((L=t.qrfolio)==null?void 0:L.image)||"",N=String(t.paymentStatus||"pending").toLowerCase(),h=N==="paid",x=String(t.status||"processing").toLowerCase(),I=$t[x]||"bg-slate-50 text-slate-600 border border-slate-200",u=W.includes(r);return e.jsxs("div",{className:`rounded-3xl border bg-white p-4 shadow-sm transition ${u?"border-blue-200 ring-1 ring-blue-200":"border-slate-200"}`,children:[e.jsxs("div",{className:s("flex","items-start","justify-between","gap-3"),children:[e.jsxs("div",{children:[e.jsx("div",{className:s("text-[11px]","font-semibold","uppercase","tracking-[0.26em]","text-slate-400"),children:"Order"}),e.jsxs("div",{className:s("mt-1","break-all","text-lg","font-semibold","text-slate-900"),children:["#",t.orderId]})]}),e.jsx("button",{type:"button",onClick:()=>dt(t.orderId),className:s("inline-flex","h-9","w-9","items-center","justify-center","rounded-full","border","border-slate-200","bg-white","text-blue-600","shadow-sm"),"aria-label":u?`Deselect order ${t.orderId}`:`Select order ${t.orderId}`,children:u?e.jsx(Ls,{size:18}):e.jsx(Os,{size:18})})]}),e.jsxs("div",{className:s("mt-3","flex","items-center","gap-3"),children:[e.jsx("div",{className:s("h-14","w-14","overflow-hidden","rounded-xl","bg-slate-100"),children:i?e.jsx("img",{src:i,alt:d,className:s("h-full","w-full","object-cover"),onError:S=>{S.currentTarget.src="https://placehold.co/80x80/f8fafc/e2e8f0?text=IMG"}}):e.jsx("div",{className:s("flex","h-full","w-full","items-center","justify-center","text-xs","text-slate-400"),children:"Img"})}),e.jsxs("div",{className:s("flex-1","space-y-0.5"),children:[e.jsx("p",{className:s("text-sm","font-semibold","text-slate-900"),children:d}),e.jsx("p",{className:s("text-xs","text-slate-500"),children:m})]})]}),e.jsxs("div",{className:s("mt-3","grid","grid-cols-2","gap-3","text-xs","text-slate-500"),children:[e.jsxs("div",{className:s("rounded-xl","bg-slate-50","p-2"),children:[e.jsx("p",{className:s("uppercase","text-[10px]","tracking-wide","text-slate-400"),children:"Placed"}),e.jsx("p",{className:s("mt-1","text-xs","font-medium","text-slate-700"),children:ae(t.createdAt)})]}),e.jsxs("div",{className:s("rounded-xl","bg-slate-50","p-2"),children:[e.jsx("p",{className:s("uppercase","text-[10px]","tracking-wide","text-slate-400"),children:"Amount"}),e.jsx("p",{className:s("mt-1","text-sm","font-semibold","text-slate-900"),children:se(t.total)})]}),e.jsxs("div",{className:s("rounded-xl","bg-slate-50","p-2"),children:[e.jsx("p",{className:s("uppercase","text-[10px]","tracking-wide","text-slate-400"),children:"Status"}),e.jsx("span",{className:`mt-1 inline-flex items-center gap-2 rounded-full px-2.5 py-1 text-[11px] font-semibold ${I}`,children:t.status})]}),e.jsxs("div",{className:s("rounded-xl","bg-slate-50","p-2"),children:[e.jsx("p",{className:s("uppercase","text-[10px]","tracking-wide","text-slate-400"),children:"Payment"}),e.jsx("span",{className:`mt-1 inline-flex items-center gap-2 rounded-full px-2.5 py-1 text-[11px] font-semibold ${h?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:`Payment: ${N}`})]})]}),e.jsxs("div",{className:s("mt-4","flex","flex-wrap","items-center","gap-2","text-xs","font-semibold"),children:[e.jsx("button",{type:"button",onClick:async()=>{if(!t.orderId&&!r){b.error("Order reference unavailable");return}if(!c){b.error("QR code not available for this order yet.");return}try{we(r),await $e({qrUrl:c,orderId:t.orderId||r,filePrefix:"order-qr",title:m}),b.success("QR code saved as PDF")}catch(S){b.error((S==null?void 0:S.message)||"Failed to download QR code")}finally{we(null)}},disabled:!c||ve===r,className:s("inline-flex","h-9","w-9","items-center","justify-center","rounded-full","border","border-slate-200","text-slate-500","transition","hover:border-blue-200","hover:bg-blue-50","disabled:cursor-not-allowed","disabled:opacity-60"),"aria-label":`Download QR for order ${t.orderId}`,children:ve===r?e.jsx(te,{size:16,className:"animate-spin"}):e.jsx(At,{size:16})}),e.jsx("button",{type:"button",onClick:()=>ct(t),className:s("inline-flex","h-9","w-9","items-center","justify-center","rounded-full","border","border-blue-100","text-blue-600","transition","hover:border-blue-200","hover:bg-blue-50"),"aria-label":`View order ${t.orderId}`,children:e.jsx(Ft,{size:16})}),e.jsx("button",{type:"button",onClick:()=>ut(t),disabled:ge===t.orderId||A,className:s("inline-flex","h-9","w-9","items-center","justify-center","rounded-full","border","border-slate-200","text-slate-500","transition","hover:border-slate-300","hover:bg-slate-50","disabled:cursor-not-allowed","disabled:opacity-60"),"aria-label":`Download invoice for order ${t.orderId}`,children:ge===t.orderId?e.jsx(te,{size:16,className:"animate-spin"}):e.jsx(Me,{size:16})}),e.jsx("button",{type:"button",onClick:()=>mt(t),disabled:be===t.orderId||A,className:s("inline-flex","h-9","w-9","items-center","justify-center","rounded-full","border","border-rose-100","text-rose-600","transition","hover:border-rose-200","hover:bg-rose-50","disabled:cursor-not-allowed","disabled:opacity-60"),"aria-label":`Delete order ${t.orderId}`,children:be===t.orderId?e.jsx(te,{size:16,className:"animate-spin"}):e.jsx(Be,{size:16})}),e.jsx("button",{type:"button",onClick:()=>xt(t),className:s("inline-flex","h-9","w-9","items-center","justify-center","rounded-full","border","border-purple-100","text-purple-600","transition","hover:border-purple-200","hover:bg-purple-50"),"aria-label":`Edit order ${t.orderId}`,children:e.jsx(Tt,{size:16})})]})]},r)})]})]}),e.jsxs("footer",{className:s("flex","flex-col","justify-between","gap-3","border-t","border-slate-200","bg-slate-50","px-5","py-4","text-xs","text-slate-500","sm:flex-row","sm:items-center"),children:[e.jsx("div",{className:s("flex","items-center","gap-3"),children:e.jsxs("label",{className:s("flex","items-center","gap-2"),children:[e.jsx("span",{className:"text-slate-600",children:"Rows per page"}),e.jsxs("select",{value:me,onChange:t=>{const l=Number(t.target.value)||10;Wt(l),de(1)},className:s("rounded-xl","border","border-slate-300","bg-white","px-2","py-1","text-xs","text-slate-700","focus:border-blue-400","focus:outline-none"),children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"})]})]})}),e.jsxs("div",{className:s("flex","items-center","gap-3"),children:[e.jsxs("span",{children:["Page ",Z," of ",B.totalPages||1]}),e.jsxs("div",{className:s("flex","items-center","gap-2"),children:[e.jsx("button",{type:"button",onClick:()=>de(t=>Math.max(t-1,1)),disabled:Z<=1||A,className:s("rounded-full","border","border-slate-300","px-3","py-1","text-xs","font-semibold","text-slate-600","transition","enabled:hover:border-blue-200","enabled:hover:bg-blue-50","enabled:hover:text-blue-600","disabled:cursor-not-allowed","disabled:opacity-40"),children:"Prev"}),e.jsx("button",{type:"button",onClick:()=>de(t=>t<B.totalPages?t+1:t),disabled:Z>=B.totalPages||A,className:s("rounded-full","border","border-slate-300","px-3","py-1","text-xs","font-semibold","text-slate-600","transition","enabled:hover:border-blue-200","enabled:hover:bg-blue-50","enabled:hover:text-blue-600","disabled:cursor-not-allowed","disabled:opacity-40"),children:"Next"})]})]})]}),lt&&gs.createPortal(e.jsxs(e.Fragment,{children:[e.jsx(Te,{children:(D||le||ye)&&e.jsx(ne.div,{className:s("fixed","inset-0","z-[1200]","flex","h-screen","w-screen","items-center","justify-center","bg-slate-900/60","p-4","backdrop-blur-sm"),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:yt,children:e.jsxs(ne.div,{initial:{y:24,opacity:0},animate:{y:0,opacity:1},exit:{y:24,opacity:0},transition:{duration:.2},className:s("modal-scroll","w-full","max-w-2xl","overflow-y-auto","rounded-2xl","bg-white","p-5","shadow-xl","md:max-h-[calc(100vh-4rem)]"),"data-modal-dvh":"true",style:{maxHeight:"calc(100vh - 2.5rem)"},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:s("mb-4","flex","items-center","justify-between","gap-3"),children:[e.jsxs("div",{children:[e.jsx("p",{className:s("text-xs","uppercase","tracking-[0.22em]","text-slate-400"),children:"Order details"}),D&&e.jsxs("h2",{className:s("mt-1","text-lg","font-semibold","text-slate-900"),children:["#",D._id]})]}),e.jsx("button",{type:"button",onClick:yt,className:s("inline-flex","h-8","w-8","items-center","justify-center","rounded-full","border","border-slate-200","text-slate-500","hover:border-slate-300","hover:text-slate-800"),"aria-label":"Close order details",children:"×"})]}),le&&e.jsxs("div",{className:s("flex","items-center","justify-center","gap-2","py-10","text-sm","text-slate-500"),children:[e.jsx(te,{className:s("h-4","w-4","animate-spin")}),e.jsx("span",{children:"Loading order details..."})]}),!le&&ye&&!D&&e.jsx("div",{className:s("rounded-xl","border","border-rose-200","bg-rose-50","px-4","py-3","text-sm","text-rose-600"),children:ye}),!le&&D&&e.jsxs("div",{className:s("space-y-4","text-sm","text-slate-700"),children:[e.jsxs("div",{className:s("flex","flex-wrap","items-center","justify-between","gap-3"),children:[e.jsxs("div",{children:[e.jsxs("p",{className:s("text-xs","text-slate-500"),children:["Placed on ",ae(D.createdAt)]}),e.jsxs("p",{className:s("text-xs","text-slate-500"),children:["Payment status:"," ",((vt=D.payment)==null?void 0:vt.status)||"--"]})]}),e.jsxs("div",{className:s("text-right","text-sm","text-slate-600"),children:[e.jsxs("p",{children:["Buyer:"," ",((wt=D.shippingAddress)==null?void 0:wt.fullName)||"--"]}),((Nt=D.shippingAddress)==null?void 0:Nt.mobile)&&e.jsxs("p",{className:s("flex","items-center","justify-end","gap-1","text-xs","text-slate-500"),children:[e.jsx(As,{size:12,className:"text-slate-400"}),D.shippingAddress.mobile]}),((St=D.shippingAddress)==null?void 0:St.email)&&e.jsxs("p",{className:s("flex","items-center","justify-end","gap-1","text-xs","text-slate-500"),children:[e.jsx(Us,{size:12,className:"text-slate-400"}),D.shippingAddress.email]})]})]}),e.jsxs("div",{className:s("rounded-2xl","border","border-slate-200","bg-slate-50","p-4"),children:[e.jsx("p",{className:s("text-xs","font-semibold","uppercase","tracking-[0.16em]","text-slate-500"),children:"Items"}),e.jsx("div",{className:s("mt-3","space-y-3"),children:Array.isArray(D.items)&&D.items.length>0?D.items.map((t,l)=>e.jsxs("div",{className:s("flex","flex-wrap","items-center","justify-between","gap-3","text-sm"),children:[e.jsxs("div",{className:s("flex","items-center","gap-3"),children:[e.jsx("div",{className:s("h-10","w-10","overflow-hidden","rounded-xl","bg-slate-100"),children:t.image?e.jsx("img",{src:t.image,alt:t.name||"Product",className:s("h-full","w-full","object-cover")}):e.jsx("div",{className:s("flex","h-full","w-full","items-center","justify-center","text-[10px]","text-slate-400"),children:e.jsx(Es,{size:14})})}),e.jsxs("div",{children:[e.jsx("p",{className:s("font-medium","text-slate-900"),children:t.name||"Product"}),e.jsxs("p",{className:s("text-xs","text-slate-500"),children:["Qty: ",t.quantity||0]})]})]}),e.jsxs("div",{className:s("text-right","text-sm","text-slate-700"),children:[e.jsx("p",{children:se(t.price||0)}),e.jsxs("p",{className:s("text-xs","text-slate-500"),children:["Total:"," ",se((t.price||0)*(t.quantity||0))]})]})]},`${t.product||t.name}-${l}`)):e.jsx("p",{className:s("py-4","text-sm","text-slate-500"),children:"No items recorded for this order."})})]}),e.jsxs("div",{className:s("grid","gap-3","md:grid-cols-2"),children:[e.jsxs("div",{className:s("rounded-2xl","border","border-slate-200","bg-white","p-4","text-sm","text-slate-700"),children:[e.jsx("p",{className:s("text-xs","font-semibold","uppercase","tracking-[0.16em]","text-slate-500"),children:"Shipping address"}),e.jsxs("div",{className:s("mt-2","space-y-1"),children:[e.jsx("p",{children:(kt=D.shippingAddress)==null?void 0:kt.addressLine}),e.jsxs("p",{children:[(It=D.shippingAddress)==null?void 0:It.city,","," ",(Ct=D.shippingAddress)==null?void 0:Ct.state," -"," ",(Pt=D.shippingAddress)==null?void 0:Pt.pincode]})]})]}),e.jsxs("div",{className:s("rounded-2xl","border","border-slate-200","bg-white","p-4","text-sm","text-slate-700"),children:[e.jsx("p",{className:s("text-xs","font-semibold","uppercase","tracking-[0.16em]","text-slate-500"),children:"Payment summary"}),e.jsxs("div",{className:s("mt-2","space-y-1"),children:[e.jsxs("p",{children:["Subtotal:"," ",se(((Dt=D.pricing)==null?void 0:Dt.subtotal)||0)]}),e.jsxs("p",{children:["Shipping:"," ",se(((Lt=D.pricing)==null?void 0:Lt.shippingFee)||0)]}),e.jsxs("p",{children:["Tax:"," ",se(((Ot=D.pricing)==null?void 0:Ot.taxAmount)||0)]}),e.jsxs("p",{className:s("font-semibold","text-slate-900"),children:["Total:"," ",se(((Et=D.pricing)==null?void 0:Et.total)||0)]})]})]})]})]})]})})}),e.jsx(Te,{children:F&&e.jsx(ne.div,{className:s("fixed","inset-0","z-[1200]","flex","h-screen","w-screen","items-center","justify-center","bg-slate-900/60","p-4","backdrop-blur-sm"),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:Ee,children:e.jsxs(ne.div,{initial:{y:24,opacity:0},animate:{y:0,opacity:1},exit:{y:24,opacity:0},transition:{duration:.2},className:s("w-full","max-w-lg","rounded-2xl","bg-white","p-6","shadow-xl"),onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:s("mb-4","flex","items-start","justify-between"),children:[e.jsxs("div",{children:[e.jsx("h2",{className:s("text-xl","font-semibold","text-slate-900"),children:"Edit Order"}),e.jsxs("p",{className:s("text-xs","text-slate-500"),children:["Order #",F._id]})]}),e.jsx("button",{type:"button",className:s("rounded-full","p-1","text-slate-400","hover:bg-slate-100","hover:text-slate-600"),onClick:Ee,"aria-label":"Close edit order",disabled:pe,children:e.jsx(js,{size:18})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:s("block","text-sm","font-medium","text-slate-700"),children:["Order Status",e.jsxs("select",{value:O.status,onChange:os,className:s("mt-1","w-full","rounded-xl","border","border-slate-200","px-3","py-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500"),disabled:ft,children:[e.jsx("option",{value:"confirmed",children:"Order Confirmed"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"picked_up",children:"Picked Up"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"out_for_delivery",children:"Out for Delivery"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"returned",children:"Returned"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),String(O.status||"").toLowerCase()==="rejected"&&e.jsxs("label",{className:s("mt-1","flex","items-center","gap-2","text-xs","font-medium","text-rose-600"),children:[e.jsx("input",{type:"checkbox",className:s("h-4","w-4","rounded","border-slate-300","text-rose-600","focus:ring-rose-500"),checked:!!O.rejectionPermanent,onChange:t=>he("rejectionPermanent",t.target.checked)}),e.jsx("span",{children:"Lock status after rejection (prevent further status changes)"})]}),ft?e.jsx("p",{className:s("text-xs","text-rose-500"),children:"Unlock the toggle above to change the order status."}):null,e.jsxs("div",{className:s("grid","gap-4","sm:grid-cols-2"),children:[e.jsxs("label",{className:s("block","text-sm","font-medium","text-slate-700"),children:["Payment Status",e.jsxs("select",{value:O.paymentStatus,disabled:bt,onChange:t=>he("paymentStatus",t.target.value),className:s("mt-1","w-full","rounded-xl","border","border-slate-200","px-3","py-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500"),children:[e.jsx("option",{value:"",children:"Keep unchanged"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Successful"}),e.jsx("option",{value:"failed",children:"Failed"})]}),bt?e.jsx("p",{className:s("mt-1","text-xs","text-slate-500"),children:"Payment is already marked successful and cannot be changed."}):null]}),e.jsxs("label",{className:s("block","text-sm","font-medium","text-slate-700"),children:["Payment Method",e.jsxs("select",{value:O.paymentMethod,onChange:t=>he("paymentMethod",t.target.value),className:s("mt-1","w-full","rounded-xl","border","border-slate-200","px-3","py-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500"),children:[e.jsx("option",{value:"",children:"Keep unchanged"}),e.jsx("option",{value:"cod",children:"Cash on Delivery"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"qr",children:"QR Code"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"netbanking",children:"Net Banking"})]})]})]}),e.jsxs("label",{className:s("block","text-sm","font-medium","text-slate-700"),children:["Estimated Delivery Date",e.jsx("input",{type:"date",value:O.estimatedDeliveryDate,disabled:Re,onChange:us,className:s("mt-1","w-full","rounded-xl","border","border-slate-200","px-3","py-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500")}),Re?e.jsxs("p",{className:s("mt-1","text-xs","text-slate-500"),children:["Delivery date is locked because the order has already been"," ",(F==null?void 0:F.status)==="returned"?"been resolved":"been delivered","."]}):null]}),e.jsxs("div",{className:s("grid","gap-4","sm:grid-cols-2"),children:[e.jsxs("label",{className:s("block","text-sm","font-medium","text-slate-700"),children:["Courier",e.jsx("select",{value:O.courier,onChange:t=>he("courier",t.target.value),className:s("mt-1","w-full","rounded-xl","border","border-slate-200","px-3","py-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500"),children:Ms.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:s("block","text-sm","font-medium","text-slate-700"),children:["Tracking ID",e.jsx("input",{type:"text",value:O.trackingId,onChange:t=>he("trackingId",t.target.value),className:s("mt-1","w-full","rounded-xl","border","border-slate-200","px-3","py-2","text-sm","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500"),placeholder:"To be assigned"})]})]})]}),e.jsxs("div",{className:s("mt-6","flex","flex-wrap","items-center","justify-end","gap-3"),children:[ze&&!Ue?e.jsx("p",{className:s("mr-auto","text-xs","text-rose-500"),children:"Mark payment as successful before setting the order to Delivered."}):null,e.jsx("button",{type:"button",className:s("rounded-xl","border","border-slate-200","px-4","py-2","text-sm","text-slate-600","hover:bg-slate-50"),onClick:Ee,disabled:pe,children:"Cancel"}),e.jsx("button",{type:"button",className:s("rounded-xl","bg-blue-600","px-5","py-2","text-sm","font-semibold","text-white","shadow-sm","hover:bg-blue-700","disabled:cursor-not-allowed","disabled:opacity-60"),onClick:ms,disabled:pe||!cs,children:pe?"Saving...":"Save Changes"})]})]})})})]}),lt)]})};export{ia as default};
