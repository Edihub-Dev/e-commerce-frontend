import{r as n,j as e,y as Re,u as Te,b as Nt,d as mt,M as ua,L as Fe,T as Ta,P as Wl,X as Ze,e as qr,S as Zt,U as wt,C as xa,f as Ia,h as ut,O as Br,i as Vr,k as Hr,l as Gr,m as rs,n as Qr,o as $t,p as Yl,R as Wr,q as Kl,s as ft,t as Je,v as $a,w as Ie,z as ge,x as ne,Q as Jl,A as Xl,B as _a,D as jt,E as Zl,F as Yr,G as _t,H as Ma,I as en,J as sr,K as tn,N as sn,V as Ps,W as et,Y as as,Z as an,_ as Kr,$ as rn,a0 as ln,a1 as nn,a2 as on,a3 as cn,a4 as dn,a5 as mn,a6 as un,a7 as xn,a8 as Jr,a9 as Ds,aa as pn,ab as Wt,ac as gs,ad as hn,ae as Xr,af as ra,ag as fn,ah as Cs,ai as bn,aj as Zr,ak as gn,al as ar,am as yn,an as jn,ao as Ua,ap as el,aq as Nn,ar as vn,as as tl,at as wn,au as Sn,av as Cn,aw as kn,ax as An,ay as Pn,az as Dn,aA as rr,aB as Rn,aC as ke,aD as In,aE as Fn,aF as En,aG as Ln,aH as zn}from"./react-DyTdMek6.js";import{a as On}from"./axios-B9ygI19o.js";import{ac as Ft,ad as We,ae as Tn,af as $n,ag as yt,ah as me,ai as _n,aj as Mn,ak as Un}from"./vendor-D4hryde_.js";import{A as ze,h as Q,P as sl,i as al,Z as qn}from"./ui-DT9BAWJ9.js";import{u as es,w as rl}from"./xlsx-3SA47z_C.js";import{a7 as Bn}from"./utils-DwDy1O30.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(r){if(r.ep)return;r.ep=!0;const c=a(r);fetch(r.href,c)}})();const Kt="ecom-mega-mart",ll="ap-south-1",Vn=`https://${Kt}.s3.${ll}.amazonaws.com`,ys=Vn.replace(/\/$/,""),Hn=`${Kt}.s3.amazonaws.com`,Gn=`s3.${ll}.amazonaws.com`,Qn="s3.amazonaws.com",Jt=t=>{var a;if(!t||typeof t!="string")return t;if(t.startsWith("http"))try{const l=new URL(t),r=(a=l.pathname)==null?void 0:a.replace(/^\/+/,"");return r?l.hostname===Hn?`${ys}/${r}`:l.hostname===Gn&&r.startsWith(`${Kt}/`)?`${ys}/${r.slice(Kt.length+1)}`:l.hostname===Qn&&r.startsWith(`${Kt}/`)?`${ys}/${r.slice(Kt.length+1)}`:t:`${ys}/`}catch{return t}if(t.startsWith("data:")||t.startsWith("blob:"))return t;const s=t.replace(/^\/+/,"");return`${ys}/${s}`},fe=On.create({baseURL:"https://apis.qrfolio.net/api",withCredentials:!0});fe.interceptors.request.use(t=>{const s=localStorage.getItem("authToken");return s?t.headers.Authorization=`Bearer ${s}`:delete t.headers.Authorization,t});const Wn=(t,s)=>{const a=t==null?void 0:t.data;if(!a)throw new Error(s);if(a.success===!1)throw new Error(a.message||s);return a},tt=async(t,s)=>{var a,l;try{const r=await t();return Wn(r,s)}catch(r){const c=((l=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:l.message)||(r==null?void 0:r.message)||s;throw new Error(c)}},Yn=(t={})=>{const s=Number(t.price??0),a=Number(t.originalPrice??t.price??t.costPrice??s),l=s||a,r=a||l,c=t.discountPercentage??(r>l?Math.round((r-l)/r*100):0),o=t.saveAmount??(c>0?r-l:0);return{price:l,originalPrice:r,discountPercentage:c,saveAmount:o}},Kn=t=>Array.isArray(t)?t.map(s=>{var r;const a=(r=s==null?void 0:s.label)==null?void 0:r.toString().trim();if(!a)return null;const l=Math.max(Number((s==null?void 0:s.stock)??0),0);return{label:a,isAvailable:!!((s==null?void 0:s.isAvailable)??!0),stock:l}}).filter(Boolean):[],nl=(t={})=>{var g,R;const{price:s,originalPrice:a,discountPercentage:l,saveAmount:r}=Yn(t),c=Array.isArray(t.gallery)?t.gallery.map(u=>Jt(u)):[],o=Jt(t.thumbnail||t.image||c[0]||""),i=Array.isArray(t.keyFeatures)?t.keyFeatures.map(u=>u==null?void 0:u.toString().trim()).filter(Boolean):[],d=t.reviews??((g=t.ratings)==null?void 0:g.totalReviews)??0,p=t.rating??((R=t.ratings)==null?void 0:R.average)??0,x=Number.isFinite(Number(d))?Number(d):0,D=x>0&&Number(p)||0;return{id:t.slug||t._id,slug:t.slug||"",mongoId:t._id,name:t.name||"Unnamed Product",description:t.shortDescription||"",image:o,gallery:c,price:s,originalPrice:a,discount:l,saveAmount:r,rating:D,reviews:x,availabilityStatus:t.availabilityStatus,brand:t.brand||"",category:t.category||"",categoryPriority:t.categoryPriority||"P5",currency:t.currency||"INR",keyFeatures:i,sizes:Kn(t.sizes),showSizes:!!t.showSizes}},Jn=(t={})=>{const s=nl(t),a=Array.isArray(t.keyFeatures)?t.keyFeatures.map(o=>o==null?void 0:o.toString().trim()).filter(Boolean):s.keyFeatures||[],l=Array.isArray(t.gallery)?t.gallery.map(o=>Jt(o)):s.gallery||[],r=Array.isArray(t.images)?t.images.map(o=>Jt(o)):[],c=Array.isArray(t.variants)?t.variants.map(o=>({...o,imageUrl:Jt(o==null?void 0:o.imageUrl)})):[];return{...s,description:t.description||s.description,shortDescription:t.shortDescription||s.description,gallery:l,images:r,thumbnail:Jt(t.thumbnail)||s.image,metadata:t.metadata||{},attributes:t.attributes||{},variants:c,stock:t.stock??0,keyFeatures:a,features:a,sizes:s.sizes,showSizes:s.showSizes,categoryPriority:s.categoryPriority,reviewsList:Array.isArray(t.reviewsList)?t.reviewsList:[],reviewsSummary:t.reviewsSummary||{totalReviews:s.reviews??0,average:s.rating??0,totalScore:(s.reviews??0)*((s.rating??0)||0)}}},il=(t="")=>String(t).replace(/-/g," ").replace(/_/g," ").trim(),Ut=async(t={})=>{const s=await tt(()=>fe.get("/products",{params:t}),"Failed to fetch products");return{data:Array.isArray(s.data)?s.data.map(nl):[],meta:s.meta||{}}},Xn=(t={})=>Ut(t),Zn=(t={})=>Ut({isFeatured:!0,...t}),ol=(t,s={})=>Ut({brand:il(t),...s}),ei=(t,s={})=>Ut({category:il(t),...s}),ti=async t=>{const s=await tt(()=>fe.get(`/products/${t}`),"Failed to fetch product");return{data:Jn(s.data||{})}},si=async({email:t,newPassword:s})=>{var a,l;try{return(await fe.post("/auth/password-reset/request",{email:t,newPassword:s})).data}catch(r){const c=((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to request password reset";throw new Error(c)}},ai=async({email:t,otp:s})=>{var a,l;try{return(await fe.post("/auth/password-reset/verify",{email:t,otp:s})).data}catch(r){const c=((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to verify reset code";throw new Error(c)}},ri=async({email:t})=>{var s,a;try{return(await fe.post("/auth/verify-email/resend",{email:t})).data}catch(l){const r=((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to resend verification code";throw new Error(r)}},qa=async()=>(await fe.get("/user/address/get")).data,li=async t=>(await fe.post("/user/address/add",t)).data,cl=async(t,s)=>(await fe.patch(`/user/address/update/${t}`,s)).data,ni=async t=>(await fe.delete(`/user/address/remove/${t}`)).data,ii=async t=>(await fe.post("/orders/create",t)).data,oi=async t=>(await fe.post("/payments/create",t)).data,ci=async t=>(await fe.get(`/payments/status/${t}`)).data,di=async()=>(await fe.get("/orders/my")).data,Ba=async t=>(await fe.get(`/orders/${t}`)).data,mi=async(t,s)=>(await fe.post(`/orders/${t}/replacement`,s)).data,ui=async(t,s)=>(await fe.patch(`/orders/${t}/replacement`,s)).data,xi=async(t,s)=>(await fe.patch(`/orders/${t}`,s)).data,pi=async(t,s)=>(await fe.post(`/orders/${t}/rate`,s)).data,dl=n.createContext(),hi=(t="")=>t.toLowerCase().replace(/[^a-z0-9\-_\/.@#&+]+/g," ").replace(/\s+/g," ").trim(),qt=t=>{if(!t)return;const s=t.toString().trim().toLowerCase();if(!s)return;const a=s.endsWith("k")?1e3:s.endsWith("m")?1e6:1,l=a===1?s:s.slice(0,-1),r=Number.parseFloat(l.replace(/[,₹]/g,""));if(!Number.isNaN(r))return Math.max(r*a,0)},fi=/(?:under|below|less than|up to|upto|within|maximum|max|<=)\s*₹?\s*(\d+[\dkm\.]*)|(?:above|over|greater than|more than|minimum|min|>=)\s*₹?\s*(\d+[\dkm\.]*)/gi,bi=/between\s+₹?\s*(\d+[\dkm\.]*)\s+(?:and|to)\s+₹?\s*(\d+[\dkm\.]*)/i,gi=/(\d+[\dkm\.]*)\s*[-–—]\s*(\d+[\dkm\.]*)/,yi=/(?:rs\.?|inr|rupees?)/gi,ji=(t="")=>{let s=String(t),a,l;const r=s.match(bi);if(r){const[,i,d]=r,p=qt(i),x=qt(d);typeof p=="number"&&typeof x=="number"&&(a=Math.min(p,x),l=Math.max(p,x)),s=s.replace(r[0]," ")}if(typeof a!="number"||typeof l!="number"){const i=s.match(gi);if(i){const[,d,p]=i,x=qt(d),D=qt(p);typeof x=="number"&&typeof D=="number"&&(a=typeof a=="number"?a:Math.min(x,D),l=typeof l=="number"?l:Math.max(x,D)),s=s.replace(i[0]," ")}}s=s.replace(fi,(i,d,p)=>{if(d&&typeof l!="number"){const x=qt(d);typeof x=="number"&&(l=x)}if(p&&typeof a!="number"){const x=qt(p);typeof x=="number"&&(a=x)}return" "});const o=s.replace(yi," ").replace(/₹/g," ").replace(/[^a-z0-9\s\-_/\.@#&+]/gi," ").replace(/\s+/g," ").trim()||s.trim();return typeof l=="number"&&typeof a!="number"&&(a=0),{searchTerm:o,minPrice:a,maxPrice:l}},Ni=(t,s,a)=>`${hi(t).replace(/\s+/g,"")}|min:${s??""}|max:${a??""}`,vi=({children:t})=>{const[s,a]=n.useState(""),[l,r]=n.useState([]),[c,o]=n.useState(!1),[i,d]=n.useState(""),p=n.useCallback(async D=>{const g=D.trim();if(!g)return r([]),d(""),[];const{searchTerm:R,minPrice:u,maxPrice:I}=ji(g),j=Ni(R,u,I);if(j===i&&l.length>0)return l;o(!0);try{const m={limit:50};R&&(m.search=R),typeof u=="number"&&(m.minPrice=u),typeof I=="number"&&(m.maxPrice=I);const{data:S}=await Ut(m);return a(g),r(S||[]),d(j),S||[]}catch(m){return console.error("Search error:",m),r([]),[]}finally{o(!1)}},[i,l.length]),x=n.useCallback(()=>{a(""),r([]),d("")},[]);return e.jsx(dl.Provider,{value:{searchQuery:s,setSearchQuery:a,searchResults:l,isSearching:c,searchProducts:p,clearSearch:x},children:t})},ml=()=>{const t=n.useContext(dl);if(!t)throw new Error("useSearch must be used within a SearchProvider");return t},ul=n.createContext(null),wi=t=>{if(!t)return null;try{const s=t.split(".")[1];if(!s)return null;const a=s.replace(/-/g,"+").replace(/_/g,"/"),l=decodeURIComponent(atob(a).split("").map(r=>`%${r.charCodeAt(0).toString(16).padStart(2,"0")}`).join(""));return JSON.parse(l)}catch(s){return console.error("Failed to decode token payload",s),null}},Si=t=>{const s=wi(t);if(!(s!=null&&s.exp))return!1;const a=Math.floor(Date.now()/1e3);return s.exp<=a},zs=t=>t?{...t,role:t.role||"customer"}:null,Ci=({children:t})=>{const[s,a]=n.useState(null),[l,r]=n.useState(!1),[c,o]=n.useState(!0);n.useEffect(()=>{try{const u=localStorage.getItem("user"),I=localStorage.getItem("authToken");if(I&&Si(I)){localStorage.removeItem("authToken"),localStorage.removeItem("user"),o(!1),Re.info("Session expired. Please log in again.",{autoClose:1500});return}if(u&&I){const j=zs(JSON.parse(u));a(j),j.role!==JSON.parse(u).role&&localStorage.setItem("user",JSON.stringify(j)),r(!0)}}catch(u){console.error("Failed to parse user from localStorage",u),localStorage.removeItem("user"),localStorage.removeItem("authToken")}finally{o(!1)}},[]);const i=async u=>{var I,j;try{const{data:m}=await fe.post("/auth/login",u),S=zs(m.user);return localStorage.setItem("user",JSON.stringify(S)),localStorage.setItem("authToken",m.token),a(S),r(!0),Re.success("Logged in successfully!",{autoClose:1e3}),m}catch(m){const S=((j=(I=m.response)==null?void 0:I.data)==null?void 0:j.message)||"Failed to log in. Please try again.";throw new Error(S)}},d=async u=>{var I,j;try{const{data:m}=await fe.post("/auth/register",u);return Re.success(m.message||"Account created. Check your email for the code.",{autoClose:1e3}),m}catch(m){const S=((j=(I=m.response)==null?void 0:I.data)==null?void 0:j.message)||"Failed to create account. Please try again.";throw new Error(S)}},p=async({email:u,otp:I})=>{var j,m;try{const{data:S}=await fe.post("/auth/verify-email",{email:u,otp:I}),P=zs(S.user);return localStorage.setItem("user",JSON.stringify(P)),localStorage.setItem("authToken",S.token),a(P),r(!0),Re.success(S.message||"Email verified successfully!",{autoClose:1e3}),S}catch(S){const P=((m=(j=S.response)==null?void 0:j.data)==null?void 0:m.message)||"Failed to verify email. Please try again.";throw new Error(P)}},x=()=>{localStorage.removeItem("user"),localStorage.removeItem("authToken"),a(null),r(!1),Re.info("Logged out.",{autoClose:1e3})},D=async u=>{var I,j,m,S;try{const P=await fe.put("/user/profile",u),H=zs(((I=P==null?void 0:P.data)==null?void 0:I.data)||{});if(H!=null&&H.name){a(W=>({...W,...H}));const E=localStorage.getItem("user"),A={...(E?JSON.parse(E):null)||{},...H};localStorage.setItem("user",JSON.stringify(A))}return Re.success(((j=P==null?void 0:P.data)==null?void 0:j.message)||"Profile updated",{autoClose:1200}),H}catch(P){const H=((S=(m=P.response)==null?void 0:m.data)==null?void 0:S.message)||P.message||"Failed to update profile";throw Re.error(H),new Error(H)}},g=(s==null?void 0:s.role)==="admin",R={user:s,isAuthenticated:l,isAdmin:g,loading:c,login:i,signup:d,verifyEmail:p,logout:x,updateProfile:D};return e.jsx(ul.Provider,{value:R,children:t})},Qe=()=>{const t=n.useContext(ul);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},xl=n.createContext(null),ki=({children:t})=>{const{user:s,isAuthenticated:a}=Qe(),l=()=>{const w=(s==null?void 0:s._id)||(s==null?void 0:s.id)||(s==null?void 0:s.email);return a&&w?`p2pdeal:cart:${w}`:"p2pdeal:cart:guest"},[r,c]=n.useState(l),[o,i]=n.useState(()=>{if(typeof window>"u")return[];try{const w=l(),A=window.localStorage.getItem(w);return A?JSON.parse(A):[]}catch(w){return console.error("Failed to parse cart from localStorage",w),[]}});n.useEffect(()=>{const w=l();if(c(w),!(typeof window>"u"))try{const A=window.localStorage.getItem(w);i(A?JSON.parse(A):[])}catch(A){console.error("Failed to load user cart from localStorage",A),i([])}},[a,s==null?void 0:s._id,s==null?void 0:s.id,s==null?void 0:s.email]),n.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(r,JSON.stringify(o))}catch(w){console.error("Failed to persist cart to localStorage",w)}},[o,r]);const d=w=>{const A=Number(w);return Number.isFinite(A)?Math.max(1,Math.floor(A)):1},p=w=>typeof w=="string"?w.trim().toUpperCase():w??"",x=(w,A)=>{if(!(w!=null&&w.showSizes)||!Array.isArray(w==null?void 0:w.sizes)||!w.sizes.length)return null;const W=p(A);return W&&w.sizes.find(L=>{var K;return((K=L==null?void 0:L.label)==null?void 0:K.toString().trim().toUpperCase())===W})||null},D=(w,A)=>{if(!w)return Number.POSITIVE_INFINITY;if(w.showSizes){const L=x(w,A);if(L){if(L.isAvailable===!1)return 0;const K=Number(L.stock);if(Number.isFinite(K))return Math.max(0,Math.floor(K))}if(A)return 0}const W=Number(w==null?void 0:w.stock);return Number.isFinite(W)?Math.max(0,Math.floor(W)):Number.POSITIVE_INFINITY},g=(w,A,W)=>{const L=(w==null?void 0:w.name)||"This item",K=W?` (size ${W})`:"";return A<=0?`${L}${K} is currently out of stock.`:`Only ${A} unit${A===1?"":"s"} of ${L}${K} are available.`},R=(w,A=1)=>{const W=typeof(w==null?void 0:w.hsnCode)=="string"?w.hsnCode.trim():(w==null?void 0:w.hsnCode)!=null?String(w.hsnCode).trim():void 0,L=(w==null?void 0:w.gstRate)!==void 0&&(w==null?void 0:w.gstRate)!==null?Number(w.gstRate):void 0,K=typeof(w==null?void 0:w.size)=="string"&&w.size.trim().length?w.size.trim():(w==null?void 0:w.size)??void 0,O=p(K),Y=d(A),M=D(w,O);if(Number.isFinite(M)&&M<=0){Re.error(g(w,M,O||""));return}const ee=/^[a-f\d]{24}$/i,te=(w==null?void 0:w.mongoId)||(w==null?void 0:w._id)||(w==null?void 0:w.product)||(w==null?void 0:w.id),y=typeof te=="string"&&ee.test(te)?te:void 0;let z=!1,b=!1,C=null;if(i(B=>{const re=B.find(F=>{const U=F.id===w.id,h=(F.size??null)===(K??null);return U&&h});if(re){const F=d(re.quantity),U=F+Y;let h=U;return Number.isFinite(M)&&U>M&&(h=Math.max(M,F),b=h!==U,C=M),h===F?(b=!0,C=C??M,B):(z=!0,B.map(k=>k.id===w.id&&(k.size??null)===(K??null)?{...k,quantity:h,hsnCode:W||k.hsnCode,gstRate:Number.isFinite(L)?L:k.gstRate}:k))}const se=Number.isFinite(M)?Math.min(Y,Math.max(1,M)):Y;if(Number.isFinite(M)&&se<=0)return b=!0,C=M,B;se<Y&&(b=!0,C=M);const X={...w,quantity:d(se),size:K};return y&&(X.product=y),W&&(X.hsnCode=W),Number.isFinite(L)&&(X.gstRate=L),z=!0,[...B,X]}),!z){Re.info(g(w,C??M,O||""),{autoClose:2e3});return}if(b){const B=C??M;Re.info(g(w,B,O||""),{autoClose:2e3});return}Re.success(`${w.name} added to cart!`,{autoClose:1e3})},u=(w,A)=>{i(W=>W.filter(L=>{const K=L.id===w,O=(L.size??null)===(A??null);return!(K&&O)})),Re.info("Item removed from cart.",{autoClose:1e3})},I=w=>{if(!w)return null;const A=w.id??w.product??w.mongoId??w._id??w.slug??null;if(!A)return null;const W=String(A).trim();if(!W)return null;const L=w.size===void 0||w.size===null?"":String(w.size).trim();return`${W}::${L}`},j=(w=[])=>{!Array.isArray(w)||w.length===0||i(A=>{const W=new Set(w.map(O=>I(O)).filter(O=>!!O));if(!W.size)return A;let L=!1;const K=A.filter(O=>{const Y=I(O);return Y&&W.has(Y)?(L=!0,!1):!0});return L?K:A})},m=(w,A,W)=>{const L=p(W),K=d(A),O=o.find(ee=>ee.id===w&&(ee.size??null)===(W??null));if(!O)return;if(K<=0){u(w,W);return}const Y=D(O,L);if(Number.isFinite(Y)&&Y<=0){u(w,W),Re.info(g(O,Y,L||""),{autoClose:2e3});return}const M=Number.isFinite(Y)?Math.min(K,Math.max(1,Y)):K;i(ee=>ee.map(te=>te.id===w&&(te.size??null)===(W??null)?{...te,quantity:M}:te)),M<K&&Re.info(g(O,Y,L||""),{autoClose:2e3})},S=()=>{if(i([]),typeof window<"u")try{window.localStorage.removeItem(r)}catch(w){console.error("Failed to clear cart from localStorage",w)}},P=o.reduce((w,A)=>w+A.quantity,0),H=o.reduce((w,A)=>w+A.price*A.quantity,0),E={cartItems:o,addItem:R,removeItem:u,removeItems:j,updateQuantity:m,clearCart:S,cartCount:P,cartTotal:H};return e.jsx(xl.Provider,{value:E,children:t})},Is=()=>{const t=n.useContext(xl);if(t===void 0)throw new Error("useCart must be used within a CartProvider");return t},lr={addresses:[],loading:!1,error:null},pl=Ft({name:"address",initialState:lr,reducers:{resetAddressState:()=>lr,setAddresses:(t,s)=>{t.addresses=s.payload,t.loading=!1,t.error=null},setAddressLoading:(t,s)=>{t.loading=s.payload},setAddressError:(t,s)=>{t.error=s.payload},addAddress:(t,s)=>{const a=s.payload;a.isDefault&&(t.addresses=t.addresses.map(l=>({...l,isDefault:!1}))),t.addresses=[...t.addresses,a]},updateAddress:(t,s)=>{const a=s.payload;t.addresses=t.addresses.map(l=>l._id===a._id?a:l)},updateAddressInStore:(t,s)=>{const a=s.payload;t.addresses=t.addresses.map(l=>l._id===a._id?{...l,...a}:l)},removeAddressFromStore:(t,s)=>{const a=s.payload;t.addresses=t.addresses.filter(l=>l._id!==a)}}}),{resetAddressState:Ai,setAddresses:Bs,setAddressLoading:la,setAddressError:hl,addAddress:Bd,updateAddressInStore:Vd,removeAddressFromStore:Hd}=pl.actions,Pi=pl.reducer,nr={step:"order-summary",items:[],shippingAddress:null,paymentMethod:null,paymentStatus:"pending",orderId:null,appliedCoupon:null,totals:{subtotal:0,shippingFee:0,taxAmount:0,discount:0,total:0,currency:"INR",baseSubtotal:0,baseTotal:0}},Di=[{matcher:/keychain/i,hsnCode:"8305",gstRate:18},{matcher:/ceramic\s+coffee\s+mug|coffee\s+mug|mug/i,hsnCode:"6912",gstRate:12},{matcher:/executive\s+diary|pen\s+set/i,hsnCode:"4820",gstRate:18},{matcher:/white\s+logo\s+cap|cap/i,hsnCode:"6501",gstRate:18},{matcher:/diary/i,hsnCode:"4820",gstRate:18},{matcher:/\bpen\b/i,hsnCode:"9608",gstRate:18},{matcher:/t\s*-?shirt|polo/i,hsnCode:"6109",gstRate:5}],Ri=(t="")=>{const s=t.toString().trim();return s&&Di.find(a=>a.matcher.test(s))||null},Ii=(t={})=>{const s={...t};if(s.hsnCode!==void 0&&s.hsnCode!==null){const r=String(s.hsnCode).trim();s.hsnCode=r||void 0}else if(s.hsn!==void 0&&s.hsn!==null){const r=String(s.hsn).trim();s.hsnCode=r||void 0}const a=s.gstRate!==void 0&&s.gstRate!==null?s.gstRate:s.taxRate!==void 0&&s.taxRate!==null?s.taxRate:void 0,l=Number(a);if(s.gstRate=Number.isFinite(l)&&l>0?l:void 0,!s.hsnCode||s.gstRate===void 0){const r=Ri(s.name||s.title||"");r&&(s.hsnCode||(s.hsnCode=r.hsnCode),s.gstRate===void 0&&(s.gstRate=r.gstRate))}return s},fl=Ft({name:"checkout",initialState:nr,reducers:{resetCheckout:t=>{const s=t.orderId||null;return{...nr,orderId:s}},setCheckoutStep:(t,s)=>{t.step=s.payload},setCheckoutItems:(t,s)=>{const a=Array.isArray(s.payload)?s.payload:[];t.items=a.map(Ii)},setShippingAddress:(t,s)=>{t.shippingAddress=s.payload},setPaymentMethod:(t,s)=>{t.paymentMethod=s.payload},setPaymentStatus:(t,s)=>{t.paymentStatus=s.payload},setCheckoutTotals:(t,s)=>{const a=s.payload||{},{baseSubtotal:l,baseTotal:r,...c}=a;t.totals={...t.totals,...c,...l!==void 0?{baseSubtotal:l}:{},...r!==void 0?{baseTotal:r}:{}}},setOrderId:(t,s)=>{t.orderId=s.payload},setAppliedCoupon:(t,s)=>{t.appliedCoupon=s.payload},clearAppliedCoupon:t=>{t.appliedCoupon=null}}}),{resetCheckout:Rs,setCheckoutStep:Mt,setCheckoutItems:bl,setShippingAddress:gl,setPaymentMethod:yl,setPaymentStatus:Ss,setCheckoutTotals:ts,setOrderId:Fa,setAppliedCoupon:Fi,clearAppliedCoupon:jl}=fl.actions,Ei=fl.reducer,Vs=(t,{shippingFee:s=0,taxAmount:a,discount:l=0,currency:r="INR"}={})=>{const c=Array.isArray(t)?t:[],o=c.reduce((R,u)=>{const I=Number(u==null?void 0:u.price)||0,j=Number(u==null?void 0:u.quantity)||0;return R+I*j},0);let i=0;a!=null?i=Number(a)||0:i=c.reduce((R,u)=>{const I=Number(u==null?void 0:u.gstRate);if(!Number.isFinite(I)||I<=0)return R;const j=Number(u==null?void 0:u.price)||0,m=Number(u==null?void 0:u.quantity)||0;return R+j*m*I/100},0);const d=Number(i.toFixed(2)),p=Number((Number(s)||0).toFixed(2)),x=Number((Number(l)||0).toFixed(2)),D=Number(o.toFixed(2)),g=Math.max(Number((D+p+d-x).toFixed(2)),0);return{subtotal:D,shippingFee:p,taxAmount:d,discount:x,total:g,currency:r}},js="Loading delivery address...",Ns="p2pdeal:lastLocationLabel",Li=()=>{const[t,s]=n.useState(!1),[a,l]=n.useState(!0),[r,c]=n.useState(0),[o,i]=n.useState(!1),[d,p]=n.useState(!1),[x,D]=n.useState(!1),[g,R]=n.useState(""),[u,I]=n.useState(js),[j,m]=n.useState([]),S=n.useRef(null),{isAuthenticated:P,user:H,logout:E,isAdmin:w}=Qe(),{cartCount:A}=Is(),{searchQuery:W,setSearchQuery:L,searchProducts:K}=ml(),O=n.useRef(null),Y=Te(),M=Nt(),{addresses:ee,loading:te}=mt(h=>h.address),{shippingAddress:y}=mt(h=>h.checkout),z=n.useCallback(h=>{try{if(!P){localStorage.removeItem(Ns);return}const k=(h||"").trim();if(!k||k===js||k==="Add delivery address"){localStorage.removeItem(Ns);return}localStorage.setItem(Ns,k)}catch(k){console.debug("Persist location label failed",k)}},[P]);n.useEffect(()=>{if(P)try{const h=localStorage.getItem(Ns);h&&I(h)}catch(h){console.debug("Restore location label failed",h)}},[P]),n.useEffect(()=>{const h=()=>{const k=window.scrollY;k<r||k<10?l(!0):k>r&&k>100&&l(!1),c(k)};return window.addEventListener("scroll",h,{passive:!0}),()=>{window.removeEventListener("scroll",h)}},[r]),n.useEffect(()=>{const h=k=>{O.current&&!O.current.contains(k.target)&&(i(!1),p(!1))};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]),n.useEffect(()=>{P||(i(!1),p(!1))},[P]),n.useEffect(()=>{let h=!0;return(async()=>{try{const{data:f}=await Ut({limit:200});if(!h)return;const G=new Map;f.forEach(Z=>{const N=(typeof Z.category=="string"?Z.category:"Other").trim();if(!N)return;const V=encodeURIComponent(N.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||"other");G.has(N)||G.set(N,{name:N,slug:V})});const le=Array.from(G.values()).slice(0,12);m(le)}catch(f){console.error("Failed to load navigation categories",f),h&&m([])}})(),()=>{h=!1}},[]),n.useEffect(()=>{if(!P||ee.length||te)return;let h=!0;return(async()=>{var f,G,le;M(la(!0));try{const Z=await qa(),ie=Array.isArray(Z)?Z:Array.isArray(Z==null?void 0:Z.data)?Z.data:Array.isArray(Z==null?void 0:Z.addresses)?Z.addresses:Array.isArray((f=Z==null?void 0:Z.data)==null?void 0:f.addresses)?Z.data.addresses:[];h&&M(Bs(ie))}catch(Z){if(h){const ie=((le=(G=Z==null?void 0:Z.response)==null?void 0:G.data)==null?void 0:le.message)||(Z==null?void 0:Z.message)||"Failed to load addresses";M(hl(ie))}}finally{h&&M(la(!1))}})(),()=>{h=!1}},[P,ee.length,te,M]),n.useEffect(()=>{const h=ie=>{var xe,je,we,_,be;if(!ie)return null;const N=(xe=ie.formattedAddress)==null?void 0:xe.trim();if(N)return N.length>55?`${N.slice(0,52)}...`:N;const V=(je=ie.city)==null?void 0:je.trim(),v=(we=ie.state)==null?void 0:we.trim(),q=((_=ie.pincode)==null?void 0:_.toString().trim())||((be=ie.zipCode)==null?void 0:be.toString().trim()),J=[V||v,q].filter(Boolean);return J.length?`Deliver to ${J.join(" - ")}`:null},k=h(y);if(k){I(k),z(k);return}if(!P){I(js),z(js);return}const f=ee.find(ie=>ie.isDefault)||ee[0]||null,G=h(f);if(G){I(G),z(G);return}if(te){I("Loading delivery address..."),z("Loading delivery address...");return}const Z=h(H||{})||"Add delivery address";I(Z),z(Z)},[P,ee,te,y,H,z]),n.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),n.useEffect(()=>{if(!t)return;const h=k=>{k.key==="Escape"&&s(!1)};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[t]);const b=()=>{i(!1),p(!1),M(Ai()),M(Rs()),E(),I(js);try{localStorage.removeItem(Ns)}catch(h){console.debug("Failed to clear stored location label",h)}},C=()=>{p(h=>{const k=!h;return i(k),k})},B=()=>{d||i(!0)},re=()=>{d||i(!1)},se=async h=>{h.preventDefault(),g.trim()&&(L(g),Y(`/search?q=${encodeURIComponent(g)}`),R(""))},X=h=>{h.key==="Enter"&&se(h)},F=()=>{R(""),S.current&&S.current.focus()},U=j.length?j:[{name:"All Products",slug:""}];return e.jsxs("header",{className:`bg-white shadow-sm sticky top-0 z-40 transition-transform duration-300 ${a?"translate-y-0":"-translate-y-full"}`,children:[e.jsx("div",{className:"bg-medium-bg text-medium-text text-sm hidden lg:block",children:e.jsxs("div",{className:"container mx-auto px-16 py-2 flex justify-between items-center",children:[e.jsx("div",{children:"Welcome to worldwide p2pdeal!"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ua,{size:16,style:{color:"#008ECC"}}),e.jsx("span",{children:u})]}),e.jsx("div",{className:"h-4 border-l border-gray-300"}),e.jsxs(Fe,{to:"/orders",className:"flex items-center space-x-2 hover:text-[#008ECC]",children:[e.jsx(Ta,{size:16,style:{color:"#008ECC"}}),e.jsx("span",{children:"Track your order"})]}),e.jsx("div",{className:"h-4 border-l border-gray-300"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Wl,{size:16,style:{color:"#008ECC"}}),e.jsx("span",{children:"All Offers"})]})]})]})}),e.jsx("div",{className:`container mx-auto px-4 sm:px-8 lg:px-16 py-3 lg:py-4 ${t?"hidden lg:block":""}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{type:"button",onClick:()=>s(h=>!h),className:"lg:hidden inline-flex items-center justify-center p-2 rounded-md border border-gray-200 text-[#008ECC] hover:bg-gray-100 transition-colors","aria-label":t?"Close navigation menu":"Open navigation menu","aria-expanded":t,children:t?e.jsx(Ze,{size:22}):e.jsx(qr,{size:24})}),e.jsx(Fe,{to:"/",className:"text-2xl sm:text-3xl font-bold",style:{color:"#008ECC"},children:"p2pdeal"})]}),e.jsxs("div",{className:`flex-1 max-w-xl hidden md:flex items-center bg-white border rounded-md transition-all duration-200 ${x?"ring-2 ring-[#008ECC] border-[#008ECC]":"border-gray-200"}`,children:[e.jsx(Zt,{size:20,className:"ml-3 text-gray-400"}),e.jsx("input",{ref:S,type:"text",value:g,onChange:h=>R(h.target.value),onKeyDown:X,onFocus:()=>D(!0),onBlur:()=>setTimeout(()=>D(!1),200),placeholder:"Search T-SHIRTS, Office Essentials, Accessories and more...",className:"bg-transparent py-2 px-3 w-full focus:outline-none text-sm text-gray-800 placeholder-gray-400 rounded-r-md","aria-label":"Search products"}),g&&e.jsx("button",{type:"button",onClick:F,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Clear search",children:e.jsx(Ze,{size:18})})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-6",children:[P?e.jsxs("div",{className:"relative hidden md:block",ref:O,onMouseEnter:B,onMouseLeave:re,children:[e.jsxs("button",{type:"button",onClick:C,className:"flex items-center gap-2 px-3 py-2 rounded-full border border-gray-200 hover:border-[#008ECC] hover:text-[#008ECC] transition-colors",children:[e.jsx(wt,{size:20,style:{color:"#008ECC"}}),e.jsx("span",{className:"text-sm",style:{color:"#000000"},children:(H==null?void 0:H.name)||(H==null?void 0:H.username)||"My Account"}),e.jsx(xa,{size:16,className:`text-gray-500 transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50",children:[w&&e.jsx(Fe,{to:"/admin",onClick:()=>{i(!1),p(!1)},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Admin Profile"}),e.jsx(Fe,{to:"/profile",onClick:()=>{i(!1),p(!1)},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"My Profile"}),e.jsx(Fe,{to:"/orders",onClick:()=>{i(!1),p(!1)},className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"My Orders"}),e.jsx("button",{onClick:b,className:"w-full text-left block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Logout"})]})]}):e.jsxs("div",{className:"hidden md:flex items-center text-sm",children:[e.jsx(wt,{size:20,style:{color:"#008ECC"}}),e.jsxs("div",{className:"ml-2 flex items-center gap-2",children:[e.jsx(Fe,{to:"/signup",className:"hover:text-[#008ECC] transition-colors",children:"Sign Up"}),e.jsx("span",{className:"text-gray-300",children:"/"}),e.jsx(Fe,{to:"/login",className:"hover:text-[#008ECC] transition-colors",children:"Sign In"})]})]}),e.jsxs(Fe,{to:"/cart",className:"flex items-center relative hover:opacity-80",children:[e.jsx(Ia,{size:20,style:{color:"#008ECC"}}),e.jsx("span",{className:"ml-2 text-sm hidden lg:inline",style:{color:"#000000"},children:"Cart"}),e.jsx(ze,{children:A>0&&e.jsx(Q.span,{className:"absolute -top-2 -right-2 bg-primary text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",initial:{scale:0},animate:{scale:1},exit:{scale:0},children:A},A)})]})]})]})}),e.jsx(ze,{children:t&&e.jsxs(Q.div,{className:"lg:hidden bg-white absolute top-full left-0 w-full h-screen z-30 p-4 border-t overflow-y-auto",initial:{opacity:0,x:-300},animate:{opacity:1,x:0},exit:{opacity:0,x:-300},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-lg font-semibold",style:{color:"#008ECC"},children:"Menu"}),e.jsx("button",{type:"button",onClick:()=>s(!1),className:"inline-flex items-center justify-center p-2 rounded-full border border-gray-200 text-gray-500 hover:text-[#008ECC] hover:border-[#008ECC] transition-colors","aria-label":"Close navigation menu",children:e.jsx(Ze,{size:20})})]}),e.jsxs("div",{className:"flex items-center bg-light-bg border border-gray-200 rounded-md mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search...",className:"bg-transparent py-2 px-4 w-full focus:outline-none"}),e.jsx("button",{className:"p-2 text-medium-text",children:e.jsx(Zt,{size:20})})]}),e.jsx("nav",{children:e.jsx("ul",{children:U.map((h,k)=>e.jsx("li",{className:"border-b",children:e.jsx(Fe,{to:h.slug?`/category/${h.slug}`:"/shop",className:"flex justify-between items-center py-3",onClick:()=>s(!1),children:h.name})},h.slug||k))})}),e.jsxs("div",{className:"mt-6 border-t pt-6 space-y-4",children:[P?e.jsxs(e.Fragment,{children:[w&&e.jsxs(Fe,{to:"/admin",className:"flex items-center",onClick:()=>s(!1),children:[e.jsx(wt,{className:"mr-2"})," Admin Profile"]}),e.jsxs(Fe,{to:"/profile",className:"flex items-center",onClick:()=>s(!1),children:[e.jsx(wt,{className:"mr-2"})," My Profile"]}),e.jsxs(Fe,{to:"/orders",className:"flex items-center",onClick:()=>s(!1),children:[e.jsx(wt,{className:"mr-2"})," My Orders"]}),e.jsxs("button",{onClick:()=>{b(),s(!1)},className:"flex items-center",children:[e.jsx(wt,{className:"mr-2"})," Logout"]})]}):e.jsxs("div",{className:"flex flex-col gap-3 text-sm",children:[e.jsxs(Fe,{to:"/signup",onClick:()=>s(!1),className:"flex items-center",children:[e.jsx(wt,{className:"mr-2"})," Sign Up"]}),e.jsxs(Fe,{to:"/login",onClick:()=>s(!1),className:"flex items-center",children:[e.jsx(wt,{className:"mr-2"})," Sign In"]})]}),e.jsxs(Fe,{to:"/cart",onClick:()=>s(!1),className:"flex items-center relative",children:[e.jsx(Ia,{className:"mr-2"})," Cart",A>0&&e.jsx("span",{className:"ml-2 bg-primary text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:A})]})]})]})}),e.jsx("div",{className:`md:hidden border-t border-gray-100 px-4 py-3 bg-white ${t?"hidden":""}`,children:e.jsxs("div",{className:"relative",children:[e.jsx(Zt,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("form",{onSubmit:se,className:"w-full",children:e.jsx("input",{type:"text",value:g,onChange:h=>R(h.target.value),onKeyDown:X,onFocus:()=>D(!0),onBlur:()=>D(!1),placeholder:"Search products...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-[#008ECC] focus:border-transparent text-sm","aria-label":"Search products"})}),g&&e.jsx("button",{type:"button",onClick:F,className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":"Clear search",children:e.jsx(Ze,{size:18})})]})})]})},zi=()=>tt(()=>fe.get("/admin/footer-categories"),"Failed to load footer categories"),Oi=()=>tt(()=>fe.get("/admin/footer-categories/available"),"Failed to load available product categories"),Ti=t=>tt(()=>fe.post("/admin/footer-categories",t),"Failed to create footer category"),$i=(t,s)=>tt(()=>fe.put(`/admin/footer-categories/${t}`,s),"Failed to update footer category"),_i=t=>tt(()=>fe.delete(`/admin/footer-categories/${t}`),"Failed to delete footer category"),Mi=t=>tt(()=>fe.post("/admin/footer-categories/reorder",{orderedIds:t}),"Failed to reorder footer categories"),Ui=()=>tt(()=>fe.get("/footer-categories"),"Failed to load footer categories"),qi=()=>{const[t,s]=n.useState([]),[a,l]=n.useState(!1),r=[{label:"Privacy Policy",to:"/legal/privacy"},{label:"Terms & Conditions",to:"/legal/terms"},{label:"Return Policy",to:"/legal/returns"}];n.useEffect(()=>{let o=!0;return(async()=>{l(!0);try{const d=await Ui();if(!o)return;const p=Array.isArray(d.data)?d.data:[];s(p.map(x=>({name:x.name,slug:x.slug||""})))}catch(d){console.error("Failed to load footer categories",d),o&&s([])}finally{o&&l(!1)}})(),()=>{o=!1}},[]);const c=n.useMemo(()=>t.length?t:[],[t]);return e.jsxs("footer",{className:"text-white pt-12 pb-6 relative overflow-hidden",style:{backgroundColor:"#008ECC"},children:[e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-blue-400/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-blue-600/10 rounded-full blur-3xl"}),e.jsxs("div",{className:"container mx-auto px-8 relative z-10",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12 mb-8 justify-items-center max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold text-base mb-4 border-b-2 border-white pb-1 inline-block mx-auto",children:"Most Popular Categories"}),e.jsxs("ul",{className:"space-y-2 text-center",children:[a&&!c.length&&e.jsx("li",{className:"text-sm opacity-80",children:"Loading categories…"}),!a&&!c.length&&e.jsx("li",{className:"text-sm opacity-80",children:"Categories unavailable"}),c.map(o=>e.jsx("li",{children:e.jsx(Fe,{to:o.slug?`/category/${encodeURIComponent(o.slug)}`:"/shop",className:"text-sm hover:underline",children:o.name})},o.name))]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold text-base mb-4 border-b-2 border-white pb-1 inline-block mx-auto",children:"Customer Services"}),e.jsx("ul",{className:"space-y-2 text-center",children:r.map(o=>e.jsx("li",{children:e.jsx(Fe,{to:o.to,className:"text-sm hover:underline",children:o.label})},o.label))})]}),e.jsxs("div",{className:"text-center flex flex-col items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 border-b-2 border-white pb-1 inline-block px-4",children:"Contact Us"}),e.jsxs(Fe,{to:"/help-support",className:"inline-flex items-center justify-center gap-2 text-sm font-medium bg-white text-[#008ECC] px-5 py-2 rounded-full shadow-sm hover:shadow-md hover:bg-blue-50 transition-all mx-auto whitespace-nowrap",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#008ECC",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",className:"flex-shrink-0",children:[e.jsx("path",{d:"M12 22c4.97 0 9-4.03 9-9s-4.03-9-9-9-9 4.03-9 9c0 2.5 1.02 4.75 2.66 6.39.19.19.3.45.28.72l-.14 2.02a1 1 0 001.09 1.09l2.02-.14c.27-.02.53.09.72.28A8.96 8.96 0 0012 22z"}),e.jsx("path",{d:"M8 12h.01"}),e.jsx("path",{d:"M12 12h.01"}),e.jsx("path",{d:"M16 12h.01"})]}),"Help & Support"]})]})]}),e.jsx("div",{className:"border-t border-white/15 mt-8 pt-4 text-center",children:e.jsx("p",{className:"text-sm",children:"© 2025 All rights reserved. p2pdeal"})})]})]})},Bi=()=>{const a=ut().pathname==="/"?"flex-grow overflow-x-hidden pt-5 pb-6 md:pt-6 md:pb-8":"flex-grow overflow-x-hidden px-4 py-6 md:px-8 md:py-8";return e.jsxs("div",{className:"flex flex-col min-h-screen overflow-x-hidden bg-white",children:[e.jsx(Li,{}),e.jsx("main",{className:a,children:e.jsx(Br,{})}),e.jsx(qi,{})]})},Yt=t=>t?t.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/&/g," and ").replace(/[^a-zA-Z0-9]+/g,"-").replace(/^-+|-+$/g,"").toLowerCase():"",ir=(...t)=>t.reduce((s,a)=>!s&&a?a:s,""),Os=new Map,St=(t,s)=>{if(!t)return"";if(typeof t.get=="function"){const l=t.get(s);return typeof l=="string"?l:l!=null?String(l):""}const a=t[s];return a==null?"":typeof a=="string"?a:String(a)},Vi=async t=>{const s=(t||"").toLowerCase();if(!s)return null;if(Os.has(s))return Os.get(s);try{const{data:a}=await Ut({search:t,limit:5}),r=a.find(c=>{var o;return((o=c==null?void 0:c.name)==null?void 0:o.toLowerCase())===s})||a[0]||null;return Os.set(s,r),r}catch(a){return console.error("Failed to resolve hero slide product",t,a),Os.set(s,null),null}},Hi=(t,s)=>{var w,A,W,L;if(!t||typeof t!="object")return null;const a=(K,O="")=>typeof K=="string"?K.trim():O,l=K=>{const O=a(K);return O||void 0},r=t&&typeof t.metadata=="object"&&!Array.isArray(t.metadata)?t.metadata:{},c=a(t.imageUrl||t.spotlightImage||""),o=a(t.backgroundUrl||t.background||""),i=a((w=t.primaryCta)==null?void 0:w.label),d=a(((A=t.primaryCta)==null?void 0:A.href)||""),p=a(St(r,"productUrl")),x=Yt(St(r,"productSlug")),D=a(St(r,"productId")),g=Yt(t.overline),R=Yt(t.title),u=ir(d,p,x&&`/product/${encodeURIComponent(x)}`,D&&`/product/${encodeURIComponent(D)}`,g&&`/product/${encodeURIComponent(g)}`,R&&`/product/${encodeURIComponent(R)}`),I=a(((W=t.secondaryCta)==null?void 0:W.label)||""),j=a(((L=t.secondaryCta)==null?void 0:L.href)||""),m=a(St(r,"categoryUrl")),S=Yt(St(r,"categorySlug")||St(r,"category")||St(r,"categoryName")||""),P=Yt(St(r,"productCategory")||""),H=ir(j,m,S&&`/category/${encodeURIComponent(S)}`,P&&`/category/${encodeURIComponent(P)}`,R&&`/category/${encodeURIComponent(R)}`),E=I||(H?"View All":"");return{id:t._id||t.id||`hero-${s}`,overline:a(t.overline),title:a(t.title),description:a(t.description),titleColor:l(t.titleColor),overlineColor:l(t.overlineColor),descriptionColor:l(t.descriptionColor),background:o||c,spotlightImage:c,showTitle:t.showTitle!==!1,showOverline:t.showOverline!==!1,showDescription:t.showDescription!==!1,primaryCta:i&&u?{label:i,href:u}:null,secondaryCta:H?{label:E,href:H}:null,showPrimaryCta:t.showPrimaryCta!==!1,showSecondaryCta:t.showSecondaryCta!==!1,order:Number.isFinite(Number(t.order))?Number(t.order):s,isActive:t.isActive!==!1}},Gi=()=>{const[t,s]=n.useState([]),[a,l]=n.useState(!0);n.useEffect(()=>{let c=!0;return(async()=>{var i;try{l(!0);const d=await fe.get("/hero-carousel"),p=Array.isArray((i=d==null?void 0:d.data)==null?void 0:i.data)?d.data.data:[],x=await Promise.all(p.map(async(D,g)=>{var P,H,E,w,A,W;if(!D||typeof D!="object")return null;const R=Hi(D,g);if(!R||!R.isActive||!R.background)return null;const u=((P=R.overline)==null?void 0:P.trim())||((H=R.title)==null?void 0:H.trim());if(!u||((E=R.primaryCta)==null?void 0:E.href)!=="/shop")return R;const I=await Vi(u),j=(I==null?void 0:I.slug)||(I==null?void 0:I.id)||(I==null?void 0:I.mongoId)||(I==null?void 0:I._id),m=j?j.toString():"";if(!I||!m)return R;const S={...R};if(S.primaryCta={label:((w=R.primaryCta)==null?void 0:w.label)||"Shop Now",href:`/product/${encodeURIComponent(m)}`},!((A=R.secondaryCta)!=null&&A.href)){const L=I.category||I.brand||R.title,K=Yt(L);K&&(S.secondaryCta={label:((W=R.secondaryCta)==null?void 0:W.label)||"View All",href:`/category/${encodeURIComponent(K)}`})}return S}));if(c){const D=x.filter(Boolean).sort((g,R)=>(g.order??0)-(R.order??0));s(D)}}catch(d){c&&s([]),console.error("Failed to load hero carousel slides",d)}finally{c&&l(!1)}})(),()=>{c=!1}},[]);const r=n.useMemo(()=>t,[t]);return r.length?e.jsx("section",{className:"relative overflow-hidden bg-slate-950  w-screen",style:{left:"50%",transform:"translateX(-50%)"},children:e.jsx("div",{className:"w-full",children:e.jsx(Vr,{modules:[sl,al],spaceBetween:0,slidesPerView:1,pagination:{clickable:!0},loop:!0,autoplay:{delay:5e3,disableOnInteraction:!1,reverseDirection:!1},onSwiper:c=>{var o;if((o=c==null?void 0:c.autoplay)!=null&&o.start)try{const i=c.autoplay.start();i&&typeof i.catch=="function"&&i.catch(()=>{})}catch{}},onAutoplay:(c,o)=>{o&&typeof o.preventDefault=="function"&&o.preventDefault()},className:"hero-slider h-full min-h-[40vh] md:min-h-[82vh]",style:{width:"100%"},children:r.map(c=>{const o=c.background||c.spotlightImage,i=c.primaryCta,d=c.secondaryCta,p=!!(d!=null&&d.label&&(d!=null&&d.href)),x=c.showPrimaryCta!==!1,D=c.showSecondaryCta!==!1&&p;return e.jsx(Hr,{className:"relative flex w-full min-h-[40vh] md:min-h-[82vh]",style:{width:"100%"},children:e.jsxs("div",{className:"relative flex h-full w-full items-center justify-center overflow-hidden min-h-[40vh] md:min-h-[82vh]",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center md:bg-[center_20%]",style:{backgroundImage:o?`url(${o})`:void 0}}),e.jsx("div",{className:"absolute inset-0 bg-slate-950/55"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(148,163,184,0.18),transparent_70%)]"}),e.jsxs("div",{className:"relative z-10 mx-auto flex max-w-3xl flex-col items-center gap-4 px-4 pt-6 text-center text-white sm:gap-6 sm:px-6 sm:pt-10 md:pt-14",children:[c.showOverline!==!1&&c.overline&&e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.35em] text-slate-200/80 sm:text-xs",style:{color:c.overlineColor||void 0},children:c.overline}),c.showTitle!==!1&&e.jsx("h1",{className:"text-2xl font-semibold leading-tight tracking-tight text-white sm:text-4xl md:text-6xl",style:{color:c.titleColor||void 0},children:c.title}),c.showDescription!==!1&&c.description&&e.jsx("p",{className:"hidden max-w-2xl text-xs text-slate-200 sm:block sm:text-sm md:text-lg",style:{color:c.descriptionColor||void 0},children:c.description}),(x||D)&&e.jsxs("div",{className:"flex w-full flex-row flex-wrap items-center justify-center gap-3 sm:w-auto sm:gap-4",children:[x&&e.jsxs(Fe,{to:i.href,className:"inline-flex items-center justify-center gap-2 rounded-full bg-[#008ECC] px-4 py-2 text-xs font-semibold text-white shadow-lg shadow-[#008ECC]/30 transition hover:bg-[#009ee3] sm:px-5 sm:py-3 sm:text-sm",children:[i.label,e.jsx(Gr,{size:16,className:"sm:size-5"})]}),D&&e.jsx(Fe,{to:d.href,className:"inline-flex items-center justify-center gap-2 rounded-full bg-[#008ECC] px-4 py-2 text-xs font-semibold text-white shadow-lg shadow-[#008ECC]/20 transition hover:bg-[#009ee3] sm:px-5 sm:py-3 sm:text-sm",children:d.label})]})]})]})},c.id)})})})}):null},Xe={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,y:-20,transition:{duration:.3}}},Nl={initial:{opacity:0,y:30},animate:{opacity:1,y:0,transition:{duration:.5,ease:"easeOut"}}},Qi={initial:{opacity:0,x:-30},animate:{opacity:1,x:0,transition:{duration:.5,ease:"easeOut"}}},Wi={initial:{opacity:0,x:30},animate:{opacity:1,x:0,transition:{duration:.5,ease:"easeOut"}}},It={initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1,transition:{duration:.4,ease:"easeOut"}}},pa={hidden:{opacity:1},show:{opacity:1,transition:{staggerChildren:.12,delayChildren:.04}}},ha={hidden:{opacity:0,y:16},show:{opacity:1,y:0,transition:{duration:.35,ease:"easeOut"}}},Yi={rest:{scale:1},hover:{scale:1.03,transition:{duration:.3,ease:"easeInOut"}}},lt={rest:{scale:1},hover:{scale:1.05,transition:{duration:.2,ease:"easeInOut"}},tap:{scale:.95}},Fs=({product:t})=>{var o;const{addItem:s}=Is(),a=Te(),l=()=>{t!=null&&t.id&&a(`/product/${t.id}`)},r=()=>{if(t!=null&&t.id){if(t!=null&&t.showSizes){a(`/product/${t.id}`);return}s({...t,hsnCode:t==null?void 0:t.hsnCode,gstRate:t==null?void 0:t.gstRate})}},c=(t==null?void 0:t.thumbnail)||(t==null?void 0:t.image)||((o=t==null?void 0:t.gallery)==null?void 0:o[0]);return e.jsxs(Q.div,{className:"bg-white border border-gray-200 rounded-lg overflow-hidden group flex flex-col h-full hover:shadow-xl transition-all duration-300 hover:border-primary/20 w-full",variants:Yi,initial:"rest",whileHover:"hover",whileTap:{scale:.98},style:{minWidth:"150px"},children:[e.jsxs(Fe,{to:`/product/${t.id}`,className:"block relative overflow-hidden bg-white group-hover:bg-gray-50 transition-colors duration-300",children:[t.discount>0&&e.jsxs("div",{className:"absolute top-3 right-3 bg-primary text-white text-xs font-bold px-3 py-1 rounded-full z-10 shadow-md",children:[t.discount,"% OFF"]}),e.jsx("div",{className:"relative w-full pt-[100%] overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-2 sm:p-3 md:p-4",children:e.jsx("img",{src:c,alt:t.name,className:"w-full h-full object-contain transition-transform duration-500 group-hover:scale-110",loading:"lazy",onError:i=>{i.target.onerror=null,i.target.src="https://placehold.co/600x600/f8fafc/e2e8f0?text=Image+Not+Found",i.target.className="w-full h-full object-cover"},style:{maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto"}})})})]}),e.jsxs("div",{className:"p-3 sm:p-4 border-t border-gray-100 flex-grow flex flex-col",children:[e.jsx("h3",{className:"text-xs sm:text-sm font-semibold text-dark-text mb-2 line-clamp-2 flex-grow min-h-[2.5em]",children:e.jsx(Fe,{to:`/product/${t.id}`,className:"hover:text-primary",children:t.name})}),e.jsxs("div",{className:"mt-auto",children:[e.jsxs("div",{className:"flex flex-wrap items-baseline gap-1 sm:gap-2 mb-1 sm:mb-2",children:[e.jsxs("p",{className:"text-base sm:text-lg font-bold text-dark-text",children:["₹",t.price.toLocaleString()]}),t.originalPrice>t.price&&e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 line-through",children:["₹",t.originalPrice.toLocaleString()]})]}),t.saveAmount>0&&e.jsxs("p",{className:"text-xs sm:text-sm font-medium text-success mb-2 sm:mb-3",children:["Save - ₹",t.saveAmount.toLocaleString()]}),e.jsxs("div",{className:"flex flex-col xs:flex-row gap-2 w-full",children:[e.jsx(Q.button,{onClick:r,className:"w-full xs:flex-1 bg-primary/10 text-primary font-medium py-2 px-2 text-sm rounded-md hover:bg-primary hover:text-white transition-colors duration-200 whitespace-nowrap flex items-center justify-center min-h-[36px]",variants:lt,whileHover:"hover",whileTap:"tap",children:e.jsx("span",{className:"truncate",children:"Add to Cart"})}),e.jsx(Q.button,{className:"w-full xs:flex-1 bg-primary text-white font-medium py-2 px-2 text-sm rounded-md hover:bg-primary/90 transition-colors duration-200 whitespace-nowrap flex items-center justify-center min-h-[36px]",variants:lt,whileHover:"hover",whileTap:"tap",type:"button",onClick:l,children:e.jsx("span",{className:"truncate",children:"Buy Now"})})]})]})]})]})},Ki=({title:t,linkTo:s,linkText:a="View All"})=>e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-text",children:t}),e.jsx("div",{className:" h-1.5 mt-2",style:{backgroundColor:"#008ECC"}})]}),s&&e.jsxs(Fe,{to:s,className:"hidden items-center font-semibold hover:underline sm:flex",children:[e.jsx("span",{style:{color:"#000000"},children:a}),e.jsx(Gr,{size:20,className:"ml-1 text-primary"})]})]}),Ji=()=>{const[t,s]=n.useState([]),[a,l]=n.useState(!0),[r,c]=n.useState("");return n.useEffect(()=>{let o=!0;return(async()=>{l(!0);try{const{data:d}=await Zn({limit:50});if(o){const p=Array.isArray(d)?[...d].sort((x,D)=>{const g=R=>{const u=String(R||"").trim().toUpperCase();if(/^P\d{1,2}$/.test(u))return parseInt(u.slice(1),10);const I=parseInt(u.replace(/[^0-9]/g,""),10);return Number.isNaN(I)?99:I};return g(x.categoryPriority)-g(D.categoryPriority)}):[];s(p.slice(0,6)),c("")}}catch(d){console.error("Failed to load featured products",d),o&&(c(d.message||"Unable to load featured products."),s([]))}finally{o&&l(!1)}})(),()=>{o=!1}},[]),e.jsx(Q.section,{className:"w-full",initial:"initial",whileInView:"animate",viewport:{once:!0,margin:"-100px"},children:e.jsxs("div",{className:"container mx-auto px-2 sm:px-4",children:[e.jsx(Ki,{title:e.jsxs(e.Fragment,{children:["MST Blockchain Official"," ",e.jsx("span",{style:{color:"#008ECC"},children:"Products"})]}),linkTo:"/shop",linkText:"Shop Collection"}),e.jsxs(Q.div,{className:"w-full overflow-hidden flex flex-col",variants:pa,children:[a&&e.jsx("div",{className:"py-6 text-center text-sm text-slate-500",children:"Loading featured products..."}),r&&!a&&e.jsx("div",{className:"py-6 text-center text-sm text-red-500",children:r}),!a&&!r&&t.length===0&&e.jsx("div",{className:"py-6 text-center text-sm text-slate-500",children:"No featured products yet. Check back soon!"}),e.jsx("div",{className:"flex flex-col sm:grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4 sm:gap-4",children:t.map(o=>e.jsx(Q.div,{variants:ha,className:"w-full min-w-0",children:e.jsx(Fs,{product:o})},o.id))}),e.jsx("div",{className:"sm:hidden mt-4 w-full",children:e.jsx("a",{href:"/shop",className:"w-full block text-center bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-3 px-4 rounded-lg transition-colors duration-200",children:"View All"})})]})]})})},Xi=()=>e.jsxs(Q.div,{className:"space-y-8 md:space-y-12 mb-8",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(Gi,{}),e.jsx("div",{className:"container mx-auto px-4 space-y-8 md:space-y-12",children:e.jsx(Ji,{})})]}),Zi=()=>{const[t,s]=n.useState([]),[a,l]=n.useState(!0),[r,c]=n.useState("");n.useEffect(()=>{let i=!0;return(async()=>{l(!0);try{const{data:p}=await Xn({limit:"all"});i&&(s(p),c(""))}catch(p){console.error("Failed to load products",p),i&&(c(p.message||"Unable to load products. Please try again later."),s([]))}finally{i&&l(!1)}})(),()=>{i=!1}},[]);const o=n.useMemo(()=>{const i=new Map,d=p=>{const x=String(p||"").trim().toUpperCase();if(/^P\d{1,2}$/.test(x))return parseInt(x.slice(1),10);const D=parseInt(x.replace(/[^0-9]/g,""),10);return Number.isNaN(D)?99:D};for(const p of t){const x=(p.category||"").trim();if(!x)continue;const D=d(p.categoryPriority);(!i.has(x)||D<i.get(x))&&i.set(x,D)}return Array.from(i.entries()).sort((p,x)=>p[1]-x[1]||p[0].localeCompare(x[0])).map(([p])=>p)},[t]);return e.jsxs(Q.div,{className:"container mx-auto px-4 py-8",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(Q.h1,{className:"text-3xl font-bold mb-6",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:"Shop All Products"}),a&&e.jsx("div",{className:"py-6 text-center text-sm text-slate-500",children:"Loading products..."}),r&&!a&&e.jsx("div",{className:"py-6 text-center text-sm text-red-500",children:r}),!a&&!r&&t.length===0&&e.jsx("div",{className:"py-6 text-center text-sm text-slate-500",children:"No products found. Check back soon!"}),!a&&!r&&t.length>0&&e.jsx("div",{className:"space-y-8",children:o.map(i=>{const d=t.filter(p=>(p.category||"").trim()===i).sort((p,x)=>{const D=g=>{const R=String(g||"").trim().toUpperCase();if(/^P\d{1,2}$/.test(R))return parseInt(R.slice(1),10);const u=parseInt(R.replace(/[^0-9]/g,""),10);return Number.isNaN(u)?99:u};return D(p.categoryPriority)-D(x.categoryPriority)});return d.length?e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:i}),e.jsx(Q.div,{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",variants:pa,initial:"hidden",animate:"show",children:d.map(p=>e.jsx(Q.div,{variants:ha,children:e.jsx(Fs,{product:p})},p.id))})]},i):null})})]})},Es=()=>Nt(),fa=t=>{const s=mt(t);return n.useMemo(()=>s,[s])},eo=()=>{const{id:t}=rs(),[s,a]=n.useState(null),[l,r]=n.useState(""),[c,o]=n.useState(!1),[i,d]=n.useState(1),[p,x]=n.useState(""),[D,g]=n.useState(""),{addItem:R}=Is(),u=Te(),I=ut(),j=n.useRef(!1),m=Es(),S=["out_of_stock","preorder"],P=(s==null?void 0:s.availabilityStatus)||"in_stock",H=S.includes(P),E=!s||H,w=Array.isArray(s==null?void 0:s.reviewsList)?s.reviewsList:[],A=w.filter(f=>(f==null?void 0:f.review)&&f.review.trim().length>0),W=(s==null?void 0:s.reviewsSummary)||{totalReviews:Number((s==null?void 0:s.reviews)??w.length??0)||0,average:Number((s==null?void 0:s.rating)??0)||0,totalScore:(Number((s==null?void 0:s.reviews)??w.length??0)||0)*(Number((s==null?void 0:s.rating)??0)||0)},L=n.useMemo(()=>{if(!(s!=null&&s.showSizes))return[];const f=["XS","S","M","L","XL","XXL","3XL"],G=f.reduce((N,V,v)=>(N[V]=v,N),{}),le=Array.isArray(s==null?void 0:s.sizes)?s.sizes:[],Z=new Set;return le.map(N=>{var J;const V=(J=N==null?void 0:N.label)==null?void 0:J.toString().trim().toUpperCase();if(!V||Z.has(V))return null;Z.add(V);const v=Math.max(Number((N==null?void 0:N.stock)??0),0),q=!!((N==null?void 0:N.isAvailable)??!0)&&v>0;return{label:V,isAvailable:q,stock:v}}).filter(Boolean).sort((N,V)=>{const v=G[N.label]??f.length,q=G[V.label]??f.length;return v===q?N.label.localeCompare(V.label):v-q})},[s]),K=n.useMemo(()=>{const f=Number((s==null?void 0:s.stock)??0);return Number.isFinite(f)?Math.max(f,0):0},[s]);n.useEffect(()=>{if(j.current||!s)return;const f=I.state;if(!(f!=null&&f.fromCart))return;const G=Number(f.quantity),le=Number.isFinite(G)?Math.max(1,Math.floor(G)):1;if(s!=null&&s.showSizes&&f.size){const ie=f.size.toString().trim().toUpperCase(),N=L.find(V=>V.label===ie);if(N){x(N.label);const V=N.stock>0?N.stock:1;d(Math.max(1,Math.min(V,le))),j.current=!0;return}}const Z=K>0?K:le;d(Math.max(1,Math.min(Z,le))),j.current=!0},[I.state,L,s,K]);const O=Number(W.average??0),Y=Number(W.totalReviews??w.length??0),M=A.length,ee=String(Math.max(Y,0)).padStart(2,"0"),te=c?A:A.slice(0,3),y=(f,{size:G=20,prefix:le="star"}={})=>{const Z=[],ie=Math.max(0,Math.min(Number(f)||0,5));let N=Math.floor(ie);const V=ie-N;V>=.75&&N<5&&(N=Math.min(5,N+1));const v=V>=.25&&V<.75&&N<5;for(let q=0;q<N&&Z.length<5;q+=1)Z.push(e.jsx($t,{size:G,className:"mr-1 text-yellow-400",fill:"currentColor"},`${le}-full-${q}`));for(v&&Z.length<5&&Z.push(e.jsx(Yl,{size:G,className:"mr-1 text-yellow-400",fill:"currentColor"},`${le}-half`));Z.length<5;){const q=Z.length;Z.push(e.jsx($t,{size:G,className:"mr-1 text-slate-300",fill:"none"},`${le}-empty-${q}`))}return Z},z=Array.isArray(s==null?void 0:s.gallery)?s.gallery.filter(Boolean):[],b=[s==null?void 0:s.thumbnail,s==null?void 0:s.image].filter(Boolean).filter(f=>!z.includes(f)),C=s?[...z,...b]:[],B=(s==null?void 0:s.thumbnail)||(s==null?void 0:s.image)||C[0],re=(()=>{switch(P){case"preorder":return"Preorder • Not ready to ship";case"out_of_stock":return"Out of stock • Not ready to ship";case"low_stock":return"Low stock • Ready to ship";default:return"In stock • Ready to ship"}})(),se=P==="preorder"?"text-blue-500":P==="out_of_stock"?"text-rose-500":P==="low_stock"?"text-amber-500":"text-green-500",X=n.useMemo(()=>p&&L.find(f=>f.label===p)||null,[L,p]),F=n.useMemo(()=>s!=null&&s.showSizes?!!X&&X.stock>0&&i>X.stock:K>0&&i>K,[s==null?void 0:s.showSizes,X,i,K]);n.useEffect(()=>{if(!L.length){p&&x("");return}if(!L.some(G=>G.label===p&&G.isAvailable)){x(""),d(1),g("");return}g("")},[L,p]),n.useEffect(()=>{if(s!=null&&s.showSizes){if(!X)return;if(X.stock>0&&i>X.stock){const f=Math.max(X.stock||1,1);d(f),g("Quantity unavailable.")}else g("");return}if(K>0&&i>K){const f=Math.max(K||1,1);d(f),g("Quantity unavailable.")}else g("")},[s==null?void 0:s.showSizes,K,X,i]);const U=f=>{d(G=>{const le=Math.max(1,f);return s!=null&&s.showSizes?X&&X.isAvailable&&X.stock>0&&le>X.stock?(g("Quantity unavailable."),Math.max(X.stock,1)):(g(""),le):K>0&&le>K?(g("Quantity unavailable."),Math.max(K||1,1)):(g(""),le)})},h=()=>{if(E)return;if(s!=null&&s.showSizes&&!p){g("Please select a size before adding to cart.");return}if(X&&(X.stock<=0||!X.isAvailable)){g(`Size ${X.label} is currently unavailable.`);return}if(X&&X.stock>0&&i>X.stock){g(`Quantity unavailable. Max ${X.stock} for size ${X.label}.`);return}if(!(s!=null&&s.showSizes)&&K>0&&i>K){g(`Quantity unavailable. Max ${K} unit${K===1?"":"s"} available.`);return}g("");const f=s.id||s._id||s.productId||s.sku||s.slug,G={...s,id:f||s.id,size:p||void 0,image:B,hsnCode:s==null?void 0:s.hsnCode,gstRate:s==null?void 0:s.gstRate};R(G,i)},k=()=>{if(E)return;if(s!=null&&s.showSizes){if(!p){g("Please select a size before continuing to checkout.");return}if(X&&(X.stock<=0||!X.isAvailable)){g(`Size ${X.label} is currently unavailable.`);return}if(X&&X.stock>0&&i>X.stock){g(`Quantity unavailable. Max ${X.stock} for size ${X.label}.`);return}}else if(K>0&&i>K){g(`Quantity unavailable. Max ${K} unit${K===1?"":"s"} available.`);return}g("");const f=s._id||s.productId||s.id,G=/^[a-f\d]{24}$/i,le={id:s.id,name:s.name,image:B,price:s.price,quantity:i,size:p||void 0,hsnCode:s==null?void 0:s.hsnCode,gstRate:s==null?void 0:s.gstRate};f&&G.test(f)&&(le.product=f);const ie=Vs([le],{shippingFee:49});m(Rs()),m(bl([le])),m(ts(ie)),m(gl(null)),m(yl(null)),m(Ss("pending")),m(Fa(null)),m(Mt("order-summary")),u("/checkout/order",{state:{source:"buy-now"}})};return n.useEffect(()=>{let f=!1;const G=async()=>{var Z,ie,N;try{const V=await ti(t),v=V==null?void 0:V.data;if(!f&&v){const q=Array.isArray(v.features)?v.features.filter(Boolean):[],J=Array.isArray(v.reviewsList)?v.reviewsList:[],xe=v.reviewsSummary||{totalReviews:Number(v.reviews??((Z=v.ratings)==null?void 0:Z.totalReviews)??0)||0,average:Number(v.rating??((ie=v.ratings)==null?void 0:ie.average)??0)||0,totalScore:Number(((N=v.ratings)==null?void 0:N.totalScore)??0)||0};a({...v,features:q,reviewsList:J,reviewsSummary:xe}),o(!1),r("");return}}catch(V){console.error("Failed to fetch product",V)}f||(a(null),o(!1),r("Product not found or currently unavailable."))};G();const le=setInterval(()=>{G()},3e4);return()=>{f=!0,clearInterval(le)}},[t]),s?e.jsxs(Q.div,{className:"container mx-auto px-4 py-8 min-h-[80vh] flex flex-col items-center",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx("div",{className:"w-full max-w-7xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 p-6",children:[e.jsx(Q.div,{variants:Qi,className:"relative",children:e.jsx("div",{className:"relative overflow-hidden rounded-lg bg-gray-50",children:e.jsx(Vr,{style:{"--swiper-pagination-color":"#008ECC","--swiper-pagination-bullet-size":"10px","--swiper-pagination-bullet-horizontal-gap":"6px"},spaceBetween:10,pagination:{clickable:!0,dynamicBullets:!0},zoom:!0,autoplay:{delay:2e3,disableOnInteraction:!1,pauseOnMouseEnter:!0},loop:!0,speed:500,modules:[sl,qn,al],className:"w-full h-[400px] md:h-[500px] relative",children:C.map((f,G)=>e.jsx(Hr,{children:e.jsx("div",{className:"swiper-zoom-container w-full h-full flex items-center justify-center p-4",children:e.jsx("img",{src:f,alt:`${s.name} ${G+1}`,className:"w-full h-full object-contain"})})},G))})})}),e.jsxs(Q.div,{variants:Wi,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:s.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"flex items-center",children:y(O,{size:20,prefix:"average-rating"})}),e.jsxs("span",{className:"text-gray-600 text-sm",children:["(",ee,")"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-baseline space-x-3 mb-1",children:[e.jsxs("p",{className:"text-3xl font-bold text-primary",children:["₹",s.price.toLocaleString()]}),s.originalPrice>s.price&&e.jsxs("p",{className:"text-lg text-gray-500 line-through",children:["₹",s.originalPrice.toLocaleString()]})]}),s.discount>0&&e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsxs("span",{className:"inline-block bg-green-100 text-green-800 text-sm font-medium px-2.5 py-0.5 rounded",children:["Save ₹",s.saveAmount.toLocaleString()," (",s.discount,"% OFF)"]}),e.jsx("p",{className:"text-xs text-slate-600",children:"Price excludes GST (added at checkout)"})]})]}),e.jsx("div",{className:"prose max-w-none mb-6 text-gray-600",children:e.jsx("p",{children:s.description})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Key Features"}),e.jsx("ul",{className:"space-y-2",children:s.features.map((f,G)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("svg",{className:"h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:f})]},G))})]})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-gray-100",children:[e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Qty"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>!E&&U(i-1),disabled:E||i<=1,className:`h-9 w-9 rounded-full border text-lg font-semibold transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 ${E||i<=1?"cursor-not-allowed border-slate-200 text-slate-300":"border-slate-300 text-slate-700 hover:border-blue-500 hover:text-blue-600"}`,"aria-label":"Decrease quantity",children:"−"}),e.jsx("div",{className:"flex h-10 w-16 items-center justify-center rounded-md border border-slate-300 bg-white shadow-sm focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-200",children:e.jsx("input",{type:"tel",min:"1",value:i,onFocus:f=>{f.target.select()},onChange:f=>{if(E)return;const G=f.target.value.replace(/[^0-9]/g,"");if(!G.length){d("");return}const le=Number(G);Number.isNaN(le)||U(le)},className:"w-full bg-transparent text-center text-lg font-semibold text-slate-700 focus:outline-none",inputMode:"numeric",pattern:"[0-9]*"})}),e.jsx("button",{type:"button",onClick:()=>!E&&U(i+1),disabled:E,className:`h-9 w-9 rounded-full border text-lg font-semibold transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 ${E?"cursor-not-allowed border-slate-200 text-slate-300":"border-slate-300 text-slate-700 hover:border-blue-500 hover:text-blue-600"}`,"aria-label":"Increase quantity",children:"+"})]})]}),L.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Sizes Available:"}),L.map(f=>{const G=p===f.label,le=!f.isAvailable||E;return e.jsx("button",{type:"button",onClick:()=>{le||(x(f.label),d(Z=>{const ie=Math.max(1,Z);return f.stock>0&&ie>f.stock?(g(`Only ${f.stock} unit${f.stock===1?"":"s"} available for size ${f.label}.`),f.stock):(g(""),ie)}))},disabled:le,title:f.isAvailable?void 0:"Currently unavailable",className:`inline-flex items-center justify-center rounded-full border px-4 py-1.5 text-sm font-semibold transition ${G?"border-blue-600 bg-blue-50 text-blue-600":"border-slate-200 bg-white text-slate-600 hover:border-blue-200 hover:text-blue-600"} ${f.isAvailable?"":"cursor-not-allowed opacity-50"}`,children:f.label},f.label)})]}),D&&e.jsx("div",{className:"w-full rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-700",children:D}),e.jsx(Q.button,{type:"button",className:`flex-1 px-6 py-3 rounded-lg font-medium transition-colors text-center whitespace-nowrap ${E||F?"bg-slate-200 text-slate-500 cursor-not-allowed":"bg-primary text-white hover:bg-primary/90"}`,whileHover:E||F?void 0:lt.whileHover,whileTap:E||F?void 0:lt.whileTap,disabled:E||F,onClick:h,children:H?"Unavailable":"Add to Cart"}),e.jsx(Q.button,{type:"button",className:`flex-1 px-6 py-3 rounded-lg font-medium transition-colors text-center whitespace-nowrap ${E||F?"bg-slate-200 text-slate-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,whileHover:E||F?void 0:lt.whileHover,whileTap:E||F?void 0:lt.whileTap,disabled:E||F,onClick:k,children:H?"Notify Me":"Buy Now"})]})}),H&&e.jsx("div",{className:"mt-3 rounded-lg border border-rose-100 bg-rose-50 px-3 py-2 text-sm text-rose-600",children:"This item is currently unavailable for purchase. Please check back soon."}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500 flex items-center",children:[e.jsx("svg",{className:`h-5 w-5 mr-2 ${se}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:P==="out_of_stock"?"M6 18L18 6M6 6l12 12":"M5 13l4 4L19 7"})}),re]})]})]})]})})}),e.jsx("div",{className:"w-full max-w-7xl mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden p-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Customer Reviews"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Hear from shoppers who bought this product."})]}),e.jsx("div",{className:"rounded-lg bg-slate-50 px-4 py-2 text-xs text-gray-500 font-medium",children:M>0?`${M} customer review${M>1?"s":""}`:"No customer reviews yet"})]}),e.jsx("div",{className:"mt-6 space-y-4",children:M>0&&te.length>0?te.map((f,G)=>{var le;return e.jsxs("div",{className:"border border-slate-100 rounded-xl p-4 bg-slate-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"font-semibold text-secondary text-sm",children:f.reviewerName||"Verified Buyer"}),e.jsxs("div",{className:"flex items-center",children:[y(f.rating,{size:16,prefix:`review-${G}`}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:f.ratedAt?new Date(f.ratedAt).toLocaleDateString():""})]})]}),e.jsxs("div",{className:"mt-3 flex items-start gap-3 text-sm text-medium-text",children:[e.jsx(Qr,{className:"h-4 w-4 text-secondary mt-0.5"}),e.jsx("p",{className:"whitespace-pre-line break-words",children:(le=f.review)!=null&&le.trim()?f.review:"No additional comments provided."})]})]},`${f.reviewerName||"reviewer"}-${G}`)}):e.jsx("p",{className:"text-sm text-gray-500",children:"No reviews yet. Be the first to share your experience after purchasing!"})}),M>3&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>o(f=>!f),className:"px-4 py-2 text-sm font-medium text-primary border border-primary rounded-lg hover:bg-primary/10 transition",children:c?"Show Less":`Show All Reviews (${M})`})})]})})]}):e.jsx("div",{className:"container mx-auto px-4 py-16 text-center",children:l?e.jsx("p",{className:"text-sm font-medium text-red-500",children:l}):e.jsx("div",{className:"animate-pulse",children:"Loading product details..."})})},to=()=>{const{slug:t}=rs(),[s,a]=n.useState([]),[l,r]=n.useState(!0),[c,o]=n.useState("");let i="";try{i=decodeURIComponent(t||"")}catch{i=t||""}i=i.replace(/[-_]+/g," ").replace(/\s+/g," ").trim();const[d,p]=n.useState(i);return n.useEffect(()=>{let x=!0;return(async()=>{var g,R;r(!0);try{let u=[];if(u=(await ei(t,{limit:"all"})).data,u.length||(u=(await ol(t,{limit:"all"})).data),x){a(u);const j=(g=u.find(P=>P==null?void 0:P.category))==null?void 0:g.category,m=(R=u.find(P=>P==null?void 0:P.brand))==null?void 0:R.brand,S=(j||m||i||"").toString().trim();p(S),o("")}}catch(u){console.error("Failed to load category products",u),x&&(o(u.message||"Unable to load products for this category."),a([]),p(i))}finally{x&&r(!1)}})(),()=>{x=!1}},[t]),e.jsxs(Q.div,{className:"container mx-auto px-4 py-8",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsxs(Q.h1,{className:"text-3xl font-bold mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2},children:["Category: ",d]}),l&&e.jsx("div",{className:"py-6 text-center text-sm text-slate-500",children:"Loading category products..."}),c&&!l&&e.jsx("div",{className:"py-6 text-center text-sm text-red-500",children:c}),!l&&!c&&s.length===0&&e.jsx("div",{className:"py-6 text-center text-sm text-slate-500",children:"No products found in this category yet."}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:s.map(x=>e.jsx(Fs,{product:x},x.id))})]})},so=()=>{const{slug:t}=rs(),[s,a]=n.useState([]),[l,r]=n.useState(!0),[c,o]=n.useState(""),i=t.replace(/-/g," ").replace(/\b\w/g,d=>d.toUpperCase());return n.useEffect(()=>{let d=!0;return(async()=>{r(!0);try{const{data:x}=await ol(t,{limit:60});d&&(a(x),o(""))}catch(x){console.error("Failed to load brand products",x),d&&(o(x.message||"Unable to load products for this brand."),a([]))}finally{d&&r(!1)}})(),()=>{d=!1}},[t]),e.jsxs(Q.div,{className:"container mx-auto px-4 py-8",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsxs(Q.h1,{className:"text-3xl font-bold mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2},children:["Brand: ",i]}),l&&e.jsx("div",{className:"py-6 text-center text-sm text-slate-500",children:"Loading brand products..."}),c&&!l&&e.jsx("div",{className:"py-6 text-center text-sm text-red-500",children:c}),!l&&!c&&s.length===0&&e.jsx("div",{className:"py-6 text-center text-sm text-slate-500",children:"No products found for this brand yet."}),e.jsx(Q.div,{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",variants:pa,initial:"initial",animate:"animate",children:s.map(d=>e.jsx(Q.div,{variants:ha,children:e.jsx(Fs,{product:d})},d.id))})]})},ao=()=>{const{cartItems:t,updateQuantity:s,removeItem:a,cartCount:l,cartTotal:r}=Is(),c=Te(),o=Nt(),[i,d]=n.useState({}),p=n.useCallback(m=>{if(!m)return"";const S=m.id||m.product||m.mongoId||m._id||m.slug||"",P=m.size||"";return`${S}::${P}`},[]),x=n.useCallback(m=>{const S=p(m),P=i[S];return P===void 0?String(m.quantity):P},[i,p]),D=n.useCallback((m,S)=>{const P=p(m),H=S.replace(/[^0-9]/g,"");d(E=>({...E,[P]:H}))},[p]),g=n.useCallback(m=>{const S=p(m),P=i[S];if(P===void 0)return;const H=Number(P);if(!Number.isFinite(H)||H<=0){s(m.id,1,m.size),d(E=>{const w={...E};return delete w[S],w});return}s(m.id,H,m.size),d(E=>{const w={...E};return delete w[S],w})},[p,i,s]),R=n.useCallback(m=>{g(m)},[g]),u=n.useCallback((m,S)=>{m.key==="Enter"&&(m.preventDefault(),g(S))},[g]),I=n.useMemo(()=>{const m=/^[a-f\d]{24}$/i;return t.map(S=>{const P=S.product||S.mongoId||S._id||S.id||S.slug,H=typeof P=="string"&&m.test(P)?P:void 0;return{...S,product:H||S.product,quantity:Number(S.quantity)||1,price:Number(S.price)||0}})},[t]),j=()=>{I.length&&(o(Rs()),o(bl(I)),o(ts({subtotal:I.reduce((m,S)=>m+S.price*S.quantity,0),shippingFee:0,taxAmount:0,discount:0,total:I.reduce((m,S)=>m+S.price*S.quantity,0)})),o(Mt("order")),c("/checkout/order"))};return l===0?e.jsxs(Q.div,{className:"container mx-auto px-4 py-16 text-center",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(Q.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},children:e.jsx(Ia,{className:"mx-auto h-24 w-24 text-gray-300"})}),e.jsx(Q.h2,{className:"mt-6 text-2xl font-bold",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:"Your Cart is Empty"}),e.jsx(Q.p,{className:"mt-2 text-gray-600",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:"Looks like you haven't added anything to your cart yet."}),e.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:e.jsx(Fe,{to:"/",className:"mt-6 inline-block bg-primary text-white font-bold py-3 px-6 rounded-md hover:bg-primary-dark transition-colors",children:"Start Shopping"})})]}):e.jsxs(Q.div,{className:"container mx-auto max-w-4xl px-4 py-8 overflow-x-hidden",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsxs(Q.h1,{className:"text-3xl font-bold mb-6",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},children:["Your Shopping Cart (",l," items)"]}),e.jsx(Q.div,{className:"space-y-4",variants:pa,initial:"initial",animate:"animate",children:e.jsx(ze,{children:t.map(m=>e.jsx(Q.div,{className:"rounded-2xl border border-slate-200 bg-white/80 p-4 shadow-sm backdrop-blur-sm",variants:ha,layout:!0,exit:{opacity:0,x:-100,transition:{duration:.3}},children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start",children:[e.jsx("img",{src:m.image,alt:m.name,className:"h-24 w-24 flex-shrink-0 rounded-lg object-contain bg-slate-50"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(Fe,{to:`/product/${m.id}`,className:"text-base font-semibold text-slate-800 hover:text-primary",children:m.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Unit price: ₹",m.price.toLocaleString()]}),(()=>{const S=[];if(m!=null&&m.hsnCode&&S.push(`HSN: ${m.hsnCode}`),Number.isFinite(Number(m==null?void 0:m.gstRate))){const P=Number(m.gstRate).toFixed(2).replace(/\.00$/,"");S.push(`GST: ${P}%`)}return m!=null&&m.size&&S.push(`Size: ${m.size}`),S.length?e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-500",children:S.map((P,H)=>e.jsxs(Wr.Fragment,{children:[H>0?e.jsx("span",{className:"text-slate-300",children:"|"}):null,e.jsx("span",{children:P})]},`${m.id}-meta-${P}`))}):null})()]}),e.jsxs("div",{className:"flex flex-col items-start gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 rounded-full border border-slate-200 bg-white px-3 py-1.5 shadow-sm",children:[e.jsx("button",{onClick:()=>s(m.id,m.quantity-1,m.size),className:"rounded-full p-1.5 transition hover:bg-slate-100","aria-label":"Decrease quantity",children:e.jsx(Kl,{size:16})}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",className:"w-14 text-center text-sm font-semibold text-slate-700 border border-transparent focus:border-primary focus:outline-none rounded-md py-1",value:x(m),onChange:S=>D(m,S.target.value),onBlur:()=>R(m),onKeyDown:S=>u(S,m),"aria-label":`Quantity for ${m.name}`}),e.jsx("button",{onClick:()=>s(m.id,m.quantity+1,m.size),className:"rounded-full p-1.5 transition hover:bg-slate-100","aria-label":"Increase quantity",children:e.jsx(ft,{size:16})})]}),e.jsxs("p",{className:"text-base font-semibold text-slate-900 sm:text-right sm:text-lg",children:["₹",(m.price*m.quantity).toLocaleString()]})]}),e.jsx("div",{className:"flex flex-col gap-3 border-t border-slate-200 pt-3 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs(Q.button,{onClick:()=>a(m.id,m.size),className:"inline-flex items-center gap-2 text-sm font-medium text-slate-500 transition hover:text-rose-500",whileHover:{scale:1.03},whileTap:{scale:.97},type:"button",children:[e.jsx(Je,{size:18})," Remove"]})})]})]})},m.id))})}),e.jsxs(Q.div,{className:"mt-8 rounded-3xl border border-slate-200 bg-white/95 p-6 shadow-sm backdrop-blur-sm",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3,type:"spring",stiffness:140},children:[e.jsxs("div",{className:"flex flex-col gap-5 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs font-semibold tracking-[0.2em] text-slate-500",children:"ORDER SUMMARY"}),e.jsxs("p",{className:"mt-1 text-3xl font-semibold text-secondary",children:["₹",r.toLocaleString()]}),e.jsx("p",{className:"mt-1 text-xs text-slate-400 sm:hidden",children:"Taxes and shipping calculated at checkout."})]}),e.jsx(Q.button,{onClick:j,className:"inline-flex w-full items-center justify-center rounded-2xl bg-primary px-6 py-4 text-sm font-semibold text-white shadow-md transition hover:bg-primary-dark sm:w-auto sm:rounded-full",variants:lt,whileHover:"hover",whileTap:"tap",type:"button",children:"Proceed to Checkout"})]}),e.jsx("p",{className:"mt-3 hidden text-xs text-slate-400 sm:block",children:"Taxes and shipping will be calculated at checkout."})]})]})},Bt=[{id:"order",label:"Order Summary",path:"/checkout/order"},{id:"address",label:"Delivery Address",path:"/checkout/address"},{id:"payment",label:"Payment",path:"/checkout/payment"},{id:"confirmation",label:"Confirmation",path:"/checkout/confirmation"}],or=t=>t.includes("/checkout/payment-success")||t.includes("/checkout/payment-failed")?"confirmation":t.includes("/checkout/payment")?"payment":t.includes("/checkout/address")?"address":t.includes("/checkout/confirmation")?"confirmation":"order",ro=()=>{var r;const t=ut(),s=Te(),a=mt(c=>c.checkout),l=n.useMemo(()=>or(t.pathname),[t.pathname]);return n.useEffect(()=>{const c=or(t.pathname)==="confirmation",o=!!a.orderId;!a.items.length&&!c&&!o&&s("/cart",{replace:!0})},[a.items.length,a.orderId,t.pathname,s]),e.jsx("div",{className:"min-h-screen bg-light-bg",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 lg:px-6 py-6 lg:py-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"h-12 w-12 rounded-2xl bg-primary/10 text-primary flex items-center justify-center",children:e.jsx($a,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-secondary",children:"Secure Checkout"}),e.jsx("p",{className:"text-sm text-medium-text",children:"Follow the steps to complete your purchase safely."})]})]}),e.jsxs("nav",{className:"w-full mb-10",children:[e.jsx("div",{className:"hidden md:flex items-center justify-between gap-6",children:Bt.map((c,o)=>{const i=o+1,p=Bt.findIndex(D=>D.id===l)>o,x=c.id===l;return e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{onClick:()=>p&&s(c.path),className:"group w-full",type:"button",disabled:!p,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex h-12 w-12 items-center justify-center rounded-full border-2 text-base font-semibold transition-all duration-200 ${x?"border-primary bg-primary text-white shadow-lg shadow-primary/20":p?"border-primary/40 bg-white text-primary":"border-slate-200 bg-white text-slate-400"}`,children:i}),o!==Bt.length-1&&e.jsx("div",{className:`h-0.5 flex-1 mx-4 transition-colors duration-200 ${p?"bg-primary":"bg-slate-200"}`})]})}),e.jsx("p",{className:`mt-3 text-sm font-medium text-center transition-colors duration-200 ${x?"text-primary":p?"text-primary/70":"text-slate-500"}`,children:c.label})]},c.id)})}),e.jsxs("div",{className:"md:hidden bg-white rounded-2xl border border-slate-100 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Step"}),e.jsxs("p",{className:"text-sm font-semibold text-secondary",children:[Bt.findIndex(c=>c.id===l)+1," of"," ",Bt.length]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Current"}),e.jsx("p",{className:"text-sm font-semibold text-primary",children:(r=Bt.find(c=>c.id===l))==null?void 0:r.label})]})]})]}),e.jsx(ze,{mode:"wait",children:e.jsx(Q.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-16},transition:{duration:.3},className:"bg-white rounded-3xl border border-slate-100 shadow-xl shadow-slate-200/40 overflow-hidden",children:e.jsx(Br,{})},t.pathname)})]})})},lo=async({code:t,orderAmount:s})=>{const l=(await fe.post("/coupons/validate",{code:t,orderAmount:s})).data||{};if(l.success===!1)throw new Error(l.message||"Failed to validate coupon");return l.data},Hs=We("coupon/validate",async({code:t,orderAmount:s},{rejectWithValue:a})=>{var l,r;try{return await lo({code:t,orderAmount:s})}catch(c){const o=((r=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:r.message)||(c==null?void 0:c.message)||"Unable to validate coupon";return a(o)}}),cr=()=>{const t=Te(),s=Nt(),{items:a,totals:l,appliedCoupon:r}=mt(j=>j.checkout),c=mt(j=>j.coupon),[o]=n.useState(29),[i,d]=n.useState((r==null?void 0:r.code)||""),p=n.useMemo(()=>Vs(a,{shippingFee:o,discount:l.discount,currency:l.currency}),[a,o,l.discount,l.currency]),x=n.useMemo(()=>a.reduce((j,m)=>j+Number(m.price||0)*Number(m.quantity||0),0),[a]),D=c.status==="loading",g=c.error;n.useEffect(()=>{d((r==null?void 0:r.code)||"")},[r==null?void 0:r.code]);const R=()=>{s(ts({...p,baseSubtotal:x,baseTotal:x+p.shippingFee+p.taxAmount})),s(Mt("address")),t("/checkout/address")},u=async()=>{const j=i.trim().toUpperCase();if(!j){ge.error("Enter a coupon code");return}try{const m=await s(Hs({code:j,orderAmount:x})).unwrap();s(Fi({code:m.code,type:m.type,discountType:m.discountType,discountValue:m.discountValue,discountAmount:m.discountAmount}));const S=Vs(a,{shippingFee:o,discount:m.discountAmount,currency:l.currency}),P=x+S.shippingFee+S.taxAmount;s(ts({...S,baseSubtotal:x,baseTotal:P})),ge.success("Coupon applied")}catch(m){const S=(m==null?void 0:m.message)||g||"Unable to apply coupon";ge.error(S)}},I=()=>{d(""),s(jl());const j=Vs(a,{shippingFee:o,discount:0,currency:l.currency}),m=x+j.shippingFee+j.taxAmount;s(ts({...j,baseSubtotal:x,baseTotal:m}))};return a.length?e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr] lg:gap-0",children:[e.jsxs("div",{className:"p-6 lg:p-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Review your order"}),e.jsx("p",{className:"text-sm text-medium-text mt-1",children:"Confirm product details and pricing before continuing."})]}),e.jsx("span",{className:"text-sm text-primary bg-primary/10 px-3 py-1 rounded-full",children:"Step 1 of 4"})]}),e.jsx("div",{className:"space-y-5",children:a.map((j,m)=>e.jsxs(Q.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{delay:m*.05},className:"flex flex-col md:flex-row gap-5 border border-slate-200 rounded-2xl p-5",children:[e.jsx("div",{className:"w-full md:w-40 lg:w-48 h-40 bg-slate-50 border border-slate-100 rounded-xl flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:j.image,alt:j.name,className:"max-w-full max-h-full object-contain",onError:S=>{S.target.onerror=null,S.target.src="https://placehold.co/200x200/f8fafc/e2e8f0?text=Image"}})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary",children:j.name}),j.size&&e.jsxs("p",{className:"text-sm text-medium-text mt-1 uppercase",children:["Size: ",j.size]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-medium-text",children:[e.jsxs("span",{children:["Qty: ",j.quantity]}),e.jsx("span",{className:"text-slate-300",children:"|"}),e.jsxs("span",{children:["Unit Price: ₹",j.price.toLocaleString()]}),e.jsx("span",{className:"text-slate-300",children:"|"}),e.jsxs("span",{children:["Line Total: ₹",(j.price*j.quantity).toLocaleString()]})]}),e.jsx("p",{className:"text-sm text-slate-500",children:"returns within 7 days of delivery"})]})]},`${j.id}-${j.size||"default"}-${m}`))}),e.jsx("div",{className:"mt-10 hidden justify-end lg:flex",children:e.jsx(Q.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:R,className:"px-6 py-3 rounded-xl bg-primary text-white font-semibold shadow-md shadow-primary/20 hover:bg-primary-dark transition",children:"Continue to Address"})})]}),e.jsx("aside",{className:"border-t border-slate-100 bg-slate-50 p-6 lg:border-t-0 lg:border-l lg:p-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-semibold text-secondary",children:"Redeem Coupon"}),e.jsx("p",{className:"mt-1 text-xs text-medium-text",children:"Apply a coupon before reviewing price details."})]}),(r==null?void 0:r.code)&&e.jsxs("span",{className:"rounded-full bg-emerald-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-600",children:["Applied: ",r.code]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"min-w-[200px] flex-1",children:[e.jsx("label",{htmlFor:"checkout-order-coupon",className:"sr-only",children:"Coupon code"}),e.jsx("input",{id:"checkout-order-coupon",type:"text",value:i,onChange:j=>d(j.target.value.toUpperCase()),placeholder:"MEGA50",className:"w-full rounded-xl border border-slate-200 px-4 py-2 text-sm font-semibold uppercase tracking-wide text-slate-700 focus:border-primary focus:outline-none disabled:cursor-not-allowed disabled:opacity-60",disabled:D})]}),r!=null&&r.code?e.jsx("button",{type:"button",onClick:I,className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-4 py-2 text-sm font-semibold text-rose-600 transition hover:bg-rose-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:D,children:"Remove"}):e.jsx("button",{type:"button",onClick:u,className:"inline-flex items-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-primary-dark disabled:cursor-not-allowed disabled:opacity-60",disabled:D||!i.trim(),children:D?e.jsx(Ie,{size:16,className:"animate-spin"}):"Apply"})]}),g&&!(r!=null&&r.code)&&e.jsx("p",{className:"mt-2 text-xs text-rose-600",children:g}),(r==null?void 0:r.code)&&e.jsx("div",{className:"mt-3 rounded-xl border border-emerald-100 bg-emerald-50 px-3 py-2 text-xs text-emerald-700",children:e.jsxs("p",{children:["Coupon applied successfully. Savings: ₹",Number(r.discountAmount||0).toLocaleString()]})})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary",children:"Price Details"}),e.jsxs("div",{className:"mt-4 space-y-4 text-sm text-medium-text",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",p.subtotal.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping Fee"}),e.jsxs("span",{children:["₹",p.shippingFee.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsxs("span",{children:["₹",p.taxAmount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between font-medium text-emerald-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",p.discount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between border-t border-slate-200 pt-3 text-base font-semibold text-secondary",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",p.total.toLocaleString()]})]})]})]})]})}),e.jsx("div",{className:"px-6 pb-6 lg:hidden",children:e.jsx(Q.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:R,className:"w-full rounded-xl bg-primary px-6 py-3 text-base font-semibold text-white shadow-md shadow-primary/20 transition hover:bg-primary-dark",children:"Continue to Address"})})]}):e.jsx("div",{className:"p-8",children:e.jsx("p",{className:"text-center text-gray-500",children:"No items in checkout."})})},vl="IN",no=Tn.getStatesOfCountry(vl)||[],io=t=>{const s=$n.getCitiesOfState(vl,t.isoCode).map(a=>a.name).filter(Boolean).sort((a,l)=>a.localeCompare(l));return{name:t.name,isoCode:t.isoCode,cities:s}},wl=no.map(io).sort((t,s)=>t.name.localeCompare(s.name)),na=wl.map(t=>t.name),Sl=t=>{if(!t)return[];const s=wl.find(a=>a.name===t);return s?s.cities:[]},oo={110001:[{Name:"Connaught Place",BranchType:"Head Office",DeliveryStatus:"Delivery",Circle:"Delhi",District:"New Delhi",Division:"New Delhi Central",Region:"Delhi",State:"Delhi",Block:"New Delhi",Taluk:"New Delhi"}],302020:[{Name:"Mansarovar",BranchType:"Sub Office",DeliveryStatus:"Delivery",Circle:"Rajasthan",District:"Jaipur",Division:"Jaipur City",Region:"Jaipur HQ",State:"Rajasthan",Block:"Sanganer",Taluk:"Jaipur"}],302021:[{Name:"Lalarpura",BranchType:"Branch Office",DeliveryStatus:"Delivery",Circle:"Rajasthan",District:"Jaipur",Division:"Jaipur City",Region:"Jaipur HQ",State:"Rajasthan",Block:"Sanganer",Taluk:"Jaipur"}],400001:[{Name:"Mumbai G.P.O.",BranchType:"Head Office",DeliveryStatus:"Delivery",Circle:"Maharashtra",District:"Mumbai",Division:"Mumbai",Region:"Mumbai",State:"Maharashtra",Block:"Fort",Taluk:"Mumbai"}],560001:[{Name:"Bangalore G.P.O.",BranchType:"Head Office",DeliveryStatus:"Delivery",Circle:"Karnataka",District:"Bengaluru",Division:"Bengaluru East",Region:"Bengaluru HQ",State:"Karnataka",Block:"Bengaluru North",Taluk:"Bengaluru"}]},co=t=>{const s=String(t||"").trim();if(!s)return null;const a=oo[s];return Array.isArray(a)&&a.length?a.map(l=>({...l})):null},mo=t=>`https://api.postalpincode.in/pincode/${encodeURIComponent(t)}`,ht=(t="")=>t.toString().trim().replace(/\s+/g," "),Dt=(t="")=>ht(t).toLowerCase(),uo=(t,s=12)=>{if(t.split(/\s+/).filter(Boolean).length>=s)return t;const l=["easily reachable for delivery agents","well known to local residents","provides clear guidance for couriers","surrounded by recognizable neighborhood amenities","simple to navigate without repeated phone calls"];let r=t,c=0;for(;r.split(/\s+/).filter(Boolean).length<s;)r=`${r}, ${l[c%l.length]}`,c+=1;return r},xo=/[\p{L}\p{N}\s,./-]+/u,dr=/^[A-Za-z]+$/,mr=/^[\u0900-\u097F]+$/u,po=new Set(["bldg","nr","blk","stn","rd","flr","apt","gn","sct","sec","opp"]),ho=(t,{minimumWords:s=0,minimumSegments:a=5,minSegmentLength:l=4}={})=>{const r=ht(t),c=[];if(!r)return{isValid:!1,errors:["Add a detailed address line covering area, nearby landmark, road, building, city, and state."],wordCount:0,suspiciousWords:[]};xo.test(r)||c.push("Use only Hindi or English letters, numbers, commas, slashes, hyphens, and spaces in the address line.");const o=r.split(/[\s,]+/).map(x=>x.replace(/^[./-]+|[./-]+$/g,"")).filter(Boolean),i=r.split(",").map(x=>ht(x)).filter(Boolean);a>0&&i.length<a&&c.push("Structure the address line with area, nearby landmark, road, building, city, and state (use commas to separate each part).");const d=[],p=[];return o.forEach(x=>{const D=x.toLowerCase();if(D.length<=2||/\d/.test(D))return;const g=D.replace(/[^a-z\u0900-\u097f]/gu,"");g&&(po.has(g)||mr.test(g)||dr.test(g)&&!/[aeiou]/.test(g)&&d.push(x))}),d.length&&c.push(`Replace gibberish words in the address line: ${d.slice(0,4).join(", ")}.`),i.forEach(x=>{if(x.length<l){p.push(x);return}x.split(/\s+/).map(R=>R.replace(/^[./-]+|[./-]+$/g,"")).filter(Boolean).some(R=>{const u=R.toLowerCase();return!!(mr.test(R)||/\d/.test(u)||dr.test(R)&&/[aeiou]/i.test(R))})||p.push(x)}),p.length&&c.push(`Clarify these address parts so they describe the location clearly: ${p.slice(0,4).join(", ")}.`),{isValid:c.length===0,errors:c,wordCount:o.length,segmentCount:i.length,suspiciousWords:d}},Cl=(t,s)=>{if(!t)return"";const a=ht(t.Name||t.Block||t.Taluk||t.District||"local"),l=ht(t.Division||t.Region||t.Circle||"community landmark"),r=ht(t.Taluk||t.Block||`${t.District||"city"} main road`),c=ht(t.BranchType?`${t.BranchType.toLowerCase()} building`:"residential building"),o=ht(t.District||t.Name||""),i=ht(t.State||""),d=[a?`${a} area`:null,l?`near ${l}`:null,r?`along ${r}`:null,c,o,i,s?`PIN ${ht(s)}`:null,"India"].filter(Boolean);return uo(d.join(", "))},ur=(t=[],s)=>t.map(a=>({Country:a.Country||"India",DeliveryStatus:a.DeliveryStatus||"Delivery",Pincode:a.Pincode||String(s).trim(),...a})),kl=async t=>{var l;const s=String(t||"").trim();if(!s)return{success:!1,message:"Pincode is required.",postOffices:[]};const a=co(s);if(Array.isArray(a)&&a.length)return{success:!0,postOffices:ur(a,s),source:"static"};try{const r=await fetch(mo(s));if(!r.ok)throw new Error("Unable to reach postal validation service.");const c=await r.json(),o=Array.isArray(c)?c[0]:null;return!o||o.Status!=="Success"||!((l=o.PostOffice)!=null&&l.length)?{success:!1,message:"Pincode is invalid or currently not serviceable.",postOffices:[]}:{success:!0,postOffices:ur(o.PostOffice,s),source:"remote"}}catch(r){return{success:!1,message:r.message||"Failed to validate address with postal service.",postOffices:[]}}},Al=async({pincode:t,state:s,city:a})=>{const l=await kl(t);if(!l.success)return l;const r=Dt(s),c=Dt(a),o=l.postOffices.find(i=>{const d=Dt(i.State),p=Dt(i.District),x=Dt(i.Name);return d===r&&(p===c||x===c)});if(!o){const i=l.postOffices[0];return{success:!1,message:`City/State do not match this PIN code. Try "${(i==null?void 0:i.District)||(i==null?void 0:i.Name)||""}, ${(i==null?void 0:i.State)||""}" for PIN ${String(t).trim()}.`}}return{success:!0,data:{state:o.State,city:o.District||o.Name,postOffice:o.Name,addressLineSuggestion:Cl(o,t)}}},ks=(t,{city:s,state:a})=>{if(!t)return!1;const l=Dt(t),r=Dt(a),c=Dt(s);return l.includes(c)&&l.includes(r)},Pl=async t=>{const s=await kl(t);if(!s.success)return s;const a=s.postOffices[0];return a?{success:!0,data:{state:a.State,city:a.District||a.Name,postOffice:a.Name,addressLineSuggestion:Cl(a,t)}}:{success:!1,message:"No post offices found for this pincode."}},fo=(t="",s="")=>({fullName:s||"",mobile:"",email:t,pincode:"",state:"",city:"",addressLine:"",alternatePhone:"",isDefault:!1,latitude:null,longitude:null,formattedAddress:"",isGeoVerified:!1}),bo=/^[6-9]\d{9}$/,Dl=/^[1-9]\d{5}$/,xr=/^[A-Za-z\s.'-]{2,}$/,Ts=255,ga=255,go="p2pdeal:checkout:address_draft",yo=async({city:t,state:s,pincode:a})=>{try{const l=encodeURIComponent(`${a||""} ${t||""} ${s||""} India`),r=await fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&addressdetails=1&countrycodes=in&q=${l}`,{headers:{Accept:"application/json"}});if(!r.ok)return null;const c=await r.json();if(!Array.isArray(c)||!c.length)return null;const o=c[0],i=Number(o.lat),d=Number(o.lon);return!Number.isFinite(i)||!Number.isFinite(d)?null:{latitude:i,longitude:d,formattedAddress:o.display_name}}catch{return null}},jo=t=>{const s=[],a=ho(t.addressLine,{minimumWords:0,minimumSegments:6,minSegmentLength:5});a.isValid||s.push(...a.errors);const l=String(t.mobile||"").trim();bo.test(l)||s.push("Enter a valid 10-digit mobile number starting with 6-9.");const r=String(t.pincode||"").trim();Dl.test(r)||s.push("Enter a valid 6-digit pincode.");const c=String(t.state||"").trim();xr.test(c)||s.push("Enter a valid state name using only letters.");const o=String(t.city||"").trim();return xr.test(o)||s.push("Enter a valid city name using only letters."),{isValid:s.length===0,errors:s}},No=()=>{const t=Nt(),s=Te(),{user:a}=Qe(),l=n.useMemo(()=>(a==null?void 0:a.name)||(a==null?void 0:a.username)||(a==null?void 0:a.fullName)||"",[a==null?void 0:a.name,a==null?void 0:a.username,a==null?void 0:a.fullName]),r=n.useCallback(()=>fo(a==null?void 0:a.email,l),[a==null?void 0:a.email,l]),{items:c}=mt(b=>b.checkout),{addresses:o,loading:i}=mt(b=>b.address),[d,p]=n.useState(null),[x,D]=n.useState(!1),[g,R]=n.useState(!1),[u,I]=n.useState(r),[j,m]=n.useState(null),S=n.useRef(""),P=n.useRef(!0),H=n.useRef(!1),E=n.useMemo(()=>{const b=(a==null?void 0:a._id)||(a==null?void 0:a.id)||(a==null?void 0:a.email)||(a==null?void 0:a.phone)||"guest";return`${go}:${b}`},[a==null?void 0:a._id,a==null?void 0:a.email,a==null?void 0:a.id,a==null?void 0:a.phone]),w=n.useCallback(()=>{if(!(typeof window>"u"))try{window.localStorage.removeItem(E)}catch(b){console.error("Failed to clear address draft",b)}},[E]);n.useEffect(()=>{if(typeof window>"u"){P.current=!1;return}P.current=!0;try{const b=window.localStorage.getItem(E);if(!b)return;const C=JSON.parse(b);if(C!=null&&C.formState){const B={...r(),...C.formState};I(B),D(C.showForm??!0),m(C.editingAddressId??null),H.current=!0}}catch(b){console.error("Failed to restore address draft",b)}finally{P.current=!1}},[E,r]),n.useEffect(()=>{if(!(typeof window>"u")&&!P.current){if(!x){w();return}try{window.localStorage.setItem(E,JSON.stringify({formState:u,editingAddressId:j,showForm:!0,timestamp:Date.now()}))}catch(b){console.error("Failed to persist address draft",b)}}},[u,j,x,E,w]);const A=n.useCallback(()=>{I(r()),m(null),D(!0),w(),H.current=!1},[r,w]),W=n.useCallback(()=>{D(!1),I(r()),m(null),w(),H.current=!1},[r,w]),L=n.useMemo(()=>{const b=Sl(u.state)||[];return u.city&&b.length&&!b.includes(u.city)?[...b,u.city]:b},[u.state,u.city]),K=(b="")=>b.toString().toLowerCase().replace(/&/g,"and").replace(/\./g,"").replace(/\s+/g," ").trim(),O=(b="")=>{if(!b)return"";const C=K(b);return na.find(re=>K(re)===C)||b};n.useEffect(()=>{t(Mt("address")),c.length||(ne.error("Your checkout session expired. Start again."),s("/cart",{replace:!0}))},[t,c.length,s]),n.useEffect(()=>{a!=null&&a.email&&I(b=>({...b,email:b.email||a.email}))},[a==null?void 0:a.email]),n.useEffect(()=>{l&&I(b=>({...b,fullName:b.fullName||l}))},[l]),n.useEffect(()=>{(async()=>{var C;t(la(!0));try{const B=await qa(),re=Array.isArray(B)?B:((C=B==null?void 0:B.data)==null?void 0:C.data)||(B==null?void 0:B.data)||[];t(Bs(re))}catch(B){console.error("Failed to fetch addresses",B),t(hl(B.message||"Failed to fetch addresses")),ne.error(B.message||"Failed to fetch addresses")}finally{t(la(!1))}})()},[t]),n.useEffect(()=>{if(!P.current){if(!o.length)D(!0),p(null),m(null),H.current||I(r());else if(!d){const b=o.find(C=>C.isDefault);p((b==null?void 0:b._id)||o[0]._id),D(!1),H.current=!1}}},[o,d,a==null?void 0:a.email]),n.useEffect(()=>{const b=String(u.pincode||"").trim();if(!Dl.test(b)||b===S.current)return;let C=!0;return S.current=b,(async()=>{var U;const re=await Pl(b);if(!C)return;if(!re.success){ne.error(re.message);return}const se=O(re.data.state),X=(re.data.city||"").trim(),F=((U=re.data.addressLineSuggestion)==null?void 0:U.trim().slice(0,Ts))||"";!se&&!X||I(h=>{const k=se||h.state,f=X||h.city,G=F&&(!h.addressLine||!ks(h.addressLine,{city:f,state:k}));return h.state===k&&h.city===f&&!G?h:{...h,state:k,city:f,...G?{addressLine:F}:{},isGeoVerified:!1,latitude:null,longitude:null,formattedAddress:""}})})(),()=>{C=!1}},[u.pincode]);const Y=n.useMemo(()=>o.find(b=>b._id===d)||null,[o,d]),M=b=>{const{name:C,value:B,type:re,checked:se}=b.target,X=re==="checkbox"?se:B;I(F=>({...F,[C]:X,...C==="state"&&F.state!==X?{city:""}:{},...C==="addressLine"||C==="city"||C==="state"||C==="pincode"?{isGeoVerified:!1,latitude:null,longitude:null,formattedAddress:""}:{}}))},ee=async b=>{var B,re,se,X,F,U,h,k,f;b.preventDefault(),R(!0);let C={...u,isDefault:j!==null?u.isDefault:u.isDefault||o.length===0};try{const G=jo(u);if(!G.isValid){G.errors.forEach(q=>ne.error(q)),R(!1);return}const le=await Al(u);if(!le.success){ne.error(le.message),R(!1);return}C.state=le.data.state,C.city=le.data.city;const Z=((B=le.data.addressLineSuggestion)==null?void 0:B.trim().slice(0,Ts))||"";if(Z&&(ks(C.addressLine,{city:C.city,state:C.state})||(C.addressLine=Z,I(J=>({...J,addressLine:Z})))),C.addressLine.length>Ts&&(C.addressLine=C.addressLine.slice(0,Ts)),!ks(C.addressLine,{city:C.city,state:C.state})){ne.error("Provide an address line that includes the resolved city and state for this PIN."),R(!1);return}const ie=await yo({city:C.city,state:C.state,pincode:C.pincode});ie&&(C.latitude=ie.latitude,C.longitude=ie.longitude,C.formattedAddress=ie.formattedAddress.slice(0,ga).trim(),C.formattedAddress||delete C.formattedAddress,C.isGeoVerified=!0);let N;const V={...C};if(V.email=((re=V.email)==null?void 0:re.trim())||((se=a==null?void 0:a.email)==null?void 0:se.trim())||"",!V.email){ne.error("Email is required for delivery updates."),R(!1);return}["latitude","longitude"].forEach(q=>{(V[q]===null||V[q]===void 0)&&delete V[q]}),(X=V.formattedAddress)!=null&&X.trim()||delete V.formattedAddress,((F=V.formattedAddress)==null?void 0:F.length)>ga&&(V.formattedAddress=V.formattedAddress.slice(0,ga).trim()),(U=V.alternatePhone)!=null&&U.trim()||delete V.alternatePhone,j?(N=await cl(j,V),ne.success("Address updated successfully")):(N=await li(V),ne.success("Address saved successfully"));const v=Array.isArray(N)?N:((h=N==null?void 0:N.data)==null?void 0:h.data)||(N==null?void 0:N.data)||[];if(t(Bs(v)),!j&&v.length){const q=v[v.length-1];p((q==null?void 0:q._id)||null)}j&&p(j),D(!1),I(r()),w(),m(null)}catch(G){console.error("Failed to save address",G),ne.error(((f=(k=G.response)==null?void 0:k.data)==null?void 0:f.message)||G.message||"Failed to save address")}finally{R(!1)}},te=b=>{m(b._id),I({fullName:b.fullName||"",mobile:b.mobile||"",email:b.email||"",pincode:b.pincode||"",state:b.state||"",city:b.city||"",addressLine:b.addressLine||"",alternatePhone:b.alternatePhone||"",isDefault:!!b.isDefault,latitude:b.latitude??null,longitude:b.longitude??null,formattedAddress:b.formattedAddress||"",isGeoVerified:!!b.isGeoVerified}),D(!0)},y=async b=>{var B,re,se;if(window.confirm(`Delete address for ${b.fullName}? This action cannot be undone.`))try{const X=b._id||b.id;if(!X){ne.error("Unable to delete address: missing identifier");return}const F=await ni(X),U=Array.isArray(F)?F:((B=F==null?void 0:F.data)==null?void 0:B.data)||(F==null?void 0:F.data)||[];if(t(Bs(U)),ne.success("Address removed"),j===b._id&&(m(null),I(r()),D(!1)),!U.length)p(null),D(!0);else if(d===b._id||d===b.id){const h=U.find(k=>k.isDefault);p((h==null?void 0:h._id)||U[0]._id)}}catch(X){console.error("Failed to delete address",X),ne.error(((se=(re=X.response)==null?void 0:re.data)==null?void 0:se.message)||X.message||"Failed to delete address")}},z=()=>{if(x&&!o.length){ne.error("Please add an address before continuing");return}if(!Y){ne.error("Select an address to proceed");return}t(gl(Y)),t(Mt("payment")),s("/checkout/payment")};return e.jsxs("div",{className:"grid lg:grid-cols-[2fr,1fr] gap-0",children:[e.jsxs("div",{className:"p-6 lg:p-10 space-y-8",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Delivery Address"}),e.jsx("p",{className:"text-sm text-medium-text mt-1",children:"Choose an existing address or add a new one."})]}),e.jsx("span",{className:"text-sm text-primary bg-primary/10 px-3 py-1 rounded-full",children:"Step 2 of 4"})]}),i?e.jsx("div",{className:"border border-slate-200 rounded-2xl p-6 text-center text-medium-text",children:"Loading your saved addresses..."}):e.jsxs("div",{className:"space-y-4",children:[o.map((b,C)=>{const B=b._id||b.id||C,re=d===b._id||d===b.id;return e.jsx("label",{className:`block border rounded-2xl p-4 cursor-pointer transition-colors ${re?"border-primary bg-primary/5":"border-slate-200 bg-white hover:border-primary/50"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("input",{type:"radio",name:"selectedAddress",checked:re,onChange:()=>p(b._id||b.id),className:"mt-1 h-4 w-4 text-primary focus:ring-primary"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-base font-semibold text-secondary",children:b.fullName}),b.isDefault&&e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-primary/10 text-primary",children:"Default"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:se=>{se.preventDefault(),se.stopPropagation(),te(b)},className:"text-xs font-medium text-primary hover:text-primary-dark",children:"Edit"}),e.jsx("button",{type:"button",onClick:se=>{se.preventDefault(),se.stopPropagation(),y(b)},className:"text-xs font-medium text-rose-500 hover:text-rose-600",children:"Remove"})]})]}),e.jsxs("p",{className:"text-sm text-medium-text",children:[b.addressLine,", ",b.city,", ",b.state," -"," ",b.pincode]}),e.jsxs("p",{className:"text-sm text-medium-text",children:["Mobile: ",b.mobile]}),b.alternatePhone&&e.jsxs("p",{className:"text-sm text-medium-text",children:["Alternate: ",b.alternatePhone]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Email: ",b.email]})]})]})},B)}),e.jsx("button",{type:"button",onClick:()=>{D(b=>!b),m(null),I(r()),w()},className:"text-sm font-medium text-primary hover:text-primary-dark",children:x&&!j?"Cancel adding new address":x&&j?"Cancel editing":"+ Add New Address"})]}),x&&e.jsxs(Q.form,{onSubmit:ee,initial:{opacity:0,y:16},animate:{opacity:1,y:0},className:"border border-slate-200 rounded-2xl p-6 space-y-4 bg-white",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary",children:j?"Update Address":"Add New Address"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"space-y-2 text-sm font-medium text-secondary/80",children:["Full Name",e.jsx("input",{type:"text",name:"fullName",value:u.fullName,onChange:M,required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("label",{className:"space-y-2 text-sm font-medium text-secondary/80",children:["Mobile Number",e.jsx("input",{type:"tel",name:"mobile",value:u.mobile,onChange:M,required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("label",{className:"space-y-2 text-sm font-medium text-secondary/80",children:["Email",e.jsx("input",{type:"email",name:"email",value:u.email,onChange:M,required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("label",{className:"space-y-2 text-sm font-medium text-secondary/80",children:["Pincode",e.jsx("input",{type:"text",name:"pincode",value:u.pincode,onChange:M,required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("label",{className:"space-y-2 text-sm font-medium text-secondary/80",children:["State",e.jsxs("select",{name:"state",value:u.state,onChange:M,required:!0,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"Select state"}),na.map(b=>e.jsx("option",{value:b,children:b},b))]})]}),e.jsxs("label",{className:"space-y-2 text-sm font-medium text-secondary/80",children:["City",e.jsxs("select",{name:"city",value:u.city,onChange:M,required:!0,disabled:!u.state&&!L.length,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary disabled:cursor-not-allowed disabled:bg-slate-100",children:[e.jsx("option",{value:"",children:u.state||L.length?"Select city":"Select state first"}),L.map(b=>e.jsx("option",{value:b,children:b},b))]})]})]}),e.jsxs("label",{className:"space-y-2 text-sm font-medium text-secondary/80 block",children:["Address Line",e.jsx("textarea",{name:"addressLine",value:u.addressLine,onChange:M,required:!0,rows:3,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"})]}),u.isGeoVerified?e.jsx("p",{className:"text-xs text-emerald-600",children:"Address verified via map service."}):null,e.jsx("p",{className:"text-xs text-medium-text",children:"Enter the full delivery address as it should appear on the package. Our team will review it before shipping."}),e.jsxs("label",{className:"space-y-2 text-sm font-medium text-secondary/80 block",children:["Alternate Phone (optional)",e.jsx("input",{type:"tel",name:"alternatePhone",value:u.alternatePhone,onChange:M,className:"w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-medium-text",children:[e.jsx("input",{type:"checkbox",name:"isDefault",checked:u.isDefault,onChange:M,className:"h-4 w-4 text-primary focus:ring-primary"}),"Set as default delivery address"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:W,className:"px-4 py-2 rounded-lg border border-slate-200 text-secondary hover:bg-slate-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:A,className:"px-4 py-2 rounded-lg border border-slate-200 text-secondary hover:bg-slate-50",children:"Reset"}),e.jsxs(Q.button,{type:"submit",whileHover:{scale:1.02},whileTap:{scale:.98},disabled:g,className:"px-4 py-2 rounded-lg bg-primary text-white font-medium shadow-md shadow-primary/20 disabled:cursor-not-allowed disabled:opacity-60",children:[g?j?"Updating...":"Saving...":j?"Save Changes":"Save Address",g&&e.jsx(Ie,{className:"ml-2 inline h-4 w-4 animate-spin"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Q.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:z,className:"px-6 py-3 rounded-xl bg-primary text-white font-semibold shadow-md shadow-primary/20 hover:bg-primary-dark transition",children:"Continue to Payment"})})]}),e.jsxs("aside",{className:"bg-white border-l border-slate-100 p-6 lg:p-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary",children:"Why we need this?"}),e.jsxs("ul",{className:"mt-4 space-y-3 text-sm text-medium-text",children:[e.jsx("li",{children:"• Ensure accurate delivery of your order."}),e.jsx("li",{children:"• Provide updates on shipping and delivery status."}),e.jsx("li",{children:"• Offer faster checkout for future purchases."})]})]})]})},pr={status:"idle",error:"",data:null},Rl=Ft({name:"coupon",initialState:pr,reducers:{resetCouponState:()=>({...pr})},extraReducers:t=>{t.addCase(Hs.pending,s=>{s.status="loading",s.error=""}).addCase(Hs.fulfilled,(s,a)=>{s.status="succeeded",s.data=a.payload,s.error=""}).addCase(Hs.rejected,(s,a)=>{var l;s.status="failed",s.error=a.payload||((l=a.error)==null?void 0:l.message)||"Failed to validate coupon"})}}),{resetCouponState:vo}=Rl.actions,wo=Rl.reducer,hr=3500,fr=40,So=()=>typeof window<"u"&&window.matchMedia("(max-width: 768px)").matches,Co=[{id:"upi",title:"PhonePe / UPI",description:"Pay instantly using any UPI app linked to PhonePe."},{id:"qr",title:"PhonePe QR Code",description:"Scan and pay securely with the official PhonePe QR."},{id:"cod",title:"Cash on Delivery",description:"Pay in cash when the product is delivered to you."}],Ct=(t=0,s="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:s,maximumFractionDigits:2}).format(Number(t)||0),ko=()=>{var F,U;const t=Nt(),s=Te(),{user:a}=Qe(),{items:l,shippingAddress:r,totals:c,orderId:o,appliedCoupon:i}=mt(h=>h.checkout),{removeItems:d}=Is(),[p,x]=n.useState("cod"),[D,g]=n.useState(!1),[R,u]=n.useState(!1),[I,j]=n.useState(null),[m,S]=n.useState(null),P=n.useRef(0),H=n.useRef(null);n.useEffect(()=>{if(!l.length){if(o)return;s("/cart",{replace:!0});return}if(!r){s("/checkout/address",{replace:!0});return}t(Mt("payment"))},[t,l.length,r,o,s]);const E=n.useMemo(()=>l.map(({product:h,name:k,image:f,price:G,quantity:le,size:Z,hsnCode:ie,hsn:N,gstRate:V,taxRate:v})=>({product:h,name:k,image:f,price:G,quantity:le,size:Z,hsnCode:ie||N||void 0,gstRate:V!=null?Number(V):v!=null?Number(v):void 0})),[l]),w=n.useMemo(()=>E.reduce((h,k)=>h+Number(k.price||0)*Number(k.quantity||0),0),[E]),A=n.useMemo(()=>{const h=(V,v=0)=>Number.isFinite(Number(V))?Number(V):v,k=h(c.shippingFee,0),f=h(c.taxAmount,0),G=h(c.discount,0),le=c.subtotal>0?c.subtotal:w,Z=c.total>0?c.total:le+k+f-G,ie=Math.max(Number.isFinite(Z)?Z:0,0),N=c.currency||"INR";return{subtotal:le,shippingFee:k,taxAmount:f,discount:G,total:ie,currency:N}},[w,c]),W=n.useMemo(()=>({shippingFee:A.shippingFee,taxAmount:A.taxAmount,discount:A.discount,currency:A.currency,baseSubtotal:w}),[w,A]),L=n.useMemo(()=>{if(!r)return null;const h=r.email&&r.email.trim()||(a==null?void 0:a.email)&&a.email.trim()||"";return{fullName:r.fullName,mobile:r.mobile,email:h,pincode:r.pincode,state:r.state,city:r.city,addressLine:r.addressLine,alternatePhone:r.alternatePhone||""}},[r,a==null?void 0:a.email]),K=n.useCallback(()=>{H.current&&(clearTimeout(H.current),H.current=null)},[]),O=n.useCallback(h=>{h!==p&&(h!=="cod"&&(K(),S(null),u(!1),j(null)),x(h))},[p,K]),Y=n.useCallback((h,k)=>{const f=(k==null?void 0:k.order)||null,G=(f==null?void 0:f._id)||(k==null?void 0:k.orderId);t(Ss("paid")),G&&t(Fa(G));const le=Array.isArray(f==null?void 0:f.items)&&f.items.length?f.items:E;d(le),ne.success("Payment Success ✅"),K(),u(!1),S(Z=>Z&&{...Z,paymentStatus:"SUCCESS",completedAt:new Date}),s("/checkout/payment-success",{replace:!0,state:{order:f,orderId:G,transactionId:h,amountPaid:k==null?void 0:k.amountInRupees}}),t(Rs()),t(jl()),t(vo())},[t,s,E,d,K]),M=n.useCallback((h,k,f)=>{t(Ss("failed")),ne.error(k||"Payment Failed ❌"),K(),u(!1),S(G=>G&&{...G,paymentStatus:"FAILED"}),s("/checkout/payment-failed",{replace:!0,metadata:{initiationMessage:phonePeResponse.message},state:{transactionId:h,message:k||"We couldn't confirm your payment. Please try again or choose another method.",gateway:f==null?void 0:f.gateway}})},[t,s,K]),ee=n.useCallback(h=>{P.current=0,j(null);const k=async()=>{var f,G;P.current+=1;try{const le=await ci(h),Z=le==null?void 0:le.data;if(!Z)throw new Error("No payment status returned by server");const ie=String(Z.paymentStatus||"").toUpperCase();if(ie==="SUCCESS"){Y(h,Z);return}if(ie==="FAILED"){M(h,((f=Z.gateway)==null?void 0:f.message)||((G=Z.gatewayError)==null?void 0:G.message),Z,le);return}if(S(N=>N&&{...N,qrData:Z.qrData||N.qrData,redirectUrl:Z.redirectUrl||N.redirectUrl}),P.current>=fr){u(!1),j("Payment is still pending. Please confirm the status in the PhonePe app."),ne("Payment pending. You can retry once in PhonePe is complete.",{icon:"⏳"});return}H.current=setTimeout(k,hr)}catch(le){if(console.error("pollPaymentStatus error",le),P.current>=fr){u(!1),j(le.message||"Unable to confirm payment right now. Please check the PhonePe app."),ne.error("Could not verify payment. Please check and try again.");return}H.current=setTimeout(k,Math.round(hr*1.5))}};u(!0),K(),k()},[M,Y,K]);n.useEffect(()=>()=>K(),[K]),n.useEffect(()=>{p==="cod"&&(S(null),u(!1),j(null),K())},[p,K]),n.useEffect(()=>{A.total>0&&(Math.abs(((c==null?void 0:c.total)||0)-A.total)>.01||Math.abs(((c==null?void 0:c.subtotal)||0)-A.subtotal)>.01)&&t(ts(A))},[t,A,c]);const te=n.useCallback(async()=>{if(!L)return;const h={items:E,pricing:{...W},shippingAddress:L,payment:{method:"cod",status:"pending"},...i!=null&&i.code?{coupon:{code:i.code}}:{}},k=await ii(h),f=k==null?void 0:k.data,G=f==null?void 0:f._id;t(Ss("pending")),t(Fa(G)),d(Array.isArray(f==null?void 0:f.items)?f.items:E),ne.success("Order placed successfully"),s("/",{replace:!0,state:{recentOrderId:G}}),t(Rs())},[t,s,E,W,A.subtotal,A.total,L,d]),y=n.useCallback(()=>{if(!(m!=null&&m.merchantTransactionId)){ne.error("Transaction ID not available yet");return}ee(m.merchantTransactionId)},[m,ee]),z=n.useCallback(h=>{if(!(!h||typeof window>"u"))try{window.open(h,"_blank","noopener,noreferrer")||(window.location.href=h)}catch(k){console.error("Failed to open redirect url",k),window.location.href=h}},[]),b=n.useCallback(async h=>{var k;if(!(!h||typeof navigator>"u"))try{if((k=navigator.clipboard)!=null&&k.writeText)await navigator.clipboard.writeText(h),ne.success("Transaction ID copied");else throw new Error("Clipboard API not available")}catch(f){console.error("Failed to copy transaction id",f),ne.error("Unable to copy transaction ID")}},[]),C=async()=>{var h,k,f,G,le;if(!L){ne.error("Please provide a delivery address first"),s("/checkout/address");return}if(!E.length){ne.error("Your cart is empty"),s("/cart");return}if(!(A.total>0)){ne.error("Order total must be greater than zero before paying");return}if(t(yl(p)),p==="cod"){try{g(!0),await te()}catch(Z){console.error("Failed to place COD order",Z);const ie=((k=(h=Z.response)==null?void 0:h.data)==null?void 0:k.message)||Z.message||"Failed to place order";ne.error(ie)}finally{g(!1)}return}try{g(!0),j(null);const Z={paymentMethod:p,items:E,pricing:{...W,subtotal:A.subtotal,total:A.total},shippingAddress:L,paymentInstrument:{type:"PAY_PAGE"},metadata:{checkoutSubtotal:A.subtotal,checkoutTotal:A.total}},ie=await oi(Z);if(!(ie!=null&&ie.success)||!((f=ie==null?void 0:ie.data)!=null&&f.merchantTransactionId))throw new Error((ie==null?void 0:ie.message)||"Failed to initiate PhonePe payment");const N=ie.data;ne.success("Payment Initiated 🚀"),S({merchantTransactionId:N.merchantTransactionId,amountInRupees:N.amountInRupees,qrData:N.qrData,redirectUrl:N.redirectUrl,paymentStatus:N.paymentStatus,initiatedAt:new Date}),t(Ss("pending")),N.redirectUrl&&So()&&setTimeout(()=>{window.location.assign(N.redirectUrl)},400),ee(N.merchantTransactionId)}catch(Z){console.error("PhonePe payment initiation failed",Z);const ie=((le=(G=Z.response)==null?void 0:G.data)==null?void 0:le.message)||Z.message||"Unable to initiate payment";ne.error(ie),u(!1),S(null)}finally{g(!1)}},B=(i==null?void 0:i.discountAmount)||0,re=A.discount>0?A.discount:B,se=m?String(m.paymentStatus||"PENDING").toUpperCase():"PENDING",X=se==="SUCCESS"?"bg-emerald-100 text-emerald-700":se==="FAILED"?"bg-rose-100 text-rose-600":"bg-amber-100 text-amber-700";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-[calc(100vh-180px)] bg-light-bg",children:e.jsx("div",{className:"mx-auto w-full max-w-6xl p-6 lg:p-10",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Q.header,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex flex-col gap-3 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide text-primary",children:"Secure Payment"}),e.jsx("h2",{className:"text-2xl font-semibold text-secondary",children:"Choose how you want to pay"}),e.jsx("p",{className:"mt-1 text-sm text-medium-text",children:"Scan the PhonePe QR or pay via UPI for instant confirmation."})]}),e.jsx("span",{className:"inline-flex w-max items-center justify-center rounded-full bg-primary/10 px-4 py-1 text-sm font-medium text-primary",children:"Step 3 of 4"})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-secondary",children:"Delivering to"}),e.jsx("p",{className:"mt-1 text-sm text-medium-text",children:"Review your address before completing the payment."})]}),e.jsx("button",{type:"button",onClick:()=>s("/checkout/address"),className:"rounded-xl border border-primary/40 px-4 py-2 text-sm font-medium text-primary transition hover:border-primary hover:bg-primary/5",children:"Change address"})]}),L&&e.jsxs("div",{className:"mt-4 grid gap-3 text-sm text-secondary sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:L.fullName}),e.jsx("p",{className:"text-medium-text",children:L.mobile}),L.email&&e.jsx("p",{className:"text-medium-text",children:L.email})]}),e.jsxs("div",{children:[e.jsx("p",{children:L.addressLine}),e.jsxs("p",{children:[L.city,", ",L.state," -"," ",L.pincode]}),L.alternatePhone&&e.jsxs("p",{className:"text-medium-text",children:["Alt: ",L.alternatePhone]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-8 lg:grid lg:grid-cols-[1.1fr,0.9fr]",children:[e.jsx("aside",{className:"order-1 lg:order-2 lg:sticky lg:top-10 lg:h-max",children:e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 px-5 py-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary",children:"Order Summary"}),(i==null?void 0:i.code)&&e.jsxs("span",{className:"rounded-full bg-emerald-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-emerald-600",children:["Coupon ",i.code]})]}),e.jsxs("div",{className:"space-y-5 px-5 pb-5 pt-4 text-sm text-medium-text",children:[e.jsx("div",{className:"space-y-3",children:l.map(h=>{var k,f;return e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 px-4 py-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium text-secondary",children:h.name}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Qty: ",h.quantity]})]}),h.size&&e.jsxs("span",{className:"mt-1 text-xs uppercase text-slate-500",children:["Size: ",h.size]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] text-slate-500",children:[e.jsxs("span",{children:["HSN: ",h!=null&&h.hsnCode?h.hsnCode:"--"]}),e.jsx("span",{className:"text-slate-300",children:"|"}),e.jsxs("span",{children:["GST:"," ",Number.isFinite(Number(h==null?void 0:h.gstRate))?`${Number(h.gstRate).toFixed(2).replace(/\.00$/,"")} %`:"--"]})]}),e.jsxs("span",{className:"mt-2 block text-xs text-slate-500",children:["Unit Price: ₹",((f=(k=h.price)==null?void 0:k.toLocaleString)==null?void 0:f.call(k))||0]})]},`${h.product||h.id}-${h.size||"default"}`)})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:Ct(A.subtotal,A.currency)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Shipping Fee"}),e.jsx("span",{children:Ct(A.shippingFee,A.currency)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:Ct(A.taxAmount,A.currency)})]}),e.jsxs("div",{className:"flex items-center justify-between font-semibold text-emerald-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-",Ct(re>0?re:0,A.currency)]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-200 pt-3 text-base font-semibold text-secondary",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:Ct(A.total,A.currency)})]})]}),e.jsx("div",{className:"rounded-xl bg-primary/5 px-4 py-3 text-xs text-medium-text",children:"All card and UPI transactions on p2pdeal are 100% secure and encrypted."})]})]})}),e.jsxs("div",{className:"order-2 space-y-6 lg:order-1",children:[e.jsxs("header",{className:"flex flex-col gap-4 rounded-3xl border border-slate-100 bg-white p-6 shadow-sm lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Choose your payment method"}),e.jsx("p",{className:"text-sm text-medium-text",children:"Select a secure payment option to complete your order."})]}),e.jsxs("div",{className:"rounded-2xl bg-primary/5 px-4 py-2 text-sm text-primary",children:["Total payable:"," ",Ct(A.total,A.currency)]})]}),e.jsx("section",{className:"rounded-3xl border border-slate-100 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-secondary",children:"Payment Options"}),e.jsx("p",{className:"text-xs text-medium-text",children:"All transactions are secure and encrypted. Select your preferred method below."})]}),e.jsx("div",{className:"space-y-3",children:Co.map(h=>{const k=p===h.id;return e.jsx("button",{type:"button",onClick:()=>O(h.id),className:`w-full rounded-2xl border px-4 py-4 text-left transition ${k?"border-primary bg-primary/5 text-primary shadow-sm":"border-slate-200 bg-white text-secondary hover:border-primary/40 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold",children:h.title}),e.jsx("p",{className:"text-xs text-medium-text",children:h.description})]}),e.jsx("span",{className:`mt-1 inline-flex h-5 w-5 items-center justify-center rounded-full border text-[10px] font-semibold transition ${k?"border-primary bg-primary text-white":"border-slate-300 text-slate-400"}`,children:""})]})},h.id)})})]})}),e.jsx(ze,{children:e.jsx(Q.section,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},transition:{duration:.25},className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:m?e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-base font-semibold text-secondary",children:"Complete your PhonePe payment"}),e.jsx("span",{className:`inline-flex items-center justify-center rounded-full px-3 py-1 text-xs font-semibold ${X}`,children:se})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1fr),minmax(0,1fr)]",children:[e.jsx("div",{className:"flex flex-col items-center justify-center gap-4 rounded-2xl border border-dashed border-slate-200 bg-slate-50/60 p-6",children:m.qrData?e.jsxs(e.Fragment,{children:[e.jsx(Jl,{value:m.qrData,size:220,includeMargin:!0,renderAs:"svg"}),e.jsxs("p",{className:"text-sm font-medium text-secondary",children:["Scan using the PhonePe app to pay"," ",Ct(m.amountInRupees,A.currency)]})]}):e.jsx("p",{className:"text-center text-sm text-medium-text",children:"Generating QR code… follow the redirect link below to continue in the PhonePe app."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4 text-sm text-secondary",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium",children:"Transaction ID"}),e.jsx("button",{type:"button",onClick:()=>b(m.merchantTransactionId),className:"text-xs font-semibold text-primary hover:underline",children:"Copy"})]}),e.jsx("p",{className:"mt-1 break-all font-mono text-xs text-medium-text",children:m.merchantTransactionId}),e.jsxs("p",{className:"mt-3 flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Amount"}),e.jsx("span",{className:"font-semibold text-secondary",children:Ct(m.amountInRupees,A.currency)})]}),m.initiatedAt&&e.jsxs("p",{className:"mt-1 text-xs text-medium-text",children:["Initiated at"," ",(U=(F=m.initiatedAt).toLocaleTimeString)==null?void 0:U.call(F,"en-IN",{hour:"2-digit",minute:"2-digit"})]})]}),m.redirectUrl&&e.jsx("button",{type:"button",onClick:()=>z(m.redirectUrl),className:"w-full rounded-xl bg-primary px-4 py-3 text-sm font-semibold text-white shadow hover:bg-primary-dark",children:"Open PhonePe payment page"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("button",{type:"button",onClick:y,className:"rounded-xl border border-slate-300 px-4 py-2 text-sm font-medium text-secondary transition hover:border-primary/60 hover:text-primary",children:"Refresh status"}),e.jsx("button",{type:"button",onClick:()=>S(null),className:"rounded-xl border border-transparent px-4 py-2 text-sm text-medium-text underline-offset-4 hover:text-primary hover:underline",children:"Try a different method"})]}),I&&e.jsx("p",{className:"rounded-xl border border-amber-400 bg-amber-50 p-3 text-sm text-amber-700",children:I})]})]})]}):e.jsxs("div",{className:"space-y-4 text-sm text-medium-text",children:[e.jsx("h3",{className:"text-base font-semibold text-secondary",children:"How PhonePe checkout works"}),e.jsxs("ol",{className:"list-decimal space-y-2 pl-5",children:[e.jsx("li",{children:"Click “Pay & Place Order” to create a secure PhonePe transaction."}),e.jsx("li",{children:"Scan the QR on desktop or continue in the PhonePe app on mobile."}),e.jsx("li",{children:"We’ll automatically confirm your payment and place the order."})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Need to change the payment option? You can always switch back to Cash on Delivery."})]})},m?"phonepe-session":"phonepe-instructions")}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("button",{type:"button",onClick:()=>s("/checkout/address"),className:"w-full rounded-xl border border-slate-300 px-5 py-3 text-sm font-semibold text-secondary transition hover:border-primary/50 hover:bg-primary/5 sm:w-auto",children:"Back to Address"}),e.jsx(Q.button,{whileHover:{scale:D||R?1:1.02},whileTap:{scale:.98},onClick:C,disabled:D||R,className:"w-full rounded-xl bg-primary px-6 py-3 text-sm font-semibold text-white shadow-md shadow-primary/20 transition disabled:cursor-not-allowed disabled:opacity-60 hover:bg-primary-dark sm:w-auto",children:D?p==="cod"?"Placing Order...":"Contacting PhonePe...":p==="cod"?"Place Order":m?"Regenerate Payment":"Pay & Place Order"})]})]})]})]})})}),e.jsx(ze,{children:R&&e.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:e.jsxs(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.2},className:"w-full max-w-sm rounded-3xl bg-white p-6 text-center shadow-xl",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-2 border-primary/30 border-t-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-secondary",children:"Waiting for PhonePe confirmation…"}),e.jsx("p",{className:"mt-2 text-sm text-medium-text",children:"Complete the payment in the PhonePe app. We’ll place your order as soon as it is confirmed."}),(m==null?void 0:m.merchantTransactionId)&&e.jsxs("p",{className:"mt-4 truncate text-xs font-mono text-slate-500",children:["Txn ID: ",m.merchantTransactionId]})]})},"phonepe-wait-overlay")})]})},br=()=>{var P,H,E,w,A,W,L,K,O,Y,M,ee,te,y,z,b,C,B,re,se,X,F,U,h,k,f,G,le,Z,ie,N,V,v;const{orderId:t}=rs(),s=ut(),a=Te(),l=Nt(),[r,c]=n.useState(((P=s.state)==null?void 0:P.order)||null),[o,i]=n.useState(!((H=s.state)!=null&&H.order)&&!!t),[d,p]=n.useState(null),[x,D]=n.useState(!1),[g,R]=n.useState(8),u=n.useMemo(()=>{const q="https://apis.qrfolio.net/api";{const J=q.replace(/\/$/,"");return J.endsWith("/api")?J:`${J}/api`}},[]);n.useEffect(()=>{l(Mt("confirmation"))},[l]),n.useEffect(()=>{(async()=>{if(!(!t||r))try{i(!0);const J=await Ba(t),xe=J==null?void 0:J.data;if(!xe)throw new Error("Order not found");c(xe)}catch(J){console.error("Failed to load order",J),p(J.message||"Failed to load order"),ne.error(J.message||"Failed to load order")}finally{i(!1)}})()},[t,r]),n.useEffect(()=>{var q;!t&&!((q=s.state)!=null&&q.order)&&ne("Showing your latest order",{icon:"ℹ️"})},[t,(E=s.state)==null?void 0:E.order]),n.useEffect(()=>{if(!r)return;const q=window.setInterval(()=>{R(J=>J<=1?(a("/",{replace:!0}),0):J-1)},1e3);return()=>window.clearInterval(q)},[r,a]);const I=()=>a("/orders"),j=()=>a("/shop"),m=async()=>{if(!(r!=null&&r._id)){ne.error("Order details unavailable");return}D(!0);try{const q=localStorage.getItem("authToken"),J=await fetch(`${u}/orders/${r._id}/invoice`,{method:"GET",headers:{...q?{Authorization:`Bearer ${q}`}:{}},credentials:"include"});if(!J.ok){const de=await J.text();throw new Error(de||"Failed to download invoice")}const xe=await J.blob(),we=(J.headers.get("content-disposition")||"").match(/filename="?([^";]+)"?/i),_=(we==null?void 0:we[1])||`invoice-${r._id}.pdf`,be=window.URL.createObjectURL(xe),ve=document.createElement("a");ve.href=be,ve.download=_,document.body.appendChild(ve),ve.click(),document.body.removeChild(ve),window.URL.revokeObjectURL(be)}catch(q){console.error("Invoice download failed",q),ne.error("Unable to download invoice. Please try again.")}finally{D(!1)}};if(o)return e.jsx("div",{className:"p-10 text-center text-medium-text",children:"Fetching your order details..."});if(d)return e.jsxs("div",{className:"p-10 text-center space-y-4",children:[e.jsx("p",{className:"text-lg text-secondary font-semibold",children:"Unable to load order"}),e.jsx("p",{className:"text-medium-text",children:d}),e.jsx("button",{onClick:I,className:"px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary-dark",children:"View My Orders"})]});if(!r)return null;const S=r.estimatedDeliveryDate?new Date(r.estimatedDeliveryDate).toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"To be updated";return e.jsxs("div",{className:"grid lg:grid-cols-[2fr,1fr] gap-0",children:[e.jsxs("div",{className:"p-6 lg:p-10 space-y-8",children:[e.jsxs(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-3xl border border-green-200 bg-green-50 p-6 flex gap-4 items-start",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-white text-green-600 flex items-center justify-center shadow-md",children:e.jsx(Xl,{className:"h-7 w-7"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Order placed successfully!"}),e.jsxs("p",{className:"text-sm text-medium-text mt-1",children:["Your order ID is ",e.jsxs("span",{className:"font-medium",children:["#",r._id]}),". A confirmation email has been sent to"," ",(w=r.shippingAddress)==null?void 0:w.email,"."]}),e.jsxs("p",{className:"text-xs text-emerald-600 mt-2",children:["Redirecting you to the home page in ",g," seconds."]})]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("section",{className:"border border-slate-200 rounded-3xl p-6",children:[e.jsxs("header",{className:"flex items-center gap-3 mb-4 text-secondary",children:[e.jsx(_a,{className:"h-5 w-5"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Order Timeline"})]}),e.jsxs("ul",{className:"space-y-3 text-sm text-medium-text",children:[(A=r.statusTimeline)==null?void 0:A.map((q,J)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 h-2 w-2 rounded-full bg-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary",children:q.label}),q.description&&e.jsx("p",{children:q.description}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:q.at?new Date(q.at).toLocaleString():"--"})]})]},`${q.label}-${J}`)),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 h-2 w-2 rounded-full bg-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary",children:"Estimated delivery"}),e.jsx("p",{children:S})]})]})]})]}),e.jsxs("section",{className:"border border-slate-200 rounded-3xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary mb-4",children:"Items in this order"}),e.jsx("div",{className:"space-y-4",children:(W=r.items)==null?void 0:W.map((q,J)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-20 w-20 rounded-xl bg-slate-100 flex items-center justify-center overflow-hidden border border-slate-200",children:e.jsx("img",{src:q.image,alt:q.name,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-secondary",children:q.name}),e.jsxs("p",{className:"text-sm text-medium-text mt-1",children:["Qty: ",q.quantity,q.size&&` • Size: ${q.size}`]}),e.jsxs("p",{className:"text-sm text-medium-text mt-1",children:["Price: ₹",q.price.toLocaleString()," • Line Total: ₹",(q.price*q.quantity).toLocaleString()]})]})]},`${q.name}-${J}`))})]}),e.jsxs("section",{className:"border border-slate-200 rounded-3xl p-6 grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary mb-3",children:"Delivery Address"}),e.jsxs("div",{className:"space-y-1 text-sm text-medium-text",children:[e.jsx("p",{className:"font-medium text-secondary",children:(L=r.shippingAddress)==null?void 0:L.fullName}),e.jsx("p",{children:(K=r.shippingAddress)==null?void 0:K.addressLine}),e.jsxs("p",{children:[(O=r.shippingAddress)==null?void 0:O.city,", ",(Y=r.shippingAddress)==null?void 0:Y.state," ","- ",(M=r.shippingAddress)==null?void 0:M.pincode]}),e.jsxs("p",{children:["Mobile: ",(ee=r.shippingAddress)==null?void 0:ee.mobile]}),((te=r.shippingAddress)==null?void 0:te.alternatePhone)&&e.jsxs("p",{children:["Alternate: ",r.shippingAddress.alternatePhone]}),e.jsxs("p",{children:["Email: ",(y=r.shippingAddress)==null?void 0:y.email]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary mb-3",children:"Payment Summary"}),e.jsxs("ul",{className:"space-y-2 text-sm text-medium-text",children:[e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",(C=(b=(z=r.pricing)==null?void 0:z.subtotal)==null?void 0:b.toLocaleString)==null?void 0:C.call(b)]})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["₹",(se=(re=(B=r.pricing)==null?void 0:B.shippingFee)==null?void 0:re.toLocaleString)==null?void 0:se.call(re)]})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsxs("span",{children:["₹",(U=(F=(X=r.pricing)==null?void 0:X.taxAmount)==null?void 0:F.toLocaleString)==null?void 0:U.call(F)]})]}),e.jsxs("li",{className:"flex justify-between text-success font-medium",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",(f=(k=(h=r.pricing)==null?void 0:h.discount)==null?void 0:k.toLocaleString)==null?void 0:f.call(k)]})]}),e.jsxs("li",{className:"flex justify-between text-base font-semibold text-secondary border-t border-slate-200 pt-3",children:[e.jsx("span",{children:"Total Paid"}),e.jsxs("span",{children:["₹",(Z=(le=(G=r.pricing)==null?void 0:G.total)==null?void 0:le.toLocaleString)==null?void 0:Z.call(le)]})]}),e.jsxs("li",{className:"text-xs text-slate-400 pt-1",children:["Method: ",(V=(N=(ie=r.payment)==null?void 0:ie.method)==null?void 0:N.toUpperCase)==null?void 0:V.call(N)," • Status:"," ",(v=r.payment)==null?void 0:v.status]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-end",children:[e.jsx("button",{onClick:j,className:"px-5 py-3 rounded-xl border border-slate-200 text-secondary hover:bg-slate-50",children:"Continue Shopping"}),e.jsx("button",{onClick:I,className:"px-5 py-3 rounded-xl bg-secondary text-white hover:bg-secondary/90",children:"Go to My Orders"}),e.jsxs("button",{type:"button",onClick:m,disabled:x,className:"px-5 py-3 rounded-xl bg-primary text-white hover:bg-primary-dark disabled:opacity-60 disabled:cursor-not-allowed inline-flex items-center gap-2",children:[e.jsx(jt,{className:"h-4 w-4"}),x?"Preparing Invoice...":"Download Invoice"]})]})]}),e.jsxs("aside",{className:"bg-white border-l border-slate-100 p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-secondary",children:[e.jsx(Zl,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Estimated Delivery"}),e.jsx("p",{className:"text-sm text-medium-text",children:S})]})]}),e.jsx("div",{className:"rounded-2xl bg-primary/5 border border-primary/20 p-4 text-sm text-medium-text",children:"Need help with your order? Our support team is available 24/7 at support@p2pdeal.net."})]})]})},Ao={list:[],selectedOrder:null,loading:!1,error:null},Il=Ft({name:"orders",initialState:Ao,reducers:{setOrders:(t,s)=>{t.list=s.payload},setSelectedOrder:(t,s)=>{t.selectedOrder=s.payload},setOrdersLoading:(t,s)=>{t.loading=s.payload},setOrdersError:(t,s)=>{t.error=s.payload}}}),{setOrders:Po,setSelectedOrder:Gd,setOrdersLoading:ya,setOrdersError:gr}=Il.actions,Do=Il.reducer,Ro=()=>{const t=Nt(),s=Te(),{list:a,loading:l,error:r}=mt(o=>o.orders);n.useEffect(()=>{let o=!0,i=!1;const d=D=>{var g;return Array.isArray(D)?D:Array.isArray(D==null?void 0:D.data)?D.data:Array.isArray((g=D==null?void 0:D.data)==null?void 0:g.data)?D.data.data:Array.isArray(D==null?void 0:D.orders)?D.orders:[]},p=async({showLoader:D=!1}={})=>{try{D&&t(ya(!0));const g=await di();if(!o)return;const R=d(g);t(Po(R)),t(gr(null))}catch(g){console.error("Failed to load orders",g),i||(ne.error(g.message||"Failed to load orders"),i=!0),o&&t(gr(g.message||"Failed to load orders"))}finally{o&&D&&t(ya(!1))}};p({showLoader:!0});const x=setInterval(()=>p({showLoader:!1}),15e3);return()=>{o=!1,clearInterval(x),t(ya(!1))}},[t]);const c=o=>{var i,d,p,x,D,g,R,u,I,j,m,S,P,H,E,w,A,W,L,K,O,Y,M,ee,te,y,z;return e.jsxs(Q.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},className:"border border-slate-200 rounded-3xl p-6 space-y-6 bg-white",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-start gap-3 min-w-0",children:[e.jsx("div",{className:"h-12 w-12 rounded-2xl bg-primary/10 text-primary flex items-center justify-center flex-shrink-0",children:e.jsx(Yr,{className:"h-6 w-6"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-semibold text-secondary break-words",children:["Order #",o._id]}),e.jsxs("p",{className:"text-xs sm:text-sm text-medium-text break-words",children:["Placed on ",new Date(o.createdAt).toLocaleString()]})]})]}),e.jsx("span",{className:"text-xs font-medium px-3 py-1 rounded-full bg-primary/10 text-primary flex-shrink-0 text-center",children:(i=o.status)==null?void 0:i.replace(/_/g," ")})]}),e.jsxs("section",{className:"space-y-3 text-sm text-medium-text",children:[e.jsx("header",{className:"font-medium text-secondary",children:"Items"}),e.jsx("ul",{className:"space-y-3",children:(d=o.items)==null?void 0:d.map((b,C)=>e.jsxs("li",{className:"grid sm:grid-cols-[2fr,1fr,1fr] gap-2",children:[e.jsx("span",{className:"font-medium text-secondary",children:b.name}),e.jsxs("span",{children:["Qty: ",b.quantity,b.size&&` • Size: ${b.size}`]}),e.jsxs("span",{children:["₹",(b.price*b.quantity).toLocaleString()]})]},`${b.name}-${C}`))})]}),e.jsxs("section",{className:"grid gap-4 text-sm text-medium-text",children:[e.jsxs("div",{children:[e.jsx("header",{className:"font-medium text-secondary mb-1",children:"Delivery Address"}),e.jsx("p",{children:(p=o.shippingAddress)==null?void 0:p.fullName}),((x=o.shippingAddress)==null?void 0:x.addressLine)&&e.jsx("p",{children:o.shippingAddress.addressLine}),e.jsxs("p",{children:[(D=o.shippingAddress)==null?void 0:D.city,", ",(g=o.shippingAddress)==null?void 0:g.state," - ",(R=o.shippingAddress)==null?void 0:R.pincode]}),e.jsxs("p",{children:["Mobile: ",(u=o.shippingAddress)==null?void 0:u.mobile]})]}),e.jsxs("div",{children:[e.jsx("header",{className:"font-medium text-secondary mb-1",children:"Payment"}),e.jsxs("p",{children:["Method: ",(m=(j=(I=o.payment)==null?void 0:I.method)==null?void 0:j.toUpperCase)==null?void 0:m.call(j)," ",e.jsx("br",{}),"Status: ",(S=o.payment)==null?void 0:S.status]})]}),e.jsxs("div",{children:[e.jsx("header",{className:"font-medium text-secondary mb-1",children:"Totals"}),e.jsxs("p",{children:["Subtotal: ₹",(E=(H=(P=o.pricing)==null?void 0:P.subtotal)==null?void 0:H.toLocaleString)==null?void 0:E.call(H)," ",e.jsx("br",{}),"Shipping: ₹",(W=(A=(w=o.pricing)==null?void 0:w.shippingFee)==null?void 0:A.toLocaleString)==null?void 0:W.call(A)," ",e.jsx("br",{}),"Tax: ₹",(O=(K=(L=o.pricing)==null?void 0:L.taxAmount)==null?void 0:K.toLocaleString)==null?void 0:O.call(K)," ",e.jsx("br",{}),"Discount: ₹",(ee=(M=(Y=o.pricing)==null?void 0:Y.discount)==null?void 0:M.toLocaleString)==null?void 0:ee.call(M)," ",e.jsx("br",{}),e.jsxs("span",{className:"font-semibold text-secondary",children:["Total: ₹",(z=(y=(te=o.pricing)==null?void 0:te.total)==null?void 0:y.toLocaleString)==null?void 0:z.call(y)]})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3 justify-end",children:e.jsx("button",{onClick:()=>s(`/orders/${o._id}`),className:"px-4 py-2 rounded-xl bg-primary text-white hover:bg-primary-dark",children:"View Order Details"})})]},o._id)};return l&&!a.length?e.jsx("div",{className:"max-w-5xl mx-auto px-4 lg:px-6 py-12 text-center text-medium-text",children:"Fetching your latest orders..."}):!l&&!a.length?e.jsxs("div",{className:"max-w-5xl mx-auto px-4 lg:px-6 py-12 text-center space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"No orders yet"}),e.jsx("p",{className:"text-medium-text",children:"Orders will appear here as soon as you place one. Try refreshing if youre expecting an update."}),r&&e.jsx("p",{className:"text-sm text-rose-500",children:r})]}):e.jsxs("div",{className:"max-w-5xl mx-auto px-4 lg:px-6 py-8 lg:py-10 space-y-6",children:[r&&e.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600",children:r}),a.map(c)]})},Gs=[{key:"order_confirmed",label:"Order Confirmed",defaultDescription:"Your order has been placed."},{key:"processed",label:"Processed",defaultDescription:"Seller has processed your order."},{key:"picked_up",label:"Picked Up",defaultDescription:"Your item has been picked up by delivery partner."},{key:"shipped",label:"Shipped",defaultDescription:"Package is on the way to the nearest hub."},{key:"out_for_delivery",label:"Out For Delivery",defaultDescription:"Your order is out for delivery."},{key:"delivered",label:"Delivered",defaultDescription:"Your item has been delivered."},{key:"returned",label:"Return Initiated",defaultDescription:"Return or replacement processing has begun."}],yr=t=>t?new Date(t).toLocaleString("en-IN"):"--",jr={"order placed":"order_confirmed","order confirmed":"order_confirmed",processed:"processed","seller processed":"processed",packed:"processed",picked_up:"picked_up","picked up":"picked_up","item picked up":"picked_up",shipped:"shipped",dispatched:"shipped","out for delivery":"out_for_delivery",delivered:"delivered",returned:"returned","return initiated":"returned","return approved":"returned","return request rejected":"returned"},Nr=(t="")=>{const s=String(t).trim().toLowerCase();if(!s)return null;if(jr[s])return jr[s];const a=Gs.find(l=>l.label.toLowerCase()===s||l.key.replace(/_/g," ")===s);return(a==null?void 0:a.key)||null},Io=t=>{if(!t)return[];const s=new Map;(t.statusTimeline||[]).forEach((g={})=>{const R=Nr(g.label);if(!R)return;const u=s.get(R),I=g.at?new Date(g.at).getTime():0,j=u!=null&&u.at?new Date(u.at).getTime():0;(!u||I>=j)&&s.set(R,{label:g.label,description:g.description,at:g.at})});const a={processing:"order confirmed",confirmed:"order confirmed",picked_up:"picked up",shipped:"shipped",out_for_delivery:"out for delivery",delivered:"delivered",cancelled:"cancelled",returned:"returned"},l=String(t.status||"").toLowerCase(),r=a[l]||l,c=Nr(r)||"order_confirmed",o=Gs.findIndex(g=>g.key===c),i=o===-1?0:o,d=s.size>0,D=!!(t.replacementRequest&&t.replacementRequest.status!=="none")||s.has("returned")||c==="returned"?Gs:Gs.filter(g=>g.key!=="returned");return D.map(g=>{const R=s.get(g.key)||null,u=D.findIndex(P=>P.key===g.key),I=d?o:i,j=c==="delivered";let m=!!(R!=null&&R.at),S=!1;return R!=null&&R.at||(I!==-1?u<I?m=!0:u===I&&!j&&(S=!0):!d&&u===0&&(S=!0)),j&&I!==-1&&(m=u<=I,S=!1),{...g,label:(R==null?void 0:R.label)||g.label,isCompleted:m,isCurrent:S,description:(R==null?void 0:R.description)||g.defaultDescription,at:(R==null?void 0:R.at)||null}})},Fo=()=>{var V,v,q,J,xe,je,we,_,be,ve,de,pe,$,ce,he,Pe,$e,Me,qe,rt,Ge,ls,ns,Ls,is,Et,Lt,os,cs;const{orderId:t}=rs(),s=Te(),l=((V=ut().state)==null?void 0:V.from)==="admin-orders",[r,c]=n.useState(null),[o,i]=n.useState(!0),[d,p]=n.useState(null),[x,D]=n.useState(!1),[g,R]=n.useState(null),[u,I]=n.useState({}),[j,m]=n.useState(null),[S,P]=n.useState(!1),[H,E]=n.useState(!1),[w,A]=n.useState({itemIndex:0,description:"",size:"",color:"",remarks:""});n.useMemo(()=>{const oe="https://apis.qrfolio.net/api";{const ye=oe.replace(/\/$/,"");return ye.endsWith("/api")?ye:`${ye}/api`}},[]);const W=()=>{l?s("/admin/orders",{replace:!0}):s(-1)};n.useEffect(()=>{(async()=>{var ye,Se;try{i(!0);const Ne=await Ba(t),Ce=Ne==null?void 0:Ne.data;if(!Ce)throw new Error("Order not found");c(Ce)}catch(Ne){console.error("Failed to load order",Ne);const Ce=((Se=(ye=Ne.response)==null?void 0:ye.data)==null?void 0:Se.message)||Ne.message||"Failed to load order";p(Ce),ne.error(Ce)}finally{i(!1)}})()},[t]),n.useMemo(()=>{var Ye,Be,Ve,_e,xt,pt,ds,ms;if(!r)return null;const oe=(r.items||[]).map(bt=>{const us=[bt.quantity?`x${bt.quantity}`:null,bt.size?`Size ${bt.size}`:null].filter(Boolean).join(" ");return us?`${bt.name} (${us})`:bt.name}).join(" | "),ye={paid:"Successful",pending:"Pending",failed:"Failed"},Se={cod:"Cash on Delivery",upi:"UPI",qr:"QR Code",card:"Card",netbanking:"Net Banking"},Ne=(Be=(Ye=r.payment)==null?void 0:Ye.status)==null?void 0:Be.toLowerCase(),Ce=(_e=(Ve=r.payment)==null?void 0:Ve.method)==null?void 0:_e.toLowerCase(),Le=r.totalAmount??((xt=r.pricing)==null?void 0:xt.total)??0;return{id:r._id,placedAt:r.createdAt?new Date(r.createdAt).toISOString():"",customer:((pt=r.shippingAddress)==null?void 0:pt.fullName)||"Customer",email:((ds=r.shippingAddress)==null?void 0:ds.email)||"--",itemsSummary:oe,total:Number(Le).toFixed(2),orderStatus:(r.status||"processing").replace(/_/g," "),paymentMethod:Se[Ce]||((ms=Ce==null?void 0:Ce.toUpperCase)==null?void 0:ms.call(Ce))||"",paymentStatus:ye[Ne]||Ne||""}},[r]);const L=n.useMemo(()=>r!=null&&r.estimatedDeliveryDate?new Date(r.estimatedDeliveryDate).toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"To be updated",[r==null?void 0:r.estimatedDeliveryDate]),K=n.useMemo(()=>Io(r),[r]);n.useEffect(()=>{var oe;(oe=r==null?void 0:r.items)!=null&&oe.length&&A(ye=>({...ye,itemIndex:ye.itemIndex>=0&&ye.itemIndex<r.items.length?ye.itemIndex:0}))},[(v=r==null?void 0:r.items)==null?void 0:v.length]);const O=n.useMemo(()=>{var oe;if(!((oe=r==null?void 0:r.statusTimeline)!=null&&oe.length))return(r==null?void 0:r.status)==="delivered"?r.updatedAt:null;for(let ye=r.statusTimeline.length-1;ye>=0;ye-=1){const Se=r.statusTimeline[ye];if(String((Se==null?void 0:Se.label)||"").toLowerCase().includes("delivered"))return Se.at||Se.createdAt||Se.updatedAt||null}return(r==null?void 0:r.status)==="delivered"?r.updatedAt:null},[r==null?void 0:r.statusTimeline,r==null?void 0:r.status,r==null?void 0:r.updatedAt]),Y=(r==null?void 0:r.replacementRequest)||{},M=!!(Y!=null&&Y.status&&Y.status!=="none"),ee=n.useMemo(()=>{if(!O)return!1;const oe=new Date(O).getTime();if(Number.isNaN(oe))return!1;const ye=Date.now()-oe,Se=10080*60*1e3;return ye>=0&&ye<=Se},[O]),te=ee&&!M&&!Y.used,y=n.useMemo(()=>!!(O&&(r==null?void 0:r.status)==="delivered"),[O,r==null?void 0:r.status]),z=n.useMemo(()=>M?null:ee?"Return & replace can be requested once per order while the request window is active.":"Return & replace is available within 7 days after delivery.",[M,ee]),b=(oe,ye)=>{var Se,Ne;if(!((Ne=(Se=r==null?void 0:r.items)==null?void 0:Se[oe])!=null&&Ne.ratedAt||j!==null)){if(!y){ne.error("You can rate items after the order is delivered.");return}R(oe),I(Ce=>{var Le;return{...Ce,[oe]:{rating:ye,review:((Le=Ce[oe])==null?void 0:Le.review)||""}}})}},C=(oe,ye)=>{I(Se=>{var Ne;return{...Se,[oe]:{rating:((Ne=Se[oe])==null?void 0:Ne.rating)||0,review:ye}}})},B=()=>{A(oe=>({...oe,itemIndex:oe.itemIndex??0,description:"",size:"",color:"",remarks:""})),P(!0)},re=(oe,ye)=>{A(Se=>({...Se,[oe]:ye}))},se=n.useMemo(()=>{var oe;return(oe=r==null?void 0:r.items)!=null&&oe.length&&r.items[w.itemIndex]||null},[r==null?void 0:r.items,w.itemIndex]),X=async oe=>{var ye,Se;if(oe.preventDefault(),!!(r!=null&&r._id)){if(!w.description||w.description.trim().length<10){ne.error("Please describe the issue (minimum 10 characters).");return}try{E(!0);const Ne={itemIndex:w.itemIndex,description:w.description.trim(),replacement:{size:w.size.trim()||void 0,color:w.color.trim()||void 0,remarks:w.remarks.trim()||void 0}},Ce=await mi(r._id,Ne);if(!(Ce!=null&&Ce.success))throw new Error((Ce==null?void 0:Ce.message)||"Failed to submit request");c(Le=>({...Le,replacementRequest:Ce.data})),P(!1),ne.success("Replacement request sent to support.")}catch(Ne){console.error("Replacement request failed",Ne);const Ce=((Se=(ye=Ne==null?void 0:Ne.response)==null?void 0:ye.data)==null?void 0:Se.message)||(Ne==null?void 0:Ne.message)||"Failed to submit request";ne.error(Ce)}finally{E(!1)}}},F=async oe=>{var Se,Ne,Ce;const ye=u[oe];if(!(!(ye!=null&&ye.rating)||j!==null||(Ne=(Se=r==null?void 0:r.items)==null?void 0:Se[oe])!=null&&Ne.ratedAt))try{m(oe);const Le=await pi(r._id,{itemIndex:oe,rating:ye.rating,review:(Ce=ye.review)==null?void 0:Ce.trim()});if(!(Le!=null&&Le.success))throw new Error((Le==null?void 0:Le.message)||"Unable to submit rating");const Ye=r.items.map((Be,Ve)=>{var _e,xt,pt;return Ve===oe?{...Be,rating:(_e=Le.data)==null?void 0:_e.rating,review:(xt=Le.data)==null?void 0:xt.review,ratedAt:(pt=Le.data)==null?void 0:pt.ratedAt}:Be});c(Be=>({...Be,items:Ye})),R(null),I(Be=>{const Ve={...Be};return delete Ve[oe],Ve}),ne.success("Thank you for rating this product!")}catch(Le){console.error("Failed to submit rating",Le),ne.error(Le.message||"Unable to submit rating")}finally{m(null)}};if(o)return e.jsx("div",{className:"max-w-5xl mx-auto px-4 lg:px-6 py-10 text-center text-medium-text",children:"Fetching order details..."});if(d||!r)return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 lg:px-6 py-10 text-center space-y-4",children:[e.jsx("p",{className:"text-lg font-semibold text-secondary",children:"Unable to load order"}),e.jsx("p",{className:"text-medium-text",children:d||"Order not found"}),e.jsx("button",{onClick:W,className:"px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary-dark",children:"Back to Orders"})]});const U=(((q=r==null?void 0:r.payment)==null?void 0:q.status)||"pending").toLowerCase()==="paid",h=async()=>{var oe,ye,Se;if(!(r!=null&&r._id)){ne.error("Order details unavailable");return}if(!U){ne.error("Invoice will be available once the payment is successful.");return}D(!0);try{const Ne=await fe.get(`/orders/${r._id}/invoice`,{responseType:"blob",headers:{Accept:"application/pdf"}}),Ce=Ne.data,Ye=(((oe=Ne.headers)==null?void 0:oe["content-disposition"])||"").match(/filename="?([^";]+)"?/i),Be=(Ye==null?void 0:Ye[1])||`invoice-${r._id}.pdf`,Ve=window.URL.createObjectURL(Ce),_e=document.createElement("a");_e.href=Ve,_e.download=Be,document.body.appendChild(_e),_e.click(),document.body.removeChild(_e),window.URL.revokeObjectURL(Ve)}catch(Ne){console.error("Invoice download failed",Ne);const Ce=((Se=(ye=Ne==null?void 0:Ne.response)==null?void 0:ye.data)==null?void 0:Se.message)||(Ne==null?void 0:Ne.message)||"Unable to download invoice. Please try again.";ne.error(Ce)}finally{D(!1)}},k=oe=>(Number.isFinite(Number(oe))?Number(oe):0).toLocaleString("en-IN",{style:"currency",currency:"INR"}),f=((J=r==null?void 0:r.pricing)==null?void 0:J.subtotal)??((xe=r==null?void 0:r.pricing)==null?void 0:xe.itemTotal)??0,G=((je=r==null?void 0:r.pricing)==null?void 0:je.shippingFee)??0,le=((we=r==null?void 0:r.pricing)==null?void 0:we.taxAmount)??0,Z=((_=r==null?void 0:r.pricing)==null?void 0:_.discount)??0,ie=((be=r==null?void 0:r.pricing)==null?void 0:be.total)??(r==null?void 0:r.totalAmount)??0,N=r==null?void 0:r.coupon;return Number.isFinite(Number(N==null?void 0:N.discountAmount))&&Number(N.discountAmount),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 lg:px-6 py-8 lg:py-10 space-y-6",children:[e.jsxs("button",{onClick:W,className:"inline-flex items-center gap-2 text-sm text-medium-text hover:text-secondary",children:[e.jsx(_t,{className:"h-4 w-4"})," Back"]}),e.jsxs(Q.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},className:"rounded-3xl border border-slate-200 bg-white p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-secondary break-all",children:["Order #",r._id]}),e.jsxs("p",{className:"text-sm text-medium-text break-words",children:["Placed on ",new Date(r.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"grid gap-4 text-sm text-medium-text md:grid-cols-2 md:items-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_a,{className:"h-4 w-4 text-secondary"}),e.jsxs("span",{className:"whitespace-nowrap text-secondary",children:[e.jsx("span",{className:"font-medium",children:"Items:"})," ",e.jsx("span",{className:"text-medium-text",children:((ve=r.items)==null?void 0:ve.length)||0})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:justify-end md:text-right",children:[e.jsx(ua,{className:"h-4 w-4 text-secondary"}),e.jsxs("span",{className:"text-secondary md:text-right",children:[e.jsx("span",{className:"font-medium",children:"Estimated delivery:"})," ",e.jsx("span",{className:"text-medium-text whitespace-nowrap",children:L})]})]})]})]}),e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 space-y-6",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-secondary",children:"Tracking Updates"}),e.jsxs("p",{className:"text-sm text-medium-text",children:["Tracking ID: ",((de=r==null?void 0:r.shipping)==null?void 0:de.trackingId)||"To be assigned"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Courier: ",((pe=r==null?void 0:r.shipping)==null?void 0:pe.courier)||"Ekart Logistics"]})]}),e.jsx("div",{className:"relative",children:e.jsx("ul",{className:"space-y-0",children:K.map((oe,ye)=>{var Ve;const Se=oe.isCompleted?Ma:en,Ce=!(ye===K.length-1),Le=ye>0?K[ye-1]:null,Ye=ye>0,Be=_e=>_e!=null&&_e.isCompleted?"bg-emerald-500":_e!=null&&_e.isCurrent?"bg-primary/40":"bg-slate-200";return e.jsxs("li",{className:"relative flex gap-4 pb-6 last:pb-0",children:[e.jsxs("div",{className:"relative flex w-6 justify-center",children:[Ye&&e.jsx("span",{className:`absolute left-1/2 w-[2px] -translate-x-1/2 ${Be(Le)}`,style:{top:"-12px",height:"calc(50% + 12px)"}}),e.jsx("span",{className:`relative z-10 inline-flex h-6 w-6 items-center justify-center rounded-full border-2 ${oe.isCompleted?"border-emerald-500 bg-emerald-500 text-white":oe.isCurrent?"border-primary bg-white text-primary":"border-slate-300 bg-white text-slate-300"}`,children:e.jsx(Se,{className:"h-3.5 w-3.5"})}),Ce&&e.jsx("span",{className:`absolute left-1/2 w-[2px] -translate-x-1/2 ${Be(oe)}`,style:{top:"calc(50%)",height:"calc(50% + 12px)"}})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-secondary",children:oe.label}),oe.at&&e.jsx("span",{className:"text-xs text-slate-400",children:yr(oe.at)})]}),e.jsx("p",{className:"text-sm text-medium-text whitespace-pre-line",children:oe.description}),oe.key==="shipped"&&((Ve=r==null?void 0:r.shipping)==null?void 0:Ve.trackingId)&&e.jsxs("div",{className:"rounded-xl bg-slate-50 px-3 py-2 text-xs text-medium-text",children:[e.jsxs("p",{children:[r.shipping.courier||"Ekart Logistics"," •"," ",r.shipping.trackingId]}),e.jsxs("p",{className:"mt-1 text-slate-400",children:["Last updated"," ",yr(r.shipping.updatedAt)]})]})]})]},oe.key)})})})]}),M?e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 space-y-4",children:[e.jsxs("header",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-secondary",children:"Return & Replace status"}),e.jsxs("p",{className:"text-xs text-medium-text",children:["Requested on"," ",Y.requestedAt?new Date(Y.requestedAt).toLocaleString():"--"]})]}),e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-primary"}),Y.status.replace(/_/g," ")]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2 text-sm text-medium-text",children:[e.jsx("h3",{className:"text-sm font-semibold text-secondary",children:"Item details"}),e.jsxs("p",{className:"font-medium text-secondary",children:[Y.itemName,Y.itemSize&&` • Size ${Y.itemSize}`]}),e.jsxs("p",{children:["Quantity: ",Y.quantity||1]}),Y.issueDescription&&e.jsx("p",{className:"rounded-xl border border-slate-200 bg-slate-50 p-3 text-sm text-slate-600",children:Y.issueDescription})]}),e.jsxs("div",{className:"space-y-2 text-sm text-medium-text",children:[e.jsx("h3",{className:"text-sm font-semibold text-secondary",children:"Replacement preference"}),e.jsxs("p",{children:["Size: ",(($=Y.replacementPreferences)==null?void 0:$.size)||"--"]}),e.jsxs("p",{children:["Color:"," ",((ce=Y.replacementPreferences)==null?void 0:ce.color)||"--"]}),e.jsxs("p",{children:["Notes:"," ",((he=Y.replacementPreferences)==null?void 0:he.remarks)||"--"]}),Y.adminNotes&&e.jsxs("p",{className:"rounded-xl border border-primary/20 bg-primary/5 p-3 text-sm text-primary",children:["Admin notes: ",Y.adminNotes]})]})]}),Array.isArray(Y.history)&&Y.history.length?e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-secondary",children:"Activity"}),e.jsx("ul",{className:"space-y-2 text-xs text-medium-text",children:Y.history.slice().reverse().map((oe,ye)=>{var Se;return e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-0.5 inline-flex h-2 w-2 rounded-full bg-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary",children:((Se=oe.status)==null?void 0:Se.replace(/_/g," "))||"Update"}),e.jsx("p",{className:"text-medium-text",children:oe.note||"Status updated"}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:[oe.at?new Date(oe.at).toLocaleString():"--",oe.actor?` • by ${oe.actor}`:""]})]})]},`${oe.at||ye}-${oe.status}`)})})]}):null]}):null,e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-secondary",children:"Items in your order"}),te&&e.jsxs("button",{type:"button",onClick:B,className:"inline-flex items-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-primary-dark",children:[e.jsx(sr,{className:"h-4 w-4"})," Request return & replace"]})]}),z&&e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700",children:[e.jsx(tn,{className:"h-4 w-4"}),z]}),e.jsx("div",{className:"space-y-4",children:(Pe=r.items)==null?void 0:Pe.map((oe,ye)=>{var Ce,Le;const Se=oe.price.toLocaleString(),Ne=(oe.price*oe.quantity).toLocaleString();return e.jsxs("div",{className:"flex flex-col gap-4 rounded-2xl border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex h-20 w-20 items-center justify-center overflow-hidden rounded-xl border border-slate-200 bg-white",children:e.jsx("img",{src:oe.image,alt:oe.name,className:"max-h-full max-w-full object-contain"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"font-semibold text-secondary",children:oe.name}),e.jsxs("p",{className:"text-sm text-medium-text",children:["Qty: ",oe.quantity,oe.size&&e.jsxs("span",{className:"ml-2",children:["• Size: ",oe.size]})]}),e.jsxs("p",{className:"text-sm text-medium-text",children:["Price: ₹",Se]}),e.jsxs("p",{className:"text-sm text-medium-text",children:["Line Total: ₹",Ne]})]})]}),e.jsx("div",{className:"border-t border-slate-100 pt-3",children:oe.ratedAt?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-secondary",children:[[...Array(5)].map((Ye,Be)=>e.jsx($t,{size:18,className:Be<Math.round(oe.rating||0)?"fill-yellow-400 text-yellow-400":"text-slate-300"},Be)),e.jsxs("span",{className:"text-xs text-medium-text",children:["Rated on ",new Date(oe.ratedAt).toLocaleDateString()]})]}),oe.review&&e.jsxs("div",{className:"flex items-start gap-2 rounded-xl bg-slate-50 p-3 text-sm text-medium-text",children:[e.jsx(Qr,{className:"h-4 w-4 text-secondary mt-0.5"}),e.jsx("p",{className:"whitespace-pre-line break-words",children:oe.review})]})]}):y?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:[...Array(5)].map((Ye,Be)=>{var pt;const Ve=Be+1,xt=(((pt=u[ye])==null?void 0:pt.rating)||0)>=Ve;return e.jsx("button",{type:"button",onClick:()=>b(ye,Ve),className:"focus:outline-none",disabled:j!==null,"aria-label":`Rate ${Ve} star${Ve>1?"s":""}`,children:e.jsx($t,{size:24,className:xt?"fill-yellow-400 text-yellow-400":"text-slate-300"})},Ve)})}),g===ye&&((Ce=u[ye])==null?void 0:Ce.rating)>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:((Le=u[ye])==null?void 0:Le.review)||"",onChange:Ye=>C(ye,Ye.target.value),placeholder:"Share your experience with this product (optional)",className:"w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-medium-text focus:border-primary focus:outline-none",rows:3,maxLength:2e3,disabled:j!==null}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>F(ye),disabled:j!==null,className:"inline-flex items-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-60",children:[e.jsx(sn,{className:"h-4 w-4"}),j===ye?"Submitting...":"Submit review"]})})]})]}):null})]},`${oe.name}-${ye}`)})})]}),e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2 text-sm text-medium-text break-words",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary mb-2",children:"Delivery Address"}),e.jsx("p",{className:"font-medium text-secondary",children:($e=r.shippingAddress)==null?void 0:$e.fullName}),e.jsx("p",{children:(Me=r.shippingAddress)==null?void 0:Me.addressLine}),e.jsxs("p",{children:[(qe=r.shippingAddress)==null?void 0:qe.city,", ",(rt=r.shippingAddress)==null?void 0:rt.state," -"," ",(Ge=r.shippingAddress)==null?void 0:Ge.pincode]}),e.jsxs("p",{children:["Mobile: ",(ls=r.shippingAddress)==null?void 0:ls.mobile]}),((ns=r.shippingAddress)==null?void 0:ns.alternatePhone)&&e.jsxs("p",{children:["Alternate: ",r.shippingAddress.alternatePhone]}),e.jsxs("p",{children:["Email: ",(Ls=r.shippingAddress)==null?void 0:Ls.email]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-medium-text",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary",children:"Payment Summary"}),(N==null?void 0:N.code)&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-600",children:"Coupon applied"})]}),e.jsxs("p",{className:"flex justify-between gap-3",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:k(f)})]}),e.jsxs("p",{className:"flex justify-between gap-3",children:[e.jsx("span",{children:"Shipping Fee"}),e.jsx("span",{children:k(G)})]}),e.jsxs("p",{className:"flex justify-between gap-3",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:k(le)})]}),e.jsxs("p",{className:"flex justify-between text-success font-medium gap-3",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-",k(Z)]})]}),e.jsxs("p",{className:"flex justify-between text-base font-semibold text-slate-900 border-t border-slate-200 pt-3 gap-3",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:k(ie)})]}),e.jsxs("p",{className:"text-xs text-slate-400 pt-1 break-words",children:["Method: ",(Lt=(Et=(is=r.payment)==null?void 0:is.method)==null?void 0:Et.toUpperCase)==null?void 0:Lt.call(Et)," • Status:"," ",(os=r.payment)==null?void 0:os.status]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-end",children:[e.jsx("button",{onClick:W,className:"px-5 py-3 rounded-xl border border-slate-200 text-secondary hover:bg-slate-50",children:"Back to Orders"}),e.jsxs("button",{type:"button",onClick:h,disabled:x||!U,className:"px-5 py-3 rounded-xl bg-primary text-white hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",children:[e.jsx(jt,{className:"h-4 w-4"}),x?"Preparing Invoice...":U?"Download Invoice":"Invoice available after payment"]})]}),S&&e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40 px-4",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-3xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"mb-4 flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-secondary",children:"Return & Replace request"}),e.jsx("p",{className:"text-xs text-medium-text",children:"Tell us what went wrong so we can arrange a replacement."})]}),e.jsx("button",{type:"button",onClick:()=>P(!1),className:"rounded-full border border-slate-200 bg-white p-1 text-slate-500 hover:bg-slate-100",children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsxs("form",{className:"space-y-4",onSubmit:X,children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-[1.4fr_1fr]",children:[e.jsxs("label",{className:"space-y-2 text-sm text-medium-text",children:[e.jsx("span",{className:"font-medium text-secondary",children:"Select product"}),e.jsx("select",{value:w.itemIndex,onChange:oe=>re("itemIndex",Number(oe.target.value)),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none",children:(cs=r==null?void 0:r.items)==null?void 0:cs.map((oe,ye)=>e.jsxs("option",{value:ye,children:[oe.name,oe.size?` • Size ${oe.size}`:""]},`${oe.name}-${ye}`))})]}),se?e.jsx("div",{className:"flex items-center justify-center rounded-xl border border-slate-100 bg-slate-50 p-3",children:e.jsx("img",{src:se.image,alt:se.name,className:"h-20 w-20 rounded-lg object-contain"})}):null]}),e.jsxs("label",{className:"space-y-2 text-sm text-medium-text",children:[e.jsx("span",{className:"font-medium text-secondary",children:"Describe the issue"}),e.jsx("textarea",{value:w.description,onChange:oe=>re("description",oe.target.value),required:!0,minLength:10,rows:4,className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"Share what went wrong with the product."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"space-y-2 text-sm text-medium-text",children:[e.jsx("span",{className:"font-medium text-secondary",children:"Preferred size"}),e.jsx("input",{value:w.size,onChange:oe=>re("size",oe.target.value),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"e.g. L"})]}),e.jsxs("label",{className:"space-y-2 text-sm text-medium-text",children:[e.jsx("span",{className:"font-medium text-secondary",children:"Preferred color"}),e.jsx("input",{value:w.color,onChange:oe=>re("color",oe.target.value),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"e.g. Blue"})]})]}),e.jsxs("label",{className:"space-y-2 text-sm text-medium-text",children:[e.jsx("span",{className:"font-medium text-secondary",children:"Additional notes (optional)"}),e.jsx("input",{value:w.remarks,onChange:oe=>re("remarks",oe.target.value),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"Share anything else the team should know."})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>P(!1),className:"rounded-xl border border-slate-200 px-4 py-2 text-sm text-secondary hover:bg-slate-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:H,className:"inline-flex items-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-primary-dark disabled:cursor-not-allowed disabled:opacity-60",children:H?e.jsx(e.Fragment,{children:"Submitting..."}):e.jsxs(e.Fragment,{children:[e.jsx(sr,{className:"h-4 w-4"})," Send request"]})})]})]})]})})]})},Fl=yt.string().pattern(/^(?=.{8,}$)(?=.*\d)(?=.*[^A-Za-z0-9])[A-Z][^\s]{7,}$/).messages({"string.empty":"Password is required","string.pattern.base":"Password must be at least 8 characters, start with an uppercase letter, and include at least one number and symbol"}),Eo=yt.object({username:yt.string().min(3).max(30).required().messages({"string.empty":"Username is required","string.min":"Username must be at least 3 characters long","string.max":"Username cannot be more than 30 characters long"}),email:yt.string().email({tlds:{allow:!1}}).required().messages({"string.empty":"Email is required","string.email":"Please enter a valid email address"}),password:Fl,confirmPassword:yt.any().valid(yt.ref("password")).required().messages({"any.only":"Passwords do not match","any.required":"Please confirm your password"})}),Lo=yt.object({email:yt.string().email({tlds:{allow:!1}}).required().messages({"string.empty":"Email is required","string.email":"Please enter a valid email address"}),password:yt.string().required().messages({"string.empty":"Password is required"})}),zo=()=>{var I,j;const[t,s]=n.useState({email:"",password:""}),[a,l]=n.useState(!1),[r,c]=n.useState({}),[o,i]=n.useState(!1),d=n.useRef(null),{login:p}=Qe(),x=Te();(j=(I=ut().state)==null?void 0:I.from)!=null&&j.pathname;const g=m=>{const{name:S,value:P}=m.target;s(H=>({...H,[S]:P}))},R=m=>{var S;m.key==="Enter"&&(m.preventDefault(),(S=d.current)==null||S.focus())},u=async m=>{m.preventDefault();const{error:S}=Lo.validate(t,{abortEarly:!1});if(S){const P={};S.details.forEach(H=>{P[H.path[0]]=H.message}),c(P);return}c({});try{i(!0),await p(t),x("/",{replace:!0})}catch(P){Re.error(P.message||"Failed to log in.",{autoClose:1e3})}finally{i(!1)}};return e.jsx(Q.div,{className:"container mx-auto px-4 py-16 flex justify-center",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:e.jsxs(Q.div,{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md border",variants:It,initial:"initial",animate:"animate",children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:"Login to p2pdeal"}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",name:"email",id:"email",value:t.email,onChange:g,onKeyDown:R,className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${r.email?"border-red-500":"border-gray-300"}`}),r.email&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:r.email})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx(Fe,{to:"/forgot-password",className:"text-xs font-medium text-primary hover:underline",children:"Forgot password?"})]}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{type:a?"text":"password",name:"password",id:"password",value:t.password,onChange:g,ref:d,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${r.password?"border-red-500":"border-gray-300"}`}),e.jsx("button",{type:"button",onClick:()=>l(m=>!m),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700","aria-label":a?"Hide password":"Show password",children:a?e.jsx(Ps,{size:18}):e.jsx(et,{size:18})})]}),r.password&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:r.password})]}),e.jsx("div",{children:e.jsx(Q.button,{type:"submit",disabled:o,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-70",variants:lt,whileHover:"hover",whileTap:"tap",children:o?"Signing in...":"Sign In"})})]}),e.jsxs("p",{className:"text-sm text-center text-gray-600",children:["Don't have an account?"," ",e.jsx(Fe,{to:"/signup",className:"font-medium text-primary hover:underline",children:"Sign up"})]})]})})},Oo=()=>{const[t,s]=n.useState({username:"",email:"",password:"",confirmPassword:""}),[a,l]=n.useState(!1),[r,c]=n.useState(!1),[o,i]=n.useState({}),{signup:d}=Qe(),p=Te(),x=n.useRef(null),D=n.useRef(null),g=n.useRef(null),R=j=>{const{name:m,value:S}=j.target;s(P=>({...P,[m]:S}))},u=(j,m)=>{var S;j.key==="Enter"&&(j.preventDefault(),(S=m==null?void 0:m.current)==null||S.focus())},I=async j=>{j.preventDefault();const{error:m}=Eo.validate(t,{abortEarly:!1});if(m){const S={};m.details.forEach(P=>{S[P.path[0]]=P.message}),i(S);return}i({});try{await d({name:t.username,username:t.username,email:t.email,password:t.password}),p("/verify-email",{state:{email:t.email}})}catch(S){const P=S.message||"Failed to create account.";Re.error(P,{autoClose:1e3})}};return e.jsx(Q.div,{className:"container mx-auto px-4 py-16 flex justify-center",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:e.jsxs(Q.div,{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md border",variants:It,initial:"initial",animate:"animate",children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:"Create an Account"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Username"}),e.jsx("input",{type:"text",name:"username",id:"username",value:t.username,onChange:R,onKeyDown:j=>u(j,x),className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${o.username?"border-red-500":"border-gray-300"}`}),o.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.username})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",name:"email",id:"email",value:t.email,onChange:R,onKeyDown:j=>u(j,D),ref:x,className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${o.email?"border-red-500":"border-gray-300"}`}),o.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{type:a?"text":"password",name:"password",id:"password",value:t.password,onChange:R,onKeyDown:j=>u(j,g),ref:D,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${o.password?"border-red-500":"border-gray-300"}`}),e.jsx("button",{type:"button",onClick:()=>l(j=>!j),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700","aria-label":a?"Hide password":"Show password",children:a?e.jsx(Ps,{size:18}):e.jsx(et,{size:18})})]}),o.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{type:r?"text":"password",name:"confirmPassword",id:"confirmPassword",value:t.confirmPassword,onChange:R,ref:g,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${o.confirmPassword?"border-red-500":"border-gray-300"}`}),e.jsx("button",{type:"button",onClick:()=>c(j=>!j),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700","aria-label":r?"Hide confirm password":"Show confirm password",children:r?e.jsx(Ps,{size:18}):e.jsx(et,{size:18})})]}),o.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.confirmPassword})]}),e.jsx("div",{children:e.jsx(Q.button,{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",variants:lt,whileHover:"hover",whileTap:"tap",children:"Sign Up"})})]}),e.jsxs("p",{className:"text-sm text-center text-gray-600",children:["Already have an account?"," ",e.jsx(Fe,{to:"/login",className:"font-medium text-primary hover:underline",children:"Log in"})]})]})})},To=()=>{const[t,s]=n.useState({email:"",password:"",confirmPassword:""}),[a,l]=n.useState({}),[r,c]=n.useState(!1),[o,i]=n.useState(!1),[d,p]=n.useState(!1),x=Te(),D=u=>{const{name:I,value:j}=u.target;s(m=>({...m,[I]:j}))},g=()=>{const u={};if(t.email||(u.email="Email is required"),!t.password)u.password="Password is required";else{const{error:I}=Fl.validate(t.password);I&&(u.password=I.message)}return t.confirmPassword?t.password!==t.confirmPassword&&(u.confirmPassword="Passwords do not match"):u.confirmPassword="Please confirm your password",l(u),Object.keys(u).length===0},R=async u=>{if(u.preventDefault(),!!g())try{p(!0),await si({email:t.email,newPassword:t.password}),Re.success("Reset code sent to your email. Please check your inbox.",{autoClose:1e3}),x("/reset-password-otp",{state:{email:t.email}})}catch(I){Re.error(I.message,{autoClose:1e3})}finally{p(!1)}};return e.jsx(Q.div,{className:"container mx-auto px-4 py-16 flex justify-center",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:e.jsxs(Q.div,{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md border",variants:It,initial:"initial",animate:"animate",children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:"Reset your password"}),e.jsx("p",{className:"text-sm text-center text-gray-600",children:"Enter your account email and choose a new password. We'll send a verification code to confirm the change."}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",name:"email",value:t.email,onChange:D,className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${a.email?"border-red-500":"border-gray-300"}`}),a.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"New Password"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{type:r?"text":"password",id:"password",name:"password",value:t.password,onChange:D,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${a.password?"border-red-500":"border-gray-300"}`}),e.jsx("button",{type:"button",onClick:()=>c(u=>!u),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700","aria-label":r?"Hide password":"Show password",children:r?e.jsx(Ps,{size:18}):e.jsx(et,{size:18})})]}),a.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{type:o?"text":"password",id:"confirmPassword",name:"confirmPassword",value:t.confirmPassword,onChange:D,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${a.confirmPassword?"border-red-500":"border-gray-300"}`}),e.jsx("button",{type:"button",onClick:()=>i(u=>!u),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700","aria-label":o?"Hide confirm password":"Show confirm password",children:o?e.jsx(Ps,{size:18}):e.jsx(et,{size:18})})]}),a.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.confirmPassword})]}),e.jsx("div",{children:e.jsx(Q.button,{type:"submit",disabled:d,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-70",variants:lt,whileHover:"hover",whileTap:"tap",children:d?"Sending code...":"Reset Password"})})]}),e.jsxs("p",{className:"text-sm text-center text-gray-600",children:["Remembered your password?"," ",e.jsx(Fe,{to:"/login",className:"font-medium text-primary hover:underline",children:"Back to login"})]})]})})},$o=()=>{const t=ut(),s=Te(),[a,l]=n.useState({email:"",otp:""}),[r,c]=n.useState({}),[o,i]=n.useState(!1);n.useEffect(()=>{var g;const D=(g=t.state)==null?void 0:g.email;D&&l(R=>({...R,email:D}))},[t.state]);const d=D=>{const{name:g,value:R}=D.target;l(u=>({...u,[g]:R}))},p=()=>{const D={};return a.email||(D.email="Email is required"),a.otp?/^[0-9]{6}$/.test(a.otp)||(D.otp="Please enter the 6-digit code you received"):D.otp="Verification code is required",c(D),Object.keys(D).length===0},x=async D=>{if(D.preventDefault(),!!p())try{i(!0),await ai({email:a.email,otp:a.otp}),Re.success("Password reset successful. You can now log in with your new password.",{autoClose:1e3}),s("/login")}catch(g){Re.error(g.message,{autoClose:1e3})}finally{i(!1)}};return e.jsx(Q.div,{className:"container mx-auto px-4 py-16 flex justify-center",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:e.jsxs(Q.div,{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md border",variants:It,initial:"initial",animate:"animate",children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:"Verify reset code"}),e.jsx("p",{className:"text-sm text-center text-gray-600",children:"Enter the six-digit code we sent to your email to finish resetting your password."}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:d,className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${r.email?"border-red-500":"border-gray-300"}`}),r.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"otp",className:"block text-sm font-medium text-gray-700",children:"Verification Code"}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,id:"otp",name:"otp",value:a.otp,onChange:D=>{const g=D.target.value.replace(/[^0-9]/g,"").slice(0,6);l(R=>({...R,otp:g}))},className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm tracking-widest text-center focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${r.otp?"border-red-500":"border-gray-300"}`}),r.otp&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.otp})]}),e.jsx("div",{children:e.jsx(Q.button,{type:"submit",disabled:o,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-70",variants:lt,whileHover:"hover",whileTap:"tap",children:o?"Verifying...":"Verify & Continue"})})]}),e.jsxs("p",{className:"text-sm text-center text-gray-600",children:["Didn't get a code?"," ",e.jsx(Fe,{to:"/forgot-password",className:"font-medium text-primary hover:underline",children:"Try again"})]})]})})},_o=()=>{const t=ut(),s=Te(),{verifyEmail:a}=Qe(),[l,r]=n.useState({email:"",otp:""}),[c,o]=n.useState({}),[i,d]=n.useState(!1),[p,x]=n.useState(!1);n.useEffect(()=>{var I;const u=(I=t.state)==null?void 0:I.email;u&&r(j=>({...j,email:u}))},[t.state]);const D=()=>{const u={};return l.email||(u.email="Email is required"),l.otp?/^[0-9]{6}$/.test(l.otp)||(u.otp="Enter the 6-digit code you received"):u.otp="Verification code is required",o(u),Object.keys(u).length===0},g=async u=>{if(u.preventDefault(),!!D())try{d(!0),await a({email:l.email,otp:l.otp}),s("/",{replace:!0})}catch(I){Re.error(I.message,{autoClose:1e3})}finally{d(!1)}},R=async()=>{if(!l.email){o(u=>({...u,email:"Email is required"}));return}try{x(!0),await ri({email:l.email}),Re.success("Verification code resent. Check your inbox.",{autoClose:1e3})}catch(u){Re.error(u.message,{autoClose:1e3})}finally{x(!1)}};return e.jsx(Q.div,{className:"container mx-auto px-4 py-16 flex justify-center",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:e.jsxs(Q.div,{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md border",variants:It,initial:"initial",animate:"animate",children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:"Verify your email"}),e.jsx("p",{className:"text-sm text-center text-gray-600",children:"Enter the six-digit code we sent to your email to complete your registration."}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",name:"email",value:l.email,onChange:u=>r(I=>({...I,email:u.target.value})),className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${c.email?"border-red-500":"border-gray-300"}`}),c.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"otp",className:"block text-sm font-medium text-gray-700",children:"Verification Code"}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,id:"otp",name:"otp",value:l.otp,onChange:u=>{const I=u.target.value.replace(/[^0-9]/g,"").slice(0,6);r(j=>({...j,otp:I}))},className:`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm tracking-widest text-center focus:outline-none focus:ring-primary focus:border-primary sm:text-sm ${c.otp?"border-red-500":"border-gray-300"}`}),c.otp&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.otp})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q.button,{type:"submit",disabled:i,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-70",variants:lt,whileHover:"hover",whileTap:"tap",children:i?"Verifying...":"Verify & Continue"}),e.jsx("button",{type:"button",onClick:R,disabled:p,className:"w-full text-sm font-medium text-primary hover:underline disabled:opacity-70",children:p?"Sending...":"Resend code"})]})]})]})})},vr=()=>({fullName:"",mobile:"",addressLine:"",city:"",state:"",pincode:""}),Mo=/^[6-9]\d{9}$/,wr=/^[A-Za-z\s.'-]{2,}$/,El=/^[1-9]\d{5}$/,Uo=async({city:t,state:s,pincode:a})=>{try{const l=encodeURIComponent(`${a||""} ${t||""} ${s||""} India`),r=await fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&addressdetails=1&countrycodes=in&q=${l}`,{headers:{Accept:"application/json"}});if(!r.ok)return null;const c=await r.json();if(!Array.isArray(c)||!c.length)return null;const o=c[0],i=Number(o.lat),d=Number(o.lon);return!Number.isFinite(i)||!Number.isFinite(d)?null:{latitude:i,longitude:d,formattedAddress:o.display_name}}catch{return null}},qo=t=>{const s=[],a=String(t.fullName||"").trim();(!a||a.length<2)&&s.push("Enter the recipient's full name.");const l=String(t.addressLine||"").trim();(!l||l.length<5)&&s.push("Enter a complete address line (min 5 characters).");const r=String(t.mobile||"").trim();Mo.test(r)||s.push("Enter a valid 10-digit mobile number starting with 6-9.");const c=String(t.city||"").trim();wr.test(c)||s.push("Enter a valid city name using only letters.");const o=String(t.state||"").trim();wr.test(o)||s.push("Enter a valid state name using only letters.");const i=String(t.pincode||"").trim();return El.test(i)||s.push("Enter a valid 6-digit PIN code."),{isValid:s.length===0,errors:s}},Bo=()=>{const{user:t,updateProfile:s}=Qe(),[a,l]=n.useState([]),[r,c]=n.useState(!0),[o,i]=n.useState(null),[d,p]=n.useState(!1),[x,D]=n.useState(vr),[g,R]=n.useState(!1),[u,I]=n.useState((t==null?void 0:t.name)||""),[j,m]=n.useState(!1),S=n.useRef(""),P=n.useMemo(()=>{const O=Sl(x.state)||[];return x.city&&O.length&&!O.includes(x.city)?[...O,x.city]:O},[x.state,x.city]),H=(O="")=>O.toString().toLowerCase().replace(/&/g,"and").replace(/\./g,"").replace(/\s+/g," ").trim(),E=(O="")=>{if(!O)return"";const Y=H(O);return na.find(ee=>H(ee)===Y)||O};n.useEffect(()=>{(async()=>{var Y;c(!0);try{const M=await qa(),ee=Array.isArray(M)?M:((Y=M==null?void 0:M.data)==null?void 0:Y.data)||(M==null?void 0:M.data)||[];l(ee)}catch(M){console.error("Failed to fetch addresses",M),ne.error(M.message||"Failed to load saved addresses.")}finally{c(!1)}})()},[]),n.useEffect(()=>{const O=String(x.pincode||"").trim();if(!El.test(O)||O===S.current)return;let Y=!0;return S.current=O,(async()=>{var b;const ee=await Pl(O);if(!Y)return;if(!ee.success){ne.error(ee.message);return}const te=E(ee.data.state),y=(ee.data.city||"").trim(),z=((b=ee.data.addressLineSuggestion)==null?void 0:b.trim())||"";!te&&!y||D(C=>{const B=te||C.state,re=y||C.city,se=z&&(!C.addressLine||!ks(C.addressLine,{city:re,state:B}));return C.state===B&&C.city===re&&!se?C:{...C,state:B,city:re,...se?{addressLine:z}:{}}})})(),()=>{Y=!1}},[x.pincode]);const w=O=>{i(O._id||O.id),D({fullName:O.fullName||"",mobile:O.mobile||"",addressLine:O.addressLine||"",city:O.city||"",state:O.state||"",pincode:O.pincode||""})},A=()=>{i(null),D(vr())},W=O=>{const{name:Y,value:M}=O.target;D(ee=>({...ee,[Y]:M,...Y==="state"&&ee.state!==M?{city:""}:{}}))},L=async O=>{var ee,te,y;if(O.preventDefault(),!o)return;const Y=qo(x);if(!Y.isValid){Y.errors.forEach(z=>ne.error(z));return}p(!0);const M={fullName:x.fullName.trim(),mobile:x.mobile.trim(),addressLine:x.addressLine.trim(),city:x.city.trim(),state:x.state.trim(),pincode:x.pincode.trim()};try{const z=await Al(M);if(!z.success){ne.error(z.message),p(!1);return}if(M.state=z.data.state,M.city=z.data.city,!ks(M.addressLine,{city:M.city,state:M.state})){ne.error("Address line must include the resolved city and state for this PIN."),p(!1);return}const b=await Uo(M);b&&(M.latitude=b.latitude,M.longitude=b.longitude,M.formattedAddress=b.formattedAddress,M.isGeoVerified=!0);const C=await cl(o,M),B=Array.isArray(C)?C:((ee=C==null?void 0:C.data)==null?void 0:ee.data)||(C==null?void 0:C.data)||[];l(B),ne.success("Address updated successfully."),A()}catch(z){console.error("Failed to update address",z),ne.error(((y=(te=z.response)==null?void 0:te.data)==null?void 0:y.message)||z.message||"Failed to update address.")}finally{p(!1)}},K=async O=>{O.preventDefault();const Y=u.trim();if(Y.length<2){ne.error("Name must be at least 2 characters.");return}m(!0);try{await s({name:Y}),R(!1)}catch(M){console.error("Failed to update profile name",M)}finally{m(!1)}};return e.jsxs(Q.div,{className:"container mx-auto px-4 py-10 sm:py-12 lg:py-16",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(Q.h1,{className:"mb-8 text-3xl font-bold text-secondary",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2},children:"My Profile"}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr,2fr] lg:gap-8 lg:items-start",children:[e.jsx(Q.div,{className:"self-start rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",variants:It,initial:"initial",animate:"animate",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-semibold text-secondary",children:"Account"})}),!g&&e.jsx("button",{type:"button",onClick:()=>R(!0),className:"inline-flex items-center justify-center gap-2 rounded-lg border border-primary/20 bg-primary/10 px-3 py-2 text-xs font-semibold text-primary hover:bg-primary/20",children:e.jsx(as,{className:"h-4 w-4"})})]}),g?e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("label",{className:"text-sm font-medium text-secondary/80",children:["Name",e.jsx("input",{value:u,onChange:O=>I(O.target.value),className:"mt-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30",placeholder:"Enter your name",maxLength:100})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:justify-end",children:[e.jsx("button",{type:"button",className:"rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-secondary hover:bg-slate-50",onClick:()=>{R(!1),I((t==null?void 0:t.name)||"")},disabled:j,children:"Cancel"}),e.jsx("button",{type:"submit",className:"inline-flex items-center justify-center rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save"})]})]}):e.jsxs("dl",{className:"grid gap-3 text-sm text-medium-text",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("dt",{className:"font-medium text-secondary/80",children:"Name:"}),e.jsx("dd",{className:"text-secondary text-base",children:(t==null?void 0:t.name)||"-"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("dt",{className:"font-medium text-secondary/80",children:"Email:"}),e.jsx("dd",{className:"select-text text-secondary",children:(t==null?void 0:t.email)||"-"})]})]})]})}),e.jsxs(Q.div,{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",variants:It,initial:"initial",animate:"animate",children:[e.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-semibold text-secondary",children:"Saved Addresses"})})}),e.jsx("div",{className:"mt-5 space-y-4",children:r?e.jsxs("div",{className:"flex items-center justify-center rounded-xl border border-slate-100 bg-slate-50 py-10 text-sm text-medium-text",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4 animate-spin text-primary"}),"Loading saved addresses..."]}):a.length?a.map(O=>{const Y=O._id||O.id,M=o===Y;return e.jsx(Q.div,{variants:It,initial:"initial",animate:"animate",className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:M?e.jsxs("form",{className:"space-y-4",onSubmit:L,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"text-sm font-medium text-secondary/80",children:["Full Name",e.jsx("input",{name:"fullName",value:x.fullName,onChange:W,className:"mt-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30",placeholder:"Recipient name"})]}),e.jsxs("label",{className:"text-sm font-medium text-secondary/80",children:["Mobile Number",e.jsx("input",{name:"mobile",value:x.mobile,onChange:W,className:"mt-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30",placeholder:"10-digit mobile",maxLength:10})]})]}),e.jsxs("label",{className:"text-sm font-medium text-secondary/80",children:["Address",e.jsx("textarea",{name:"addressLine",value:x.addressLine,onChange:W,className:"mt-2 h-20 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30",placeholder:"House number, street, locality"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"text-sm font-medium text-secondary/80",children:["State",e.jsxs("select",{name:"state",value:x.state,onChange:W,className:"mt-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30",children:[e.jsx("option",{value:"",children:"Select state"}),na.map(ee=>e.jsx("option",{value:ee,children:ee},ee))]})]}),e.jsxs("label",{className:"text-sm font-medium text-secondary/80",children:["City",e.jsxs("select",{name:"city",value:x.city,onChange:W,disabled:!x.state,className:"mt-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30 disabled:cursor-not-allowed disabled:bg-slate-100",children:[e.jsx("option",{value:"",children:x.state?"Select city":"Select state first"}),P.map(ee=>e.jsx("option",{value:ee,children:ee},ee))]})]}),e.jsxs("label",{className:"text-sm font-medium text-secondary/80 md:col-span-1",children:["PIN Code",e.jsx("input",{name:"pincode",value:x.pincode,onChange:W,className:"mt-2 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30",placeholder:"6-digit PIN",maxLength:6})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-end",children:[e.jsx("button",{type:"button",onClick:A,className:"rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-secondary hover:bg-slate-50",disabled:d,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d,className:"inline-flex items-center justify-center rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",children:d?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save changes"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-semibold text-secondary",children:O.fullName}),O.mobile?e.jsxs("p",{className:"text-sm text-medium-text",children:["Phone: ",O.mobile]}):null,e.jsxs("p",{className:"text-xs text-slate-400",children:["Email: ",O.email||(t==null?void 0:t.email)||"-"]})]}),e.jsx("button",{type:"button",onClick:()=>w(O),className:"inline-flex items-center justify-center gap-2 rounded-lg border border-primary/20 bg-primary/10 px-3 py-1.5 text-xs font-semibold text-primary hover:bg-primary/20",children:e.jsx(as,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-medium-text",children:[e.jsx(ua,{className:"mt-0.5 h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{children:O.addressLine}),e.jsxs("p",{children:[O.city,", ",O.state," -"," ",O.pincode]})]})]}),O.isGeoVerified?e.jsx("p",{className:"text-xs font-medium text-emerald-600",children:"✓ Location verified"}):null]})},Y)}):e.jsx("div",{className:"rounded-xl border border-dashed border-slate-200 bg-slate-50 py-12 text-center text-sm text-medium-text",children:"No saved addresses yet. Add one during checkout to see it here."})})]})]})]})},Vo=()=>e.jsxs(Q.div,{className:"container mx-auto px-4 py-16",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(Q.h1,{className:"text-3xl font-bold mb-4",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2},children:"About p2pdeal"}),e.jsx(Q.p,{className:"text-lg text-gray-700",variants:Nl,initial:"initial",animate:"animate",children:"Welcome to p2pdeal, your number one source for all things. We're dedicated to giving you the very best of products, with a focus on dependability, customer service and uniqueness."})]}),Ho=()=>e.jsxs(Q.div,{className:"container mx-auto px-4 py-16",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(Q.h1,{className:"text-3xl font-bold mb-4",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2},children:"Contact Us"}),e.jsxs(Q.p,{className:"text-lg text-gray-700",variants:Nl,initial:"initial",animate:"animate",children:["If you have any questions, feel free to reach out to us at"," ",e.jsx("a",{href:"mailto:support@p2pdeal.net",className:"link-primary",children:"support@p2pdeal.net"}),"."]})]}),Go=()=>tt(()=>fe.get("/help-support/topics"),"Failed to load help topics"),Qo=()=>tt(()=>fe.get("/admin/help-support/topics"),"Failed to load help topics"),Wo=t=>tt(()=>fe.post("/admin/help-support/topics",t),"Failed to create help topic"),Yo=(t,s)=>tt(()=>fe.put(`/admin/help-support/topics/${t}`,s),"Failed to update help topic"),Ko=t=>tt(()=>fe.delete(`/admin/help-support/topics/${t}`),"Failed to delete help topic"),Sr={sender:"bot",text:"Hi! I'm the p2pdeal assistant. Choose a topic below and I'll share the answers you need."},Jo=()=>{const[t,s]=n.useState([Sr]),[a,l]=n.useState([]),[r,c]=n.useState(null),[o,i]=n.useState(null),[d,p]=n.useState(0),[x,D]=n.useState(!1),[g,R]=n.useState(""),u=n.useRef(null),I=n.useRef([]),j=n.useMemo(()=>{const A=new Map;return a.forEach(W=>{A.set(W.id,W)}),A},[a]),m=r&&j.get(r)||null,S=n.useMemo(()=>m?[...m.items.map(A=>({type:"question",id:A.id,label:A.question,item:A})),{type:"back",id:"back-to-topics",label:"Back to all topics"}]:a.map(A=>({type:"category",id:A.id,label:A.category})),[m,a]);n.useEffect(()=>{u.current&&u.current.scrollTo({top:u.current.scrollHeight,behavior:"smooth"})},[t]),n.useEffect(()=>{let A=!0;return(async()=>{D(!0);try{const L=await Go();if(!A)return;const O=(Array.isArray(L.data)?L.data:[]).filter(Y=>Y&&Y.isActive!==!1).map(Y=>({id:Y.slug||Y._id,category:Y.title,description:Y.description,items:Array.isArray(Y.questions)?Y.questions.filter(M=>(M==null?void 0:M.question)&&(M==null?void 0:M.answer)).map(M=>({id:M._id||M.question,question:M.question,answer:M.answer,order:M.order??0})):[],order:Y.order??0,isActive:Y.isActive!==!1,responseDelayMs:typeof Y.responseDelayMs=="number"?Math.max(0,Y.responseDelayMs):2e3})).filter(Y=>{var M;return((M=Y.category)==null?void 0:M.trim())&&Y.items.length}).sort((Y,M)=>{const ee=Y.order??0,te=M.order??0;return ee-te});l(O),R("")}catch(L){if(console.error("Failed to load help topics",L),!A)return;R(L.message||"Failed to load help topics"),l([])}finally{A&&D(!1)}})(),()=>{A=!1}},[]);const P=A=>{const W=j.get(A);W&&(s(L=>[...L,{sender:"user",text:W.category},{sender:"bot",text:`Here are the top questions about ${W.category}. Pick one to learn more.`}]),c(W.id),i(null),p(0))};n.useEffect(()=>()=>{I.current.forEach(A=>clearTimeout(A)),I.current=[]},[]);const H=A=>{if(!m)return;const W=o===A.id,L=W?d+1:1,K=Math.max(0,m.responseDelayMs??2e3),O=`typing-${Date.now()}-${Math.random()}`;s(M=>[...M,{sender:"user",text:A.question},{sender:"bot",text:"Thinking...",tempId:O}]);const Y=setTimeout(()=>{s(M=>{const ee=M.findIndex(z=>z.tempId===O),y=[...ee!==-1?[...M.slice(0,ee),...M.slice(ee+1)]:[...M],{sender:"bot",text:A.answer}];return W&&L>=2&&y.push({sender:"bot",text:"Let's revisit the main topics. Choose what you'd like help with."}),y}),W&&L>=2?(c(null),i(null),p(0)):(i(A.id),p(L)),I.current=I.current.filter(M=>M!==Y)},K);I.current.push(Y)},E=()=>{s(A=>[...A,{sender:"bot",text:"Sure, here are all the topics again. What can I help you with?"}]),c(null),i(null),p(0)},w=()=>{s([Sr]),c(null),i(null),p(0)};return e.jsx("div",{className:"min-h-[70vh] bg-gradient-to-b from-gray-50 via-white to-gray-100 py-12 md:py-16",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-10",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur rounded-3xl shadow-2xl border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"bg-[#008ECC] text-white px-6 sm:px-10 py-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold",children:"Help & Support"}),e.jsx("p",{className:"text-sm sm:text-base opacity-90 mt-1",children:"Your one-stop assistant for orders, returns, and payments."})]}),e.jsx("button",{onClick:w,className:"bg-white/15 hover:bg-white/25 transition-colors text-white text-xs sm:text-sm font-medium px-4 py-2 rounded-full",children:"Reset Chat"})]}),e.jsxs("div",{className:"grid lg:grid-cols-[1.8fr_1fr]",children:[e.jsxs("div",{className:"flex flex-col border-r border-gray-100 bg-white",children:[e.jsx("div",{ref:u,className:"h-[420px] md:h-[460px] overflow-y-auto px-6 sm:px-8 py-6 space-y-4 bg-gradient-to-b from-gray-50 to-white",children:t.map((A,W)=>e.jsx("div",{className:`flex ${A.sender==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] rounded-2xl px-4 py-3 text-sm leading-relaxed shadow-sm ${A.sender==="user"?"bg-[#008ECC] text-white rounded-br-none":"bg-gray-100 text-gray-900 rounded-bl-none"}`,children:A.text})},W))}),e.jsxs("div",{className:"border-t border-gray-100 px-6 sm:px-8 py-5 bg-white",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-400 mb-3",children:m?"Select a question":"Choose a topic"}),g&&!x&&!a.length?e.jsx("p",{className:"text-sm text-rose-500",children:g}):null,!g&&!x&&!a.length?e.jsx("p",{className:"text-sm text-gray-500",children:"Help topics will appear here once the admin adds them."}):null,e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[x&&!m?e.jsx("span",{className:"text-xs text-gray-500",children:"Loading topics…"}):null,S.map(A=>A.type==="category"?e.jsx("button",{onClick:()=>P(A.id),className:"w-full text-xs sm:text-sm border border-[#008ECC] text-[#008ECC] hover:bg-[#008ECC] hover:text-white transition-all px-4 py-2 rounded-full shadow-sm",children:A.label},A.id):A.type==="question"&&A.item?e.jsx("button",{onClick:()=>H(A.item),className:"w-full text-xs sm:text-sm border border-[#008ECC] text-[#008ECC] hover:bg-[#008ECC] hover:text-white transition-all px-4 py-2 rounded-full shadow-sm",children:A.label},A.id):e.jsx("button",{onClick:E,className:"w-full text-xs sm:text-sm border border-gray-300 text-gray-600 hover:bg-gray-100 transition-all px-4 py-2 rounded-full shadow-sm",children:A.label},A.id))]})]})]}),e.jsx("aside",{className:"hidden lg:block bg-gradient-to-b from-white to-gray-50 px-6 py-8 space-y-8",children:a.map(A=>e.jsxs("div",{children:[e.jsx("button",{onClick:()=>P(A.id),className:`text-sm font-semibold uppercase tracking-wide mb-3 transition-colors ${r===A.id?"text-[#008ECC]":"text-gray-700 hover:text-[#008ECC]"}`,children:A.category}),r===A.id&&e.jsxs("ul",{className:"space-y-2 pl-1",children:[A.items.map(W=>e.jsx("li",{children:e.jsx("button",{onClick:()=>H(W),className:"text-sm text-left text-gray-600 hover:text-[#008ECC] transition-colors",children:W.question})},W.id)),e.jsx("li",{children:e.jsx("button",{onClick:E,className:"text-sm text-left text-gray-500 hover:text-gray-700 transition-colors",children:"Back to all topics"})})]})]},A.id))})]})]})})})},Xo=()=>{const t=Te();return e.jsx("main",{className:"px-4 py-10 sm:px-8 lg:px-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("button",{type:"button",onClick:()=>t(-1),className:"inline-flex items-center gap-2 text-sm font-medium text-secondary hover:text-primary transition-colors",children:[e.jsx(_t,{className:"h-4 w-4"}),"Back"]}),e.jsxs("header",{className:"space-y-3",children:[e.jsx("h1",{className:"text-3xl font-semibold text-secondary",children:"Privacy Policy"}),e.jsx("p",{className:"text-base text-slate-600",children:"Your trust matters. This notice describes how p2pdeal collects, uses, and protects information when you browse products, create an account, place an order, or request a return/replacement."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Information we collect"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-slate-600",children:[e.jsx("li",{children:"Profile details you provide—name, email, phone number, shipping addresses, and GST information for business buyers."}),e.jsx("li",{children:"Order and support history, including return and replacement interactions, so we can resolve issues faster the next time."}),e.jsx("li",{children:"Payment method references (tokenised by our gateway) to process transactions. We never store full card numbers."}),e.jsx("li",{children:"Device, app, and usage data (such as browser type, pages visited, on-site searches) gathered via cookies to improve performance and detect fraud."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"How we use your data"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-slate-600",children:[e.jsx("li",{children:"Fulfil orders, schedule deliveries, and manage returns or replacements in line with our Return & Replacement Policy."}),e.jsx("li",{children:"Personalise product recommendations, price alerts, and marketing messages (only when you opt in)."}),e.jsx("li",{children:"Send transactional notifications about order status, pick-up schedules, and support resolutions."}),e.jsx("li",{children:"Secure the platform, prevent misuse, and comply with record-keeping, taxation, and other legal requirements."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"How we protect & share data"}),e.jsx("p",{className:"text-slate-600",children:"We apply encryption, network monitoring, and role-based access to keep your data safe. Information is shared only with verified partners who enable payments, logistics, analytics, or customer support. Each partner is bound by confidentiality agreements and is permitted to use the data solely to serve p2pdeal customers."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Your controls & choices"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-slate-600",children:[e.jsxs("li",{children:["Visit ",e.jsx("strong",{children:"My Profile"})," to update contact details, addresses, or delete saved payment references."]}),e.jsx("li",{children:"Manage email preferences using the unsubscribe link or the notifications settings in your account."}),e.jsx("li",{children:"If you need a copy of your data or want us to delete your account, contact us from your registered email for verification."}),e.jsx("li",{children:"Most browsers allow you to control cookies. Disabling them may impact features like saved carts or personalised suggestions."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Contact us"}),e.jsxs("p",{className:"text-slate-600",children:["Questions about this policy or your information? Email",e.jsx("a",{href:"mailto:support@p2pdeal.net",className:"text-primary underline ml-1",children:"support@p2pdeal.net"}),". We respond to privacy requests within 7 business days."]})]})]})})},Zo=()=>{const t=Te();return e.jsx("main",{className:"px-4 py-10 sm:px-8 lg:px-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("button",{type:"button",onClick:()=>t(-1),className:"inline-flex items-center gap-2 text-sm font-medium text-secondary hover:text-primary transition-colors",children:[e.jsx(_t,{className:"h-4 w-4"}),"Back"]}),e.jsxs("header",{className:"space-y-3",children:[e.jsx("h1",{className:"text-3xl font-semibold text-secondary",children:"Terms & Conditions"}),e.jsx("p",{className:"text-base text-slate-600",children:"Thanks for shopping with p2pdeal. By accessing our website, creating an account, or placing an order, you agree to the following terms that keep the experience safe and transparent for everyone."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Accounts & eligibility"}),e.jsx("p",{className:"text-slate-600",children:"You must be at least 18 years of age (or the legal age of majority in your region) to register. Keep your login credentials confidential, as you are responsible for all actions that happen through your account. Please notify us immediately if you suspect unauthorised access."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Pricing & payment"}),e.jsx("p",{className:"text-slate-600",children:"Prices shown on p2pdeal are in INR and include applicable taxes unless noted otherwise. We may update pricing, promotions, or product availability without prior notice. Payments are processed securely via trusted gateways; we do not store complete card information."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Orders & fulfilment"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-slate-600",children:[e.jsx("li",{children:"Orders are confirmed once payment is captured or COD verification succeeds."}),e.jsx("li",{children:"In rare cases where stock or quality checks fail, we will cancel the order and issue store credit or a replacement as per availability."}),e.jsx("li",{children:"Delivery timelines depend on serviceable pin codes and logistics partner performance; delays will be communicated via email or SMS."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Return & replacement policy"}),e.jsx("p",{className:"text-slate-600",children:"We follow a replacement-first approach. Eligible products can be returned within 7 days of delivery for a like-for-like replacement or p2pdeal store credit. Cash refunds to the original payment method are not available. Detailed steps are listed in our Return & Replacement Policy."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Usage guidelines"}),e.jsx("p",{className:"text-slate-600",children:"Do not misuse the site by attempting unauthorised access, scraping, or uploading harmful code. Product reviews or questions you post must be respectful, accurate, and free of infringing material. We reserve the right to remove content or suspend accounts that violate these expectations."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Intellectual property"}),e.jsx("p",{className:"text-slate-600",children:"All text, graphics, logos, and product imagery available on p2pdeal are owned by p2pdeal or our brand partners. You may not reproduce or reuse any portion without prior written consent from the respective owner."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Limitation of liability"}),e.jsx("p",{className:"text-slate-600",children:"p2pdeal’s total liability for any claim relating to an order is limited to the amount you paid for that order. We are not responsible for indirect, incidental, or consequential damages arising from use of the platform."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Contact us"}),e.jsxs("p",{className:"text-slate-600",children:["Questions about these terms? Email",e.jsx("a",{href:"mailto:support@p2pdeal.net",className:"text-primary underline ml-1",children:"support@p2pdeal.net"}),"."]})]})]})})},ec=()=>{const t=Te();return e.jsx("main",{className:"px-4 py-10 sm:px-8 lg:px-16",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("button",{type:"button",onClick:()=>t(-1),className:"inline-flex items-center gap-2 text-sm font-medium text-secondary hover:text-primary transition-colors",children:[e.jsx(_t,{className:"h-4 w-4"}),"Back"]}),e.jsxs("header",{className:"space-y-3",children:[e.jsx("h1",{className:"text-3xl font-semibold text-secondary",children:"Return & Replacement Policy"}),e.jsx("p",{className:"text-base text-slate-600",children:"We stand behind every order that ships from p2pdeal. If something isn’t quite right, we’ll help you send the item back and arrange a replacement or issue store credit so you can try again—no cash refunds or reversals to original payment methods are provided."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"What qualifies for a return?"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-slate-600",children:[e.jsx("li",{children:"Submit the return request within 7 days of the delivery date shown in your p2pdeal account."}),e.jsx("li",{children:"The product must be unused, in resalable condition, and include all tags, accessories, manuals, and any bundled freebies."}),e.jsx("li",{children:"Items marked as final sale, custom-built, or perishable can only be returned if they arrive damaged or incorrect."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"How returns work"}),e.jsxs("ol",{className:"list-decimal pl-6 space-y-2 text-slate-600",children:[e.jsxs("li",{children:["Open ",e.jsx("strong",{children:"My Orders"}),", choose the product, and tap",e.jsx("em",{children:"Request Return"})," with a short note on what went wrong."]}),e.jsx("li",{children:"We’ll share pick-up or self-ship instructions within 24 hours. Self-ship charges are reimbursed as store credit once verified."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Replacements & Store Credits"}),e.jsx("p",{className:"text-slate-600",children:"Once the returned product clears quality checks, we’ll dispatch a like-for-like replacement (subject to availability) or issue p2pdeal store credit you can use on future purchases. Store credit is posted within 7 business days of approval. Cash refunds or reversal to the original payment method are not offered."})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-secondary",children:"Contact Us"}),e.jsxs("p",{className:"text-slate-600",children:["Need help? Email",e.jsx("a",{href:"mailto:support@p2pdeal.net",className:"text-primary underline ml-1",children:"support@p2pdeal.net"})]})]})]})})},tc=()=>{const t=ut(),s=Te(),{searchResults:a,isSearching:l,searchProducts:r}=ml(),c=n.useMemo(()=>new URLSearchParams(t.search).get("q")||"",[t.search]);n.useEffect(()=>{let d=!0;return d&&(async()=>{c&&await r(c)})(),()=>{d=!1}},[c,r]);const o=n.useMemo(()=>e.jsx("div",{className:"container mx-auto px-4 py-12 flex justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#008ECC] mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-600",children:['Searching for "',c,'"...']})]})}),[c]),i=n.useMemo(()=>a.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:a.map(d=>e.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(Fs,{product:d})},d.id))}):c&&!l?e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-gray-600 mb-4",children:[`We couldn't find any products matching "`,c,'"']}),e.jsx("button",{onClick:()=>s("/"),className:"bg-[#008ECC] text-white px-6 py-2 rounded-md hover:bg-[#0078b5] transition-colors",children:"Continue Shopping"})]}):null,[a,c,l,s]);return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(ze,{mode:"wait",children:l?e.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:o},"loading"):e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[c&&e.jsx("h1",{className:"text-2xl font-bold mb-6",children:a.length>0?`Search Results for "${c}"`:`No results found for "${c}"`}),i]},"results")})})},sc=()=>e.jsxs(Q.div,{className:"container mx-auto px-4 py-16 text-center",variants:Xe,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(Q.h1,{className:"text-6xl font-bold text-primary",initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},children:"404"}),e.jsx(Q.h2,{className:"mt-4 text-3xl font-bold",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:"Page Not Found"}),e.jsx(Q.p,{className:"mt-2 text-gray-600",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},children:"Sorry, the page you are looking for does not exist."}),e.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},children:e.jsx(Fe,{to:"/",className:"mt-8 inline-block bg-primary text-white font-bold py-3 px-6 rounded-md hover:bg-primary-dark transition-colors",children:"Go to Homepage"})})]}),ac=[{label:"Dashboard",icon:an,to:"/admin"},{label:"Hero Carousel",icon:Kr,to:"/admin/hero-carousel"},{label:"Products",icon:Yr,to:"/admin/products"},{label:"Orders",icon:$a,to:"/admin/orders"},{label:"Customers",icon:rn,to:"/admin/customers"},{label:"Coupons",icon:ln,to:"/admin/coupons"},{label:"Footer Categories",icon:nn,to:"/admin/footer-categories"},{label:"Help & Support",icon:on,to:"/admin/help-support"}],Cr=Q.create(Fe),Ue=({active:t,className:s,onNavigate:a})=>{const l="bg-white border-r border-slate-200 h-full md:h-screen md:sticky md:top-0 md:left-0",[r,c]=n.useState(t);return n.useEffect(()=>{c(t)},[t]),e.jsx("aside",{className:`${l} ${s}`,children:e.jsxs("div",{className:"flex flex-col w-full h-full px-6 py-8 space-y-12",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xl font-semibold text-slate-900",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-blue-100 text-blue-600 grid place-items-center font-bold",children:"P"}),e.jsx("span",{children:"p2pdeal Admin"})]}),e.jsxs("nav",{className:"flex-1 space-y-2",children:[ac.map(({label:o,icon:i,to:d})=>{const p=o===r;return e.jsxs(Cr,{whileHover:{x:6},to:d,onClick:()=>{c(o),a==null||a()},className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-150 cursor-pointer ${p?"bg-blue-100 text-blue-700 shadow-sm":"text-slate-500 hover:text-blue-600 hover:bg-blue-50"}`,children:[e.jsx(i,{size:20}),o]},o)}),e.jsx("div",{className:"pt-4 mt-6 border-t border-slate-100",children:e.jsxs(Cr,{to:"/",whileHover:{x:6},onClick:()=>a==null?void 0:a(),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-slate-500 transition-colors hover:text-blue-600 hover:bg-blue-50",children:[e.jsx(Kr,{size:20}),"User Dashboard"]})})]}),e.jsxs("div",{className:"hidden lg:block text-xs text-slate-400",children:["© ",new Date().getFullYear()," p2pdeal. All rights reserved."]})]})})};Ue.propTypes={active:me.string,className:me.string,onNavigate:me.func};Ue.defaultProps={active:"Dashboard",className:"hidden md:flex md:w-64",onNavigate:void 0};const rc=["All Date","12 Months","30 Days","7 Days","24 Hour"],nt=({onToggleSidebar:t,activeRange:s,onSelectRange:a,adminName:l,adminRole:r,notifications:c,showRangeSelector:o,showNotifications:i,onLogout:d})=>{const p=l||"Admin",x=p.split(" ").map(u=>u.charAt(0)).join("").slice(0,2).toUpperCase(),D=((c==null?void 0:c.pendingOrders)||0)+((c==null?void 0:c.shippedOrders)||0)+((c==null?void 0:c.deliveredOrders)||0),[g,R]=n.useState(!1);return e.jsx("header",{className:"sticky top-0 z-30 bg-white/90 backdrop-blur border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 px-4 py-4 md:px-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:t,className:"md:hidden inline-flex h-10 w-10 items-center justify-center rounded-xl border border-slate-200 text-slate-600 hover:text-blue-600 hover:border-blue-200 transition","aria-label":"Toggle navigation",children:e.jsx(qr,{size:20})}),e.jsxs("div",{className:"max-w-[70vw] space-y-0.5 sm:max-w-none sm:space-y-1",children:[e.jsxs("h1",{className:"text-base font-semibold text-slate-900 sm:text-xl",children:["Welcome Back ",p]}),e.jsx("p",{className:"text-xs text-slate-500 sm:text-sm",children:"Manage Sales, Orders, Customers and Deliveries"})]})]}),e.jsxs("div",{className:"flex flex-1 justify-end items-center gap-6 pr-2 sm:pr-4",children:[o&&e.jsx("nav",{className:"hidden sm:flex items-center gap-2 bg-slate-100/60 rounded-full px-1 py-1",children:rc.map(u=>{const I=u===s;return e.jsx(Q.button,{whileHover:{y:-1},onClick:()=>a(u),className:`px-3 py-1.5 text-xs md:text-sm font-medium rounded-full transition ${I?"bg-white text-blue-600 shadow-sm":"text-slate-500"}`,children:u},u)})}),i&&e.jsxs("button",{type:"button",className:"relative h-10 w-10 flex items-center justify-center rounded-xl border border-slate-200 text-slate-600 hover:text-blue-600 hover:border-blue-200 transition","aria-label":"Notifications",children:[e.jsx(cn,{size:20}),e.jsx("span",{className:"absolute -top-1 -right-1 inline-flex h-4 min-w-[1rem] px-1 items-center justify-center rounded-full bg-blue-500 text-white text-[10px]",children:D})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>R(u=>!u),className:"flex items-center gap-2 rounded-2xl border border-slate-200 px-2 py-2 hover:border-blue-200 transition sm:gap-3 sm:px-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 text-white grid place-items-center font-semibold",children:x||"AD"}),e.jsxs("div",{className:"hidden sm:block text-left",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:p}),e.jsx("p",{className:"text-xs text-slate-500",children:r||"Administrator"})]}),e.jsx(xa,{size:18,className:"hidden text-slate-400 sm:block"})]}),e.jsx(ze,{children:g&&e.jsxs(Q.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.18},className:"absolute right-0 z-20 mt-2 w-48 rounded-2xl border border-slate-200 bg-white shadow-xl",children:[e.jsxs("div",{className:"px-4 py-3 text-sm",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:p}),e.jsx("p",{className:"text-xs text-slate-500",children:r||"Administrator"})]}),e.jsx("div",{className:"border-t border-slate-100",children:e.jsxs("button",{type:"button",onClick:()=>{R(!1),d==null||d()},className:"flex w-full items-center gap-3 px-4 py-3 text-sm text-slate-600 hover:bg-slate-50",children:[e.jsx(dn,{size:16})," Logout"]})})]})})]})]})]})})};nt.propTypes={onToggleSidebar:me.func.isRequired,activeRange:me.string.isRequired,onSelectRange:me.func.isRequired,adminName:me.string,adminRole:me.string,notifications:me.shape({pendingOrders:me.number,shippedOrders:me.number,deliveredOrders:me.number}),showRangeSelector:me.bool,showNotifications:me.bool,onLogout:me.func};nt.defaultProps={adminName:"",adminRole:"Administrator",notifications:{pendingOrders:0,shippedOrders:0,deliveredOrders:0},showRangeSelector:!0,showNotifications:!0,onLogout:void 0};const Va=({icon:t,label:s,value:a,accent:l,isLoading:r})=>e.jsxs(Q.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.4},className:"bg-white rounded-2xl shadow-sm border border-slate-100 p-6 flex items-center gap-4",children:[e.jsx("div",{className:`h-12 w-12 rounded-2xl grid place-items-center text-xl font-semibold ${l}`,children:t}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:s}),e.jsx("p",{className:"text-2xl font-semibold text-slate-900 mt-1",children:r?e.jsx("span",{className:"inline-block h-6 w-20 rounded-md bg-slate-200 animate-pulse"}):a})]})]});Va.propTypes={icon:me.node.isRequired,label:me.string.isRequired,value:me.string.isRequired,accent:me.string,isLoading:me.bool};Va.defaultProps={accent:"bg-blue-50 text-blue-600",isLoading:!1};const kr=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t||0),Ar=t=>new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(t||0),Ha=({metrics:t,isLoading:s})=>{const a=[{label:"Sales",value:kr(t==null?void 0:t.sales),icon:e.jsx(mn,{size:22}),accent:"bg-blue-50 text-blue-600"},{label:"Orders",value:Ar(t==null?void 0:t.orders),icon:e.jsx($a,{size:22}),accent:"bg-purple-50 text-purple-600"},{label:"Profit",value:kr(t==null?void 0:t.profit),icon:e.jsx(un,{size:22}),accent:"bg-emerald-50 text-emerald-600"},{label:"Customer",value:Ar(t==null?void 0:t.customers),icon:e.jsx(xn,{size:22}),accent:"bg-orange-50 text-orange-600"}];return e.jsx("section",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4",children:a.map(l=>e.jsx("div",{className:"min-w-0",children:e.jsx(Va,{...l,isLoading:s})},l.label))})};Ha.propTypes={metrics:me.shape({sales:me.number,orders:me.number,profit:me.number,customers:me.number}),isLoading:me.bool};Ha.defaultProps={metrics:{sales:0,orders:0,profit:0,customers:0},isLoading:!1};const lc=[{label:"All Statuses",value:""},{label:"Processing",value:"processing"},{label:"Shipped",value:"shipped"},{label:"Delivered",value:"delivered"},{label:"Return / Replace",value:"returned"}],Pr=t=>`₹${(typeof t=="number"&&!Number.isNaN(t)?t:0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,Dr={processing:"bg-orange-100 text-orange-600",shipped:"bg-blue-100 text-blue-600",out_for_delivery:"bg-blue-100 text-blue-600",delivered:"bg-green-100 text-green-600",returned:"bg-slate-100 text-slate-500"},Rr={paid:"bg-emerald-100 text-emerald-600",pending:"bg-amber-100 text-amber-600",failed:"bg-rose-100 text-rose-600"},ja={paid:"Successful",pending:"Pending",failed:"Failed"},Na={cod:"Cash on Delivery",upi:"UPI",qr:"QR Code",card:"Card",netbanking:"Net Banking"},Ea=(t="")=>{const s=String(t).toLowerCase();return s==="confirmed"?"processing":s},va=(t="")=>Ea(t).replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),nc=t=>{if(t==null)return"";const s=String(t);return/[",\n]/.test(s)?`"${s.replace(/"/g,'""')}"`:s},Ga=({orders:t,isLoading:s,error:a,totalOrders:l,statusBreakdown:r,filters:c,appliedFilters:o,onFiltersChange:i,onApplyFilters:d,onClearFilters:p,onOrderDeleted:x,onOrderUpdated:D,onViewAll:g})=>{const R=Te(),[u,I]=n.useState(new Set),j=n.useCallback(E=>{E&&R(`/admin/orders/${E}`)},[R]),m=n.useCallback(async E=>{var w,A;if(window.confirm("Are you sure you want to delete this order?")){I(W=>new Set(W).add(E));try{await fe.delete(`/orders/${E}`),ne.success("Order deleted"),x==null||x(E)}catch(W){console.error("Failed to delete order",W);const L=((A=(w=W.response)==null?void 0:w.data)==null?void 0:A.message)||"Failed to delete order. Please try again.";ne.error(L)}finally{I(W=>{const L=new Set(W);return L.delete(E),L})}}},[x]),S=n.useCallback(()=>{if(!t.length){ne.error("No orders to export yet");return}const E=["Order ID","Placed At","Customer","Email","Items","Total","Order Status","Payment Method","Payment Status"],w=t.map(O=>{var b,C,B,re,se,X,F,U;const Y=O.customerName||((b=O.shippingAddress)==null?void 0:b.fullName)||"Customer",M=O.customerEmail||((C=O.shippingAddress)==null?void 0:C.email)||"--",ee=(O.items||[]).map(h=>{const k=[h.quantity?`x${h.quantity}`:null,h.size?`Size ${h.size}`:null].filter(Boolean).join(" ");return k?`${h.name} (${k})`:h.name}).join(" | "),te=O.totalAmount??((B=O.pricing)==null?void 0:B.total)??0,y=(se=(re=O.payment)==null?void 0:re.status)==null?void 0:se.toLowerCase(),z=(F=(X=O.payment)==null?void 0:X.method)==null?void 0:F.toLowerCase();return[O._id,O.createdAt?new Date(O.createdAt).toISOString():"",Y,M,ee,Number(te).toFixed(2),va(O.status),Na[z]||((U=z==null?void 0:z.toUpperCase)==null?void 0:U.call(z))||"",ja[y]||y||""]}),A=[E,...w].map(O=>O.map(nc).join(",")).join(`\r
`),W=new Blob(["\uFEFF"+A],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(W),K=document.createElement("a");K.href=L,K.download=`recent-orders-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(L)},[t]),P=typeof l=="number"?l:t.length,H=[{key:"processing",label:"Processing",className:"bg-orange-100 text-orange-600"},{key:"shipped",label:"Shipped",className:"bg-blue-100 text-blue-600"},{key:"delivered",label:"Delivered",className:"bg-green-100 text-green-600"},{key:"returned",label:"Return/Replace",className:"bg-slate-100 text-slate-500"}];return e.jsxs(Q.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.45,delay:.1},className:"bg-white border border-slate-100 rounded-2xl shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 px-6 py-4 border-b border-slate-100",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Recent Orders"}),e.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Showing ",t.length," of ",P," orders"]}),((o==null?void 0:o.status)||(o==null?void 0:o.startDate)||(o==null?void 0:o.endDate))&&e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-slate-500",children:[o.status&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 px-2 py-1",children:["Status: ",o.status]}),o.startDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 px-2 py-1",children:["From: ",o.startDate]}),o.endDate&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 px-2 py-1",children:["To: ",o.endDate]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-xl border border-blue-200 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 transition",onClick:S,children:[e.jsx(jt,{size:18})," Download CSV"]}),g&&e.jsx("button",{type:"button",className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:border-blue-200 hover:text-blue-600 transition",onClick:g,children:"View more"}),e.jsxs("form",{className:"flex flex-wrap items-center gap-3",onSubmit:E=>{E.preventDefault(),d()},children:[e.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600",children:[e.jsx(Jr,{size:18}),e.jsx("select",{value:c.status,onChange:E=>i({status:E.target.value}),className:"bg-transparent focus:outline-none",children:lc.map(E=>e.jsx("option",{value:E.value,children:E.label},E.value))})]}),e.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600",children:[e.jsx(Ds,{size:18}),e.jsx("input",{type:"date",value:c.startDate,onChange:E=>i({startDate:E.target.value}),className:"bg-transparent focus:outline-none"})]}),e.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600",children:[e.jsx(Ds,{size:18}),e.jsx("input",{type:"date",value:c.endDate,onChange:E=>i({endDate:E.target.value}),className:"bg-transparent focus:outline-none"})]}),e.jsx("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 transition",children:"Apply"}),e.jsx("button",{type:"button",className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600 hover:border-blue-200 hover:text-blue-600 transition",onClick:p,children:"Clear"})]})]})]}),e.jsx("div",{className:"hidden overflow-x-auto md:block",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100",children:[e.jsx("thead",{className:"bg-slate-50/80",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Payment"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-slate-100",children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-12 text-center text-slate-400",children:"Loading recent orders..."})}):a?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-12 text-center text-red-400",children:a})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-12 text-center text-slate-400",children:"No orders found."})}):t.map(E=>{var b,C,B,re,se,X,F,U,h,k;const w=((b=E.items)==null?void 0:b[0])||{},A=E.productName||w.name||"Unknown product",W=E.productImage||w.image||"https://placehold.co/80x80/f8fafc/e2e8f0?text=IMG",L=E.customerName||((C=E.shippingAddress)==null?void 0:C.fullName)||"Customer",K=E.customerEmail||((B=E.shippingAddress)==null?void 0:B.email)||"--",O=E.totalAmount??((re=E.pricing)==null?void 0:re.total)??0,Y=E.status||"processing",M=Ea(Y),ee=Dr[M]||"bg-slate-100 text-slate-500",te=(X=(se=E.payment)==null?void 0:se.status)==null?void 0:X.toLowerCase(),y=(U=(F=E.payment)==null?void 0:F.method)==null?void 0:U.toLowerCase(),z=Rr[te]||"bg-slate-100 text-slate-500";return e.jsxs("tr",{className:"hover:bg-slate-50/60 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:W,alt:A,className:"h-10 w-10 rounded-xl object-cover",onError:f=>{f.target.onerror=null,f.target.src="https://placehold.co/80x80/f8fafc/e2e8f0?text=IMG"}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:A}),e.jsx("p",{className:"text-xs text-slate-400",children:((h=E.items)==null?void 0:h.length)>1?`+${E.items.length-1} other item${E.items.length-1>1?"s":""}`:w.size?`Size: ${w.size}`:"Single item"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-600",children:L}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-400",children:K}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-slate-900",children:Pr(O)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-600",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"font-medium text-slate-700",children:Na[y]||((k=y==null?void 0:y.toUpperCase)==null?void 0:k.call(y))||"--"}),e.jsx("span",{className:`inline-flex w-fit items-center rounded-full px-3 py-1 text-xs font-medium ${z}`,children:ja[te]||(te==null?void 0:te.replace(/_/g," "))||"--"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${ee}`,children:va(Y)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-slate-400",children:e.jsxs("div",{className:"inline-flex items-center gap-3",children:[e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-blue-50 text-blue-600 transition","aria-label":"View order",onClick:()=>j(E._id),children:e.jsx(et,{size:18})}),e.jsx("button",{type:"button",className:"p-2 rounded-full hover:bg-red-50 text-red-500 transition disabled:opacity-50","aria-label":"Delete order",onClick:()=>m(E._id),disabled:u.has(E._id),children:u.has(E._id)?e.jsx(Ie,{size:18,className:"animate-spin"}):e.jsx(Je,{size:18})})]})})]},E._id)})})]})}),e.jsx("div",{className:"space-y-3 px-4 md:hidden",children:e.jsxs(ze,{children:[s&&e.jsx(Q.div,{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-slate-500",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx(Ie,{className:"h-4 w-4 animate-spin"}),"Loading recent orders..."]})}),!s&&a&&e.jsx(Q.div,{className:"rounded-2xl border border-rose-200 bg-white p-6 text-center text-rose-600",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a}),!s&&!a&&t.length===0&&e.jsx(Q.div,{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-slate-500",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:"No orders found."}),!s&&!a&&t.map(E=>{var z,b,C,B,re,se,X,F;const w=((z=E.items)==null?void 0:z[0])||{},A=E.productName||w.name||"Unknown product",W=E.productImage||w.image||"https://placehold.co/80x80/f8fafc/e2e8f0?text=IMG",L=E.customerName||((b=E.shippingAddress)==null?void 0:b.fullName)||"Customer",K=E.totalAmount??((C=E.pricing)==null?void 0:C.total)??0,O=E.status||"processing",Y=Ea(O),M=Dr[Y]||"bg-slate-100 text-slate-500",ee=(re=(B=E.payment)==null?void 0:B.status)==null?void 0:re.toLowerCase(),te=(X=(se=E.payment)==null?void 0:se.method)==null?void 0:X.toLowerCase(),y=Rr[ee]||"bg-slate-100 text-slate-500";return e.jsx(Q.div,{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("img",{src:W,alt:A,className:"h-14 w-14 flex-shrink-0 rounded-xl object-cover",onError:U=>{U.currentTarget.src="https://placehold.co/80x80/f8fafc/e2e8f0?text=IMG"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:A}),e.jsx("span",{className:"text-xs text-slate-500",children:L}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Order ID: ",E._id]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-xs text-slate-500",children:[e.jsxs("div",{className:"rounded-xl bg-slate-50 p-2",children:[e.jsx("p",{className:"uppercase text-[10px] tracking-wide text-slate-400",children:"Total"}),e.jsx("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:Pr(K)})]}),e.jsxs("div",{className:"rounded-xl bg-slate-50 p-2",children:[e.jsx("p",{className:"uppercase text-[10px] tracking-wide text-slate-400",children:"Payment"}),e.jsx("p",{className:"mt-1 text-xs font-medium text-slate-700",children:Na[te]||((F=te==null?void 0:te.toUpperCase)==null?void 0:F.call(te))||"--"}),e.jsx("span",{className:`mt-1 inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${y}`,children:ja[ee]||(ee==null?void 0:ee.replace(/_/g," "))||"--"})]}),e.jsxs("div",{className:"rounded-xl bg-slate-50 p-2",children:[e.jsx("p",{className:"uppercase text-[10px] tracking-wide text-slate-400",children:"Status"}),e.jsx("span",{className:`mt-1 inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${M}`,children:va(O)})]}),e.jsxs("div",{className:"rounded-xl bg-slate-50 p-2",children:[e.jsx("p",{className:"uppercase text-[10px] tracking-wide text-slate-400",children:"Placed on"}),e.jsx("p",{className:"mt-1 text-xs font-medium text-slate-700",children:E.createdAt?new Date(E.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"--"})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>j(E._id),className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600",children:[e.jsx(et,{size:14})," View"]}),e.jsxs("button",{type:"button",onClick:()=>m(E._id),disabled:u.has(E._id),className:"inline-flex items-center gap-2 rounded-full border border-rose-200 px-3 py-1.5 text-xs font-semibold text-rose-500 hover:border-rose-300 disabled:opacity-60",children:[u.has(E._id)?e.jsx(Ie,{size:14,className:"animate-spin"}):e.jsx(Je,{size:14}),"Delete"]})]})]})]})},E._id)})]})}),e.jsxs("div",{className:"flex flex-col gap-3 border-t border-slate-100 px-4 py-4 text-sm text-slate-500 md:flex-row md:items-center md:justify-between md:px-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("p",{children:["Showing ",t.length," ",t.length===1?"order":"orders",P>t.length?` of ${P}`:""]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:H.map(({key:E,label:w,className:A})=>e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium ${A}`,children:[w,": ",(r==null?void 0:r[E])??0]},E))})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[[1,2,3].map(E=>e.jsx("button",{type:"button",className:`h-9 w-9 rounded-full border text-sm font-medium transition ${E===1?"border-slate-900 bg-slate-900 text-white":"border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`,children:E},E)),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-full border border-slate-200 text-slate-400","aria-label":"Next page",children:"..."})]})]})]})};Ga.propTypes={orders:me.arrayOf(me.shape({_id:me.string.isRequired,productName:me.string,productImage:me.string,customerName:me.string,customerEmail:me.string,items:me.array,shippingAddress:me.shape({fullName:me.string,email:me.string}),pricing:me.shape({total:me.number}),totalAmount:me.number,status:me.string})),isLoading:me.bool,error:me.string,totalOrders:me.number,statusBreakdown:me.shape({processing:me.number,shipped:me.number,delivered:me.number,cancelled:me.number}),onOrderDeleted:me.func,onOrderUpdated:me.func,onViewAll:me.func};Ga.defaultProps={orders:[],isLoading:!1,error:"",totalOrders:0,statusBreakdown:{processing:0,shipped:0,delivered:0,cancelled:0},filters:{status:"",startDate:"",endDate:""},appliedFilters:{status:"",startDate:"",endDate:""},onFiltersChange:()=>{},onApplyFilters:()=>{},onClearFilters:()=>{},onOrderDeleted:()=>{},onOrderUpdated:()=>{}};const ba=({users:t,isLoading:s,error:a,onUserUpdated:l,enableManagement:r})=>{var N,V;const[c,o]=n.useState(!1),[i,d]=n.useState(!1),[p,x]=n.useState(null),[D,g]=n.useState({name:"",username:"",email:"",role:"customer",isVerified:!1}),[R,u]=n.useState(null),[I,j]=n.useState(!1),[m,S]=n.useState(null),[P,H]=n.useState(""),[E,w]=n.useState("all"),[A,W]=n.useState("all"),[L,K]=n.useState([]),[O,Y]=n.useState(!1),[M,ee]=n.useState(!1),[te,y]=n.useState(!1);n.useEffect(()=>{if(!r){K([]);return}K(v=>v.filter(q=>t.some(J=>J._id===q)))},[r,t]),n.useEffect(()=>{L.length||y(!1)},[L]);const z=v=>{x(v),g({name:v.name||"",username:v.username||"",email:v.email||"",role:v.role||"customer",isVerified:!!v.isVerified}),o(!0)},b=()=>{i||(o(!1),x(null))},C=v=>{u(v)},B=()=>u(null),re=v=>{S(v)},se=()=>{I||S(null)},X=v=>{const{name:q,value:J,type:xe,checked:je}=v.target;g(we=>({...we,[q]:xe==="checkbox"?je:J}))},F=async v=>{var J,xe;if(v.preventDefault(),!p)return;const q=D.username.trim();if(!q){Re.error("Username is required");return}d(!0);try{const je={username:q,role:D.role,isVerified:D.isVerified},{data:we}=await fe.put(`/admin/users/${p._id}`,je);Re.success("Team member updated"),d(!1),o(!1),x(null),l==null||l(we.data)}catch(je){console.error("Failed to update member",je);const we=((xe=(J=je.response)==null?void 0:J.data)==null?void 0:xe.message)||"Unable to update team member. Please try again.";Re.error(we),d(!1)}},U=n.useMemo(()=>[...t].sort((v,q)=>new Date(q.createdAt)-new Date(v.createdAt)),[t]),h=n.useMemo(()=>{const v=P.trim().toLowerCase();return U.filter(q=>{const J=v?[q.name,q.username,q.email].filter(Boolean).some(we=>we.toLowerCase().includes(v)):!0,xe=E==="all"?!0:q.role===E,je=A==="all"?!0:A==="verified"?!!q.isVerified:!q.isVerified;return J&&xe&&je})},[U,P,E,A]),k=()=>{if(!U.length){Re.info("No team members to export");return}const v=["Name","Username","Email","Role","Verified","Joined"],q=U.map(_=>[(_.name||"").replace(/\n|\r|"/g," "),(_.username||"").replace(/\n|\r|"/g," "),_.email,_.role,_.isVerified?"Yes":"No",new Intl.DateTimeFormat("en-IN",{dateStyle:"medium",timeStyle:"short"}).format(new Date(_.createdAt))]),J=[v,...q].map(_=>_.map(be=>`"${String(be??"").replace(/"/g,'""')}"`).join(",")).join(`
`),xe=new Blob(["\uFEFF"+J],{type:"text/csv;charset=utf-8;"}),je=URL.createObjectURL(xe),we=document.createElement("a");we.href=je,we.setAttribute("download",`team-members-${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(we),we.click(),document.body.removeChild(we),URL.revokeObjectURL(je)},f=async()=>{var v,q;if(m){j(!0);try{await fe.delete(`/admin/users/${m._id}`),Re.success("Team member deleted"),l==null||l({_id:m._id,__delete:!0}),j(!1),S(null)}catch(J){console.error("Failed to delete member",J);const xe=((q=(v=J.response)==null?void 0:v.data)==null?void 0:q.message)||"Unable to delete team member. Please try again.";Re.error(xe),j(!1)}}},G=()=>{if(!r)return;const v=h.map(J=>J._id),q=v.some(J=>!L.includes(J));K(q?v:[])},le=v=>{r&&K(q=>q.includes(v)?q.filter(J=>J!==v):[...q,v])},Z=async()=>{var v,q;if(!L.length){Re.info("Select at least one user to delete");return}Y(!0);try{const{data:J}=await fe.post("/admin/users/bulk-delete",{ids:L}),xe=(J==null?void 0:J.deletedIds)||[],je=(J==null?void 0:J.skippedIds)||[];xe.length&&(Re.success(`Deleted ${xe.length} user${xe.length>1?"s":""}`),l==null||l({__bulkDelete:!0,deletedIds:xe})),je.length&&Re.warn(`Skipped ${je.length} user${je.length>1?"s":""}`),K([]),ee(!1)}catch(J){console.error("Failed to bulk delete",J);const xe=((q=(v=J.response)==null?void 0:v.data)==null?void 0:q.message)||"Unable to delete selected users.";Re.error(xe)}finally{Y(!1)}},ie=n.useMemo(()=>h.filter(v=>L.includes(v._id)),[h,L]);return e.jsxs(Q.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.45,delay:.15},className:"bg-white border border-slate-100 rounded-2xl shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-100 px-6 py-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Customers"})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2",children:[e.jsx(Zt,{className:"h-4 w-4 text-slate-400"}),e.jsx("input",{type:"search",value:P,onChange:v=>H(v.target.value),placeholder:"Search name, email, username",className:"w-48 bg-transparent text-sm text-slate-600 placeholder:text-slate-400 focus:outline-none"})]}),e.jsxs("select",{value:E,onChange:v=>w(v.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-600 focus:outline-none focus:border-blue-400",children:[e.jsx("option",{value:"all",children:"All roles"}),e.jsx("option",{value:"customer",children:"Customers"}),e.jsx("option",{value:"admin",children:"Admins"})]}),e.jsxs("select",{value:A,onChange:v=>W(v.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-600 focus:outline-none focus:border-blue-400",children:[e.jsx("option",{value:"all",children:"All status"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Pending"})]}),e.jsxs("button",{type:"button",onClick:k,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600 hover:border-blue-200 hover:text-blue-600 transition",children:[e.jsx(pn,{size:18})," Export CSV"]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>y(!0),disabled:L.length===0,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600 disabled:cursor-not-allowed disabled:border-slate-200 disabled:text-slate-300",children:[e.jsx(et,{size:16})," Bulk View"]}),e.jsxs("button",{type:"button",onClick:()=>ee(!0),disabled:L.length===0,className:"inline-flex items-center gap-2 rounded-xl border border-red-200 px-4 py-2 text-sm font-medium text-red-500 transition hover:border-red-300 hover:text-red-600 disabled:cursor-not-allowed disabled:border-slate-200 disabled:text-slate-300",children:[e.jsx(Je,{size:16})," Bulk Delete"]})]})]})]}),e.jsx("div",{className:"hidden overflow-x-auto md:block",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100",children:[e.jsx("thead",{className:"bg-slate-50/80",children:e.jsxs("tr",{children:[r&&e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",checked:h.length>0&&h.every(v=>L.includes(v._id)),onChange:G,className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"})})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Joined"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold text-slate-400 uppercase tracking-wide",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-slate-100",children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:r?7:6,className:"px-6 py-12 text-center text-slate-400",children:"Loading team members..."})}):a?e.jsx("tr",{children:e.jsx("td",{colSpan:r?7:6,className:"px-6 py-12 text-center text-red-400",children:a})}):h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:r?7:6,className:"px-6 py-12 text-center text-slate-400",children:"No users found."})}):h.map(v=>e.jsxs("tr",{className:"hover:bg-slate-50/60 transition",children:[r&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:L.includes(v._id),onChange:()=>le(v._id),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 text-white grid place-items-center font-semibold",children:(v.name||v.username||"U").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:v.name||v.username}),e.jsx("p",{className:"text-xs text-slate-400",children:v.username})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-600",children:v.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${v.role==="admin"?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-500"}`,children:v.role==="admin"?"Admin":"Customer"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.isVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-600",children:[e.jsx(Wt,{size:14})," Verified"]}):e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-orange-50 px-3 py-1 text-xs font-medium text-orange-500",children:[e.jsx(gs,{size:14})," Pending"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-slate-500",children:new Intl.DateTimeFormat("en-IN",{dateStyle:"medium"}).format(new Date(v.createdAt))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>C(v),className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1 text-xs font-medium text-slate-500 hover:border-blue-200 hover:text-blue-600 transition",children:[e.jsx(et,{size:14})," View"]}),e.jsxs("button",{type:"button",onClick:()=>z(v),className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1 text-xs font-medium text-slate-500 hover:border-blue-200 hover:text-blue-600 transition",children:[e.jsx(as,{size:14})," Edit"]}),r&&e.jsxs("button",{type:"button",onClick:()=>re(v),className:"inline-flex items-center gap-2 rounded-full border border-red-200 px-3 py-1 text-xs font-medium text-red-500 hover:border-red-300 hover:text-red-600 transition",children:[e.jsx(Je,{size:14})," Delete"]})]})})]},v._id))})]})}),e.jsxs("div",{className:"space-y-3 px-4 md:hidden",children:[r&&h.length>0&&e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-200 bg-white px-4 py-3 shadow-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Selection"}),e.jsxs("p",{className:"text-sm font-medium text-slate-700",children:[L.length," selected"]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:h.length>0&&h.every(v=>L.includes(v._id)),onChange:G,className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),"Select all"]})]}),e.jsxs(ze,{children:[s&&e.jsx(Q.div,{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-slate-500",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:"Loading team members..."}),!s&&a&&e.jsx(Q.div,{className:"rounded-2xl border border-rose-200 bg-white p-6 text-center text-rose-600",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:a}),!s&&!a&&h.length===0&&e.jsx(Q.div,{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-slate-500",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:"No users found."}),!s&&!a&&h.map(v=>{const q=L.includes(v._id);return e.jsxs(Q.div,{className:`relative rounded-2xl border bg-white p-4 shadow-sm transition focus-within:ring-2 focus-within:ring-blue-100 ${r&&q?"border-blue-300 ring-2 ring-blue-100":"border-slate-200"}`,initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},children:[r&&e.jsx("div",{className:"absolute -top-2 -left-2",children:e.jsxs("label",{className:"flex items-center gap-2 rounded-full bg-white/80 px-2 py-1 shadow-sm",children:[e.jsx("input",{type:"checkbox",checked:q,onChange:()=>le(v._id),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-[11px] font-medium text-slate-600",children:"Select"})]})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-12 w-12 flex-shrink-0 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 text-white grid place-items-center font-semibold",children:(v.name||v.username||"U").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:v.name||v.username}),e.jsx("p",{className:"text-xs text-slate-500",children:v.email}),e.jsx("p",{className:"text-xs text-slate-400",children:v.username})]}),e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${v.role==="admin"?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-500"}`,children:v.role==="admin"?"Admin":"Customer"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-xs text-slate-500",children:[e.jsxs("div",{className:"rounded-xl bg-slate-50 p-3",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"Status"}),v.isVerified?e.jsxs("span",{className:"mt-1 inline-flex items-center gap-2 rounded-full bg-emerald-50 px-3 py-1 text-[11px] font-medium text-emerald-600",children:[e.jsx(Wt,{size:12})," Verified"]}):e.jsxs("span",{className:"mt-1 inline-flex items-center gap-2 rounded-full bg-orange-50 px-3 py-1 text-[11px] font-medium text-orange-500",children:[e.jsx(gs,{size:12})," Pending"]})]}),e.jsxs("div",{className:"rounded-xl bg-slate-50 p-3",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"Joined"}),e.jsx("p",{className:"mt-1 text-xs font-medium text-slate-700",children:new Intl.DateTimeFormat("en-IN",{dateStyle:"medium"}).format(new Date(v.createdAt))})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-end gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>C(v),className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600",children:[e.jsx(et,{size:14})," View"]}),e.jsxs("button",{type:"button",onClick:()=>z(v),className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600",children:[e.jsx(as,{size:14})," Edit"]}),r&&e.jsxs("button",{type:"button",onClick:()=>re(v),className:"inline-flex items-center gap-2 rounded-full border border-rose-200 px-3 py-1.5 text-xs font-semibold text-rose-500 hover:border-rose-300",children:[e.jsx(Je,{size:14})," Delete"]})]})]})]})]},v._id)})]})]}),e.jsxs(ze,{children:[R&&e.jsxs(Q.div,{className:"fixed inset-0 z-50 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:B,"aria-label":"Close view modal"}),e.jsxs(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:240,damping:24},className:"relative z-10 w-full max-w-lg rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Team Member Details"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Quick snapshot of account information."})]}),e.jsx("button",{type:"button",onClick:B,className:"rounded-full border border-slate-200 text-slate-400 hover:text-slate-600 hover:border-slate-300 p-1","aria-label":"Close",children:e.jsx(Ze,{size:18})})]}),e.jsxs("div",{className:"px-6 py-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Name"}),e.jsx("p",{className:"text-sm font-medium text-slate-800",children:R.name||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Username"}),e.jsx("p",{className:"text-sm font-medium text-slate-800",children:R.username||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Email"}),e.jsx("p",{className:"text-sm font-medium text-slate-800",children:R.email})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${R.role==="admin"?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-500"}`,children:R.role==="admin"?"Admin":"Customer"}),R.isVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-600",children:[e.jsx(Wt,{size:14})," Verified"]}):e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-orange-50 px-3 py-1 text-xs font-medium text-orange-500",children:[e.jsx(gs,{size:14})," Pending Verification"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Joined"}),e.jsx("p",{className:"text-sm font-medium text-slate-800",children:new Intl.DateTimeFormat("en-IN",{dateStyle:"medium",timeStyle:"short"}).format(new Date(R.createdAt))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Addresses"}),!((N=R.addresses)!=null&&N.length)&&e.jsx("p",{className:"text-sm font-medium text-slate-500",children:"No saved addresses"}),(V=R.addresses)==null?void 0:V.map(v=>e.jsxs("div",{className:"mt-3 rounded-xl border border-slate-100 bg-slate-50 px-4 py-3 text-sm text-slate-700",children:[e.jsxs("p",{className:"font-semibold text-slate-900",children:[v.fullName,v.isDefault?e.jsx("span",{className:"ml-2 inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-[11px] font-medium text-blue-600",children:"Default"}):null]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[v.mobile,v.alternatePhone?` · Alt: ${v.alternatePhone}`:""]}),e.jsxs("p",{className:"mt-1 leading-relaxed",children:[v.addressLine,", ",v.city,", ",v.state," -"," ",v.pincode]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:v.email})]},v._id))]})]})]})]}),M&&e.jsxs(Q.div,{className:"fixed inset-0 z-50 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:()=>{O||ee(!1)},"aria-label":"Close selection overview"}),e.jsxs(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:240,damping:24},className:"relative z-10 w-full max-w-3xl rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-start justify-between px-6 py-4 border-b border-slate-200",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900",children:["Selected users (",L.length,")"]}),e.jsxs("p",{className:"text-sm text-slate-500 flex items-center gap-2",children:[e.jsx(hn,{size:16,className:"text-blue-500"})," Review the list before deleting accounts."]})]}),e.jsx("button",{type:"button",onClick:()=>{O||ee(!1)},className:"rounded-full border border-slate-200 text-slate-400 hover:text-slate-600 hover:border-slate-300 p-1","aria-label":"Close",disabled:O,children:e.jsx(Ze,{size:18})})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto px-6 py-4",children:ie.length?e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Name"}),e.jsx("th",{className:"px-4 py-3",children:"Email"}),e.jsx("th",{className:"px-4 py-3",children:"Role"}),e.jsx("th",{className:"px-4 py-3",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white text-slate-700",children:ie.map(v=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:v.name||v.username}),e.jsx("p",{className:"text-xs text-slate-400",children:v.username})]}),e.jsx("td",{className:"px-4 py-3",children:v.email}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium ${v.role==="admin"?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-600"}`,children:v.role==="admin"?"Admin":"Customer"})}),e.jsx("td",{className:"px-4 py-3",children:v.isVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-emerald-50 px-3 py-1 text-[11px] font-medium text-emerald-600",children:[e.jsx(Wt,{size:12})," Verified"]}):e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-orange-50 px-3 py-1 text-[11px] font-medium text-orange-500",children:[e.jsx(gs,{size:12})," Pending"]})})]},v._id))})]}):e.jsx("p",{className:"text-sm text-slate-500",children:"No users selected or some accounts are no longer available."})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-slate-100",children:[e.jsx("button",{type:"button",onClick:()=>{O||ee(!1)},className:"rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-500 hover:text-slate-700 hover:border-slate-300 transition",disabled:O,children:"Cancel"}),e.jsx("button",{type:"button",onClick:Z,className:"inline-flex items-center gap-2 rounded-xl bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 transition disabled:opacity-60",disabled:O||!ie.length,children:O?"Deleting...":"Delete Selected"})]})]})]}),c&&e.jsxs(Q.div,{className:"fixed inset-0 z-50 flex",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("button",{type:"button",className:"flex-1 bg-black/40",onClick:b,"aria-label":"Close edit panel"}),e.jsxs(Q.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:200,damping:26},className:"w-full max-w-md bg-white h-full overflow-y-auto shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Edit Team Member"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Update profile details and access for this account."})]}),e.jsx("button",{type:"button",onClick:b,className:"rounded-full border border-slate-200 text-slate-400 hover:text-slate-600 hover:border-slate-300 p-1","aria-label":"Close",children:e.jsx(Ze,{size:18})})]}),e.jsxs("form",{className:"px-6 py-6 space-y-5",onSubmit:F,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",htmlFor:"name",children:"Full Name"}),e.jsx("input",{id:"name",name:"name",type:"text",value:D.name,readOnly:!0,className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:outline-none",placeholder:"e.g. Priya Sharma","aria-readonly":"true"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Name changes must be requested by the user."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",htmlFor:"username",children:"Username"}),e.jsx("input",{id:"username",name:"username",type:"text",value:D.username,onChange:X,className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100",placeholder:"e.g. priyash",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",name:"email",type:"email",value:D.email,readOnly:!0,className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:outline-none",placeholder:"e.g. priya@example.com",required:!0,"aria-readonly":"true"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Email cannot be modified by admin."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",htmlFor:"role",children:"Role"}),e.jsxs("select",{id:"role",name:"role",value:D.role,onChange:X,className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100",children:[e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 rounded-xl border border-slate-200 px-3 py-3 text-sm text-slate-600",children:[e.jsx("input",{type:"checkbox",name:"isVerified",checked:D.isVerified,onChange:X,className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),"Mark email as verified"]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-200",children:[e.jsx("button",{type:"button",onClick:b,className:"rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-500 hover:text-slate-700 hover:border-slate-300 transition",disabled:i,children:"Cancel"}),e.jsx("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 transition disabled:opacity-60",disabled:i,children:i?"Saving...":"Save Changes"})]})]})]})]}),m&&e.jsxs(Q.div,{className:"fixed inset-0 z-50 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:se,"aria-label":"Dismiss delete confirmation"}),e.jsx(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:240,damping:24},className:"relative z-10 w-full max-w-md rounded-2xl bg-white shadow-2xl",children:e.jsxs("div",{className:"px-6 py-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Delete Team Member"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["This will permanently remove"," ",m.name||m.username,"'s account access."]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:se,className:"rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-500 hover:text-slate-700 hover:border-slate-300 transition",disabled:I,children:"Cancel"}),e.jsx("button",{type:"button",onClick:f,className:"inline-flex items-center gap-2 rounded-xl bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 transition disabled:opacity-60",disabled:I,children:I?"Deleting...":"Delete"})]})]})})]}),te&&e.jsxs(Q.div,{className:"fixed inset-0 z-50 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:()=>y(!1),"aria-label":"Close bulk view"}),e.jsxs(Q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:240,damping:24},className:"relative z-10 w-full max-w-4xl rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-start justify-between px-6 py-4 border-b border-slate-200",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900",children:["Selected customers (",ie.length,")"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"Review key details before performing a bulk action."})]}),e.jsx("button",{type:"button",onClick:()=>y(!1),className:"rounded-full border border-slate-200 text-slate-400 hover:text-slate-600 hover:border-slate-300 p-1","aria-label":"Close",children:e.jsx(Ze,{size:18})})]}),e.jsx("div",{className:"max-h-[65vh] overflow-y-auto px-6 py-5 space-y-4",children:ie.length?ie.map(v=>e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 px-4 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:v.name||v.username||"Unnamed"}),e.jsx("p",{className:"text-xs text-slate-500",children:v.email})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${v.role==="admin"?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-500"}`,children:v.role==="admin"?"Admin":"Customer"}),v.isVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-600",children:[e.jsx(Wt,{size:14})," Verified"]}):e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-orange-50 px-3 py-1 text-xs font-medium text-orange-500",children:[e.jsx(gs,{size:14})," Pending"]})]})]}),e.jsxs("div",{className:"mt-3 grid gap-3 text-xs text-slate-600 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"Username"}),e.jsx("p",{className:"mt-1 font-medium text-slate-700",children:v.username||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"Joined"}),e.jsx("p",{className:"mt-1 font-medium text-slate-700",children:new Intl.DateTimeFormat("en-IN",{dateStyle:"medium"}).format(new Date(v.createdAt))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"Addresses saved"}),e.jsx("p",{className:"mt-1 font-medium text-slate-700",children:Array.isArray(v.addresses)?v.addresses.length:0})]})]})]},v._id)):e.jsx("p",{className:"text-sm text-slate-500",children:"No customers selected."})})]})]})]})]})};ba.propTypes={users:me.arrayOf(me.shape({_id:me.string.isRequired,name:me.string,username:me.string,email:me.string.isRequired,role:me.string,isVerified:me.bool,createdAt:me.string,addresses:me.arrayOf(me.shape({_id:me.string,fullName:me.string,mobile:me.string,email:me.string,pincode:me.string,state:me.string,city:me.string,addressLine:me.string,alternatePhone:me.string,isDefault:me.bool}))})),isLoading:me.bool,error:me.string,onUserUpdated:me.func,enableManagement:me.bool};ba.defaultProps={users:[],isLoading:!1,error:"",onUserUpdated:void 0,enableManagement:!1};const Ir={status:"",startDate:"",endDate:""},Fr=()=>{const t=new Date,s=new Date(t);return s.setDate(s.getDate()-1),{status:"",startDate:ia(s),endDate:ia(t)}},ia=t=>t.toISOString().slice(0,10),ic=(t="processing")=>{const s=String(t).toLowerCase();return["confirmed"].includes(s)?"processing":["shipped","out_for_delivery"].includes(s)?"shipped":["delivered"].includes(s)?"delivered":["returned"].includes(s)?"returned":"processing"},$s=(t=[])=>{const s={processing:0,shipped:0,delivered:0,returned:0};return t.forEach(a=>{const l=ic(a.status);s[l]!==void 0&&(s[l]+=1)}),s},oc=()=>{const t=Te(),[s,a]=n.useState([]),[l,r]=n.useState(!0),[c,o]=n.useState(""),[i,d]=n.useState({sales:0,orders:0,profit:0,customers:0}),[p,x]=n.useState({processing:0,shipped:0,delivered:0,returned:0}),[D,g]=n.useState({pendingOrders:0,shippedOrders:0,deliveredOrders:0}),[R,u]=n.useState(!0),[I,j]=n.useState(""),[m,S]=n.useState([]),[P,H]=n.useState(!0),[E,w]=n.useState(""),[A,W]=n.useState("24 Hour"),[L,K]=n.useState(!1),[O,Y]=n.useState(()=>Fr()),[M,ee]=n.useState(()=>Fr()),{user:te,logout:y}=Qe(),z=n.useMemo(()=>({...O}),[O]),b=U=>{if(U.__delete){S(h=>h.filter(k=>k._id!==U._id));return}if(U.__bulkDelete&&Array.isArray(U.deletedIds)){S(h=>h.filter(k=>!U.deletedIds.includes(k._id)));return}S(h=>h.map(k=>k._id===U._id?{...k,...U}:k))},C=U=>{ee(h=>({...h,...U}))},B=()=>{Y({...M})},re=()=>{ee({...Ir}),Y({...Ir}),W("All Date")},se=U=>{if(W(U),U==="All Date"){ee(G=>({...G,startDate:"",endDate:""})),Y(G=>({...G,startDate:"",endDate:""}));return}const h=new Date;let k;switch(U){case"12 Months":k=new Date(h),k.setFullYear(k.getFullYear()-1);break;case"30 Days":k=new Date(h),k.setDate(k.getDate()-30);break;case"7 Days":k=new Date(h),k.setDate(k.getDate()-7);break;case"24 Hour":k=new Date(h),k.setDate(k.getDate()-1);break;default:k=null;break}const f={startDate:k?ia(k):"",endDate:ia(h)};ee(G=>({...G,...f})),Y(G=>({...G,...f}))};n.useEffect(()=>{let U=!0;const h=async()=>{var f,G;if(U){u(!0);try{const le=await fe.get("/admin/overview");if(!U)return;if((f=le.data)!=null&&f.success){const Z=le.data.data||{};d(Z.metrics||{}),g(Z.notifications||{}),x({...$s(Z.recentOrders||[]),...Z.statusBreakdown||{}}),j("")}else j(((G=le.data)==null?void 0:G.message)||"Unable to load admin overview.")}catch(le){if(!U)return;console.error("Failed to load admin overview",le),j("Unable to load admin overview. Please try again.")}finally{U&&u(!1)}}},k=async()=>{var f;if(U){H(!0);try{const G=await fe.get("/admin/users");if(!U)return;S(((f=G.data)==null?void 0:f.data)||[]),w("")}catch(G){if(!U)return;console.error("Failed to load users",G),w("Unable to load users. Please try again.")}finally{U&&H(!1)}}};return h(),k(),()=>{U=!1}},[]),n.useEffect(()=>{let U=!0;return(async()=>{var k;if(U){r(!0);try{const f={};O.status&&(f.status=O.status),O.startDate&&(f.startDate=O.startDate),O.endDate&&(f.endDate=O.endDate);const G=await fe.get("/orders",{params:f});if(!U)return;const le=((k=G.data)==null?void 0:k.data)||[];a(le),x(Z=>({...Z,...$s(le)})),o("")}catch(f){if(!U)return;console.error("Failed to fetch orders",f),o("Unable to load orders. Please try again shortly.")}finally{U&&r(!1)}}})(),()=>{U=!1}},[O]),n.useEffect(()=>(L?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[L]);const X=n.useCallback(U=>{a(h=>{const k=h.filter(f=>f._id!==U);return x(f=>({...f,...$s(k)})),d(f=>({...f,orders:k.length})),k})},[]),F=n.useCallback(U=>{a(h=>{const k=h.map(f=>f._id===U._id?{...f,...U}:f);return x(f=>({...f,...$s(k)})),k})},[]);return e.jsx("div",{className:"min-h-screen md:h-screen bg-slate-50 text-slate-900 overflow-x-hidden",children:e.jsxs("div",{className:"flex md:h-screen",children:[e.jsx(Ue,{active:"Dashboard",className:"hidden md:flex md:w-64 md:flex-none",onNavigate:()=>K(!1)}),e.jsx(ze,{children:L&&e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx(Q.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(Ue,{active:"Dashboard",className:"flex w-full",onNavigate:()=>K(!1)})}),e.jsx("button",{type:"button",onClick:()=>K(!1),className:"flex-1 bg-black/30","aria-label":"Close sidebar"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(nt,{onToggleSidebar:()=>K(U=>!U),activeRange:A,onSelectRange:se,adminName:(te==null?void 0:te.name)||(te==null?void 0:te.username),adminRole:(te==null?void 0:te.role)==="admin"?"Administrator":te==null?void 0:te.role,notifications:D,onLogout:y}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-4 py-6 md:px-8 space-y-6",children:[e.jsx(Ha,{metrics:i,isLoading:R}),I&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-600",children:I}),!R&&!I&&e.jsx("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 xl:grid-cols-4",children:[{key:"processing",label:"Processing",chipClass:"bg-orange-50 text-orange-600"},{key:"shipped",label:"Shipped",chipClass:"bg-blue-50 text-blue-600"},{key:"delivered",label:"Delivered",chipClass:"bg-emerald-50 text-emerald-600"},{key:"returned",label:"Return/Replace",chipClass:"bg-slate-100 text-slate-600"}].map(({key:U,label:h,chipClass:k})=>e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-slate-500",children:h}),e.jsx("p",{className:`mt-2 inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm font-semibold ${k}`,children:(p==null?void 0:p[U])??0})]},U))}),e.jsx(Ga,{orders:s,isLoading:l,error:c,totalOrders:(i==null?void 0:i.orders)||s.length,statusBreakdown:p,filters:M,appliedFilters:z,onFiltersChange:C,onApplyFilters:B,onClearFilters:re,onOrderDeleted:X,onOrderUpdated:F,onViewAll:()=>t("/admin/orders")}),e.jsx(ba,{users:m,isLoading:P,error:E,onUserUpdated:b})]})]})]})})},Ll=["S","M","L","XL","XXL"],cc=[{matcher:/keychain/i,hsnCode:"8305",gstRate:18},{matcher:/ceramic\s+coffee\s+mug|coffee\s+mug|mug/i,hsnCode:"6912",gstRate:12},{matcher:/executive\s+diary|pen\s+set/i,hsnCode:"4820",gstRate:18},{matcher:/white\s+logo\s+cap|cap/i,hsnCode:"6501",gstRate:18},{matcher:/diary/i,hsnCode:"4820",gstRate:18},{matcher:/\bpen\b/i,hsnCode:"9608",gstRate:18},{matcher:/t\s*-?shirt|polo/i,hsnCode:"6109",gstRate:5}],dc=(t="")=>{const s=t.toString().trim();return s&&cc.find(a=>a.matcher.test(s))||null},oa=()=>Ll.map(t=>({label:t,isAvailable:!0,stock:0})),Er=t=>{if(t==null)return"";const s=t.toString().trim().toUpperCase();if(!s)return"";if(/^P\d{1,2}$/.test(s))return s;const a=parseInt(s.replace(/[^0-9]/g,""),10);return!Number.isNaN(a)&&a>0?`P${a}`:""},Ot=t=>{if(!Array.isArray(t)||!t.length)return oa();const s=new Set,a=t.map(l=>{var c;const r=(c=l==null?void 0:l.label)==null?void 0:c.toString().trim().toUpperCase();return!r||s.has(r)?null:(s.add(r),{label:r,isAvailable:!!((l==null?void 0:l.isAvailable)??!0),stock:Math.max(Number((l==null?void 0:l.stock)??0),0)})}).filter(Boolean);return Ll.forEach(l=>{s.has(l)||a.push({label:l,isAvailable:!0,stock:0})}),a.length?a:oa()},Vt=t=>(Array.isArray(t)?t:[]).reduce((a,l)=>{if(!l||!l.isAvailable)return a;const r=Number(l.stock??0);return Number.isFinite(r)?a+Math.max(r,0):a},0),Tt={name:"",sku:"",category:"",brand:"",categoryPriority:"",price:"",originalPrice:"",discountPercentage:"",saveAmount:"",stock:"",status:"published",availabilityStatus:"in_stock",thumbnail:"",description:"",gallery:[],isFeatured:!1,keyFeatures:[""],sizes:oa(),showSizes:!1,hsnCode:"",gstRate:""},mc=[{label:"Published",value:"published"},{label:"Archived",value:"archived"}],uc=[{label:"In Stock",value:"in_stock"},{label:"Low Stock",value:"low_stock"},{label:"Out of Stock",value:"out_of_stock"},{label:"Preorder",value:"preorder"}],xc={hidden:{opacity:0,y:20},visible:{opacity:1,y:0},exit:{opacity:0,y:20}},Qa=({isOpen:t,mode:s,initialData:a,onClose:l,onSubmit:r,isSubmitting:c,error:o})=>{const[i,d]=n.useState(Tt),[p,x]=n.useState(null),[D,g]=n.useState(""),[R,u]=n.useState(!1),[I,j]=n.useState(!1),[m,S]=n.useState(!1),[P,H]=n.useState(!1),E=n.useMemo(()=>s==="edit"?"Edit Product":"Add Product",[s]),w=n.useMemo(()=>s==="edit"?"Save Changes":"Create Product",[s]);n.useEffect(()=>{if(t){const F=a||{};d({...Tt,...F,thumbnail:F.thumbnail||Tt.thumbnail,gallery:Array.isArray(F.gallery)?[...F.gallery]:[...Tt.gallery],keyFeatures:Array.isArray(F.keyFeatures)?F.keyFeatures.length?[...F.keyFeatures]:[""]:[...Tt.keyFeatures],sizes:Ot(F.sizes),showSizes:!!F.showSizes,categoryPriority:Er(F.categoryPriority),hsnCode:F.hsnCode!=null?String(F.hsnCode):Tt.hsnCode,gstRate:F.gstRate!=null&&F.gstRate!==""?String(F.gstRate):Tt.gstRate}),g(""),S(!!(F!=null&&F.hsnCode)),H((F==null?void 0:F.gstRate)!==void 0&&(F==null?void 0:F.gstRate)!==null&&(F==null?void 0:F.gstRate)!=="")}},[t,a]),n.useEffect(()=>{o&&g(o)},[o]);const A=["out_of_stock","preorder"],W=A.includes(i.availabilityStatus),L=F=>U=>{const h=U.target.value;d(k=>{const f={...k,[F]:h};if(F==="availabilityStatus")if(A.includes(h))f.stock="0";else{const G=Vt(Ot(k.sizes));f.stock=G.toString()}if(F==="name"){const G=dc(h);G&&((!m||!k.hsnCode)&&(f.hsnCode=G.hsnCode,S(!1)),(!P||!k.gstRate)&&(f.gstRate=G.gstRate.toString(),H(!1)))}return f})},K=F=>U=>{const h=U.target.value;F==="hsnCode"&&S(!0),F==="gstRate"&&H(!0),d(k=>({...k,[F]:h}))},O=F=>U=>{const{checked:h}=U.target;d(k=>{if(F==="showSizes"){const f=Vt(Ot(k.sizes));return{...k,[F]:h,stock:h&&!A.includes(k.availabilityStatus)?f.toString():k.stock}}return{...k,[F]:h}})},Y=F=>U=>{const{value:h}=U.target;d(k=>{const f={...k,[F]:h},G=F==="price"?h:f.price,le=F==="originalPrice"?h:f.originalPrice,Z=parseFloat(G),ie=parseFloat(le);if(!Number.isNaN(Z)&&!Number.isNaN(ie)&&ie>=Z&&ie>0){const N=ie-Z;f.discountPercentage=Math.round(N/ie*100).toString(),f.saveAmount=N.toFixed(2)}else f.discountPercentage="",f.saveAmount="";return f})},M=2*1024*1024,ee=F=>new Promise((U,h)=>{const k=new FileReader;k.onload=()=>U(k.result),k.onerror=()=>h(new Error("Failed to read file")),k.readAsDataURL(F)}),te=async F=>{var h;const U=(h=F.target.files)==null?void 0:h[0];if(U){if(!U.type.startsWith("image/")){g("Please upload an image file for the thumbnail"),F.target.value="";return}if(U.size>M){g("Thumbnail must be under 2MB"),F.target.value="";return}u(!0);try{const k=await ee(U);d(f=>({...f,thumbnail:k})),g("")}catch{g("Failed to load thumbnail image")}finally{u(!1),F.target.value=""}}},y=async F=>{const U=Array.from(F.target.files||[]);if(!U.length)return;if(U.some(k=>!k.type.startsWith("image/"))){g("All gallery files must be images"),F.target.value="";return}if(U.find(k=>k.size>M)){g("Each gallery image must be under 2MB"),F.target.value="";return}j(!0);try{const k=await Promise.all(U.map(ee));d(f=>{const G=Array.isArray(f.gallery)?f.gallery:[],le=k.filter(Z=>!G.includes(Z));return{...f,gallery:[...G,...le]}}),g("")}catch{g("Failed to load gallery images")}finally{j(!1),F.target.value=""}},z=F=>{d(U=>{const h=(U.gallery||[]).filter((k,f)=>f!==F);return{...U,gallery:h}})},b=n.useMemo(()=>Ot(i.sizes),[i.sizes]),C=n.useMemo(()=>Vt(b),[b]),B=F=>{d(U=>{const h=Ot(U.sizes).map(f=>f.label===F?{...f,isAvailable:!f.isAvailable}:f),k=Vt(h);return{...U,sizes:h,stock:A.includes(U.availabilityStatus)?U.stock:k.toString()}})},re=()=>{d(F=>{const U=oa(),h=Vt(U);return{...F,sizes:U,stock:A.includes(F.availabilityStatus)?F.stock:h.toString()}})},se=F=>U=>{const k=(U.target.value??"").toString().replace(/[^0-9]/g,""),f=Math.max(Number(k||0),0);d(G=>{const le=Ot(G.sizes).map(ie=>ie.label===F?{...ie,stock:f}:ie),Z=Vt(le);return{...G,sizes:le,stock:A.includes(G.availabilityStatus)?G.stock:Z.toString()}})},X=F=>{var k;if(F.preventDefault(),g(""),!i.name.trim()){g("Product name is required");return}if(!i.category.trim()){g("Category is required");return}if(!i.categoryPriority.trim()){g("Set a category priority (e.g. P1, P2)");return}if(i.hsnCode&&!/^\d{2,}$/i.test(i.hsnCode.trim())){g("HSN code should contain at least 2 digits");return}if(i.gstRate!==""){const f=Number(i.gstRate);if(Number.isNaN(f)||f<0||f>100){g("GST rate must be between 0 and 100");return}}if(!i.thumbnail.trim()){g("Thumbnail URL is required");return}if(!Array.isArray(i.gallery)||i.gallery.length===0){g("Add at least one gallery image");return}if(!i.price||Number.isNaN(Number(i.price))){g("Valid price is required");return}const U=Array.isArray(i.keyFeatures)?i.keyFeatures.map(f=>f.trim()).filter(Boolean):[];if(!U.length){g("Add at least one key feature");return}const h=Ot(i.sizes);if(i.showSizes&&!h.some(f=>f.isAvailable)){g("Enable at least one size or turn off the size selector before saving");return}if(i.originalPrice&&(Number.isNaN(Number(i.originalPrice))||Number(i.originalPrice)<Number(i.price))){g("Original price must be a valid number greater than or equal to price");return}if(i.stock!==""&&Number.isNaN(Number(i.stock))){g("Stock must be a number");return}r({...i,price:Number(i.price),originalPrice:i.originalPrice?Number(i.originalPrice):void 0,discountPercentage:i.discountPercentage?Number(i.discountPercentage):void 0,saveAmount:i.saveAmount?Number(i.saveAmount):void 0,stock:Number(["out_of_stock","preorder"].includes(i.availabilityStatus)?0:i.stock||0),gallery:Array.isArray(i.gallery)?i.gallery:[],isFeatured:!!i.isFeatured,keyFeatures:U,sizes:h,showSizes:!!i.showSizes,category:i.category,categoryPriority:Er(i.categoryPriority),brand:i.brand,hsnCode:((k=i.hsnCode)==null?void 0:k.toString().trim())||void 0,gstRate:i.gstRate!==""&&!Number.isNaN(Number(i.gstRate))?Number(i.gstRate):void 0})};return e.jsx(ze,{children:t&&e.jsx(Q.div,{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 py-8 md:items-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(Q.div,{variants:xc,initial:"hidden",animate:"visible",exit:"exit",className:"w-full max-w-xl rounded-2xl bg-white p-6 shadow-xl md:my-0 max-h-[calc(100vh-4rem)] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:E}),e.jsx("p",{className:"text-sm text-slate-500",children:s==="edit"?"Update product details and inventory":"Create a new product listing"})]}),e.jsx("button",{type:"button",onClick:l,className:"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-transparent text-slate-400 hover:border-slate-200 hover:text-slate-600","aria-label":"Close",disabled:c,children:e.jsx(Ze,{size:18})})]}),e.jsxs("form",{onSubmit:X,className:"mt-6 space-y-5",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Product Name",e.jsx("input",{type:"text",value:i.name,onChange:L("name"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"Smartwatch E2"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["HSN Code",e.jsx("input",{type:"text",value:i.hsnCode,onChange:K("hsnCode"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"6109"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:"Auto-suggested from product name; edit if required."})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["GST Rate (%)",e.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",value:i.gstRate,onChange:K("gstRate"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"e.g. 18"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:"Leave blank to auto-fill from presets."})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-xs font-medium text-slate-500 md:col-span-2",children:["Key Features",e.jsxs("div",{className:"space-y-2",children:[(i.keyFeatures||[]).map((F,U)=>e.jsxs("div",{className:"flex gap-2 rounded-xl border border-slate-200 bg-white px-2 py-1",draggable:!0,onDragStart:()=>x(U),onDragOver:h=>{h.preventDefault()},onDrop:h=>{h.preventDefault(),d(k=>{const f=Array.isArray(k.keyFeatures)?[...k.keyFeatures]:[],G=p,le=U;if(G==null||G===le||G<0||le<0||G>=f.length||le>=f.length)return k;const[Z]=f.splice(G,1);return f.splice(le,0,Z),{...k,keyFeatures:f.length?f:[""]}}),x(null)},children:[e.jsx("input",{type:"text",value:F,onChange:h=>{const k=h.target.value;d(f=>{const G=Array.isArray(f.keyFeatures)?[...f.keyFeatures]:[""];return G[U]=k,{...f,keyFeatures:G}})},placeholder:"E.g. Premium breathable fabric",className:"flex-1 rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"}),e.jsx("button",{type:"button",onClick:()=>{d(h=>{const k=Array.isArray(h.keyFeatures)?h.keyFeatures.filter((f,G)=>G!==U):[];return{...h,keyFeatures:k.length?k:[""]}})},className:"inline-flex items-center justify-center rounded-xl border border-slate-200 px-2 py-2 text-xs font-medium text-slate-500 hover:border-rose-200 hover:text-rose-500",disabled:(i.keyFeatures||[]).length===1,children:"Remove"})]},U)),e.jsx("button",{type:"button",onClick:()=>{d(F=>({...F,keyFeatures:Array.isArray(F.keyFeatures)?[...F.keyFeatures,""]:["",""]}))},className:"inline-flex items-center gap-2 rounded-xl border border-dashed border-blue-300 px-3 py-2 text-xs font-semibold text-blue-600 hover:bg-blue-50",children:"Add Feature"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["id",e.jsx("input",{type:"text",value:i.sku,onChange:L("sku"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"SW-302011"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Category",e.jsx("input",{type:"text",value:i.category,onChange:L("category"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"Menswear"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Category Priority",e.jsx("input",{type:"text",value:i.categoryPriority,onChange:L("categoryPriority"),placeholder:"P1",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:"Use P1, P2, P3… Higher priority appears first in listings."})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Brand",e.jsx("input",{type:"text",value:i.brand,onChange:L("brand"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"p2pdeal"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Price",e.jsx("input",{type:"number",min:"0",step:"0.01",value:i.price,onChange:Y("price"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"599.00"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Original Price (MRP)",e.jsx("input",{type:"number",min:"0",step:"0.01",value:i.originalPrice,onChange:Y("originalPrice"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"799.00"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Discount (%)",e.jsx("input",{type:"number",min:"0",step:"1",value:i.discountPercentage,onChange:L("discountPercentage"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"Auto"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["You Save (₹)",e.jsx("input",{type:"number",min:"0",step:"0.01",value:i.saveAmount,onChange:L("saveAmount"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"Auto"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Stock",e.jsx("input",{type:"number",min:"0",step:"1",value:i.stock,onChange:L("stock"),disabled:W,readOnly:i.showSizes&&!W,title:i.showSizes&&!W?"Auto-calculated from per-size stock":void 0,className:`rounded-xl border px-3 py-2 text-sm focus:border-blue-400 focus:outline-none ${W||i.showSizes?"cursor-not-allowed border-slate-200 bg-slate-100 text-slate-500":"border-slate-200"}`,placeholder:W?"Managed automatically":i.showSizes?"Calculated from sizes":"40"}),W&&e.jsxs("span",{className:"text-[11px] text-slate-500",children:["Stock is controlled automatically when status is"," ",i.availabilityStatus==="preorder"?"Preorder":"Out of Stock","."]}),i.showSizes&&!W&&e.jsxs("span",{className:"text-[11px] text-slate-500",children:["Total from size quantities: ",C]})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Status",e.jsx("select",{value:i.status,onChange:L("status"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:outline-none",children:mc.map(F=>e.jsx("option",{value:F.value,children:F.label},F.value))})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Stock Status",e.jsx("select",{value:i.availabilityStatus,onChange:L("availabilityStatus"),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:outline-none",children:uc.map(F=>e.jsx("option",{value:F.value,children:F.label},F.value))})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Featured Product",e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-slate-200 bg-slate-50 px-3 py-2",children:[e.jsx("span",{className:"text-xs text-slate-600",children:"Highlight this item in storefront collections"}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!i.isFeatured,onChange:O("isFeatured"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500","aria-label":"Toggle featured product"}),e.jsx("span",{className:"text-xs text-slate-600",children:i.isFeatured?"Yes":"No"})]})]})]})]}),e.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 bg-slate-50/60 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-slate-500",children:"Size Availability"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Toggle which sizes are purchasable and whether the selector appears on the product page."})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:!!i.showSizes,onChange:O("showSizes"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),i.showSizes?"Shown on product page":"Hidden on product page"]})]}),i.showSizes?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-500",children:[e.jsxs("span",{className:"font-medium text-slate-600",children:["Total size stock: ",C]}),e.jsx("button",{type:"button",onClick:re,className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-1.5 text-[11px] font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600",children:"Reset sizes"})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:b.map(F=>{const U=!!F.isAvailable,h=Number(F.stock??0);return e.jsxs("div",{className:"flex flex-col gap-2 rounded-xl border border-slate-200 bg-white p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>B(F.label),className:`inline-flex items-center gap-2 rounded-lg border px-3 py-1.5 text-xs font-semibold transition focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 ${U?"border-blue-600 bg-blue-50 text-blue-600 hover:border-blue-700 hover:bg-blue-100":"border-rose-200 bg-rose-50 text-rose-500 hover:border-rose-300 hover:bg-rose-100"}`,children:[e.jsx("span",{children:F.label}),!U&&e.jsx("span",{className:"rounded-full bg-white px-2 py-0.5 text-[9px] font-semibold uppercase text-rose-500 shadow-sm",children:"Blocked"})]}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:"0",value:U&&!W&&h>0?h:"",onFocus:k=>k.target.select(),onChange:se(F.label),disabled:!U||W,placeholder:"0",className:`w-24 rounded-lg border px-2 py-1 text-xs font-semibold focus:border-blue-400 focus:outline-none ${U&&!W?"border-slate-200 bg-white text-slate-700":"cursor-not-allowed border-slate-100 bg-slate-100 text-slate-400"}`,"aria-label":`${F.label} stock quantity`})]}),e.jsx("p",{className:"text-[11px] text-slate-500",children:U?"Adjust units for this size when available.":"Blocked sizes stay hidden for shoppers."})]},F.label)})}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Tip: Total stock equals the sum of enabled size quantities."})]}):e.jsx("p",{className:"rounded-lg border border-dashed border-slate-200 bg-white px-3 py-2 text-[11px] text-slate-500",children:"Enable the toggle to manage per-size availability for this listing."})]}),e.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 bg-slate-50/60 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-slate-500",children:"Thumbnail"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload a primary image (max 2MB) that will be used as the card preview."})]}),e.jsxs("div",{className:`flex flex-col items-center justify-center rounded-2xl border-2 border-dashed px-4 py-8 text-center ${i.thumbnail?"border-blue-200 bg-white":"border-slate-200 bg-white"}`,children:[i.thumbnail?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i.thumbnail,alt:"Thumbnail preview",className:"h-28 w-28 rounded-2xl object-cover shadow-sm"}),e.jsx("button",{type:"button",onClick:()=>d(F=>({...F,thumbnail:""})),className:"absolute -right-2 -top-2 inline-flex items-center justify-center rounded-full bg-white px-2 py-1 text-[10px] font-semibold shadow-sm",children:"Remove"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-white shadow-sm",children:R?e.jsx(Ie,{className:"h-5 w-5 animate-spin text-blue-600"}):e.jsx(Xr,{className:"h-5 w-5 text-blue-500"})}),e.jsx("p",{className:"mt-3 text-xs text-slate-500",children:"Drag and drop image here, or click add image"})]}),e.jsxs("label",{className:"mt-4 inline-flex items-center gap-2 rounded-xl bg-blue-600 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-blue-700",children:[e.jsx(ra,{size:14}),i.thumbnail?"Replace Image":"Add Image",e.jsx("input",{type:"file",accept:"image/*",onChange:te,className:"hidden"})]})]})]}),e.jsxs("section",{className:"space-y-3 rounded-xl border border-slate-200 bg-slate-50/60 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-slate-500",children:"Gallery Images"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload multiple images (under 2MB each) for the product swiper."})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:(i.gallery||[]).map((F,U)=>e.jsxs("div",{className:"group relative overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm",children:[e.jsx("img",{src:F,alt:`Gallery ${U+1}`,className:"h-24 w-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>z(U),className:"absolute inset-x-2 bottom-2 rounded-lg bg-white/90 px-2 py-1 text-[10px] font-semibold text-slate-600 opacity-0 shadow-sm transition group-hover:opacity-100",children:"Remove"})]},`${F}-${U}`))}),e.jsxs("label",{className:"inline-flex items-center gap-2 rounded-xl border border-dashed border-blue-300 px-3 py-2 text-xs font-semibold text-blue-600 hover:bg-blue-50",children:[e.jsx(ra,{size:14}),I?"Uploading...":"Add Gallery Images",e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:y,className:"hidden"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:["Description",e.jsx("textarea",{value:i.description,onChange:L("description"),rows:3,className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"A short description about this product"})]}),(D||o)&&e.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-600",children:D||o}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:l,disabled:c,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:border-slate-300 disabled:opacity-60",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c,className:"inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 disabled:opacity-70",children:c?"Saving...":w})]})]})]})})})};Qa.propTypes={isOpen:me.bool.isRequired,mode:me.oneOf(["add","edit"]).isRequired,initialData:me.object,onClose:me.func.isRequired,onSubmit:me.func.isRequired,isSubmitting:me.bool,error:me.string};Qa.defaultProps={initialData:null,isSubmitting:!1,error:""};const pc=async(t={})=>(await fe.get("/admin/products",{params:t})).data,hc=async t=>(await fe.post("/admin/products",t)).data,fc=async(t,s)=>(await fe.put(`/admin/products/${t}`,s)).data,bc=async t=>(await fe.delete(`/admin/products/${t}`)).data,As=We("adminProducts/fetch",async(t,{rejectWithValue:s})=>{var a,l;try{return await pc(t)}catch(r){const c=((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||r.message||"Failed to fetch products";return s(c)}}),zl=We("adminProducts/create",async(t,{rejectWithValue:s})=>{var a,l;try{return await hc(t)}catch(r){const c=((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||r.message||"Failed to create product";return s(c)}}),Ol=We("adminProducts/update",async({id:t,payload:s},{rejectWithValue:a})=>{var l,r;try{return await fc(t,s)}catch(c){const o=((r=(l=c.response)==null?void 0:l.data)==null?void 0:r.message)||c.message||"Failed to update product";return a(o)}}),Tl=We("adminProducts/delete",async(t,{rejectWithValue:s})=>{var a,l;try{return await bc(t)}catch(r){const c=((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||r.message||"Failed to delete product";return s(c)}}),$l={search:"",productId:"",category:"",status:"",stockStatus:"",minPrice:"",maxPrice:"",minStock:"",maxStock:"",isFeatured:"",dateRange:{startDate:"",endDate:""}},wa={items:[],meta:{page:1,limit:20,total:0,totalPages:1,counts:{lowStock:0,outOfStock:0}},filters:$l,sort:{field:"createdAt",order:"desc"},selection:{allSelected:!1,selectedIds:[]},status:"idle",error:null},_l=Ft({name:"adminProducts",initialState:wa,reducers:{setFilters(t,s){t.filters={...t.filters,...s.payload},t.meta.page=1},clearFilters(t){t.filters={...$l},t.meta.page=1},setSort(t,s){t.sort=s.payload,t.meta.page=1},setPage(t,s){t.meta.page=s.payload},setLimit(t,s){t.meta.limit=s.payload,t.meta.page=1},toggleSelectAll(t,s){const{selectAll:a}=s.payload;t.selection.allSelected=a,t.selection.selectedIds=a?t.items.map(l=>l._id):[]},toggleSelectRow(t,s){const{id:a}=s.payload;t.selection.selectedIds.includes(a)?t.selection.selectedIds=t.selection.selectedIds.filter(l=>l!==a):t.selection.selectedIds.push(a),t.selection.allSelected=t.selection.selectedIds.length===t.items.length},resetSelection(t){t.selection={...wa.selection}}},extraReducers:t=>{t.addCase(As.pending,s=>{s.status="loading",s.error=null}).addCase(As.fulfilled,(s,a)=>{s.status="succeeded",s.items=a.payload.data||[],a.payload.meta&&(s.meta={...s.meta,...a.payload.meta}),s.selection={...wa.selection}}).addCase(As.rejected,(s,a)=>{var l;s.status="failed",s.error=((l=a.error)==null?void 0:l.message)||"Failed to load products"}).addCase(zl.fulfilled,(s,a)=>{s.items.unshift(a.payload.data),s.meta.total+=1,s.meta.totalPages=Math.max(Math.ceil(s.meta.total/s.meta.limit),1)}).addCase(Ol.fulfilled,(s,a)=>{const l=a.payload.data;s.items=s.items.map(r=>r._id===l._id?l:r)}).addCase(Tl.fulfilled,(s,a)=>{const{_id:l}=a.payload.data;s.items=s.items.filter(r=>r._id!==l),s.meta.total=Math.max(s.meta.total-1,0),s.meta.totalPages=Math.max(Math.ceil(s.meta.total/s.meta.limit),1)})}}),{setFilters:Ht,clearFilters:Qd,setSort:gc,setPage:yc,setLimit:Wd,toggleSelectAll:jc,toggleSelectRow:Nc,resetSelection:vc}=_l.actions,wc=_l.reducer,_s={published:"bg-emerald-100 text-emerald-700",archived:"bg-slate-300 text-slate-500"},Ms={in_stock:"bg-emerald-50 text-emerald-600",low_stock:"bg-amber-50 text-amber-600",out_of_stock:"bg-rose-50 text-rose-600",preorder:"bg-blue-50 text-blue-600"},Sc={hidden:{opacity:0,y:12},visible:{opacity:1,y:0}},Cc=[{label:"All Status",value:""},{label:"Published",value:"published"},{label:"Archived",value:"archived"}],kc=[{label:"All Stock",value:""},{label:"In Stock",value:"in_stock"},{label:"Low Stock",value:"low_stock"},{label:"Out of Stock",value:"out_of_stock"},{label:"Preorder",value:"preorder"}],Sa=({label:t,value:s,onChange:a,options:l,ariaLabel:r})=>{const[c,o]=n.useState(!1),i=n.useRef(null),d=n.useId(),p=n.useId(),x=l.find(g=>g.value===s)??l[0],D=x==null?void 0:x.fallbackLabel;return n.useEffect(()=>{const g=R=>{var u;(u=i.current)!=null&&u.contains(R.target)||o(!1)};return document.addEventListener("mousedown",g),document.addEventListener("touchstart",g),()=>{document.removeEventListener("mousedown",g),document.removeEventListener("touchstart",g)}},[]),e.jsxs("div",{className:"flex flex-col gap-1 text-xs font-medium text-slate-500",children:[e.jsx("span",{id:d,children:t}),e.jsxs("div",{ref:i,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>o(g=>!g),className:`inline-flex w-full items-center justify-between gap-2 rounded-xl border px-3 py-2 text-sm font-semibold transition focus:outline-none focus:ring-2 focus:ring-blue-100 ${c?"border-blue-400 bg-white text-blue-600":"border-slate-200 bg-white text-slate-600 hover:border-blue-300"}`,"aria-haspopup":"listbox","aria-expanded":c,"aria-labelledby":`${d} ${p}`,"aria-label":r,children:[e.jsx("span",{children:(x==null?void 0:x.label)||D||t}),e.jsx(xa,{size:14,className:`transition ${c?"rotate-180 text-blue-500":"text-slate-400"}`})]}),c&&e.jsx("div",{id:p,role:"listbox",className:"absolute left-0 top-[calc(100%+0.35rem)] z-30 w-48 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-lg",children:e.jsx("ul",{className:"max-h-48 overflow-y-auto py-1",children:l.map(g=>{const R=g.value===s;return e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{a(g.value),o(!1)},className:`flex w-full items-center justify-between px-3 py-2 text-xs font-semibold transition ${R?"bg-blue-50 text-blue-600":"text-slate-600 hover:bg-slate-50"}`,role:"option","aria-selected":R,children:[g.label||g.fallbackLabel||t,R&&e.jsx("span",{className:"text-[10px] font-bold uppercase text-blue-500",children:"Selected"})]})},g.value)})})})]})]})},Ac=()=>{var xe,je,we;const t=Te(),s=Es(),{items:a,meta:l,filters:r,sort:c,status:o,error:i,selection:d}=fa(_=>_.adminProducts),[p,x]=n.useState(!1),[D,g]=n.useState(r.search||""),[R,u]=n.useState(!1),[I,j]=n.useState(!1),[m,S]=n.useState(!1),[P,H]=n.useState(null),[E,w]=n.useState(""),[A,W]=n.useState(!1),[L,K]=n.useState(null),{user:O,logout:Y}=Qe(),[M,ee]=n.useState([]);n.useEffect(()=>{ee(_=>{const be=new Set(_);a.forEach(pe=>{pe!=null&&pe.category&&be.add(pe.category)}),r.category&&be.add(r.category);const ve=Array.from(be).sort((pe,$)=>pe.localeCompare($));return ve.length!==_.length||ve.some((pe,$)=>pe!==_[$])?ve:_})},[a,r.category]);const te=n.useMemo(()=>["",...M],[M]),y=n.useMemo(()=>{const _=(be,ve)=>be.map(de=>typeof de=="string"?{value:de,label:de||ve}:de);return{categories:_(te,"All Categories"),statuses:_(Cc,"All Status"),stocks:_(kc,"All Stock")}},[te]),z=n.useMemo(()=>{var be;const _={page:l.page,limit:l.limit,sortBy:c.field,sortOrder:c.order};return(be=r.search)!=null&&be.trim()&&(_.search=r.search.trim()),r.status&&(_.status=r.status),r.stockStatus&&(_.stockStatus=r.stockStatus),r.category&&(_.category=r.category),r.dateRange.startDate&&(_.startDate=r.dateRange.startDate),r.dateRange.endDate&&(_.endDate=r.dateRange.endDate),_},[r,l.limit,l.page,c.field,c.order]);n.useEffect(()=>{s(As(z))},[s,z]);const b=_=>{const be=_.target.value;g(be),s(Ht({search:be}))},C=()=>{if(!a.length){ge.error("No products to export");return}try{const _=["Name","ID","Category","Brand","Price","Original Price","Discount %","Stock","Availability","Status"],be=a.map(ce=>{const he=Number(ce.price??0),Pe=Number(ce.originalPrice??ce.price??0),$e=Number(ce.discountPercentage??0);return[ce.name||"",ce._id||"",ce.category||"",ce.brand||"",he.toString(),Pe.toString(),$e.toString(),(ce.stock??0).toString(),ce.availabilityStatus||"",ce.status||""].map(Me=>`"${String(Me).replace(/"/g,'""')}"`).join(",")}),ve=[_.join(","),...be].join(`
`),de=new Blob([ve],{type:"text/csv;charset=utf-8;"});if(typeof window>"u"){ge.error("Export is only available in the browser");return}const pe=window.URL.createObjectURL(de),$=document.createElement("a");$.href=pe,$.setAttribute("download",`products_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild($),$.click(),document.body.removeChild($),window.URL.revokeObjectURL(pe),ge.success("Exported products as CSV")}catch(_){console.error("Failed to export products",_),ge.error("Failed to export products")}},B=_=>{const ve=c.field===_&&c.order==="asc"?"desc":"asc";s(gc({field:_,order:ve}))},re=_=>{s(jc({selectAll:_.target.checked}))},se=_=>{s(Nc({id:_}))},X=_=>{s(yc(_))},F=_=>{s(Ht({category:_}))},U=_=>{s(Ht({status:_}))},h=_=>{s(Ht({stockStatus:_}))},k=(_,be)=>{s(Ht({dateRange:{...r.dateRange,[_]:be}}))},f=()=>{s(Ht({search:"",category:"",status:"",stockStatus:"",dateRange:{startDate:"",endDate:""}})),g("")};n.useEffect(()=>()=>{s(vc())},[s]),n.useEffect(()=>{if(typeof document>"u"||!(m||!!L))return;const be=document.body,ve=be.style.overflow,de=be.style.paddingRight,pe=window.innerWidth-document.documentElement.clientWidth;return be.style.overflow="hidden",pe>0&&(be.style.paddingRight=`${pe}px`),()=>{be.style.overflow=ve,be.style.paddingRight=de}},[m,L]);const G=o==="loading",le=!G&&a.length===0,Z=n.useMemo(()=>{var ve,de;if(!P)return null;const _=pe=>!pe||typeof pe!="string"||pe.startsWith("http")?pe:`https://s3.ap-south-1.amazonaws.com/ecom-mega-mart/${pe.replace(/^\/+/,"")}`,be=Array.isArray(P.gallery)?P.gallery:Array.isArray(P.images)?P.images:[];return{name:P.name||"",sku:P.sku||P.id||"",category:P.category||"",categoryPriority:P.categoryPriority||"P5",brand:P.brand||"",price:P.price??"",originalPrice:P.originalPrice??"",discountPercentage:P.discountPercentage??"",saveAmount:P.saveAmount??"",hsnCode:P.hsnCode??"",gstRate:P.gstRate!==void 0&&P.gstRate!==null?P.gstRate:"",rating:P.rating??((ve=P.ratings)==null?void 0:ve.average)??"",reviews:P.reviews??((de=P.ratings)==null?void 0:de.totalReviews)??"",stock:P.stock??"",status:P.status||"published",availabilityStatus:P.availabilityStatus||"in_stock",thumbnail:_(P.thumbnail||P.image||P.imageUrl||""),description:P.description||"",gallery:be.map(pe=>_(pe)),isFeatured:!!P.isFeatured,keyFeatures:Array.isArray(P.keyFeatures)?P.keyFeatures:[],sizes:Array.isArray(P.sizes)?P.sizes.map(pe=>({label:(pe==null?void 0:pe.label)??"",isAvailable:!!((pe==null?void 0:pe.isAvailable)??!0),stock:Math.max(Number((pe==null?void 0:pe.stock)??0),0)})):[],showSizes:!!P.showSizes}},[P]),ie=()=>{S(!1),H(null),w("")},N=_=>{H(_),w(""),S(!0)},V=_=>{K(_)},v=()=>{K(null)},q=async _=>{if(P!=null&&P._id){W(!0),w("");try{await s(Ol({id:P._id,payload:_})).unwrap(),ge.success("Product updated successfully."),ie()}catch(be){const ve=(be==null?void 0:be.message)||be||"Unable to save product. Please try again.";w(ve),ge.error(ve)}finally{W(!1)}}},J=async _=>{if(window.confirm(`Delete product "${_.name}"? This action cannot be undone.`))try{await s(Tl(_._id)).unwrap(),ge.success("Product deleted successfully.")}catch(ve){const de=(ve==null?void 0:ve.message)||ve||"Failed to delete product. Please try again.";ge.error(de)}};return e.jsxs("div",{className:"min-h-screen md:h-screen bg-slate-50 text-slate-900 overflow-x-hidden",children:[e.jsxs("div",{className:"flex md:h-screen",children:[e.jsx(Ue,{active:"Products",className:"hidden md:flex md:w-64 md:flex-none",onNavigate:()=>x(!1)}),e.jsx(ze,{children:p&&e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx(Q.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(Ue,{active:"Products",className:"flex w-full",onNavigate:()=>x(!1)})}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"flex-1 bg-black/30","aria-label":"Close sidebar"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(nt,{onToggleSidebar:()=>x(_=>!_),activeRange:"All Date",onSelectRange:()=>{},adminName:(O==null?void 0:O.name)||(O==null?void 0:O.username)||"Admin",adminRole:(O==null?void 0:O.role)==="admin"?"Administrator":O==null?void 0:O.role,notifications:{pendingOrders:0,shippedOrders:0,deliveredOrders:0},showRangeSelector:!1,showNotifications:!1,onLogout:Y}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-4 py-6 md:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Dashboard / Products"}),e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Products"})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center",children:[e.jsxs("button",{type:"button",onClick:C,className:"inline-flex w-full items-center justify-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 hover:border-blue-200 hover:text-blue-600 sm:w-auto",children:[e.jsx(jt,{size:16}),"Export"]}),e.jsxs("button",{type:"button",onClick:()=>t("/admin/products/new"),className:"inline-flex w-full items-center justify-center gap-2 rounded-xl bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:w-auto",children:[e.jsx(ft,{size:16}),"Add Product"]})]})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Total Products"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold",children:l.total})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Low Stock"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-amber-600",children:((xe=l.counts)==null?void 0:xe.lowStock)??0})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Out of Stock"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-rose-600",children:((je=l.counts)==null?void 0:je.outOfStock)??0})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Selected"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-blue-600",children:d.selectedIds.length})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[e.jsx("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-1 lg:flex-row lg:items-center",children:[e.jsxs("div",{className:"flex w-full items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm",children:[e.jsx(Zt,{size:16,className:"text-slate-400"}),e.jsx("input",{value:D,onChange:b,placeholder:"Search product name or ID",className:"w-full bg-transparent outline-none placeholder:text-slate-400"})]}),e.jsxs("div",{className:"relative w-full sm:w-auto",children:[e.jsxs("button",{type:"button",className:"inline-flex w-full items-center justify-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 hover:border-blue-200 hover:text-blue-600 sm:w-auto",onClick:()=>j(_=>!_),children:[e.jsx(Ds,{size:16}),"Select Dates"]}),I&&e.jsx("div",{className:"absolute left-0 z-20 mt-2 w-full min-w-[16rem] rounded-2xl border border-slate-200 bg-white p-4 shadow-lg sm:w-64",children:e.jsxs("div",{className:"flex flex-col gap-3 text-sm",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"Start Date"}),e.jsx("input",{type:"date",value:r.dateRange.startDate,onChange:_=>k("startDate",_.target.value),className:"rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"End Date"}),e.jsx("input",{type:"date",value:r.dateRange.endDate,onChange:_=>k("endDate",_.target.value),className:"rounded-lg border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"})]})]})})]}),e.jsxs("button",{type:"button",className:`inline-flex w-full items-center justify-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium transition sm:w-auto ${R?"border-blue-200 text-blue-600":"text-slate-600 hover:border-blue-200 hover:text-blue-600"}`,onClick:()=>u(_=>!_),children:[e.jsx(Jr,{size:16}),"Filters"]})]})}),e.jsx(ze,{children:R&&e.jsxs(Q.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},className:"mt-3 grid gap-3 md:grid-cols-4",children:[e.jsx(Sa,{label:"Category",value:r.category,onChange:F,options:y.categories,ariaLabel:"Filter products by category"}),e.jsx(Sa,{label:"Status",value:r.status,onChange:U,options:y.statuses,ariaLabel:"Filter products by status"}),e.jsx(Sa,{label:"Stock Status",value:r.stockStatus,onChange:h,options:y.stocks,ariaLabel:"Filter products by stock status"}),e.jsx("div",{className:"flex flex-col items-end md:flex-row md:items-center md:justify-end",children:e.jsx("button",{type:"button",onClick:f,className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 hover:border-blue-200 hover:text-blue-600 md:w-auto",children:"Clear Filters"})})]})}),e.jsx("div",{className:"relative mt-4 hidden overflow-x-auto rounded-2xl border border-slate-100 md:block",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[e.jsx("thead",{className:"bg-slate-50/70",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500",checked:d.allSelected,onChange:re,"aria-label":"Select all products"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"id"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 font-semibold text-slate-500",onClick:()=>B("price"),children:["Price",e.jsx(fn,{size:14})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Featured"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Added"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:e.jsxs(ze,{children:[G&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-10 text-center text-slate-500",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx(Ie,{className:"h-4 w-4 animate-spin"}),"Loading products..."]})})}),!G&&i&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-10 text-center text-rose-600",children:i})}),le&&!i&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-10 text-center text-slate-500",children:"No products found. Try adjusting your filters."})}),!G&&!i&&a.map(_=>{var $;const be=_s[_.status]||_s.published,ve=Ms[_.availabilityStatus]||Ms.in_stock,de=Number(_.price||0).toLocaleString("en-IN",{style:"currency",currency:_.currency||"INR",minimumFractionDigits:2}),pe=_.createdAt?new Date(_.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"--";return e.jsxs(Q.tr,{initial:"hidden",animate:"visible",variants:Sc,className:"hover:bg-slate-50/70",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500",checked:d.selectedIds.includes(_._id),onChange:()=>se(_._id),"aria-label":`Select ${_.name}`})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 overflow-hidden rounded-xl border border-slate-100 bg-slate-50",children:e.jsx("img",{src:_.thumbnail||_.imageUrl,alt:_.name,className:"h-full w-full object-cover",onError:ce=>{ce.currentTarget.src="https://placehold.co/96x96/f8fafc/e2e8f0?text=IMG"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:_.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[(($=_.variants)==null?void 0:$.length)||0," Variants"]})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:_._id||"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:_.category||"--"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-medium ${ve}`,children:_.stock??0})}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-slate-900",children:de}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-semibold ${_.isFeatured?"bg-blue-50 text-blue-600":"bg-slate-100 text-slate-500"}`,children:[e.jsx($t,{size:12,className:_.isFeatured?"text-blue-500 fill-blue-400":"text-slate-400"}),_.isFeatured?"Featured":"Standard"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold ${be}`,children:_.status?_.status.charAt(0).toUpperCase()+_.status.slice(1):"Published"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-500",children:pe}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-end gap-2 text-slate-400",children:[e.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-transparent hover:border-blue-200 hover:text-blue-600","aria-label":"View product",onClick:()=>V(_),children:e.jsx(et,{size:16})}),e.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-transparent hover:border-blue-200 hover:text-blue-600","aria-label":"Edit product",onClick:()=>N(_),children:e.jsx(Cs,{size:16})}),e.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-transparent hover:border-rose-200 hover:text-rose-600","aria-label":"Delete product",onClick:()=>J(_),children:e.jsx(Je,{size:16})})]})})]},_._id)})]})})]})}),e.jsx("div",{className:"mt-4 space-y-3 md:hidden",children:e.jsxs(ze,{children:[G&&e.jsx(Q.div,{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-slate-500",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx(Ie,{className:"h-4 w-4 animate-spin"}),"Loading products..."]})}),!G&&i&&e.jsx(Q.div,{className:"rounded-2xl border border-rose-200 bg-white p-6 text-center text-rose-600",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:i}),le&&!i&&e.jsx(Q.div,{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-slate-500",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:"No products found. Try adjusting your filters."}),!G&&!i&&a.map(_=>{const be=_s[_.status]||_s.published,ve=Ms[_.availabilityStatus]||Ms.in_stock,de=Number(_.price||0).toLocaleString("en-IN",{style:"currency",currency:_.currency||"INR",minimumFractionDigits:2}),pe=_.createdAt?new Date(_.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"--";return e.jsxs(Q.div,{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:.2},children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500",checked:d.selectedIds.includes(_._id),onChange:()=>se(_._id),"aria-label":`Select ${_.name}`}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-16 w-16 overflow-hidden rounded-xl border border-slate-100 bg-slate-50",children:e.jsx("img",{src:_.thumbnail||_.imageUrl,alt:_.name,className:"h-full w-full object-cover",onError:$=>{$.currentTarget.src="https://placehold.co/96x96/f8fafc/e2e8f0?text=IMG"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:_.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["ID: ",_._id||"--"]})]})]})]}),e.jsx("span",{className:`inline-flex max-w-full items-center rounded-full px-3 py-1 text-xs font-semibold ${be}`,children:_.status?_.status.charAt(0).toUpperCase()+_.status.slice(1):"Published"})]}),e.jsxs("div",{className:"mt-4 grid gap-2 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs uppercase text-slate-400",children:"Category"}),e.jsx("span",{className:"font-medium",children:_.category||"--"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs uppercase text-slate-400",children:"Price"}),e.jsx("span",{className:"font-semibold text-slate-900",children:de})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs uppercase text-slate-400",children:"Featured"}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-semibold ${_.isFeatured?"bg-blue-50 text-blue-600":"bg-slate-100 text-slate-500"}`,children:[e.jsx($t,{size:12,className:_.isFeatured?"text-blue-500 fill-blue-400":"text-slate-400"}),_.isFeatured?"Yes":"No"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs uppercase text-slate-400",children:"Stock"}),e.jsx("span",{className:`inline-flex min-w-[64px] items-center justify-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${ve}`,children:_.stock??0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs uppercase text-slate-400",children:"Added"}),e.jsx("span",{children:pe})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-end gap-2",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600",onClick:()=>V(_),children:[e.jsx(et,{size:14})," View"]}),e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600",onClick:()=>N(_),children:[e.jsx(Cs,{size:14})," Edit"]}),e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 px-3 py-2 text-xs font-semibold text-rose-600 hover:border-rose-300",onClick:()=>J(_),children:[e.jsx(Je,{size:14})," Delete"]})]})]},_._id)})]})}),!G&&!le&&!i&&e.jsxs("div",{className:"flex flex-col gap-3 pt-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("p",{className:"text-xs text-slate-500",children:["Showing ",(l.page-1)*l.limit+1,"-",Math.min(l.page*l.limit,l.total)," of"," ",l.total]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"inline-flex items-center gap-1 rounded-lg border border-slate-200 px-3 py-1 text-xs font-medium text-slate-600 disabled:opacity-50",disabled:l.page===1,onClick:()=>X(l.page-1),children:"Prev"}),Array.from({length:l.totalPages},(_,be)=>be+1).map(_=>e.jsx("button",{type:"button",onClick:()=>X(_),className:`inline-flex h-8 w-8 items-center justify-center rounded-lg text-xs font-semibold ${_===l.page?"bg-blue-600 text-white":"border border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`,children:_},_)),e.jsx("button",{type:"button",className:"inline-flex items-center gap-1 rounded-lg border border-slate-200 px-3 py-1 text-xs font-medium text-slate-600 disabled:opacity-50",disabled:l.page>=l.totalPages,onClick:()=>X(l.page+1),children:"Next"})]})]})]})]})]})]}),e.jsx(Qa,{isOpen:m,mode:"edit",initialData:Z,onClose:ie,onSubmit:q,isSubmitting:A,error:E}),e.jsx(ze,{children:L&&e.jsx(Q.div,{className:"fixed inset-0 z-50 flex items-start justify-center bg-slate-900/40 px-4 py-8 md:items-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(Q.div,{className:"relative w-full max-w-3xl rounded-3xl bg-white shadow-2xl md:my-0 max-h-[calc(100vh-4rem)] overflow-y-auto",initial:{scale:.95,opacity:0,y:24},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:24},transition:{type:"spring",stiffness:220,damping:26},children:[e.jsx("button",{type:"button",onClick:v,className:"absolute right-4 top-4 inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600","aria-label":"Close",children:e.jsx(Ze,{size:18})}),e.jsxs("div",{className:"grid gap-6 px-6 pb-6 pt-12 md:grid-cols-[1.2fr,1fr]",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Product"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:L.name||"Untitled product"}),e.jsxs("p",{className:"mt-1 text-sm text-slate-500",children:["ID: ",L._id||"--"]})]}),e.jsx("span",{className:"inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-xs font-medium text-slate-600",children:L.category||"No category"})]}),e.jsxs("div",{className:"space-y-3 rounded-2xl border border-slate-200 bg-slate-50/60 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[e.jsxs("div",{className:"rounded-xl bg-white px-3 py-2 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Price"}),e.jsxs("p",{className:"text-base font-semibold text-slate-900",children:["₹",Number(L.price??0).toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"rounded-xl bg-white px-3 py-2 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Stock"}),e.jsx("p",{className:"text-base font-semibold text-slate-900",children:L.stock??0})]}),e.jsxs("div",{className:"rounded-xl bg-white px-3 py-2 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Availability"}),e.jsx("p",{className:"text-base font-semibold text-slate-900",children:L.availabilityStatus||"--"})]}),e.jsxs("div",{className:"rounded-xl bg-white px-3 py-2 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Status"}),e.jsx("p",{className:"text-base font-semibold text-slate-900",children:L.status||"--"})]}),e.jsxs("div",{className:"rounded-xl bg-white px-3 py-2 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Featured"}),e.jsxs("p",{className:"mt-1 inline-flex items-center gap-1 text-sm font-semibold text-slate-900",children:[e.jsx($t,{size:14,className:L.isFeatured?"text-blue-500 fill-blue-400":"text-slate-300"}),L.isFeatured?"Yes":"No"]})]})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Brand"}),e.jsx("p",{className:"mt-1 text-sm font-medium text-slate-800",children:L.brand||"--"})]}),e.jsxs("div",{className:"rounded-xl bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Discount"}),e.jsxs("p",{className:"mt-1 text-sm font-medium text-slate-800",children:[Number(L.discountPercentage??0),"%"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Description"}),e.jsx("p",{className:"rounded-2xl border border-slate-200 bg-white p-4 text-sm leading-relaxed text-slate-600",children:L.description||"No description provided."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Metadata"}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-3 text-sm text-slate-600",children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-slate-400",children:"Rating"}),e.jsx("p",{className:"mt-1 text-base font-semibold text-slate-900",children:Number(L.rating??0).toFixed(1)})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-3 text-sm text-slate-600",children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-slate-400",children:"Reviews"}),e.jsx("p",{className:"mt-1 text-base font-semibold text-slate-900",children:L.reviews??0})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"overflow-hidden rounded-2xl border border-slate-200 bg-slate-50",children:e.jsx("img",{src:L.thumbnail||L.imageUrl||((we=L.gallery)==null?void 0:we[0])||"https://placehold.co/600x600/f8fafc/e2e8f0?text=Image",alt:L.name,className:"h-64 w-full object-cover",onError:_=>{_.currentTarget.src="https://placehold.co/600x600/f8fafc/e2e8f0?text=Image"}})}),Array.isArray(L.gallery)&&L.gallery.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Gallery"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:L.gallery.map((_,be)=>e.jsx("div",{className:"overflow-hidden rounded-xl border border-slate-200 bg-white",children:e.jsx("img",{src:_,alt:`${L.name||"Product"} ${be+1}`,className:"h-24 w-full object-cover",onError:ve=>{ve.currentTarget.src="https://placehold.co/200x200/f8fafc/e2e8f0?text=Image"}})},`${_}-${be}`))})]}),e.jsxs("button",{type:"button",onClick:()=>{v(),N(L)},className:"inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700",children:[e.jsx(Cs,{size:16}),"Edit Product"]})]})]})]})})})]})},Pc=[{label:"Published",value:"published"},{label:"Archived",value:"archived"}],Dc=[{label:"In Stock",value:"in_stock"},{label:"Low Stock",value:"low_stock"},{label:"Out of Stock",value:"out_of_stock"},{label:"Preorder",value:"preorder"}],Ml=["S","M","L","XL","XXL"],Rc=[{matcher:/keychain/i,hsnCode:"8305",gstRate:18},{matcher:/ceramic\s+coffee\s+mug|coffee\s+mug|mug/i,hsnCode:"6912",gstRate:12},{matcher:/executive\s+diary|pen\s+set/i,hsnCode:"4820",gstRate:18},{matcher:/white\s+logo\s+cap|cap/i,hsnCode:"6501",gstRate:18},{matcher:/diary/i,hsnCode:"4820",gstRate:18},{matcher:/\bpen\b/i,hsnCode:"9608",gstRate:18},{matcher:/t\s*-?shirt|polo/i,hsnCode:"6109",gstRate:5}],Ic=(t="")=>{const s=t.toString().trim();return s&&Rc.find(a=>a.matcher.test(s))||null},Xt=t=>{if(t==null)return"P5";const s=t.toString().trim().toUpperCase();if(/^P\d{1,2}$/.test(s))return s;const a=parseInt(s.replace(/[^0-9]/g,""),10);return!Number.isNaN(a)&&a>0?`P${a}`:"P5"},Fc=t=>{const s=Xt(t),a=parseInt(s.slice(1),10);return Number.isNaN(a)?Number.POSITIVE_INFINITY:a},ca=()=>Ml.map(t=>({label:t,isAvailable:!0,stock:0})),Pt=t=>{if(!Array.isArray(t)||!t.length)return ca();const s=new Set,a=t.map(l=>{var c;const r=(c=l==null?void 0:l.label)==null?void 0:c.toString().trim().toUpperCase();return!r||s.has(r)?null:(s.add(r),{label:r,isAvailable:!!((l==null?void 0:l.isAvailable)??!0),stock:Math.max(Number((l==null?void 0:l.stock)??0),0)})}).filter(Boolean);return Ml.forEach(l=>{s.has(l)||a.push({label:l,isAvailable:!0,stock:0})}),a.length?a:ca()},Gt=t=>(Array.isArray(t)?t:[]).reduce((a,l)=>{if(!l||!l.isAvailable)return a;const r=Number(l.stock??0);return Number.isFinite(r)?a+Math.max(r,0):a},0),dt={name:"",sku:"",description:"",category:"",brand:"",status:"published",availabilityStatus:"in_stock",price:"",originalPrice:"",discountPercentage:"",saveAmount:"",stock:"",lowStockThreshold:"",thumbnail:"",gallery:[],isFeatured:!1,keyFeatures:[""],sizes:ca(),showSizes:!0,categoryPriority:"",hsnCode:"",gstRate:""},Qs="adminAddProductFormState",Ec=()=>{if(typeof window>"u")return dt;try{const t=window.localStorage.getItem(Qs);if(!t)return dt;const s=JSON.parse(t),{rating:a,reviews:l,hsnCode:r,gstRate:c,...o}=s||{},i=Array.isArray(s.keyFeatures)&&s.keyFeatures.length?[...s.keyFeatures]:[""],d=Array.isArray(s.gallery)?[...s.gallery]:[];return{...dt,...o,keyFeatures:i,gallery:d,isFeatured:!!s.isFeatured,showSizes:typeof s.showSizes=="boolean"?s.showSizes:dt.showSizes,sizes:Pt(s.sizes),categoryPriority:(()=>{const p=s.categoryPriority;return typeof p=="string"&&p.trim()?Xt(p):dt.categoryPriority})(),hsnCode:typeof r=="string"?r:r!=null?String(r):dt.hsnCode,gstRate:c!=null&&c!==""?String(c):dt.gstRate}}catch(t){return console.warn("Failed to restore saved admin add product form",t),dt}},Lc=()=>{const t=Es(),s=Te(),{items:a}=fa(N=>N.adminProducts),[l,r]=n.useState(()=>Ec()),[c,o]=n.useState(!1),[i,d]=n.useState({}),[p,x]=n.useState(!1),[D,g]=n.useState(!1),[R,u]=n.useState(!1),{user:I,logout:j}=Qe(),[m,S]=n.useState(!1),[P,H]=n.useState(!1),[E,w]=n.useState(!1),A=()=>{r(dt),o(!1),H(!1),w(!1),d({}),typeof window<"u"&&window.localStorage.removeItem(Qs),s("/admin/products")};n.useEffect(()=>{if(!(typeof window>"u"))try{const{rating:N,reviews:V,...v}=l,q=Pt(l.sizes),J={...v,keyFeatures:Array.isArray(l.keyFeatures)&&l.keyFeatures.length?l.keyFeatures:[""],gallery:Array.isArray(l.gallery)?l.gallery:[],sizes:q,showSizes:!!l.showSizes,categoryPriority:(()=>{const xe=l.categoryPriority;return typeof xe=="string"&&xe.trim()?Xt(xe):""})()};window.localStorage.setItem(Qs,JSON.stringify(J))}catch(N){console.warn("Failed to persist admin add product form",N)}},[l]),n.useEffect(()=>{a.length||t(As({limit:100}))},[t,a.length]);const W=n.useMemo(()=>{const N=new Set;return a.forEach(V=>{V.category&&N.add(V.category)}),Array.from(N)},[a]),L=n.useMemo(()=>{const N=new Map;return a.forEach(V=>{var je;const v=(je=V==null?void 0:V.category)==null?void 0:je.toString().trim();if(!v)return;const q=Xt(V==null?void 0:V.categoryPriority),J=Fc(q),xe=N.get(v);(!xe||J<xe.numeric)&&N.set(v,{label:q,numeric:J})}),N},[a]),K=n.useMemo(()=>{const N=new Set;return a.forEach(V=>{V.brand&&N.add(V.brand)}),Array.from(N)},[a]),O=n.useMemo(()=>Pt(l.sizes),[l.sizes]),Y=n.useMemo(()=>Gt(O),[O]),M=["out_of_stock","preorder"],ee=N=>M.includes(N),te=N=>V=>{const v=V.target.value;N==="categoryPriority"?o(!0):N==="category"&&o(!1),r(q=>{const J={...q,[N]:v};if(N==="availabilityStatus")if(ee(v))J.stock="0";else{const xe=Gt(Pt(q.sizes));J.stock=xe.toString()}if(N==="category"){const xe=v==null?void 0:v.toString().trim();if(!xe)J.categoryPriority=dt.categoryPriority;else{const je=L.get(xe);J.categoryPriority=je?je.label:dt.categoryPriority}}if(N==="name"){const xe=Ic(v);xe&&((!P||!q.hsnCode)&&(J.hsnCode=xe.hsnCode,H(!1)),(!E||!q.gstRate)&&(J.gstRate=xe.gstRate.toString(),w(!1)))}return J})},y=N=>V=>{const v=V.target.value;N==="hsnCode"&&H(!0),N==="gstRate"&&w(!0),r(q=>({...q,[N]:v}))},z=N=>V=>{const{checked:v}=V.target;r(q=>{if(N==="showSizes"){const J=Gt(Pt(q.sizes));return{...q,[N]:v,stock:v&&!ee(q.availabilityStatus)?J.toString():q.stock}}return{...q,[N]:v}})},b=N=>V=>{const{value:v}=V.target;r(q=>{const J={...q,[N]:v},xe=N==="price"?v:J.price,je=N==="originalPrice"?v:J.originalPrice,we=parseFloat(xe),_=parseFloat(je);if(!Number.isNaN(we)&&!Number.isNaN(_)&&_>=we&&_>0){const be=_-we;J.discountPercentage=Math.round(be/_*100).toString(),J.saveAmount=be.toFixed(2)}else J.discountPercentage="",J.saveAmount="";return J})},C=3*1024*1024,B=N=>new Promise((V,v)=>{const q=new FileReader;q.onload=()=>V(q.result),q.onerror=()=>v(new Error("Failed to read file")),q.readAsDataURL(N)}),re=async N=>{var v;const V=(v=N.target.files)==null?void 0:v[0];if(V){if(!V.type.startsWith("image/")){ge.error("Please upload an image file"),N.target.value="";return}if(V.size>C){ge.error("Image must be smaller than 3MB"),N.target.value="";return}g(!0);try{const q=await B(V);r(J=>({...J,thumbnail:q})),ge.success("Thumbnail added")}catch{ge.error("Failed to load image")}finally{g(!1),N.target.value=""}}},se=async N=>{const V=Array.from(N.target.files||[]);if(!V.length)return;if(V.some(J=>!J.type.startsWith("image/"))){ge.error("All files must be images"),N.target.value="";return}if(V.find(J=>J.size>C)){ge.error("Each image must be under 3MB"),N.target.value="";return}u(!0);try{const J=await Promise.all(V.map(B));r(xe=>{const je=Array.isArray(xe.gallery)?xe.gallery:[],we=J.filter(_=>!je.includes(_));return{...xe,gallery:[...je,...we]}}),ge.success(`Added ${J.length} image${J.length>1?"s":""}`)}catch{ge.error("Failed to load gallery images")}finally{u(!1),N.target.value=""}},X=N=>{r(V=>{const v=(V.gallery||[]).filter((q,J)=>J!==N);return{...V,gallery:v}})},F=N=>{r(V=>{const q=Pt(V.sizes).map(xe=>xe.label===N?{...xe,isAvailable:!xe.isAvailable}:xe),J=Gt(q);return{...V,sizes:q,stock:ee(V.availabilityStatus)?V.stock:J.toString()}})},U=N=>V=>{const q=(V.target.value??"").toString().replace(/[^0-9]/g,""),J=Math.max(Number(q||0),0);r(xe=>{const we=Pt(xe.sizes).map(be=>be.label===N?{...be,stock:J}:be),_=Gt(we);return{...xe,sizes:we,stock:ee(xe.availabilityStatus)?xe.stock:_.toString()}})},h=()=>{r(N=>{const V=ca(),v=Gt(V);return{...N,sizes:V,stock:ee(N.availabilityStatus)?N.stock:v.toString()||"0"}})};n.useEffect(()=>{var v;const N=(v=l.category)==null?void 0:v.toString().trim();if(!N||c)return;const V=L.get(N);V&&r(q=>{var je;return((je=q.category)==null?void 0:je.toString().trim())!==N||Xt(q.categoryPriority)===V.label?q:{...q,categoryPriority:V.label}})},[L,l.category,c]);const k=(N,V)=>{r(v=>{const q=Array.isArray(v.keyFeatures)?[...v.keyFeatures]:[""];return q[N]=V,{...v,keyFeatures:q}})},f=()=>{r(N=>({...N,keyFeatures:Array.isArray(N.keyFeatures)?[...N.keyFeatures,""]:["",""]}))},G=N=>{r(V=>{const v=Array.isArray(V.keyFeatures)?V.keyFeatures.filter((q,J)=>J!==N):[];return{...V,keyFeatures:v.length?v:[""]}})},le=()=>{const N={};if(l.name.trim()||(N.name="Product name is required"),l.description.trim()||(N.description="Product description is required"),l.sku.trim()||(N.sku="Product ID is required"),l.category.trim()||(N.category="Select a category"),l.categoryPriority.trim()||(N.categoryPriority="Set a priority (e.g. P1, P2)"),l.brand.trim()||(N.brand="Brand is required"),l.hsnCode&&!/^\d{2,}$/i.test(l.hsnCode.trim())&&(N.hsnCode="HSN code should contain at least 2 digits"),l.gstRate!==""){const xe=Number(l.gstRate);(Number.isNaN(xe)||xe<0||xe>100)&&(N.gstRate="GST rate must be between 0 and 100")}if((!l.price||Number(l.price)<=0)&&(N.price="Enter a valid price"),l.originalPrice){const xe=Number(l.price||0),je=Number(l.originalPrice);Number.isNaN(je)||je<=0?N.originalPrice="Original price must be a positive number":je<xe&&(N.originalPrice="Original price should be greater than or equal to price")}const V=ee(l.availabilityStatus),v=Number(l.stock);return!(l.stock!==""&&!Number.isNaN(v))||v<0?N.stock=V?"Stock is managed automatically":"Enter available stock":!V&&v===0&&(N.stock="Enter available stock"),l.thumbnail.trim()||(N.thumbnail="Upload at least one image"),(!Array.isArray(l.gallery)||l.gallery.length===0)&&(N.gallery="Add at least one gallery image"),(Array.isArray(l.keyFeatures)?l.keyFeatures.map(xe=>xe.trim()).filter(Boolean):[]).length||(N.keyFeatures="Add at least one key feature"),l.showSizes&&(Pt(l.sizes).filter(je=>je.isAvailable).length||(N.sizes="Enable at least one size or turn off the size selector")),d(N),Object.keys(N).length===0},Z=async N=>{var q;if(N.preventDefault(),!le()){ge.error("Please fix the highlighted fields");return}x(!0);const V={name:l.name.trim(),description:l.description.trim(),category:l.category,brand:l.brand,status:l.status,availabilityStatus:l.availabilityStatus,price:Number(l.price),originalPrice:l.originalPrice?Number(l.originalPrice):void 0,discountPercentage:l.discountPercentage?Number(l.discountPercentage):void 0,saveAmount:l.saveAmount?Number(l.saveAmount):void 0,sku:l.sku.trim(),stock:ee(l.availabilityStatus)?0:Number(l.stock),lowStockThreshold:l.lowStockThreshold?Number(l.lowStockThreshold):void 0,thumbnail:l.thumbnail,gallery:l.gallery,isFeatured:!!l.isFeatured,keyFeatures:Array.isArray(l.keyFeatures)?l.keyFeatures.map(J=>J.trim()).filter(Boolean):[],sizes:O,showSizes:!!l.showSizes,categoryPriority:Xt(l.categoryPriority)},v=(q=l.hsnCode)==null?void 0:q.toString().trim();if(v&&(V.hsnCode=v),l.gstRate!==""){const J=Number(l.gstRate);Number.isNaN(J)||(V.gstRate=J)}try{await t(zl(V)).unwrap(),ge.success("Product added successfully!"),typeof window<"u"&&window.localStorage.removeItem(Qs),s("/admin/products")}catch(J){const xe=(J==null?void 0:J.message)||"Failed to create product. Please try again.";ge.error(xe)}finally{x(!1)}},ie=ee(l.availabilityStatus);return e.jsx("div",{className:"min-h-screen md:h-screen bg-slate-50 text-slate-900 overflow-x-hidden",children:e.jsxs("div",{className:"flex md:h-screen",children:[e.jsx(Ue,{active:"Products",className:"hidden md:flex md:w-64 md:flex-none",onNavigate:()=>S(!1)}),e.jsx(ze,{children:m&&e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx(Q.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(Ue,{active:"Products",className:"flex w-full",onNavigate:()=>S(!1)})}),e.jsx("button",{type:"button",onClick:()=>S(!1),className:"flex-1 bg-black/30","aria-label":"Close sidebar"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(nt,{onToggleSidebar:()=>S(N=>!N),activeRange:"All Date",onSelectRange:()=>{},adminName:(I==null?void 0:I.name)||(I==null?void 0:I.username)||"Admin",adminRole:(I==null?void 0:I.role)==="admin"?"Administrator":I==null?void 0:I.role,notifications:{pendingOrders:0,shippedOrders:0,deliveredOrders:0},showRangeSelector:!1,showNotifications:!1,onLogout:j}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-4 py-6 md:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Dashboard / Product / Add Product"}),e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Add Product"})]}),e.jsxs("button",{type:"button",onClick:A,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 hover:border-blue-200 hover:text-blue-600",children:[e.jsx(_t,{size:16}),"Cancel"]})]}),e.jsxs("form",{onSubmit:Z,className:"mt-6 grid gap-6 lg:grid-cols-[2fr,1fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"General Information"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Product ID"}),e.jsx("input",{type:"text",value:l.sku,onChange:te("sku"),className:`mt-1 w-full rounded-xl border px-3 py-2 text-sm uppercase tracking-wide focus:border-blue-400 focus:outline-none ${i.sku?"border-rose-300":"border-slate-200"}`,placeholder:"e.g. PROD-0001"}),i.sku&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.sku})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Product Name"}),e.jsx("input",{type:"text",value:l.name,onChange:te("name"),className:`mt-1 w-full rounded-xl border px-3 py-2 text-sm focus:border-blue-400 focus:outline-none ${i.name?"border-rose-300":"border-slate-200"}`,placeholder:"Type product name here..."}),i.name&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.name})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"HSN Code"}),e.jsx("input",{type:"text",value:l.hsnCode,onChange:y("hsnCode"),className:`mt-1 w-full rounded-xl border px-3 py-2 text-sm focus:border-blue-400 focus:outline-none ${i.hsnCode?"border-rose-300":"border-slate-200"}`,placeholder:"e.g. 6109"}),i.hsnCode?e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.hsnCode}):e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Auto-fills from name when available; editable."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"GST Rate (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",value:l.gstRate,onChange:y("gstRate"),className:`mt-1 w-full rounded-xl border px-3 py-2 text-sm focus:border-blue-400 focus:outline-none ${i.gstRate?"border-rose-300":"border-slate-200"}`,placeholder:"e.g. 5"}),i.gstRate?e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.gstRate}):e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Enter 0-100. Suggested from product type."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Key Features"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[(l.keyFeatures||[]).map((N,V)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:N,onChange:v=>k(V,v.target.value),placeholder:"E.g. Premium breathable fabric",className:"flex-1 rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none"}),e.jsx("button",{type:"button",onClick:()=>G(V),className:"inline-flex items-center justify-center rounded-xl border border-slate-200 px-2 py-2 text-xs font-medium text-slate-500 hover:border-rose-200 hover:text-rose-500",disabled:(l.keyFeatures||[]).length===1,children:"Remove"})]},V)),e.jsx("button",{type:"button",onClick:f,className:"inline-flex items-center gap-2 rounded-xl border border-dashed border-blue-300 px-3 py-2 text-xs font-semibold text-blue-600 hover:bg-blue-50",children:"Add Feature"})]}),i.keyFeatures&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.keyFeatures})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Category Priority"}),e.jsx("input",{type:"text",value:l.categoryPriority,onChange:te("categoryPriority"),placeholder:"P1",className:`mt-1 w-full rounded-xl border px-3 py-2 text-sm focus:border-blue-400 focus:outline-none ${i.categoryPriority?"border-rose-300":"border-slate-200"}`}),i.categoryPriority?e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.categoryPriority}):e.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Use priorities like P1, P2… Lower number shows first."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Brand"}),e.jsx("input",{type:"text",list:"product-brand-suggestions",value:l.brand,onChange:te("brand"),placeholder:K.length?"Select or type brand...":"Type brand...",className:`mt-1 w-full rounded-xl border px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:outline-none ${i.brand?"border-rose-300":"border-slate-200"}`}),e.jsx("datalist",{id:"product-brand-suggestions",children:K.map(N=>e.jsx("option",{value:N},N))}),i.brand&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.brand})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Description"}),e.jsx("textarea",{rows:4,value:l.description,onChange:te("description"),className:`mt-1 w-full rounded-xl border px-3 py-2 text-sm focus:border-blue-400 focus:outline-none ${i.description?"border-rose-300":"border-slate-200"}`,placeholder:"Type product description here..."}),i.description&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.description})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Media"}),e.jsxs("div",{className:`mt-4 flex flex-col items-center justify-center rounded-2xl border-2 border-dashed px-6 py-10 text-center ${i.thumbnail?"border-rose-300 bg-rose-50/60":"border-slate-200 bg-slate-50/60"}`,children:[l.thumbnail?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l.thumbnail,alt:"Preview",className:"h-40 w-40 rounded-2xl object-cover shadow-sm"}),e.jsx("button",{type:"button",onClick:()=>r(N=>({...N,thumbnail:""})),className:"absolute -right-3 -top-3 rounded-full bg-white p-2 text-xs font-semibold shadow-sm",children:"Remove"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-white shadow-sm",children:D?e.jsx(Ie,{className:"h-6 w-6 animate-spin text-blue-600"}):e.jsx(Xr,{className:"h-6 w-6 text-blue-500"})}),e.jsx("p",{className:"mt-4 text-sm text-slate-500",children:"Drag and drop image here, or click add image"}),e.jsxs("label",{className:"mt-4 inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700",children:[e.jsx(ra,{size:16}),"Add Image",e.jsx("input",{type:"file",accept:"image/*",onChange:re,className:"hidden"})]})]}),i.thumbnail&&e.jsx("p",{className:"mt-3 text-xs text-rose-500",children:i.thumbnail})]}),e.jsxs("div",{className:"mt-6 w-full space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Gallery Images"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Used for product swiper (max 3MB each)"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:(l.gallery||[]).map((N,V)=>e.jsxs("div",{className:"group relative overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm",children:[e.jsx("img",{src:N,alt:`Gallery ${V+1}`,className:"h-32 w-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>X(V),className:"absolute inset-x-2 bottom-2 rounded-lg bg-white/90 px-2 py-1 text-xs font-semibold text-slate-600 opacity-0 shadow-sm transition group-hover:opacity-100",children:"Remove"})]},`${N}-${V}`))}),e.jsxs("label",{className:"inline-flex items-center gap-2 rounded-xl border border-dashed border-blue-300 px-4 py-2 text-sm font-semibold text-blue-600 hover:bg-blue-50",children:[e.jsx(ra,{size:16}),R?"Uploading...":"Add Gallery Images",e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:se,className:"hidden"})]}),i.gallery&&e.jsx("p",{className:"text-xs text-rose-500",children:i.gallery})]})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Pricing"}),e.jsxs("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Price"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:l.price,onChange:b("price"),className:`mt-1 w-full rounded-xl border px-3 py-2 text-sm focus:border-blue-400 focus:outline-none ${i.price?"border-rose-300":"border-slate-200"}`,placeholder:"599.00"}),i.price&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.price})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Original Price (MRP)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:l.originalPrice,onChange:b("originalPrice"),className:`mt-1 w-full rounded-xl border px-3 py-2 text-sm focus:border-blue-400 focus:outline-none ${i.originalPrice?"border-rose-300":"border-slate-200"}`,placeholder:"799.00"}),i.originalPrice&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:i.originalPrice})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Discount (%)"}),e.jsx("input",{type:"number",min:"0",step:"1",value:l.discountPercentage,onChange:te("discountPercentage"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"Auto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"You Save (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:l.saveAmount,onChange:te("saveAmount"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"Auto"})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Stock Settings"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Available Stock"}),e.jsxs("div",{className:"mt-1 flex flex-col gap-1 sm:flex-row sm:items-center sm:gap-3",children:[e.jsx("input",{type:"number",min:"0",step:"1",value:l.stock,onChange:te("stock"),disabled:ie,readOnly:l.showSizes&&!ie,title:l.showSizes&&!ie?"Auto-calculated from per-size stock":void 0,className:`w-full rounded-xl border px-3 py-2 text-sm focus:border-blue-400 focus:outline-none ${i.stock?"border-rose-300":"border-slate-200"} ${ie||l.showSizes?"bg-slate-100 text-slate-500":""}`,placeholder:ie?"Managed automatically":l.showSizes?"Calculated from sizes":"e.g. 150"}),ie&&e.jsx("span",{className:"text-xs text-slate-500",children:"Stock is locked for the selected status"})]}),i.stock&&e.jsx("p",{className:"text-xs text-rose-500",children:i.stock}),l.showSizes&&!ie&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Total from size quantities:"," ",e.jsx("span",{className:"font-semibold text-slate-700",children:Y})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Low Stock Threshold"}),e.jsx("input",{type:"number",min:"0",step:"1",value:l.lowStockThreshold,onChange:te("lowStockThreshold"),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"Optional (default 10)"})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Size Availability"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Configure which standard sizes are in stock and whether to show them on the product page."})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:!!l.showSizes,onChange:z("showSizes"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),l.showSizes?"Showing on product page":"Hidden on product page"]})]}),l.showSizes?e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 text-sm text-slate-600",children:[e.jsxs("span",{className:"font-medium",children:["Total available size stock:"," ",e.jsx("span",{className:"text-slate-900",children:Y})]}),e.jsx("button",{type:"button",onClick:h,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600",children:"Reset to defaults"})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:O.map(N=>{const V=!!N.isAvailable,v=Number(N.stock??0);return e.jsxs("div",{className:"flex flex-col gap-2 rounded-xl border border-slate-200 bg-slate-50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>F(N.label),className:`inline-flex items-center gap-2 rounded-lg border px-3 py-1.5 text-xs font-semibold transition focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 ${V?"border-blue-600 bg-blue-50 text-blue-600 hover:border-blue-700 hover:bg-blue-100":"border-rose-200 bg-rose-50 text-rose-500 hover:border-rose-300 hover:bg-rose-100"}`,children:[e.jsx("span",{children:N.label}),!V&&e.jsx("span",{className:"rounded-full bg-white px-2 py-0.5 text-[10px] font-semibold uppercase text-rose-500 shadow-sm",children:"Blocked"})]}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:"0",value:V&&v>0?v:"",onFocus:q=>q.target.select(),onChange:U(N.label),disabled:!V,placeholder:"0",className:`w-24 rounded-lg border px-2 py-1 text-xs font-semibold focus:border-blue-400 focus:outline-none ${V?"border-slate-200 bg-white text-slate-700":"cursor-not-allowed border-slate-100 bg-slate-100 text-slate-400"}`,"aria-label":`${N.label} stock quantity`})]}),e.jsx("p",{className:"text-[11px] text-slate-500",children:V?"Adjust available units for this size.":"Blocked sizes are hidden from shoppers."})]},N.label)})}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Tip: Stock is the sum of all enabled sizes. Disable a size to remove it from the total."})]}):e.jsx("p",{className:"mt-4 rounded-xl border border-dashed border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-500",children:"Enable the toggle to manage per-size availability for this product."})]})]}),e.jsxs("aside",{className:"space-y-6",children:[e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Category"}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Product Category"}),e.jsx("input",{type:"text",list:"product-category-suggestions",value:l.category,onChange:te("category"),placeholder:W.length?"Select or type category...":"Type category...",className:`w-full rounded-xl border px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:outline-none ${i.category?"border-rose-300":"border-slate-200"}`}),e.jsx("datalist",{id:"product-category-suggestions",children:W.map(N=>e.jsx("option",{value:N},N))}),i.category&&e.jsx("p",{className:"text-xs text-rose-500",children:i.category})]})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Status"}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Product Status"}),e.jsx("select",{value:l.status,onChange:te("status"),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:outline-none",children:Pc.map(N=>e.jsx("option",{value:N.value,children:N.label},N.value))}),e.jsx("label",{className:"text-xs font-medium text-slate-500",children:"Stock Status"}),e.jsx("select",{value:l.availabilityStatus,onChange:te("availabilityStatus"),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:outline-none",children:Dc.map(N=>e.jsx("option",{value:N.value,children:N.label},N.value))}),e.jsxs("label",{className:"mt-3 flex items-center justify-between gap-3 rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700",children:[e.jsx("span",{className:"text-xs font-medium uppercase tracking-wide text-slate-500",children:"Featured Product"}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!l.isFeatured,onChange:z("isFeatured"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500","aria-label":"Mark product as featured"}),e.jsx("span",{className:"text-xs text-slate-600",children:l.isFeatured?"Yes":"No"})]})]})]})]}),e.jsx("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{type:"button",onClick:()=>s("/admin/products"),className:"rounded-xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 hover:border-slate-300",disabled:p,children:"Cancel"}),e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 disabled:opacity-70",disabled:p,children:[p?e.jsx(Ie,{className:"h-4 w-4 animate-spin"}):null,"Add Product"]})]})})]})]})]})]})]})})},zc=async(t={})=>{const a=(await fe.get("/orders",{params:t})).data||{};if(!a.success)throw new Error(a.message||"Failed to fetch admin orders");return{data:a.data||[],meta:a.meta||{},summary:a.summary||{}}},Oc=async t=>{const a=(await fe.delete(`/orders/${t}`)).data||{};if(!a.success)throw new Error(a.message||"Failed to delete order");return a},Tc=async(t=[])=>{const a=(await fe.post("/orders/bulk-delete",{ids:t})).data||{};if(!a.success)throw new Error(a.message||"Failed to delete selected orders");return a},Rt=We("adminOrders/fetch",async(t={},{rejectWithValue:s})=>{var a,l;try{return await zc(t)}catch(r){const c=((l=(a=r.response)==null?void 0:a.data)==null?void 0:l.message)||r.message||"Failed to fetch orders";return s(c)}}),Ul={search:"",status:"",dateRange:{startDate:"",endDate:""},amountRange:{min:"",max:""},paymentStatus:""},$c={field:"createdAt",order:"desc"},Ca={items:[],loading:!1,error:null,filters:Ul,sort:$c,meta:{total:0,page:1,limit:10,totalPages:1},selection:{allSelected:!1,selectedIds:[]},selectedDetails:null,summary:{processing:0,shipped:0,delivered:0,returned:0},lastUpdatedAt:null},ql=Ft({name:"adminOrders",initialState:Ca,reducers:{setFilters(t,s){t.filters={...t.filters,...s.payload},t.meta.page=1},resetFilters(t){t.filters={...Ul},t.meta.page=1},setSelectedDetails(t,s){t.selectedDetails=s.payload},setSort(t,s){t.sort={...t.sort,...s.payload},t.meta.page=1},setPage(t,s){t.meta.page=s.payload},setLimit(t,s){t.meta.limit=s.payload,t.meta.page=1},toggleSelectAll(t,s){const{selectAll:a}=s.payload;t.selection.allSelected=a,t.selection.selectedIds=a?t.items.map(l=>l._id):[]},toggleSelectRow(t,s){const{id:a}=s.payload;t.selection.selectedIds.includes(a)?t.selection.selectedIds=t.selection.selectedIds.filter(l=>l!==a):t.selection.selectedIds=[...t.selection.selectedIds,a],t.selection.allSelected=t.selection.selectedIds.length===t.items.length&&t.items.length>0},clearSelection(t){t.selection={...Ca.selection},t.selectedDetails=null}},extraReducers:t=>{t.addCase(Rt.pending,s=>{s.loading=!0,s.error=null}).addCase(Rt.fulfilled,(s,a)=>{s.loading=!1;const{data:l=[],meta:r={},summary:c={}}=a.payload||{};s.items=l,s.meta={...s.meta,...r,total:r.total??l.length,totalPages:r.totalPages??s.meta.totalPages},s.summary={processing:c.processing??0,shipped:c.shipped??0,delivered:c.delivered??0,returned:c.returned??0},s.selection={...Ca.selection},s.lastUpdatedAt=Date.now()}).addCase(Rt.rejected,(s,a)=>{var l;s.loading=!1,s.error=a.payload||((l=a.error)==null?void 0:l.message)||"Failed to load orders"})}}),{setFilters:kt,resetFilters:_c,setSelectedDetails:Yd,setSort:Mc,setPage:ka,setLimit:Uc,toggleSelectAll:qc,toggleSelectRow:Bc,clearSelection:Aa}=ql.actions,Vc=ql.reducer,Hc={autoConnect:!0,transports:["websocket"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:2e3},Bl=(t,s={})=>{const a=n.useRef(null);return n.useEffect(()=>{if(!t)return;const l=_n(t,{...Hc,...s});return a.current=l,()=>{l.disconnect(),a.current=null}},[t,JSON.stringify(s)]),a},Vl={processing:{label:"Processing",className:"bg-orange-100 text-orange-600"},confirmed:{label:"Confirmed",className:"bg-orange-100 text-orange-600"},shipped:{label:"Shipped",className:"bg-blue-100 text-blue-600"},out_for_delivery:{label:"Out for Delivery",className:"bg-indigo-100 text-indigo-600"},delivered:{label:"Delivered",className:"bg-emerald-100 text-emerald-600"},returned:{label:"Returned",className:"bg-rose-100 text-rose-600"}},Gc=[{key:"processing",label:"Processing Orders",icon:bn,iconClasses:"bg-amber-100 text-amber-600"},{key:"shipped",label:"Shipped Orders",icon:Ta,iconClasses:"bg-sky-100 text-sky-600"},{key:"paid",label:"Paid Orders",icon:Zr,iconClasses:"bg-emerald-100 text-emerald-600"},{key:"delivered",label:"Delivered Orders",icon:Ma,iconClasses:"bg-emerald-100 text-emerald-600"},{key:"returned",label:"Return/Replace",icon:gn,iconClasses:"bg-rose-100 text-rose-600"}],Hl=[{value:"",label:"All Statuses"},{value:"processing",label:"Processing"},{value:"shipped",label:"Shipped"},{value:"delivered",label:"Delivered"},{value:"returned",label:"Return / Replace"}],La=t=>(Number.isFinite(Number(t))?Number(t):0).toLocaleString("en-IN",{style:"currency",currency:"INR"}),za=t=>{if(!t)return"--";const s=new Date(t);return Number.isNaN(s.getTime())?"--":s.toLocaleString()},Lr=t=>{if(!t)return"";const s=new Date(t);if(Number.isNaN(s.getTime()))return"";const a=s.getTimezoneOffset()*60*1e3;return new Date(s.getTime()-a).toISOString().slice(0,10)},Pa=(t=[])=>t.map(s=>{var l,r,c,o,i,d;const a=(l=s.items)==null?void 0:l[0];return{"Order ID":s._id,Customer:s.customerName||((r=s.shippingAddress)==null?void 0:r.fullName)||"Customer",Email:s.customerEmail||((c=s.shippingAddress)==null?void 0:c.email)||"",Status:((o=Vl[String(s.status||"").toLowerCase()])==null?void 0:o.label)||"--","Primary Product":(a==null?void 0:a.name)||"--",Quantity:(a==null?void 0:a.quantity)||((i=s.items)==null?void 0:i.length)||0,Total:s.totalAmount??((d=s.pricing)==null?void 0:d.total)??s.grandTotal??0,Created:s.createdAt?new Date(s.createdAt).toLocaleString():"--"}}),Gl=({isOpen:t,onClose:s,onSubmit:a})=>{const[l,r]=n.useState({customerName:"",customerEmail:"",totalAmount:"",status:"processing"}),[c,o]=n.useState(!1);n.useEffect(()=>{t||(r({customerName:"",customerEmail:"",totalAmount:"",status:"processing"}),o(!1))},[t]);const i=p=>{const{name:x,value:D}=p.target;r(g=>({...g,[x]:D}))},d=async p=>{if(p.preventDefault(),!c){if(!l.customerName.trim()){ne.error("Customer name is required");return}if(!l.customerEmail.trim()){ne.error("Customer email is required");return}if(!l.totalAmount||Number.isNaN(Number(l.totalAmount))){ne.error("Enter a valid amount");return}o(!0);try{await(a==null?void 0:a({customerName:l.customerName.trim(),customerEmail:l.customerEmail.trim(),totalAmount:Number(l.totalAmount),status:l.status})),ne.success("Order draft captured"),s()}catch(x){console.error("Failed to create order draft",x),ne.error((x==null?void 0:x.message)||"Failed to create order")}finally{o(!1)}}};return e.jsx(ze,{children:t&&e.jsx(Q.div,{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40 px-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(Q.div,{initial:{y:24,opacity:0},animate:{y:0,opacity:1},exit:{y:24,opacity:0},transition:{duration:.2},className:"w-full max-w-lg rounded-2xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Add Order"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Capture a quick order draft. Full admin order creation API is coming soon."})]}),e.jsx("button",{type:"button",className:"rounded-full p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-600",onClick:s,"aria-label":"Close",children:"×"})]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",htmlFor:"customerName",children:"Customer Name"}),e.jsx("input",{id:"customerName",name:"customerName",value:l.customerName,onChange:i,className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"e.g. Priya Sharma",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",htmlFor:"customerEmail",children:"Customer Email"}),e.jsx("input",{id:"customerEmail",name:"customerEmail",type:"email",value:l.customerEmail,onChange:i,className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"customer@mail.com",required:!0})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",htmlFor:"totalAmount",children:"Total Amount (INR)"}),e.jsx("input",{id:"totalAmount",name:"totalAmount",value:l.totalAmount,onChange:i,inputMode:"decimal",className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",placeholder:"₹4999",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",htmlFor:"status",children:"Status"}),e.jsx("select",{id:"status",name:"status",value:l.status,onChange:i,className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",children:Hl.filter(p=>p.value).map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full rounded-xl bg-blue-600 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-70",children:c?"Saving...":"Save Draft"})]})]})})})};Gl.defaultProps={onSubmit:void 0};const Wa=({isOpen:t,onClose:s,orders:a,renderStatus:l})=>e.jsx(ze,{children:t&&e.jsx(Q.div,{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40 px-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(Q.div,{initial:{y:24,opacity:0},animate:{y:0,opacity:1},exit:{y:24,opacity:0},transition:{duration:.2},className:"w-full max-w-3xl rounded-2xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-slate-900",children:["Selected orders (",a.length,")"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"Review the highlighted orders before taking bulk actions."})]}),e.jsx("button",{type:"button",className:"rounded-full p-1 text-slate-400 transition hover:bg-slate-100 hover:text-slate-600",onClick:s,"aria-label":"Close",children:"×"})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto rounded-xl border border-slate-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Order ID"}),e.jsx("th",{className:"px-4 py-3",children:"Customer"}),e.jsx("th",{className:"px-4 py-3",children:"Primary product"}),e.jsx("th",{className:"px-4 py-3",children:"Total"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3",children:"Placed"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white text-slate-700",children:a.map(r=>{var o,i,d,p;const c=(o=r.items)==null?void 0:o[0];return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3 font-semibold text-slate-900",children:["#",r._id]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-medium",children:r.customerName||((i=r.shippingAddress)==null?void 0:i.fullName)||"Customer"}),r.customerEmail&&e.jsx("p",{className:"text-xs text-slate-500",children:r.customerEmail})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-medium text-slate-800",children:(c==null?void 0:c.name)||"Product"}),((d=r.items)==null?void 0:d.length)>1&&e.jsxs("p",{className:"text-xs text-slate-500",children:["+ ",r.items.length-1," more"]})]}),e.jsx("td",{className:"px-4 py-3 font-semibold",children:La(r.totalAmount??((p=r.pricing)==null?void 0:p.total)??r.grandTotal??0)}),e.jsx("td",{className:"px-4 py-3",children:l==null?void 0:l(r.status)}),e.jsx("td",{className:"px-4 py-3 text-slate-500",children:za(r.createdAt)})]},r._id)})})]})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",onClick:s,children:"Close"})})]})})});Wa.propTypes={isOpen:me.bool.isRequired,onClose:me.func.isRequired,orders:me.arrayOf(me.object).isRequired,renderStatus:me.func};Wa.defaultProps={renderStatus:void 0};const Qc=()=>{var ds,ms,bt,us,Ya,Ka,Ja,Xa,Za,er,tr;const t=Es(),s=Te(),{user:a,logout:l}=Qe(),{items:r,loading:c,error:o,filters:i,sort:d,meta:p,summary:x,selection:D}=fa(T=>T.adminOrders),[g,R]=n.useState(i.search),[u,I]=n.useState(i.status||""),[j,m]=n.useState(i.paymentStatus||""),[S,P]=n.useState(()=>{var T;return(T=i.dateRange)!=null&&T.startDate?new Date(i.dateRange.startDate):null}),[H,E]=n.useState(()=>{var T;return(T=i.dateRange)!=null&&T.endDate?new Date(i.dateRange.endDate):null}),[w,A]=n.useState(((ds=i.amountRange)==null?void 0:ds.min)||""),[W,L]=n.useState(((ms=i.amountRange)==null?void 0:ms.max)||""),[K,O]=n.useState(!1),[Y,M]=n.useState(!1),[ee,te]=n.useState(null),[y,z]=n.useState(!1),[b,C]=n.useState(!1),[B,re]=n.useState(null),[se,X]=n.useState({status:"",paymentStatus:"",paymentMethod:"",estimatedDeliveryDate:""});n.useMemo(()=>Lr(new Date),[]);const[F,U]=n.useState(!1),[h,k]=n.useState(null),f=n.useRef({}),G=n.useMemo(()=>"https://apis.qrfolio.net/api".replace(/\/?api\/?$/,""),[]),le=Bl(G,{withCredentials:!0}),Z=p.page??1,ie=p.limit??10,N=p.total??r.length??0,V=p.totalPages||Math.max(Math.ceil(N/ie),1);n.useEffect(()=>{R(i.search||"")},[i.search]),n.useEffect(()=>{I(i.status||"")},[i.status]),n.useEffect(()=>{m(i.paymentStatus||"")},[i.paymentStatus]),n.useEffect(()=>{const T=g.trim(),ae=(i.search||"").trim();if(T===ae)return;const ue=setTimeout(()=>{t(kt({search:T})),t(ka(1))},400);return()=>clearTimeout(ue)},[t,g,i.search]),n.useEffect(()=>{var ue,De;const T=(ue=i.dateRange)!=null&&ue.startDate?new Date(i.dateRange.startDate):null,ae=(De=i.dateRange)!=null&&De.endDate?new Date(i.dateRange.endDate):null;P(T),E(ae)},[(bt=i.dateRange)==null?void 0:bt.startDate,(us=i.dateRange)==null?void 0:us.endDate]),n.useEffect(()=>{var T,ae;A(((T=i.amountRange)==null?void 0:T.min)||""),L(((ae=i.amountRange)==null?void 0:ae.max)||"")},[(Ya=i.amountRange)==null?void 0:Ya.min,(Ka=i.amountRange)==null?void 0:Ka.max]),n.useEffect(()=>{var ae,ue,De,Ee;const T={search:i.search||void 0,status:i.status||void 0,paymentStatus:i.paymentStatus||void 0,startDate:((ae=i.dateRange)==null?void 0:ae.startDate)||void 0,endDate:((ue=i.dateRange)==null?void 0:ue.endDate)||void 0,minAmount:((De=i.amountRange)==null?void 0:De.min)||void 0,maxAmount:((Ee=i.amountRange)==null?void 0:Ee.max)||void 0,sortField:d.field,sortOrder:d.order,page:Z,limit:ie};f.current=T,t(Rt(T))},[t,i.search,i.status,i.paymentStatus,(Ja=i.dateRange)==null?void 0:Ja.startDate,(Xa=i.dateRange)==null?void 0:Xa.endDate,(Za=i.amountRange)==null?void 0:Za.min,(er=i.amountRange)==null?void 0:er.max,d.field,d.order,Z,ie]),n.useEffect(()=>{const T=le.current;if(!T)return;const ae="admin:orders",ue=()=>{const Ae=f.current;Ae&&t(Rt(Ae))},De=Ae=>{ne.success(`New order received${Ae!=null&&Ae.customerName?` from ${Ae.customerName}`:""}`),ue()},Ee=Ae=>{Ae!=null&&Ae.status?ne(`Order ${Ae.id} updated to ${Ae.status}`,{icon:"🔄"}):ne(`Order ${(Ae==null?void 0:Ae.id)||""} updated`,{icon:"🔄"}),ue()},He=Ae=>{ne(`Order ${(Ae==null?void 0:Ae.id)||""} removed`,{icon:"🗑️"}),ue()};return T.emit("joinRoom",ae),T.on("order:created",De),T.on("order:updated",Ee),T.on("order:deleted",He),()=>{T.emit("leaveRoom",ae),T.off("order:created",De),T.off("order:updated",Ee),T.off("order:deleted",He)}},[t,le]);const v=n.useMemo(()=>Gc.map(({key:T,label:ae,icon:ue,iconClasses:De})=>({key:T,label:ae,icon:ue,iconClasses:De,value:(x==null?void 0:x[T])??0})),[x]),q=(Z-1)*ie+1,J=Math.min(Z*ie,N),xe=n.useCallback(T=>{T.preventDefault(),t(kt({search:g.trim()})),t(ka(1))},[t,g]),je=()=>{R(""),I(""),P(null),E(null),A(""),L(""),m(""),t(_c())},we=T=>{t(qc({selectAll:T.target.checked}))},_=n.useCallback(T=>{t(Bc({id:T}))},[t]);n.useEffect(()=>{if(typeof window>"u")return;const T=document.body,ae=document.documentElement,ue=T.style.overflow,De=ae.style.overflow,Ee=window.matchMedia("(min-width: 768px)"),He=Oe=>{Oe?(T.style.overflow="hidden",ae.style.overflow="hidden"):(T.style.overflow=ue,ae.style.overflow=De)};He(Ee.matches);const Ae=Oe=>{He(Oe.matches)};return typeof Ee.addEventListener=="function"?Ee.addEventListener("change",Ae):typeof Ee.addListener=="function"&&Ee.addListener(Ae),()=>{typeof Ee.removeEventListener=="function"?Ee.removeEventListener("change",Ae):typeof Ee.removeListener=="function"&&Ee.removeListener(Ae),T.style.overflow=ue,ae.style.overflow=De}},[]);const be=T=>{const[ae,ue]=T.target.value.split(":");t(Mc({field:ae,order:ue}))},ve=T=>{T<1||T>V||T===Z||(t(ka(T)),t(Aa()),window.scrollTo({top:0,behavior:"smooth"}))},de=T=>{t(Uc(Number(T.target.value))),t(Aa())},pe=T=>{const ae=T.target.value;I(ae),t(kt({status:ae}))},$=T=>{const ae=T.target.value;m(ae),t(kt({paymentStatus:ae}))},ce=T=>{var ae;P(T),t(kt({dateRange:{startDate:T?T.toISOString():"",endDate:((ae=i.dateRange)==null?void 0:ae.endDate)||""}}))},he=T=>{var ae;E(T),t(kt({dateRange:{startDate:((ae=i.dateRange)==null?void 0:ae.startDate)||"",endDate:T?T.toISOString():""}}))},Pe=(T,ae)=>{const ue=ae.replace(/[^0-9.]/g,"");T==="min"?(A(ue),t(kt({amountRange:{min:ue,max:W}}))):(L(ue),t(kt({amountRange:{min:w,max:ue}})))},$e=()=>{const T=Pa(r);if(!T.length){ne.error("No orders to export");return}const ae=Object.keys(T[0]),ue=[ae.join(","),...T.map(Ae=>ae.map(Oe=>{const st=Ae[Oe]??"";return`"${String(st).replace(/"/g,'""')}`.concat('"')}).join(","))].join(`
`),De=new Blob(["\uFEFF"+ue],{type:"text/csv;charset=utf-8;"}),Ee=URL.createObjectURL(De),He=document.createElement("a");He.href=Ee,He.download=`orders-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(He),He.click(),document.body.removeChild(He),URL.revokeObjectURL(Ee),ne.success("CSV exported")},Me=()=>{const T=Pa(r);if(!T.length){ne.error("No orders to export");return}const ae=es.json_to_sheet(T),ue=es.book_new();es.book_append_sheet(ue,ae,"Orders"),rl(ue,`orders-${new Date().toISOString().slice(0,10)}.xlsx`),ne.success("XLSX exported")},qe=()=>{const T=Pa(r);if(!T.length){ne.error("No orders to export");return}const ae=new Mn({orientation:"landscape"});ae.setFontSize(14),ae.text("Orders Summary",14,18);const ue=Object.keys(T[0]),De=26,Ee=8,He=40;ue.forEach((Ae,Oe)=>{ae.text(String(Ae),14+Oe*He,De)}),T.forEach((Ae,Oe)=>{ue.forEach((st,at)=>{const it=String(Ae[st]??"");ae.text(it.substring(0,20),14+at*He,De+(Oe+1)*Ee)})}),ae.save(`orders-${new Date().toISOString().slice(0,10)}.pdf`),ne.success("PDF exported")},rt=()=>{M(!0)},Ge=T=>{s(`/admin/orders/${T}`)},ls=async T=>{var De,Ee,He,Ae;const ae=T==null?void 0:T._id;if(!ae){ne.error("Order details unavailable");return}if((((De=T.payment)==null?void 0:De.status)||"pending").toLowerCase()!=="paid"){ne.error("Invoice will be available once the payment is successful.");return}try{k(ae);const Oe=await fe.get(`/orders/${ae}/invoice`,{responseType:"blob",headers:{Accept:"application/pdf"}}),st=Oe.data,it=(((Ee=Oe.headers)==null?void 0:Ee["content-disposition"])||"").match(/filename="?([^";]+)"?/i),zt=(it==null?void 0:it[1])||`invoice-${ae}.pdf`,vt=window.URL.createObjectURL(st),ot=document.createElement("a");ot.href=vt,ot.download=zt,document.body.appendChild(ot),ot.click(),document.body.removeChild(ot),window.URL.revokeObjectURL(vt),ne.success("Invoice downloaded")}catch(Oe){console.error("Invoice download failed",Oe);const st=((Ae=(He=Oe==null?void 0:Oe.response)==null?void 0:He.data)==null?void 0:Ae.message)||(Oe==null?void 0:Oe.message)||"Unable to download invoice. Please try again.";ne.error(st)}finally{k(null)}},ns=async T=>{if(!(!T||!window.confirm("Are you sure you want to delete this order?")))try{te(T),await Oc(T),ne.success("Order deleted");const ue=f.current;ue&&t(Rt(ue))}catch(ue){console.error("Failed to delete order",ue),ne.error((ue==null?void 0:ue.message)||"Failed to delete order")}finally{te(null)}},Ls=async()=>{if(!(D.selectedIds.length===0||!window.confirm(`Delete ${D.selectedIds.length} selected order${D.selectedIds.length>1?"s":""}?`)))try{await Tc(D.selectedIds),ne.success("Selected orders deleted"),t(Aa());const ae=f.current;ae&&t(Rt(ae))}catch(ae){console.error("Failed to delete selected orders",ae),ne.error((ae==null?void 0:ae.message)||"Failed to delete selected orders")}},is=n.useCallback(T=>{var ue,De;if(!T)return;const ae={status:T.status||"processing",paymentStatus:((ue=T.payment)==null?void 0:ue.status)||"",paymentMethod:((De=T.payment)==null?void 0:De.method)||"",estimatedDeliveryDate:Lr(T.estimatedDeliveryDate)||""};re(T),X(ae)},[]),Et=n.useCallback(()=>{F||re(null)},[F]),Lt=(T,ae)=>{X(ue=>({...ue,[T]:ae}))},os=(((tr=B==null?void 0:B.payment)==null?void 0:tr.status)||"").toString().toLowerCase(),cs=(se.paymentStatus||"").toString().toLowerCase(),oe=cs||os,ye=(se.status||"").toString().toLowerCase(),Se=B?["delivered","returned"].includes((B.status||"").toString().toLowerCase()):!1,Ne=os==="paid"||cs==="paid",Ce=["paid","success","successful","completed"].includes(oe),Le=ye==="delivered",Ye=!Le||Ce,Be=T=>{const{value:ae}=T.target;if(Se){ne.error("Estimated delivery date cannot be changed after delivery.");return}Lt("estimatedDeliveryDate",ae)},Ve=async()=>{var T,ae;if(B){if(Le&&!Ce){ne.error("Payment must be successful before marking an order as delivered.");return}U(!0);try{const ue={status:se.status||void 0,paymentStatus:se.paymentStatus||void 0,paymentMethod:se.paymentMethod||void 0,estimatedDeliveryDate:se.estimatedDeliveryDate||null};await xi(B._id,ue),ne.success("Order updated successfully");const De=f.current;De&&t(Rt(De)),re(null)}catch(ue){console.error("Failed to update order",ue),ne.error((ue==null?void 0:ue.message)||((ae=(T=ue==null?void 0:ue.response)==null?void 0:T.data)==null?void 0:ae.message)||"Failed to update order")}finally{U(!1)}}},_e=T=>{const ae=String(T||"").toLowerCase(),ue=Vl[ae];return ue?e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${ue.className}`,children:ue.label}):e.jsx("span",{className:"text-slate-400",children:"--"})};n.useMemo(()=>({pendingOrders:(x==null?void 0:x.processing)??0,shippedOrders:(x==null?void 0:x.shipped)??0,deliveredOrders:(x==null?void 0:x.delivered)??0}),[x]);const xt=()=>{C(!0)},pt=()=>{C(!1)};return e.jsxs("div",{className:"min-h-screen md:h-screen bg-slate-50 text-slate-900 overflow-x-hidden md:overflow-hidden",children:[e.jsxs("div",{className:"flex md:h-screen",children:[e.jsx(Ue,{active:"Orders",className:"hidden md:flex md:w-64",onNavigate:()=>z(!1)}),y&&e.jsxs("div",{className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx("button",{type:"button","aria-label":"Close sidebar",onClick:()=>z(!1),className:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm"}),e.jsx("div",{className:"relative z-10 h-full w-72 max-w-[85%] origin-left animate-slide-in bg-white shadow-2xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-6 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Navigation"}),e.jsx("button",{type:"button",onClick:()=>z(!1),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600","aria-label":"Close navigation",children:"✕"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Ue,{active:"Orders",className:"flex w-full md:hidden",onNavigate:()=>z(!1)})})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-h-0",children:[e.jsx(nt,{onToggleSidebar:()=>z(T=>!T),activeRange:"All Date",onSelectRange:()=>{},adminName:(a==null?void 0:a.name)||(a==null?void 0:a.username)||"Admin",adminRole:(a==null?void 0:a.role)==="admin"?"Administrator":a==null?void 0:a.role,showRangeSelector:!1,showNotifications:!1,onLogout:l}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-4 py-6 md:px-8 md:py-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Dashboard / Orders"}),e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Orders"})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("button",{type:"button",onClick:()=>O(T=>!T),className:"relative inline-flex w-full items-center justify-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 hover:border-blue-200 hover:text-blue-600 sm:w-auto",children:[e.jsx(jt,{size:16}),"Export",e.jsx(ze,{children:K&&e.jsxs(Q.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.18},className:"absolute right-0 top-full z-20 mt-2 w-48 rounded-2xl border border-slate-200 bg-white text-left shadow-xl",children:[e.jsx("button",{type:"button",onClick:()=>{$e(),O(!1)},className:"block w-full px-4 py-3 text-sm text-slate-600 hover:bg-slate-50",children:"Export as CSV"}),e.jsx("button",{type:"button",onClick:()=>{Me(),O(!1)},className:"block w-full px-4 py-3 text-sm text-slate-600 hover:bg-slate-50",children:"Export as XLSX"}),e.jsx("button",{type:"button",onClick:()=>{qe(),O(!1)},className:"block w-full px-4 py-3 text-sm text-slate-600 hover:bg-slate-50",children:"Export as PDF"})]})})]}),e.jsxs("button",{type:"button",onClick:rt,className:"inline-flex w-full items-center justify-center gap-2 rounded-xl bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 sm:w-auto",children:[e.jsx(ft,{size:16}),"Add Order"]}),D.selectedIds.length>0&&e.jsxs("button",{type:"button",onClick:xt,className:"inline-flex w-full items-center justify-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 hover:border-blue-200 hover:text-blue-600 sm:w-auto",children:["View selected (",D.selectedIds.length,")"]})]})]}),e.jsx("section",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-4",children:v.map(({key:T,label:ae,value:ue,icon:De,iconClasses:Ee})=>e.jsxs("article",{className:"relative overflow-hidden rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[De?e.jsx("div",{className:`absolute right-4 top-4 flex h-11 w-11 items-center justify-center rounded-xl ${Ee||"bg-blue-50 text-blue-600"}`,children:e.jsx(De,{size:22,strokeWidth:2})}):null,e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-slate-500",children:ae}),e.jsx("p",{className:"mt-6 text-3xl font-semibold text-slate-900",children:ue.toLocaleString()})]},T))}),e.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white shadow-sm",children:[e.jsx("div",{className:"space-y-4 border-b border-slate-100 p-4",children:e.jsxs("form",{onSubmit:xe,className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:gap-3",children:[e.jsxs("div",{className:"relative w-full flex-1",children:[e.jsx(Zt,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",value:g,onChange:T=>R(T.target.value),placeholder:"Search by order ID, product, or customer",className:"w-full rounded-xl border border-slate-200 bg-white py-2 pl-10 pr-4 text-sm text-slate-700 transition focus:border-blue-400 focus:outline-none focus:ring-0"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{type:"submit",className:"inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700",children:"Search"}),e.jsx("button",{type:"button",onClick:je,className:"inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",children:"Reset"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:"Status"}),e.jsx("select",{value:u,onChange:pe,className:"rounded-lg border border-slate-200 px-3 py-1.5 text-sm text-slate-600 focus:border-blue-400 focus:outline-none",children:Hl.map(T=>e.jsx("option",{value:T.value,children:T.label},T.value))})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:"Payment"}),e.jsxs("select",{value:j,onChange:$,className:"rounded-lg border border-slate-200 px-3 py-1.5 text-sm text-slate-600 focus:border-blue-400 focus:outline-none",children:[e.jsx("option",{value:"",children:"All payments"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2",children:[e.jsx(Ds,{size:16,className:"text-slate-400"}),e.jsx(ar,{selected:S,onChange:ce,selectsStart:!0,startDate:S,endDate:H,maxDate:H||void 0,placeholderText:"Start date",isClearable:!0,className:"w-28 border-none bg-transparent px-0 py-1 text-sm text-slate-600 focus:outline-none focus:ring-0 placeholder:text-slate-400"}),e.jsx("span",{className:"text-slate-300",children:"—"}),e.jsx(ar,{selected:H,onChange:he,selectsEnd:!0,startDate:S,endDate:H,minDate:S||void 0,placeholderText:"End date",isClearable:!0,className:"w-28 border-none bg-transparent px-0 py-1 text-sm text-slate-600 focus:outline-none focus:ring-0 placeholder:text-slate-400"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:"Amount"}),e.jsx("input",{type:"text",value:w,onChange:T=>Pe("min",T.target.value),inputMode:"decimal",pattern:"[0-9]*",placeholder:"Min",className:"w-24 border-none bg-transparent px-0 py-1 text-sm text-slate-600 focus:outline-none focus:ring-0 placeholder:text-slate-400"}),e.jsx("span",{className:"text-slate-300",children:"—"}),e.jsx("input",{type:"text",value:W,onChange:T=>Pe("max",T.target.value),inputMode:"decimal",pattern:"[0-9]*",placeholder:"Max",className:"w-24 border-none bg-transparent px-0 py-1 text-sm text-slate-600 focus:outline-none focus:ring-0 placeholder:text-slate-400"})]})]})]})}),e.jsxs("div",{className:"flex flex-col gap-4 p-4",children:[D.selectedIds.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-xl border border-blue-100 bg-blue-50 px-4 py-3 text-sm text-blue-700",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"font-semibold",children:[D.selectedIds.length," order",D.selectedIds.length>1?"s":""," selected"]}),e.jsx("p",{className:"text-xs text-blue-600/80",children:"Download, inspect, or delete the selected orders."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{type:"button",onClick:xt,className:"inline-flex items-center justify-center rounded-xl border border-blue-200 px-3 py-2 text-xs font-medium text-blue-700 hover:bg-white",children:"View details"}),e.jsx("button",{type:"button",onClick:Ls,className:"inline-flex items-center justify-center rounded-xl border border-rose-200 px-3 py-2 text-xs font-medium text-rose-600 hover:bg-white",children:"Delete selected"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:["Showing"," ",e.jsx("span",{className:"font-semibold text-slate-700",children:q}),"-",e.jsx("span",{className:"font-semibold text-slate-700",children:J})," ","of",e.jsxs("span",{className:"font-semibold text-slate-700",children:[" ",N]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:["Sort by",e.jsxs("select",{value:`${d.field}:${d.order}`,onChange:be,className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",children:[e.jsx("option",{value:"createdAt:desc",children:"Newest first"}),e.jsx("option",{value:"createdAt:asc",children:"Oldest first"}),e.jsx("option",{value:"customerName:asc",children:"Customer A-Z"}),e.jsx("option",{value:"customerName:desc",children:"Customer Z-A"})]})]})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{className:"text-left text-xs font-medium uppercase text-slate-500",children:[e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:D.allSelected,onChange:we,className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500","aria-label":"Select all orders"})}),e.jsx("th",{className:"px-4 py-3",children:"Order ID"}),e.jsx("th",{className:"px-4 py-3",children:"Product"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3",children:"Customer"}),e.jsx("th",{className:"px-4 py-3",children:"Total"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 bg-white text-sm text-slate-600",children:[c&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-slate-400",children:"Loading orders..."})}),o&&!c&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-rose-500",children:o})}),!c&&!o&&r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-slate-400",children:"No orders found for the selected filters."})}),!c&&!o&&r.map(T=>{var it,zt,vt,ot,xs,ps,hs,fs,bs;const ae=T._id,ue=(it=T.items)==null?void 0:it[0],De=(ue==null?void 0:ue.thumbnail)||(ue==null?void 0:ue.image)||T.productImage||((vt=(zt=T.items)==null?void 0:zt.find(ct=>ct.image||ct.thumbnail))==null?void 0:vt.image)||((xs=(ot=T.items)==null?void 0:ot.find(ct=>ct.image||ct.thumbnail))==null?void 0:xs.thumbnail)||null,Ee=Math.max((((ps=T.items)==null?void 0:ps.length)||0)-1,0),He=T.customerName||((hs=T.shippingAddress)==null?void 0:hs.fullName)||"Customer",Ae=T.totalAmount??((fs=T.pricing)==null?void 0:fs.total)??T.grandTotal??0,Oe=D.selectedIds.includes(ae),st=(((bs=T.payment)==null?void 0:bs.status)||"pending").toLowerCase(),at=st==="paid";return e.jsxs("tr",{className:Oe?"bg-slate-50":void 0,children:[e.jsx("td",{className:"px-4 py-3 align-middle",children:e.jsx("input",{type:"checkbox",checked:Oe,onChange:()=>_(ae),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500","aria-label":`Select order ${ae}`})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-slate-700",children:["#",ae]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded-xl bg-slate-100",children:De?e.jsx("img",{src:De,alt:ue==null?void 0:ue.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"grid h-full w-full place-items-center text-xs text-slate-400",children:"Img"})}),e.jsxs("div",{className:"text-sm text-slate-600",children:[e.jsx("p",{className:"font-medium text-slate-800",children:(ue==null?void 0:ue.name)||"Product"}),Ee>0&&e.jsxs("p",{className:"text-xs text-slate-400",children:["+ ",Ee," other products"]})]})]})}),e.jsx("td",{className:"px-4 py-3 text-slate-500",children:za(T.createdAt)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-slate-700",children:He}),T.customerEmail&&e.jsx("p",{className:"text-xs text-slate-500 break-all",children:T.customerEmail})]})}),e.jsx("td",{className:"px-4 py-3 font-semibold text-slate-700",children:La(Ae)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[_e==null?void 0:_e(T.status),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium ${at?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:["Payment:"," ",at?"Paid":st]})]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-3 text-sm",children:[e.jsxs("button",{type:"button",onClick:()=>Ge(ae),className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-blue-100 text-blue-600 transition hover:border-blue-200 hover:bg-blue-50","aria-label":`View order ${ae}`,children:[e.jsxs("span",{className:"sr-only",children:["View order ",ae]}),e.jsx(et,{size:16})]}),e.jsx("button",{type:"button",onClick:()=>ls(T),disabled:!at||h===ae,className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-slate-200 text-slate-500 transition hover:border-slate-300 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50","aria-label":`Download invoice for order ${ae}`,title:at?"Download invoice":"Invoice available after payment",children:h===ae?e.jsx(Ie,{size:16,className:"animate-spin"}):e.jsx(jt,{size:16})}),e.jsxs("button",{type:"button",onClick:()=>ns(ae),disabled:ee===ae,className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-rose-100 text-rose-600 transition hover:border-rose-200 hover:bg-rose-50 disabled:cursor-not-allowed disabled:opacity-60","aria-label":`Delete order ${ae}`,children:[e.jsxs("span",{className:"sr-only",children:["Delete order ",ae]}),ee===ae?e.jsx(Ie,{size:16,className:"animate-spin"}):e.jsx(Je,{size:16})]}),e.jsx("button",{type:"button",onClick:()=>is(T),className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-purple-100 text-purple-600 transition hover:border-purple-200 hover:bg-purple-50","aria-label":`Edit order ${ae}`,children:e.jsx(as,{size:16})})]})})]},ae)})]})]})})}),e.jsxs("div",{className:"flex flex-col gap-3 md:hidden",children:[c&&e.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 text-center text-slate-400",children:"Loading orders..."}),o&&!c&&e.jsx("div",{className:"rounded-2xl border border-rose-200 bg-white p-4 text-center text-rose-500",children:o}),!c&&!o&&r.length===0&&e.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 text-center text-slate-400",children:"No orders found for the selected filters."}),!c&&!o&&r.map(T=>{var it,zt,vt,ot,xs,ps,hs,fs,bs;const ae=T._id,ue=(it=T.items)==null?void 0:it[0],De=(ue==null?void 0:ue.thumbnail)||(ue==null?void 0:ue.image)||T.productImage||((vt=(zt=T.items)==null?void 0:zt.find(ct=>ct.image||ct.thumbnail))==null?void 0:vt.image)||((xs=(ot=T.items)==null?void 0:ot.find(ct=>ct.image||ct.thumbnail))==null?void 0:xs.thumbnail)||null,Ee=Math.max((((ps=T.items)==null?void 0:ps.length)||0)-1,0),He=T.customerName||((hs=T.shippingAddress)==null?void 0:hs.fullName)||"Customer",Ae=T.totalAmount??((fs=T.pricing)==null?void 0:fs.total)??T.grandTotal??0,Oe=D.selectedIds.includes(ae),st=(((bs=T.payment)==null?void 0:bs.status)||"pending").toLowerCase(),at=st==="paid";return e.jsxs("article",{className:`rounded-2xl border border-slate-200 bg-white p-4 shadow-sm ${Oe?"ring-1 ring-blue-200":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-slate-400",children:"Order"}),e.jsxs("p",{className:"text-lg font-semibold text-slate-900 break-all",children:["#",ae]})]}),e.jsx("button",{type:"button",onClick:()=>_(ae),className:`inline-flex h-8 w-8 items-center justify-center rounded-full border text-xs font-semibold transition ${Oe?"border-blue-200 bg-blue-50 text-blue-600":"border-slate-200 text-slate-500"}`,"aria-label":`Select order ${ae}`,children:"✓"})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 overflow-hidden rounded-xl bg-slate-100",children:De?e.jsx("img",{src:De,alt:ue==null?void 0:ue.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"grid h-full w-full place-items-center text-xs text-slate-400",children:"Img"})}),e.jsxs("div",{className:"flex-1 text-sm text-slate-600",children:[e.jsx("p",{className:"font-medium text-slate-900",children:(ue==null?void 0:ue.name)||"Product"}),Ee>0&&e.jsxs("p",{className:"text-xs text-slate-400",children:["+ ",Ee," other products"]})]})]}),e.jsxs("dl",{className:"mt-4 space-y-2 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-slate-400",children:"Placed"}),e.jsx("dd",{className:"font-medium text-slate-700",children:za(T.createdAt)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("dt",{className:"text-slate-400",children:"Customer"}),e.jsx("dd",{className:"font-medium text-slate-800",children:He}),T.customerEmail&&e.jsx("dd",{className:"text-xs text-slate-500 break-all",children:T.customerEmail})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-slate-400",children:"Amount"}),e.jsx("dd",{className:"font-semibold text-slate-900",children:La(Ae)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("dt",{className:"text-slate-400",children:"Status"}),e.jsx("dd",{children:_e(T.status)}),e.jsx("dd",{children:e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium ${at?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:["Payment:"," ",at?"Paid":st]})})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>Ge(ae),className:"inline-flex h-9 w-9 shrink-0 items-center justify-center rounded-full border border-blue-100 text-blue-600 transition hover:border-blue-200 hover:bg-blue-50","aria-label":`View order ${ae}`,children:e.jsx(et,{size:16})}),e.jsx("button",{type:"button",onClick:()=>ls(T),disabled:!at||h===ae,className:"inline-flex h-9 w-9 shrink-0 items-center justify-center rounded-full border border-slate-200 text-slate-500 transition hover:border-slate-300 hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50","aria-label":`Download invoice for order ${ae}`,title:at?"Download invoice":"Invoice available after payment",children:h===ae?e.jsx(Ie,{size:16,className:"animate-spin"}):e.jsx(jt,{size:16})}),e.jsx("button",{type:"button",onClick:()=>ns(ae),disabled:ee===ae,className:"inline-flex h-9 w-9 shrink-0 items-center justify-center rounded-full border border-rose-100 text-rose-600 transition hover:border-rose-200 hover:bg-rose-50 disabled:cursor-not-allowed disabled:opacity-60","aria-label":`Delete order ${ae}`,children:ee===ae?e.jsx(Ie,{size:16,className:"animate-spin"}):e.jsx(Je,{size:16})}),e.jsx("button",{type:"button",onClick:()=>is(T),className:"inline-flex h-9 w-9 shrink-0 items-center justify-center rounded-full border border-purple-100 text-purple-600 transition hover:border-purple-200 hover:bg-purple-50","aria-label":`Edit order ${ae}`,children:e.jsx(as,{size:16})})]})]},ae)})]}),e.jsxs("div",{className:"flex flex-col gap-3 border-t border-slate-100 pt-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:["Rows per page",e.jsx("select",{value:ie,onChange:de,className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-400 focus:outline-none",children:[10,20,50].map(T=>e.jsx("option",{value:T,children:T},T))})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("button",{type:"button",onClick:()=>ve(Z-1),className:"rounded-lg border border-slate-200 px-3 py-1 hover:border-blue-200 hover:text-blue-600",children:"Prev"}),e.jsxs("span",{children:["Page ",e.jsx("span",{className:"font-semibold",children:Z})," of",e.jsxs("span",{className:"font-semibold",children:[" ",V]})]}),e.jsx("button",{type:"button",onClick:()=>ve(Z+1),className:"rounded-lg border border-slate-200 px-3 py-1 hover:border-blue-200 hover:text-blue-600",children:"Next"})]})]})]})]})]})]})]}),e.jsx(Gl,{isOpen:Y,onClose:()=>M(!1),onSubmit:async T=>{console.info("Order draft submitted",T)}}),e.jsx(Wa,{isOpen:b,onClose:pt,orders:r.filter(T=>D.selectedIds.includes(T._id)),renderStatus:_e}),e.jsx(ze,{children:B&&e.jsx(Q.div,{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40 px-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(Q.div,{initial:{y:24,opacity:0},animate:{y:0,opacity:1},exit:{y:24,opacity:0},transition:{duration:.2},className:"w-full max-w-lg rounded-2xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Edit Order"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Order #",B._id]})]}),e.jsx("button",{type:"button",className:"rounded-full p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-600",onClick:Et,"aria-label":"Close edit order",disabled:F,children:e.jsx(Ze,{size:18})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Order Status",e.jsxs("select",{value:se.status,onChange:T=>Lt("status",T.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"confirmed",children:"Order Confirmed"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"picked_up",children:"Picked Up"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"out_for_delivery",children:"Out for Delivery"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"returned",children:"Returned"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Payment Status",e.jsxs("select",{value:se.paymentStatus,disabled:Ne,onChange:T=>Lt("paymentStatus",T.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Keep unchanged"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Successful"}),e.jsx("option",{value:"failed",children:"Failed"})]}),Ne?e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Payment is already marked successful and cannot be changed."}):null]}),e.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Payment Method",e.jsxs("select",{value:se.paymentMethod,onChange:T=>Lt("paymentMethod",T.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Keep unchanged"}),e.jsx("option",{value:"cod",children:"Cash on Delivery"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"qr",children:"QR Code"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"netbanking",children:"Net Banking"})]})]})]}),e.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Estimated Delivery Date",e.jsx("input",{type:"date",value:se.estimatedDeliveryDate,disabled:Se,onChange:Be,className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),Se?e.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Delivery date is locked because the order has already been"," ",(B==null?void 0:B.status)==="returned"?"been resolved":"been delivered","."]}):null]})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-end gap-3",children:[Le&&!Ce?e.jsx("p",{className:"mr-auto text-xs text-rose-500",children:"Mark payment as successful before setting the order to Delivered."}):null,e.jsx("button",{type:"button",className:"rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-600 hover:bg-slate-50",onClick:Et,disabled:F,children:"Cancel"}),e.jsx("button",{type:"button",className:"rounded-xl bg-blue-600 px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:Ve,disabled:F||!Ye,children:F?"Saving...":"Save Changes"})]})]})})})]})},Wc={processing:{label:"Processing",badge:"bg-amber-100 text-amber-700"},confirmed:{label:"Confirmed",badge:"bg-blue-100 text-blue-700"},shipped:{label:"Shipped",badge:"bg-sky-100 text-sky-700"},out_for_delivery:{label:"Out for Delivery",badge:"bg-indigo-100 text-indigo-700"},delivered:{label:"Delivered",badge:"bg-emerald-100 text-emerald-700"},returned:{label:"Return/Replace",badge:"bg-rose-100 text-rose-700"}},Yc=[{value:"approved",label:"Approved"},{value:"pickup_completed",label:"Pickup completed"},{value:"replacement_processing",label:"Replacement processing"},{value:"replacement_shipped",label:"Replacement shipped"},{value:"replacement_out_for_delivery",label:"Out for delivery"},{value:"replacement_delivered",label:"Replacement delivered"},{value:"rejected",label:"Rejected"},{value:"cancelled",label:"Cancelled"}],gt=new Set(["rejected"]),At=t=>(Number.isFinite(Number(t))?Number(t):0).toLocaleString("en-IN",{style:"currency",currency:"INR"}),Da=(t,s="--")=>{if(!t)return s;const a=new Date(t);return Number.isNaN(a.getTime())?s:a.toLocaleString()},Kc=(t,s="--")=>{if(!t)return s;const a=new Date(t);return Number.isNaN(a.getTime())?s:a.toLocaleDateString("en-IN",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},Jc=()=>{var re,se,X,F,U,h,k,f,G,le,Z,ie,N,V,v,q,J,xe,je,we,_,be,ve;const{orderId:t}=rs(),s=Te(),{user:a,logout:l}=Qe(),[r,c]=n.useState(!1),[o,i]=n.useState(null),[d,p]=n.useState(!0),[x,D]=n.useState(null),[g,R]=n.useState(!1),[u,I]=n.useState({status:"approved",notes:"",courier:"",trackingId:""}),[j,m]=n.useState(!1),S=n.useRef(null),P=n.useMemo(()=>"https://apis.qrfolio.net/api".replace(/\/?api\/?$/,""),[]),H=Bl(P,{withCredentials:!0}),E=n.useCallback(async()=>{var de,pe;try{p(!0),D(null);const $=await Ba(t),ce=$==null?void 0:$.data;if(!ce)throw new Error("Order not found");i(ce),ce.replacementRequest&&ce.replacementRequest.status!=="none"&&I(he=>{var Pe,$e;return{...he,status:"approved",notes:"",courier:((Pe=ce.replacementRequest.replacementShipment)==null?void 0:Pe.courier)||"",trackingId:(($e=ce.replacementRequest.replacementShipment)==null?void 0:$e.trackingId)||""}})}catch($){console.error("Failed to load order",$);const ce=((pe=(de=$==null?void 0:$.response)==null?void 0:de.data)==null?void 0:pe.message)||$.message||"Failed to load order";D(ce),ne.error(ce)}finally{p(!1)}},[t]);n.useEffect(()=>{E()},[E]),n.useEffect(()=>{const de=H.current;if(!de||!t)return;const pe="admin:orders",$=(ce={})=>{const he=ce.id||ce._id;he&&String(he)===String(t)&&E()};return de.emit("joinRoom",pe),de.on("order:updated",$),de.on("order:created",$),de.on("order:deleted",$),()=>{de.emit("leaveRoom",pe),de.off("order:updated",$),de.off("order:created",$),de.off("order:deleted",$)}},[H,t,E]);const w=()=>{s("/admin/orders")},A=(de,pe)=>{I($=>({...$,[de]:pe}))};n.useEffect(()=>{var de;gt.has(u.status)&&(I(pe=>({...pe,notes:pe.notes||""})),(de=S.current)==null||de.focus())},[u.status]);const W=de=>{I(pe=>({...pe,status:de,notes:gt.has(de)?"":pe.notes})),gt.has(de)&&setTimeout(()=>{var pe;(pe=S.current)==null||pe.focus(),ne("Add a reason before submitting your decision.")},0)},L=async de=>{var pe,$,ce,he,Pe,$e;if(de.preventDefault(),!!(o!=null&&o._id)){if(gt.has(u.status)&&!(u.notes&&u.notes.trim())){ne.error("Please provide a reason for rejecting this request."),(pe=S.current)==null||pe.focus();return}try{m(!0);const Me={status:u.status,notes:(($=u.notes)==null?void 0:$.trim())||void 0,courier:((ce=u.courier)==null?void 0:ce.trim())||void 0,trackingId:((he=u.trackingId)==null?void 0:he.trim())||void 0},qe=await ui(o._id,Me);if(!(qe!=null&&qe.success))throw new Error((qe==null?void 0:qe.message)||"Failed to update request");ne.success("Replacement request updated"),await E()}catch(Me){console.error("Failed to update replacement request",Me);const qe=(($e=(Pe=Me==null?void 0:Me.response)==null?void 0:Pe.data)==null?void 0:$e.message)||(Me==null?void 0:Me.message)||"Unable to update replacement request";ne.error(qe)}finally{m(!1)}}},K=(((re=o==null?void 0:o.payment)==null?void 0:re.status)||"pending").toLowerCase()==="paid",O=async()=>{var de,pe,$;if(!(o!=null&&o._id)){ne.error("Order details unavailable");return}if(!K){ne.error("Invoice will be available once the payment is successful.");return}R(!0);try{const ce=await fe.get(`/orders/${o._id}/invoice`,{responseType:"blob",headers:{Accept:"application/pdf"}}),he=ce.data,$e=(((de=ce.headers)==null?void 0:de["content-disposition"])||"").match(/filename="?([^";]+)"?/i),Me=($e==null?void 0:$e[1])||`invoice-${o._id}.pdf`,qe=window.URL.createObjectURL(he),rt=document.createElement("a");rt.href=qe,rt.download=Me,document.body.appendChild(rt),rt.click(),document.body.removeChild(rt),window.URL.revokeObjectURL(qe)}catch(ce){console.error("Invoice download failed",ce);const he=(($=(pe=ce==null?void 0:ce.response)==null?void 0:pe.data)==null?void 0:$.message)||(ce==null?void 0:ce.message)||"Unable to download invoice. Please try again.";ne.error(he)}finally{R(!1)}},Y=n.useMemo(()=>{const de=String((o==null?void 0:o.status)||"").toLowerCase(),pe=Wc[de];return pe?e.jsx("span",{className:`inline-flex rounded-full px-3 py-1 text-xs font-medium ${pe.badge}`,children:pe.label}):e.jsx("span",{className:"inline-flex rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-600",children:"Unknown"})},[o==null?void 0:o.status]),M=n.useMemo(()=>Kc(o==null?void 0:o.estimatedDeliveryDate),[o==null?void 0:o.estimatedDeliveryDate]),ee=((se=o==null?void 0:o.pricing)==null?void 0:se.subtotal)??0,te=((X=o==null?void 0:o.pricing)==null?void 0:X.shippingFee)??0,y=((F=o==null?void 0:o.pricing)==null?void 0:F.taxAmount)??0,z=((U=o==null?void 0:o.pricing)==null?void 0:U.discount)??0,b=((h=o==null?void 0:o.pricing)==null?void 0:h.total)??0,C=o==null?void 0:o.coupon,B=Array.isArray(o==null?void 0:o.items)?o.items:[];return d?e.jsxs("div",{className:"flex h-screen items-center justify-center bg-slate-50 text-slate-500",children:[e.jsx(Ie,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-3 text-sm",children:"Loading order details..."})]}):x||!o?e.jsx("div",{className:"flex h-screen flex-col items-center justify-center bg-slate-50 text-center text-slate-600",children:e.jsxs("div",{className:"rounded-3xl bg-white px-8 py-10 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Order not available"}),e.jsx("p",{className:"mt-2 text-sm text-slate-500",children:x||"The requested order could not be found."}),e.jsxs("button",{type:"button",onClick:w,className:"mt-6 inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700",children:[e.jsx(_t,{className:"h-4 w-4"}),"Back to orders"]})]})}):e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:e.jsxs("div",{className:"flex min-h-screen flex-col md:flex-row",children:[e.jsx(Ue,{active:"Orders",className:"hidden md:flex md:w-64",onNavigate:()=>c(!1)}),r&&e.jsxs("div",{className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx("button",{type:"button","aria-label":"Close sidebar",onClick:()=>c(!1),className:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm"}),e.jsx("div",{className:"relative z-50 h-full w-72 max-w-[85%] origin-left animate-slide-in bg-white shadow-2xl",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-6 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Navigation"}),e.jsx("button",{type:"button",onClick:()=>c(!1),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600","aria-label":"Close navigation",children:"✕"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Ue,{active:"Orders",className:"flex w-full md:hidden",onNavigate:()=>c(!1)})})]})})]}),e.jsxs("div",{className:"flex w-full flex-1 flex-col",children:[e.jsx(nt,{onToggleSidebar:()=>c(de=>!de),showRangeSelector:!1,showNotifications:!1,adminName:(a==null?void 0:a.name)||(a==null?void 0:a.username)||"Admin",adminRole:(a==null?void 0:a.role)==="admin"?"Administrator":a==null?void 0:a.role,onLogout:l}),e.jsx("main",{className:"flex-1 overflow-y-auto px-4 py-6 sm:px-8 sm:py-8",children:e.jsxs("div",{className:"mx-auto max-w-5xl space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("button",{type:"button",onClick:w,className:"inline-flex items-center gap-2 text-sm text-slate-500 transition hover:text-slate-700",children:[e.jsx(_t,{className:"h-4 w-4"})," Back to orders"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:O,disabled:g||!K,className:"inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",title:K?void 0:"Invoice will be available once the payment is successful.",children:[g?e.jsx(Ie,{className:"h-4 w-4 animate-spin"}):e.jsx(jt,{className:"h-4 w-4"}),K?"Download invoice":"Invoice locked"]}),o.replacementRequest&&o.replacementRequest.status&&o.replacementRequest.status!=="none"&&e.jsx(Q.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"rounded-3xl border border-primary/20 bg-primary/5 p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-primary",children:"Return & Replace request"}),e.jsxs("p",{className:"text-xs text-primary/70",children:["Requested on"," ",Da(o.replacementRequest.requestedAt)]})]}),e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-primary/30 bg-white px-3 py-1 text-xs font-medium text-primary",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-primary"}),o.replacementRequest.status.replace(/_/g," ")]})]})})]})]}),e.jsxs(Q.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-slate-500",children:["Order #",o._id]}),e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:((k=o.shippingAddress)==null?void 0:k.fullName)||"Customer"}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Placed on ",Da(o.createdAt)]})]}),Y]}),e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx(_a,{className:"h-5 w-5"})," Items"]}),e.jsx("p",{className:"mt-2 text-xl font-semibold text-slate-900",children:B.length||0})]}),e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx(Zr,{className:"h-5 w-5"})," Payment"]}),e.jsx("p",{className:"mt-2 text-xl font-semibold text-slate-900",children:((le=(G=(f=o.payment)==null?void 0:f.method)==null?void 0:G.toUpperCase)==null?void 0:le.call(G))||"--"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Status: ",((Z=o.payment)==null?void 0:Z.status)||"--"]})]}),e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx(Ta,{className:"h-5 w-5"})," Delivery"]}),e.jsx("p",{className:"mt-2 text-base font-semibold text-slate-900",children:M})]}),e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx(yn,{className:"h-5 w-5"})," Total"]}),e.jsx("p",{className:"mt-2 text-xl font-semibold text-slate-900",children:At(b)})]})]})]}),e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Order items"}),e.jsxs("div",{className:"mt-4 divide-y divide-slate-200",children:[B.map((de,pe)=>e.jsxs("div",{className:"flex flex-col gap-4 py-4 sm:flex-row",children:[e.jsxs("div",{className:"flex items-center gap-4 sm:w-1/2",children:[e.jsx("div",{className:"h-16 w-16 overflow-hidden rounded-xl bg-slate-100",children:de.image?e.jsx("img",{src:de.image,alt:de.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs text-slate-400",children:"No image"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:de.name}),de.size&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Size: ",de.size]})]})]}),e.jsxs("div",{className:"flex flex-1 flex-wrap items-center gap-3 text-sm text-slate-600",children:[e.jsxs("span",{children:["Qty: ",de.quantity]}),e.jsxs("span",{children:["Price: ",At(de.price)]}),e.jsxs("span",{children:["Total: ",At(de.price*de.quantity)]}),de.ratedAt&&e.jsxs("span",{className:"rounded-full bg-emerald-100 px-3 py-1 text-xs text-emerald-700",children:["Rated ",de.rating??0,"/5"]})]})]},`${de.product||de.name}-${pe}`)),B.length===0&&e.jsx("div",{className:"py-8 text-center text-sm text-slate-500",children:"No items recorded for this order."})]})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Delivery address"}),e.jsx("div",{className:"mt-4 space-y-2 text-sm text-slate-600",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 rounded-full bg-blue-50 p-2 text-blue-600",children:e.jsx(ua,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:(ie=o.shippingAddress)==null?void 0:ie.fullName}),e.jsx("p",{children:(N=o.shippingAddress)==null?void 0:N.addressLine}),e.jsxs("p",{children:[(V=o.shippingAddress)==null?void 0:V.city,","," ",(v=o.shippingAddress)==null?void 0:v.state," -"," ",(q=o.shippingAddress)==null?void 0:q.pincode]}),e.jsxs("p",{children:["Mobile: ",(J=o.shippingAddress)==null?void 0:J.mobile]}),((xe=o.shippingAddress)==null?void 0:xe.alternatePhone)&&e.jsxs("p",{children:["Alternate: ",o.shippingAddress.alternatePhone]}),e.jsxs("p",{children:["Email: ",(je=o.shippingAddress)==null?void 0:je.email]})]})]})})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Payment summary"}),(C==null?void 0:C.code)&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-600",children:"Coupon applied"})]}),e.jsxs("div",{className:"mt-4 space-y-3 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:At(ee)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:At(te)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:At(y)})]}),e.jsxs("div",{className:"flex items-center justify-between text-emerald-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-",At(z)]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-200 pt-3 text-base font-semibold text-slate-900",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:At(b)})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Transaction ID: ",((we=o.payment)==null?void 0:we.transactionId)||"--"]})]})]})]}),o.replacementRequest&&o.replacementRequest.status&&o.replacementRequest.status!=="none"&&e.jsxs("section",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Return & Replace request"}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>W("approved"),className:"inline-flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs font-semibold text-emerald-700 hover:bg-emerald-100",children:"Approve request"}),e.jsx("button",{type:"button",onClick:()=>W("rejected"),className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs font-semibold text-rose-700 hover:bg-rose-100",children:"Reject request"})]}),e.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsx("h3",{className:"text-sm font-semibold text-primary",children:"Item details"}),e.jsxs("p",{className:"font-medium text-slate-900",children:[o.replacementRequest.itemName,o.replacementRequest.itemSize&&` • Size ${o.replacementRequest.itemSize}`]}),e.jsxs("p",{children:["Quantity: ",o.replacementRequest.quantity||1]}),o.replacementRequest.issueDescription&&e.jsx("p",{className:"rounded-xl border border-primary/20 bg-white p-3 text-sm text-slate-700",children:o.replacementRequest.issueDescription})]}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsx("h3",{className:"text-sm font-semibold text-primary",children:"Replacement preferences"}),e.jsxs("p",{children:["Size:"," ",((_=o.replacementRequest.replacementPreferences)==null?void 0:_.size)||"--"]}),e.jsxs("p",{children:["Color:"," ",((be=o.replacementRequest.replacementPreferences)==null?void 0:be.color)||"--"]}),e.jsxs("p",{children:["Notes:"," ",((ve=o.replacementRequest.replacementPreferences)==null?void 0:ve.remarks)||"--"]}),o.replacementRequest.adminNotes&&e.jsxs("p",{className:"rounded-xl border border-emerald-200 bg-emerald-50 p-3 text-sm text-emerald-700",children:["Admin notes: ",o.replacementRequest.adminNotes]})]})]}),e.jsxs("form",{className:"mt-6 grid gap-4 md:grid-cols-[1fr_1fr]",onSubmit:L,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:"Update status"}),e.jsx("select",{value:u.status,onChange:de=>A("status",de.target.value),className:"w-full rounded-xl border border-primary/30 px-3 py-2 text-sm focus:border-primary focus:outline-none",required:!0,children:Yc.map(de=>e.jsx("option",{value:de.value,children:de.label},de.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:"Courier (optional)"}),e.jsx("input",{value:u.courier,onChange:de=>A("courier",de.target.value),className:"w-full rounded-xl border border-primary/30 px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"e.g. Delhivery"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:"Tracking ID (optional)"}),e.jsx("input",{value:u.trackingId,onChange:de=>A("trackingId",de.target.value),className:"w-full rounded-xl border border-primary/30 px-3 py-2 text-sm focus:border-primary focus:outline-none",placeholder:"e.g. AWB123456"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:"Notes for customer"}),e.jsx("textarea",{value:u.notes,onChange:de=>A("notes",de.target.value),rows:3,ref:S,required:gt.has(u.status),className:`w-full rounded-xl border px-3 py-2 text-sm focus:border-primary focus:outline-none ${gt.has(u.status)?"border-rose-200":"border-primary/30"}`,placeholder:gt.has(u.status)?"Explain why you are rejecting this request.":"Share updates or next actions (optional)."}),gt.has(u.status)?e.jsx("p",{className:"text-xs text-rose-500",children:"A reason is required when rejecting."}):e.jsx("p",{className:"text-xs text-slate-500",children:"Optional message shared with the customer."})]}),e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-3 md:col-span-2",children:e.jsx("button",{type:"submit",disabled:j||gt.has(u.status)&&!(u.notes&&u.notes.trim()),className:"inline-flex items-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-primary-dark disabled:cursor-not-allowed disabled:opacity-60",children:j?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-4 w-4 animate-spin"})," ","Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(jn,{className:"h-4 w-4"})," Update request"]})})})]})]}),Array.isArray(o.replacementRequest.history)&&o.replacementRequest.history.length>0&&e.jsxs("div",{className:"mt-6 rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold text-slate-800",children:"Activity log"}),e.jsx("ul",{className:"space-y-2 text-xs text-slate-600",children:o.replacementRequest.history.slice().reverse().map((de,pe)=>{var $;return e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-0.5 inline-flex h-2 w-2 rounded-full bg-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-800",children:(($=de.status)==null?void 0:$.replace(/_/g," "))||"Update"}),e.jsx("p",{children:de.note||"Status updated"}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:[Da(de.at),de.actor?` • by ${de.actor}`:""]})]})]},`${de.at||pe}-${de.status}`)})})]})]})})]})]})})},vs={title:"",description:"",slug:"",order:0,isActive:!0,responseDelayMs:2e3,questions:[{question:"",answer:"",order:0}]},Xc=()=>{var te;const[t,s]=n.useState([]),[a,l]=n.useState(null),[r,c]=n.useState(!1),[o,i]=n.useState(!1),[d,p]=n.useState(""),[x,D]=n.useState(!1),[g,R]=n.useState(!1),[u,I]=n.useState(!1),[j,m]=n.useState(vs),{user:S,logout:P}=Qe(),H=n.useMemo(()=>t.find(y=>y._id===a)||null,[t,a]),E=async()=>{i(!0);try{const y=await Qo(),z=Array.isArray(y.data)?y.data:[];s(z.sort((b,C)=>{const B=b.order??0,re=C.order??0;return B===re?b.title.localeCompare(C.title):B-re})),p(""),z.length&&!a&&l(z[0]._id)}catch(y){console.error("Failed to load help topics",y),p(y.message||"Failed to load help topics")}finally{i(!1)}};n.useEffect(()=>{E()},[]);const w=y=>{var z;m(y?{_id:y._id,title:y.title||"",description:y.description||"",slug:y.slug||"",order:y.order??0,isActive:y.isActive!==!1,responseDelayMs:y.responseDelayMs??2e3,questions:(z=y.questions)!=null&&z.length?y.questions.map((b,C)=>({_id:b._id,question:b.question||"",answer:b.answer||"",order:b.order??C})):[...vs.questions]}:{...vs,questions:[...vs.questions]}),I(!0)},A=()=>{I(!1),m(vs)},W=y=>{m(z=>({...z,...y}))},L=(y,z)=>{m(b=>{const C=[...b.questions];return C[y]={...C[y],...z},{...b,questions:C}})},K=()=>{m(y=>({...y,questions:[...y.questions,{question:"",answer:"",order:y.questions.length}]}))},O=y=>{m(z=>({...z,questions:z.questions.filter((b,C)=>C!==y)}))},Y=y=>{var z,b,C;return{title:(z=y.title)==null?void 0:z.trim(),description:(b=y.description)==null?void 0:b.trim(),slug:((C=y.slug)==null?void 0:C.trim())||void 0,order:Number(y.order)||0,isActive:!!y.isActive,responseDelayMs:Math.max(0,Number(y.responseDelayMs)||0),questions:y.questions.map((B,re)=>{var se,X;return{_id:B._id,question:(se=B.question)==null?void 0:se.trim(),answer:(X=B.answer)==null?void 0:X.trim(),order:Number.isFinite(Number(B.order))?Number(B.order):re}}).filter(B=>B.question&&B.answer)}},M=async()=>{if(!j.title.trim()){ge.error("Topic title is required");return}const y=Y(j);if(!y.questions.length){ge.error("Add at least one question with an answer");return}D(!0);try{let z;j._id?(z=await Yo(j._id,y),ge.success("Topic updated")):(z=await Wo(y),ge.success("Topic created"));const b=z.data||z;s(C=>[...C.filter(re=>re._id!==b._id),b].sort((re,se)=>{const X=re.order??0,F=se.order??0;return X===F?re.title.localeCompare(se.title):X-F})),l(b._id),A()}catch(z){console.error("Failed to save topic",z),ge.error(z.message||"Failed to save topic")}finally{D(!1)}},ee=async y=>{R(!0);try{await Ko(y),ge.success("Topic deleted"),s(z=>z.filter(b=>b._id!==y)),a===y&&l(null)}catch(z){console.error("Failed to delete topic",z),ge.error(z.message||"Failed to delete topic")}finally{R(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:[e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(Ue,{active:"Help & Support",className:"hidden lg:flex lg:w-64 lg:flex-none",onNavigate:()=>c(!1)}),e.jsx(ze,{children:r&&e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx(Q.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(Ue,{active:"Help & Support",className:"flex w-full",onNavigate:()=>c(!1)})}),e.jsx("button",{type:"button",onClick:()=>c(!1),className:"flex-1 bg-black/30","aria-label":"Close sidebar"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(nt,{onToggleSidebar:()=>c(y=>!y),adminName:S==null?void 0:S.name,adminRole:S==null?void 0:S.role,onLogout:P}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Help & Support Manager"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Create, update, and organise chatbot topics and quick answers."})]}),e.jsxs("button",{onClick:()=>w(null),className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-semibold shadow-sm hover:bg-blue-700 transition",children:[e.jsx(ft,{size:16}),"Add Topic"]})]}),e.jsxs("div",{className:"grid lg:grid-cols-[320px_1fr] gap-6",children:[e.jsxs("section",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm",children:[e.jsxs("header",{className:"px-5 py-4 border-b border-slate-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-700 uppercase tracking-wide",children:"Topics"}),o&&e.jsx(Ie,{size:16,className:"animate-spin text-slate-400"})]}),e.jsx("div",{className:"max-h-[520px] overflow-y-auto divide-y divide-slate-100",children:d?e.jsx("p",{className:"px-5 py-6 text-sm text-rose-500",children:d}):t.length?t.map(y=>{const z=y._id===a;return e.jsxs("button",{onClick:()=>l(y._id),className:`w-full text-left px-5 py-4 transition ${z?"bg-blue-50 border-l-4 border-blue-500":"hover:bg-slate-50"}`,children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-800 flex items-center gap-2",children:[y.title,y.isActive===!1?e.jsx("span",{className:"text-[10px] uppercase tracking-wide bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full",children:"Hidden"}):null]}),y.description?e.jsx("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:y.description}):null]},y._id)}):e.jsx("div",{className:"px-5 py-6 text-sm text-slate-500",children:o?"Loading topics…":"No topics yet. Create the first one."})})]}),e.jsx("section",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6 space-y-6",children:H?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:H.title}),H.description?e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:H.description}):null,e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3 text-xs text-slate-500",children:[e.jsxs("span",{className:"px-3 py-1 border border-slate-200 rounded-full",children:["Order: ",H.order??0]}),e.jsx("span",{className:`px-3 py-1 rounded-full border ${H.isActive===!1?"bg-slate-100 text-slate-600 border-slate-200":"bg-emerald-50 text-emerald-600 border-emerald-100"}`,children:H.isActive===!1?"Hidden":"Visible"}),H.slug?e.jsxs("span",{className:"px-3 py-1 border border-slate-200 rounded-full",children:["Slug: ",H.slug]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>w(H),className:"inline-flex items-center gap-1 px-3 py-2 text-xs font-semibold text-blue-600 border border-blue-100 rounded-lg hover:bg-blue-50 transition",children:[e.jsx(Cs,{size:14})," Edit"]}),e.jsxs("button",{onClick:()=>ee(H._id),disabled:g,className:"inline-flex items-center gap-1 px-3 py-2 text-xs font-semibold text-rose-600 border border-rose-100 rounded-lg hover:bg-rose-50 transition disabled:opacity-50",children:[g?e.jsx(Ie,{size:14,className:"animate-spin"}):e.jsx(Je,{size:14}),"Delete"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase text-slate-600 tracking-wide",children:"Questions & Answers"}),e.jsx("div",{className:"space-y-3",children:(te=H.questions)!=null&&te.length?H.questions.slice().sort((y,z)=>(y.order??0)-(z.order??0)).map(y=>e.jsxs("div",{className:"border border-slate-200 rounded-xl p-4 bg-slate-50",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:y.question}),e.jsx("p",{className:"text-sm text-slate-600 mt-2 whitespace-pre-line",children:y.answer})]},y._id)):e.jsx("p",{className:"text-sm text-slate-500",children:"No questions added yet."})})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center text-center py-12 gap-3 text-slate-500",children:e.jsx("p",{className:"text-sm",children:"Select a topic on the left to preview its content."})})})]})]})]})]}),u&&e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-slate-900/30 backdrop-blur-sm px-4",children:e.jsxs("div",{className:"w-full max-w-3xl bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:j._id?"Edit Topic":"Create Topic"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Update the category details and associated questions."})]}),e.jsx("button",{onClick:A,className:"p-2 rounded-full text-slate-500 hover:bg-slate-100","aria-label":"Close",children:e.jsx(Ze,{size:18})})]}),e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Title"}),e.jsx("input",{type:"text",value:j.title,onChange:y=>W({title:y.target.value}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"E.g. Orders & Delivery"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Slug (optional)"}),e.jsx("input",{type:"text",value:j.slug,onChange:y=>W({slug:y.target.value}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"orders-delivery"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Display Order"}),e.jsx("input",{type:"number",value:j.order,onChange:y=>W({order:Number(y.target.value)}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",min:0})]}),e.jsxs("label",{className:"flex items-center gap-3 mt-6",children:[e.jsx("input",{type:"checkbox",checked:j.isActive,onChange:y=>W({isActive:y.target.checked}),className:"h-4 w-4 text-blue-600 border-slate-300 rounded"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Visible to customers"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Response Delay (seconds)"}),e.jsx("input",{type:"number",min:0,step:.5,value:Number((j.responseDelayMs??0)/1e3).toString(),onChange:y=>W({responseDelayMs:Math.max(0,Number(y.target.value)*1e3)}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"e.g. 2"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:"Time the assistant waits before replying. Defaults to 2 seconds."})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Description (optional)"}),e.jsx("textarea",{value:j.description,onChange:y=>W({description:y.target.value}),rows:3,className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"Short summary to help admins identify the topic"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wide text-slate-600",children:"Questions"}),e.jsxs("button",{onClick:K,className:"inline-flex items-center gap-2 text-xs font-semibold px-3 py-2 border border-dashed border-slate-300 rounded-lg hover:border-blue-400 hover:text-blue-600 transition",children:[e.jsx(ft,{size:14})," Add Question"]})]}),e.jsx("div",{className:"space-y-4",children:j.questions.map((y,z)=>e.jsxs("div",{className:"border border-slate-200 rounded-xl p-4 space-y-3 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase text-slate-500",children:["Question #",z+1]}),j.questions.length>1&&e.jsxs("button",{onClick:()=>O(z),className:"text-xs text-rose-500 inline-flex items-center gap-1",children:[e.jsx(Je,{size:14})," Remove"]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Question"}),e.jsx("input",{type:"text",value:y.question,onChange:b=>L(z,{question:b.target.value}),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"Enter the customer's question"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Answer"}),e.jsx("textarea",{value:y.answer,onChange:b=>L(z,{answer:b.target.value}),rows:3,className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"Provide the assistant's response"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Display Order"}),e.jsx("input",{type:"number",value:y.order??z,onChange:b=>L(z,{order:Number(b.target.value)}),min:0,className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200"})]})]},y._id||z))})]})]}),e.jsxs("footer",{className:"px-6 py-4 border-t border-slate-100 flex items-center justify-end gap-3 bg-slate-50",children:[e.jsx("button",{onClick:A,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold text-slate-600 border border-slate-200 hover:bg-white",children:"Cancel"}),e.jsxs("button",{onClick:M,disabled:x,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",children:[x?e.jsx(Ie,{size:16,className:"animate-spin"}):e.jsx(Ua,{size:16})," ","Save Changes"]})]})]})})]})},Zc=()=>Nt(),ed=mt,td=async()=>(await fe.get("/admin/hero-carousel")).data,sd=async t=>(await fe.post("/admin/hero-carousel",t)).data,ad=async(t,s)=>(await fe.put(`/admin/hero-carousel/${t}`,s)).data,rd=async t=>(await fe.delete(`/admin/hero-carousel/${t}`)).data,ld=async t=>(await fe.post("/admin/hero-carousel/reorder",{order:t})).data,Ws=We("adminHeroCarousel/fetchAll",async(t,{rejectWithValue:s})=>{try{return(await td()).data||[]}catch(a){return s(a.message||"Failed to load hero slides")}}),Ys=We("adminHeroCarousel/create",async(t,{rejectWithValue:s})=>{try{return(await sd(t)).data}catch(a){return s(a.message||"Failed to create hero slide")}}),Ks=We("adminHeroCarousel/update",async({id:t,payload:s},{rejectWithValue:a})=>{try{return(await ad(t,s)).data}catch(l){return a(l.message||"Failed to update hero slide")}}),Js=We("adminHeroCarousel/delete",async(t,{rejectWithValue:s})=>{try{return(await rd(t)).data}catch(a){return s(a.message||"Failed to delete hero slide")}}),Xs=We("adminHeroCarousel/reorder",async(t,{rejectWithValue:s})=>{try{return(await ld(t)).data||[]}catch(a){return s(a.message||"Failed to reorder hero slides")}}),Qt={title:"",description:"",overline:"",titleColor:"",overlineColor:"",descriptionColor:"",imageUrl:"",primaryCta:{label:"",href:""},secondaryCta:{label:"",href:""},showPrimaryCta:!0,showSecondaryCta:!0,showTitle:!0,showOverline:!0,showDescription:!0,metadata:{productId:""},isActive:!0,order:0},ws="admin-hero-carousel-draft",nd=3*1024*1024,id=(t,s)=>{if(!t)return"";if(typeof t.get=="function"){const l=t.get(s);return typeof l=="string"?l:l!=null?String(l):""}const a=t[s];return a==null?"":typeof a=="string"?a:String(a)},od=()=>e.jsx("span",{className:"flex cursor-grab items-center text-slate-400",children:e.jsx(vn,{size:18})}),cd=({draft:t,onChange:s,onSave:a,onCancel:l,isSaving:r})=>{var R,u,I,j,m;const c=S=>P=>{const H=P.target.type==="checkbox"?P.target.checked:P.target.value;s({...t,[S]:H})},o=(S,P)=>H=>{const E=H.target.value;s({...t,[S]:{...t[S]||{},[P]:E}})},i=S=>P=>{const H=P.target.value;s({...t,metadata:{...t.metadata||{},[S]:H}})},[d,p]=n.useState(null),x=S=>new Promise((P,H)=>{const E=new FileReader;E.onload=()=>P(E.result),E.onerror=()=>H(new Error("Failed to read file")),E.readAsDataURL(S)}),D=(S,P)=>async H=>{var w;const E=(w=H.target.files)==null?void 0:w[0];if(E){if(!E.type.startsWith("image/")){ne.error("Please upload an image file"),H.target.value="";return}if(E.size>nd){ne.error("Image must be smaller than 3MB"),H.target.value="";return}p(S);try{const A=await x(E);s({...t,[S]:A}),ne.success(`${P} ready to upload`)}catch{ne.error("Failed to process image")}finally{p(null),H.target.value=""}}},g=S=>()=>{s({...t,[S]:""})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"Title *"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:t.showTitle,onChange:c("showTitle"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),"Show title"]}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-200 px-3 py-2",value:t.title,onChange:c("title"),maxLength:120,required:!0})]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"Overline"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:t.showOverline,onChange:c("showOverline"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),"Show overline"]}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-200 px-3 py-2",value:t.overline,onChange:c("overline"),maxLength:160})]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"Priority"}),e.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-200 px-3 py-2",value:t.order??0,onChange:c("order"),min:0})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"Title Color"}),e.jsx("input",{type:"color",className:"h-10 w-full cursor-pointer rounded-lg border border-slate-200 px-3 py-2",value:t.titleColor||"#ffffff",onChange:c("titleColor")}),e.jsx("button",{type:"button",className:"text-xs text-slate-500 hover:text-slate-700",onClick:()=>s({...t,titleColor:""}),children:"Reset"})]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"Overline Color"}),e.jsx("input",{type:"color",className:"h-10 w-full cursor-pointer rounded-lg border border-slate-200 px-3 py-2",value:t.overlineColor||"#ffffff",onChange:c("overlineColor")}),e.jsx("button",{type:"button",className:"text-xs text-slate-500 hover:text-slate-700",onClick:()=>s({...t,overlineColor:""}),children:"Reset"})]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"Description Color"}),e.jsx("input",{type:"color",className:"h-10 w-full cursor-pointer rounded-lg border border-slate-200 px-3 py-2",value:t.descriptionColor||"#d1d5db",onChange:c("descriptionColor")}),e.jsx("button",{type:"button",className:"text-xs text-slate-500 hover:text-slate-700",onClick:()=>s({...t,descriptionColor:""}),children:"Reset"})]})]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"Description"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:t.showDescription,onChange:c("showDescription"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),"Show description"]}),e.jsx("textarea",{className:"w-full rounded-lg border border-slate-200 px-3 py-2",rows:3,value:t.description,onChange:c("description"),maxLength:300})]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-600",children:"Primary Image URL *"}),e.jsx("input",{type:"url",className:"w-full rounded-lg border border-slate-200 px-3 py-2",value:t.imageUrl,onChange:c("imageUrl"),required:!0}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-2 text-xs text-slate-500",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:D("imageUrl","Primary image"),className:"max-w-xs text-xs text-slate-500 file:mr-3 file:cursor-pointer file:rounded-full file:border-0 file:bg-blue-600 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-white file:shadow-sm hover:file:bg-blue-500"}),d==="imageUrl"&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-blue-600",children:[e.jsx(Ie,{size:14,className:"animate-spin"})," Uploading..."]}),t.imageUrl&&e.jsx("button",{type:"button",onClick:g("imageUrl"),className:"text-xs font-medium text-rose-600 hover:text-rose-700",children:"Clear image"})]}),t.imageUrl&&e.jsx("div",{className:"mt-3 overflow-hidden rounded-lg border border-slate-200 bg-slate-50",children:e.jsx("img",{src:t.imageUrl,alt:"Hero slide primary preview",className:"h-32 w-full object-cover"})})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3 rounded-xl border border-slate-200 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-600",children:"Primary CTA"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:t.showPrimaryCta,onChange:c("showPrimaryCta"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),"Show primary button"]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{children:"Label"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-200 px-3 py-2",value:((R=t.primaryCta)==null?void 0:R.label)||"",onChange:o("primaryCta","label"),maxLength:60})]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{children:"URL"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-200 px-3 py-2",value:((u=t.primaryCta)==null?void 0:u.href)||"",onChange:o("primaryCta","href"),maxLength:200,placeholder:"Optional"})]})]}),e.jsxs("div",{className:"space-y-3 rounded-xl border border-slate-200 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-600",children:"Secondary CTA"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:t.showSecondaryCta,onChange:c("showSecondaryCta"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),"Show secondary button"]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{children:"Label"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-200 px-3 py-2",value:((I=t.secondaryCta)==null?void 0:I.label)||"",onChange:o("secondaryCta","label"),maxLength:60})]}),e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{children:"URL"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-200 px-3 py-2",value:((j=t.secondaryCta)==null?void 0:j.href)||"",onChange:o("secondaryCta","href"),maxLength:200,placeholder:"Optional"})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-600",children:"Product Reference"}),e.jsx("p",{className:"mb-3 text-xs text-slate-500",children:"Provide the product ID, slug, or URL to link this slide directly to a product detail page. The storefront will prefer these values over the auto-detected match."}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-3",children:e.jsxs("label",{className:"space-y-1 text-sm",children:[e.jsx("span",{children:"Product ID"}),e.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-200 px-3 py-2",value:((m=t.metadata)==null?void 0:m.productId)||"",onChange:i("productId"),placeholder:"Mongo ID",maxLength:48})]})})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:t.isActive,onChange:c("isActive"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),"Slide is active"]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-end",children:[e.jsx("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:a,disabled:r,className:"inline-flex items-center gap-2 rounded-full bg-blue-600 px-5 py-2 text-sm font-semibold text-white shadow-lg transition hover:bg-blue-500 disabled:cursor-not-allowed disabled:bg-blue-400",children:[e.jsx(Ua,{size:18}),r?"Saving...":"Save Slide"]})]})]})},dd=({slide:t,onEdit:s,onDelete:a,isDeleting:l,dragHandleProps:r})=>e.jsxs(Q.div,{layout:!0,className:"group flex items-center gap-4 rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[e.jsx("div",{...r,className:"hidden cursor-grab md:block",children:e.jsx(od,{})}),e.jsx("div",{className:"relative h-20 w-32 overflow-hidden rounded-xl bg-slate-100",children:t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.title,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-slate-400",children:e.jsx(el,{size:24})})}),e.jsxs("div",{className:"flex flex-1 flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900",children:t.title}),!t.isActive&&e.jsx("span",{className:"rounded-full bg-slate-200 px-2 py-0.5 text-xs font-medium text-slate-600",children:"Inactive"})]}),t.subtitle&&e.jsx("p",{className:"text-sm text-slate-500 line-clamp-2",children:t.subtitle}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Priority: ",t.order??0]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:s,className:"inline-flex items-center gap-1 rounded-full border border-slate-200 px-3 py-1.5 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",children:[e.jsx(Nn,{size:16})," Edit"]}),e.jsxs("button",{type:"button",onClick:a,disabled:l,className:"inline-flex items-center gap-1 rounded-full border border-rose-200 px-3 py-1.5 text-sm font-medium text-rose-600 transition hover:bg-rose-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx(Je,{size:16})," Delete"]})]})]}),md=300,ud=()=>{const t=Zc(),{user:s,logout:a}=Qe(),[l,r]=n.useState(!1),[c,o]=n.useState(Qt),[i,d]=n.useState(null),[p,x]=n.useState(""),[D,g]=n.useState(!1),R=n.useCallback(()=>{typeof window>"u"||window.localStorage.removeItem(ws)},[]);n.useEffect(()=>{if(typeof window>"u")return;const C=window.localStorage.getItem(ws);if(C)try{const B=JSON.parse(C);B&&typeof B=="object"&&B.draft&&(o({...Qt,...B.draft}),d(typeof B.editingId=="string"&&B.editingId?B.editingId:null),g(!0))}catch(B){console.error("Failed to restore hero slide draft",B),window.localStorage.removeItem(ws)}},[]),n.useEffect(()=>{if(!(typeof window>"u")){if(!D){window.localStorage.removeItem(ws);return}try{window.localStorage.setItem(ws,JSON.stringify({draft:c,editingId:i}))}catch(C){console.error("Failed to persist hero slide draft",C)}}},[c,i,D]);const{items:u,status:I,error:j,saving:m,deletingId:S,reorderStatus:P}=ed(C=>C.adminHeroCarousel);n.useEffect(()=>{t(Ws())},[t]);const H=n.useMemo(()=>{if(!p.trim())return u;const C=p.trim().toLowerCase();return u.filter(B=>[B.title,B.subtitle,B.overline].filter(Boolean).some(re=>re.toLowerCase().includes(C)))},[u,p]),E=()=>{o({...Qt,order:u.length}),d(null),g(!0)},w=C=>{var B,re,se,X;o({...Qt,...C,primaryCta:{label:((B=C.primaryCta)==null?void 0:B.label)||"",href:((re=C.primaryCta)==null?void 0:re.href)||""},secondaryCta:{label:((se=C.secondaryCta)==null?void 0:se.label)||"",href:((X=C.secondaryCta)==null?void 0:X.href)||""},metadata:{productId:id(C.metadata,"productId")},titleColor:C.titleColor||"",overlineColor:C.overlineColor||"",descriptionColor:C.descriptionColor||"",showPrimaryCta:typeof C.showPrimaryCta=="boolean"?C.showPrimaryCta:!0,showSecondaryCta:typeof C.showSecondaryCta=="boolean"?C.showSecondaryCta:!0,showTitle:typeof C.showTitle=="boolean"?C.showTitle:!0,showOverline:typeof C.showOverline=="boolean"?C.showOverline:!0,showDescription:typeof C.showDescription=="boolean"?C.showDescription:!0}),d(C._id),g(!0)},A=async()=>{if(!c.title.trim()||!c.imageUrl.trim()){ne.error("Title and Image URL are required");return}const C=X=>typeof X=="string"?X.trim():X,B=X=>{if(!X)return;const F=C(X.label||""),U=C(X.href||"");if(!(!F&&!U))return{...F?{label:F}:{},...U?{href:U}:{}}},re=X=>{const F=C((X==null?void 0:X.productId)||"");return F?{productId:F}:void 0},se={title:C(c.title),description:C(c.description),overline:C(c.overline),imageUrl:C(c.imageUrl),titleColor:C(c.titleColor)||void 0,overlineColor:C(c.overlineColor)||void 0,descriptionColor:C(c.descriptionColor)||void 0,primaryCta:B(c.primaryCta),secondaryCta:B(c.secondaryCta),metadata:re(c.metadata),showPrimaryCta:!!c.showPrimaryCta,showSecondaryCta:!!c.showSecondaryCta,showTitle:!!c.showTitle,showOverline:!!c.showOverline,showDescription:!!c.showDescription,isActive:c.isActive,order:Number(c.order)||0};try{i?(await t(Ks({id:i,payload:se})).unwrap(),ne.success("Slide updated")):(await t(Ys(se)).unwrap(),ne.success("Slide created")),R(),g(!1),d(null),o(Qt)}catch(X){ne.error(X.message||"Failed to save slide")}},W=async C=>{if(window.confirm("Delete this slide? This action cannot be undone"))try{await t(Js(C)).unwrap(),ne.success("Slide deleted")}catch(re){ne.error(re.message||"Failed to delete slide")}},[L,K]=n.useState([]),O=n.useMemo(()=>Bn(C=>{t(Xs(C)).unwrap().catch(B=>{ne.error(B.message||"Failed to reorder slides")})},md),[t]);n.useEffect(()=>()=>{O.cancel()},[O]);const Y=C=>{K(H.map(B=>B._id)),ee(C)},[M,ee]=n.useState(null),te=C=>{C.preventDefault()},y=C=>{if(M===null||M===C){ee(null);return}const B=[...H],[re]=B.splice(M,1);B.splice(C,0,re);const X=B.map((F,U)=>({...F,order:U})).map(F=>F._id);K(X),O(X),ee(null)},z=I==="loading",b=!z&&H.length===0;return e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900 overflow-x-hidden",children:e.jsxs("div",{className:"flex md:h-screen",children:[e.jsx(Ue,{active:"Hero Carousel",className:"hidden md:flex md:w-64",onNavigate:()=>r(!1)}),e.jsx(ze,{children:l&&e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx(Q.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(Ue,{active:"Hero Carousel",className:"flex w-full",onNavigate:()=>r(!1)})}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 bg-black/30","aria-label":"Close sidebar"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(nt,{onToggleSidebar:()=>r(C=>!C),activeRange:"All Date",onSelectRange:()=>{},adminName:(s==null?void 0:s.name)||(s==null?void 0:s.username)||"Admin",adminRole:(s==null?void 0:s.role)==="admin"?"Administrator":s==null?void 0:s.role,showRangeSelector:!1,showNotifications:!1,onLogout:a}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-4 py-6 md:px-8 space-y-6",children:[e.jsxs("header",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Hero Carousel"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Manage hero slides, copy, and call-to-actions displayed on the storefront home page."})]}),e.jsxs("button",{type:"button",onClick:E,className:"inline-flex items-center gap-2 rounded-full bg-blue-600 px-5 py-2 text-sm font-semibold text-white shadow-lg transition hover:bg-blue-500",children:[e.jsx(ft,{size:18})," New Slide"]})]}),e.jsxs("div",{className:"flex flex-col gap-4 rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search slides",value:p,onChange:C=>x(C.target.value),className:"w-full rounded-full border border-slate-200 px-4 py-2 text-sm focus:border-blue-500 focus:outline-none"}),p&&e.jsx("button",{type:"button",onClick:()=>x(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-slate-400 hover:text-slate-600",children:"Clear"})]}),e.jsxs("span",{className:"text-xs font-medium uppercase tracking-wide text-slate-400",children:[H.length," slide",H.length===1?"":"s"]})]}),P==="loading"&&e.jsxs("span",{className:"inline-flex items-center gap-2 text-xs text-slate-400",children:[e.jsx(Ie,{size:14,className:"animate-spin"})," Saving order..."]})]}),z?e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-2xl border border-dashed border-slate-200 py-16 text-slate-400",children:[e.jsx(Ie,{size:32,className:"animate-spin"}),e.jsx("p",{className:"mt-3 text-sm",children:"Loading hero slides..."})]}):b?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 rounded-2xl border border-dashed border-slate-200 py-16 text-center",children:[e.jsx("div",{className:"rounded-full bg-blue-50 p-3 text-blue-500",children:e.jsx(el,{size:24})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-600",children:"No slides yet"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Create your first slide to welcome customers with custom copy and visuals."})]}),e.jsxs("button",{type:"button",onClick:E,className:"inline-flex items-center gap-2 rounded-full border border-blue-200 px-4 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50",children:[e.jsx(ft,{size:16})," Create slide"]})]}):e.jsx(Q.div,{layout:!0,className:"space-y-3",children:H.map((C,B)=>e.jsx("div",{draggable:!0,onDragStart:()=>Y(B),onDragOver:te,onDrop:()=>y(B),children:e.jsx(dd,{slide:C,onEdit:()=>w(C),onDelete:()=>W(C._id),isDeleting:S===C._id,dragHandleProps:{}})},C._id))}),j&&e.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600",children:j})]}),e.jsx(ze,{children:D&&e.jsxs(Q.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:12},className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl",children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:i?"Edit Slide":"Create Slide"}),e.jsx("p",{className:"text-sm text-slate-500",children:i?"Update content, CTAs and imagery for this hero position.":"Add a new card to the hero carousel with imagery and calls to action."})]})}),e.jsx(cd,{draft:c,onChange:o,onSave:A,onCancel:()=>{R(),g(!1),d(null),o(Qt)},isSaving:m})]})})]})]})]})})},xd=async()=>{const s=(await fe.get("/admin/users")).data||{};if(!s.success)throw new Error(s.message||"Failed to fetch users");return s.data||[]},pd=()=>{const[t,s]=n.useState([]),[a,l]=n.useState(!0),[r,c]=n.useState(!1),[o,i]=n.useState(""),[d,p]=n.useState(!1),{user:x,logout:D}=Qe(),g=async({silent:j}={silent:!1})=>{try{j?c(!0):l(!0);const m=await xd();s(Array.isArray(m)?m:[]),i("")}catch(m){console.error("Failed to load users",m),i(m.message||"Unable to load users. Please try again.")}finally{j?c(!1):l(!1)}};n.useEffect(()=>{g()},[]);const R=j=>{if(j!=null&&j.__delete){s(m=>m.filter(S=>S._id!==j._id));return}if(j!=null&&j.__bulkDelete&&Array.isArray(j.deletedIds)){s(m=>m.filter(S=>!j.deletedIds.includes(S._id)));return}j!=null&&j._id&&s(m=>m.map(S=>S._id===j._id?{...S,...j}:S))},u=n.useMemo(()=>{const j=t.length,m=t.filter(H=>H.role==="admin").length,S=t.filter(H=>H.isVerified).length,P=j-m;return{total:j,admins:m,customers:P,verified:S}},[t]),I=()=>{r||g({silent:!0})};return e.jsx("div",{className:"min-h-screen md:h-screen bg-slate-50 text-slate-900 overflow-x-hidden",children:e.jsxs("div",{className:"flex md:h-screen",children:[e.jsx(Ue,{active:"Customers",className:"hidden md:flex md:w-64 md:flex-none",onNavigate:()=>p(!1)}),e.jsx(ze,{children:d&&e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx(Q.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(Ue,{active:"Customers",className:"flex w-full",onNavigate:()=>p(!1)})}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 bg-black/30","aria-label":"Close sidebar"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(nt,{onToggleSidebar:()=>p(j=>!j),activeRange:"All Time",onSelectRange:()=>{},adminName:(x==null?void 0:x.name)||(x==null?void 0:x.username)||"Admin",adminRole:(x==null?void 0:x.role)==="admin"?"Administrator":x==null?void 0:x.role,notifications:{pendingOrders:0,shippedOrders:0,deliveredOrders:0},showRangeSelector:!1,showNotifications:!1,onLogout:D}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-4 py-6 md:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Dashboard / Customers"}),e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Customers & Admins"})]}),e.jsxs("button",{type:"button",onClick:I,disabled:r,className:"inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-60",children:[e.jsx(tl,{size:16,className:r?"animate-spin":void 0}),r?"Refreshing":"Refresh"]})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Total Accounts"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold",children:u.total})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Customers"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-blue-600",children:u.customers})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Admins"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-violet-600",children:u.admins})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-slate-400",children:"Verified Accounts"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-emerald-600",children:u.verified})]})]}),o&&e.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600",children:o}),e.jsx(ba,{users:t,isLoading:a,error:o,onUserUpdated:j=>{R(j),!(j!=null&&j.__bulkDelete||j!=null&&j.__delete)&&j!=null&&j._id&&i("")},enableManagement:!0})]})]})]})})},hd=async()=>{const s=(await fe.get("/admin/coupons")).data||{};if(s.success===!1)throw new Error(s.message||"Failed to load coupons");return s.data||[]},fd=async()=>{var a;const s=(await fe.post("/admin/coupons/generate-code")).data||{};if(s.success===!1)throw new Error(s.message||"Failed to generate code");return((a=s.data)==null?void 0:a.code)||""},bd=async t=>{const a=(await fe.post("/admin/coupons",t)).data||{};if(a.success===!1)throw new Error(a.message||"Failed to create coupon");return a.data},gd=async t=>{const a=(await fe.post("/admin/coupons/bulk",t)).data||{};if(a.success===!1)throw new Error(a.message||"Failed to create coupons");return Array.isArray(a.data)?a.data:[]},yd=async(t,s)=>{const l=(await fe.put(`/admin/coupons/${t}`,s)).data||{};if(l.success===!1)throw new Error(l.message||"Failed to update coupon");return l.data},jd=async t=>{const a=(await fe.delete(`/admin/coupons/${t}`)).data||{};if(a.success===!1)throw new Error(a.message||"Failed to delete coupon");return a},Nd=async t=>{const a=(await fe.post("/admin/coupons/bulk-delete",{ids:t})).data||{};if(a.success===!1)throw new Error(a.message||"Failed to delete selected coupons");return Array.isArray(a.deletedIds)?a.deletedIds:[]},ss=We("adminCoupons/fetchAll",async(t,{rejectWithValue:s})=>{try{return await hd()}catch(a){return s(a.message||"Failed to load coupons")}}),Zs=We("adminCoupons/create",async(t,{rejectWithValue:s})=>{try{return await bd(t)}catch(a){return s(a.message||"Failed to create coupon")}}),ea=We("adminCoupons/createBulk",async(t,{rejectWithValue:s})=>{try{return await gd(t)}catch(a){return s(a.message||"Failed to create coupons")}}),ta=We("adminCoupons/update",async({id:t,payload:s},{rejectWithValue:a})=>{try{return await yd(t,s)}catch(l){return a(l.message||"Failed to update coupon")}}),sa=We("adminCoupons/delete",async(t,{rejectWithValue:s})=>{try{return await jd(t),{_id:t}}catch(a){return s(a.message||"Failed to delete coupon")}}),aa=We("adminCoupons/deleteBulk",async(t,{rejectWithValue:s})=>{try{const a=await Nd(t);return Array.isArray(a)?a:[]}catch(a){return s(a.message||"Failed to delete selected coupons")}}),Ra=(t="single")=>({code:"",description:"",type:t,discountValue:"",maxDiscountAmount:"",minOrderAmount:"",maxRedemptions:t==="single"?"1":"",maxRedemptionsPerUser:t==="single"?"1":"",startDate:"",endDate:"",isActive:!0,count:"1"}),zr=t=>{if(!t)return"";try{return t.slice(0,10)}catch{const a=new Date(t);return Number.isNaN(a.getTime())?"":a.toISOString().slice(0,10)}},da=t=>{if(!t)return"--";const s=new Date(t);return Number.isNaN(s.getTime())?"--":s.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})},ma=t=>{if(t==null||t==="")return"--";const s=Number(t);return Number.isFinite(s)?new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(s):"--"},vd=t=>t?"Yes":"No",Or=t=>{if(t==null)return"Unlimited";const s=Number(t);return!Number.isFinite(s)||s<=0?"Unlimited":s},Tr=t=>{if(!t)return"--";const s=new Date(t);return Number.isNaN(s.getTime())?"--":s.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},$r=t=>{if(t==null||t==="")return null;const s=Number(t);return Number.isFinite(s)?Math.min(Math.max(s,0),100):null},_r=t=>!!(t!=null&&t.isFullyRedeemed||(t==null?void 0:t.redemptionStatus)==="redeemed"),Mr=({value:t,onValueChange:s,options:a,ariaLabel:l})=>{const[r,c]=n.useState(!1),o=n.useRef(null);n.useEffect(()=>{const p=x=>{var D;(D=o.current)!=null&&D.contains(x.target)||c(!1)};return document.addEventListener("mousedown",p),document.addEventListener("touchstart",p),()=>{document.removeEventListener("mousedown",p),document.removeEventListener("touchstart",p)}},[]);const i=a.find(p=>p.value===t)??a[0],d=p=>{s(p),c(!1)};return e.jsxs("div",{ref:o,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>c(p=>!p),className:`inline-flex items-center gap-2 rounded-xl border px-3 py-2 text-xs font-semibold transition focus:outline-none focus:ring-2 focus:ring-blue-100 ${r?"border-blue-400 bg-white text-blue-600":"border-slate-200 bg-white text-slate-600 hover:border-blue-300"}`,"aria-label":l,"aria-haspopup":"listbox","aria-expanded":r,children:[e.jsx("span",{children:i==null?void 0:i.label}),e.jsx(xa,{size:14,className:`transition ${r?"rotate-180 text-blue-500":"text-slate-400"}`})]}),r&&e.jsx("div",{className:"absolute left-0 top-[calc(100%+0.35rem)] z-30 w-40 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-lg",children:e.jsx("ul",{className:"max-h-48 overflow-y-auto py-1",role:"listbox",children:a.map(p=>{const x=p.value===t;return e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>d(p.value),className:`flex w-full items-center justify-between px-3 py-2 text-xs font-semibold transition ${x?"bg-blue-50 text-blue-600":"text-slate-600 hover:bg-slate-50"}`,role:"option","aria-selected":x,children:[p.label,x&&e.jsx("span",{className:"text-[10px] font-bold uppercase text-blue-500",children:"Selected"})]})},p.value)})})})]})},wd=t=>(Array.isArray(t)?t:[]).map((s,a)=>({"#":a+1,Code:s.code||"",Type:s.type==="single"?"Single use":"Multi use","Discount (%)":Number(s.discountValue)||0,"Max Discount Amount":ma(s.maxDiscountAmount),"Min Order Amount":ma(s.minOrderAmount),"Total Redemptions":Or(s.maxRedemptions??s.totalRedemptions),"Per User Limit":Or(s.maxRedemptionsPerUser??s.perUserLimit),"Usage Count":Number(s.usageCount)||0,"Remaining Redemptions":s.remainingRedemptions===null||s.remainingRedemptions===void 0?"Unlimited":Number(s.remainingRedemptions),Status:s.isActive===!1?"Inactive":s.redemptionStatus==="redeemed"?"Redeemed":"Active","Start Date":da(s.startDate),"End Date":da(s.endDate),Active:vd(s.isActive!==!1),"Created At":Tr(s.createdAt),"Updated At":Tr(s.updatedAt)})),Sd=()=>{const t=Es(),{user:s,logout:a}=Qe(),{items:l,status:r,error:c,mutationStatus:o,mutationError:i}=fa($=>$.adminCoupons),[d,p]=n.useState(Ra()),[x,D]=n.useState(null),[g,R]=n.useState(!1),[u,I]=n.useState(!1),[j,m]=n.useState("all"),[S,P]=n.useState("all"),[H,E]=n.useState(""),[w,A]=n.useState(""),[W,L]=n.useState([]),K=n.useRef(null),O=!!x,Y=Number(d.count||"1"),M=!O&&Number.isFinite(Y)&&Y>1,ee=r==="loading",te=o==="loading",y=n.useMemo(()=>{const $=$r(H),ce=$r(w);return l.filter(he=>{if(j!=="all"&&he.type!==j||!(()=>{switch(S){case"active":return he.isActive!==!1;case"inactive":return he.isActive===!1;case"redeemed":return _r(he);case"not-redeemed":return!_r(he);default:return!0}})())return!1;const $e=Number(he.discountValue)||0;return!($!==null&&$e<$||ce!==null&&$e>ce)})},[l,w,H,S,j]),z=n.useMemo(()=>y.map($=>$!=null&&$._id?String($._id):null).filter(Boolean),[y]),b=z.length>0&&z.every($=>W.includes($)),C=W.length,B=C>0,re=j!=="all"||S!=="all"||H!==""||w!=="",se=y.length===0?l.length===0?"No coupons found. Create a coupon to get started.":"No coupons match the selected filters.":"";n.useEffect(()=>{L($=>$.filter(ce=>z.includes(ce)))},[z]),n.useEffect(()=>{K.current&&(K.current.indeterminate=!b&&C>0)},[b,C]),n.useEffect(()=>{r==="idle"&&t(ss())},[t,r]),n.useEffect(()=>{o==="failed"&&i&&ge.error(i)},[o,i]);const X=n.useCallback(()=>{m("all"),P("all"),E(""),A("")},[]),F=n.useMemo(()=>{const $=l.length,ce=l.filter(Ge=>Ge.isActive!==!1).length,he=l.filter(Ge=>Ge.type==="single").length,Pe=l.filter(Ge=>Ge.type==="multi").length,$e=l.filter(Ge=>Ge.type==="single"&&Ge.isActive===!1).length,Me=l.filter(Ge=>Ge.type==="multi"&&Ge.isActive===!1).length,qe=l.filter(Ge=>Ge.isFullyRedeemed).length,rt=$-qe;return[{key:"total",label:"Total Coupons",value:$,icon:wn,badgeClass:"bg-blue-50 text-blue-600"},{key:"active",label:"Active",value:ce,icon:Wt,badgeClass:"bg-emerald-50 text-emerald-600"},{key:"single",label:"Single Use",value:he,icon:Sn,badgeClass:"bg-violet-50 text-violet-600"},{key:"multi",label:"Multi Use",value:Pe,icon:Ds,badgeClass:"bg-amber-50 text-amber-600"},{key:"expired-single",label:"Expired Single Use",value:$e,icon:Cn,badgeClass:"bg-slate-100 text-slate-600"},{key:"expired-multi",label:"Expired Multi Use",value:Me,icon:kn,badgeClass:"bg-orange-50 text-orange-600"},{key:"redeemed",label:"Redeemed Coupons",value:qe,icon:Ma,badgeClass:"bg-emerald-50 text-emerald-600"},{key:"not-redeemed",label:"Not Redeemed",value:rt,icon:An,badgeClass:"bg-blue-50 text-blue-600"}]},[l]),U=$=>{p(ce=>({...Ra($==="multi"?"multi":"single"),count:ce.count||"1"})),D(ce=>ce&&ce.type!==$?null:ce)},h=async()=>{I(!0);try{const $=await fd();p(ce=>({...ce,code:$})),ge.success("Generated coupon code")}catch($){ge.error($.message||"Unable to generate code")}finally{I(!1)}},k=n.useCallback(()=>{p(Ra()),D(null)},[]),f=$=>ce=>{const{value:he}=ce.target;p(Pe=>({...Pe,[$]:he}))},G=$=>ce=>{const{checked:he}=ce.target;p(Pe=>({...Pe,[$]:he}))},le=()=>{if(!M&&!d.code.trim())return ge.error("Coupon code is required"),!1;const $=Number(d.discountValue);if(!Number.isFinite($)||$<1||$>100)return ge.error("Discount must be between 1 and 100"),!1;const ce=d.minOrderAmount.trim();if(ce&&Number(ce)<0)return ge.error("Minimum order amount cannot be negative"),!1;if(d.type==="multi"){if(d.maxRedemptions.trim()){const he=Number(d.maxRedemptions);if(!Number.isFinite(he)||he<1)return ge.error("Total redemptions must be at least 1"),!1}if(d.maxRedemptionsPerUser.trim()){const he=Number(d.maxRedemptionsPerUser);if(!Number.isFinite(he)||he<1)return ge.error("Per user limit must be at least 1"),!1}}if(d.startDate&&d.endDate){const he=new Date(d.startDate),Pe=new Date(d.endDate);if(!Number.isNaN(he.getTime())&&!Number.isNaN(Pe.getTime())&&he>Pe)return ge.error("End date must be after start date"),!1}return!O&&(!Number.isFinite(Y)||Y<1)?(ge.error("Count must be at least 1"),!1):!0},Z=()=>{const $=d.type==="multi"?"multi":"single";return{code:d.code.trim().toUpperCase(),description:d.description.trim()||void 0,type:$,discountValue:Number(d.discountValue),maxDiscountAmount:d.maxDiscountAmount.trim()?Number(d.maxDiscountAmount):null,minOrderAmount:d.minOrderAmount.trim()?Number(d.minOrderAmount):0,maxRedemptions:$==="single"?1:d.maxRedemptions.trim()?Number(d.maxRedemptions):null,maxRedemptionsPerUser:$==="single"?1:d.maxRedemptionsPerUser.trim()?Number(d.maxRedemptionsPerUser):null,startDate:d.startDate||null,endDate:d.endDate||null,isActive:!!d.isActive}},ie=async $=>{if($.preventDefault(),te||!le())return;const ce=Z();try{x!=null&&x._id?(await t(ta({id:x._id,payload:ce})).unwrap(),ge.success("Coupon updated successfully")):M?(await t(ea({...ce,count:Y})).unwrap(),ge.success(`Created ${Y} coupons`)):(await t(Zs(ce)).unwrap(),ge.success("Coupon created successfully")),k(),r!=="loading"&&t(ss())}catch(he){const Pe=(he==null?void 0:he.message)||"Unable to save coupon. Please try again.";ge.error(Pe)}},N=$=>{$&&(D($),p({code:$.code||"",description:$.description||"",type:$.type||"single",discountValue:$.discountValue!==void 0?String($.discountValue):"",maxDiscountAmount:$.maxDiscountAmount!==void 0&&$.maxDiscountAmount!==null?String($.maxDiscountAmount):"",minOrderAmount:$.minOrderAmount!==void 0&&$.minOrderAmount!==null?String($.minOrderAmount):"",maxRedemptions:$.type==="single"?"1":$.maxRedemptions!==void 0&&$.maxRedemptions!==null?String($.maxRedemptions):"",maxRedemptionsPerUser:$.type==="single"?"1":$.maxRedemptionsPerUser!==void 0&&$.maxRedemptionsPerUser!==null?String($.maxRedemptionsPerUser):"",startDate:zr($.startDate),endDate:zr($.endDate),isActive:$.isActive!==!1,count:"1"}),window.scrollTo({top:0,behavior:"smooth"}))},V=async $=>{if(!(!($!=null&&$._id)||!window.confirm(`Delete coupon "${$.code}"? This action cannot be undone.`)))try{await t(sa($._id)).unwrap(),ge.success("Coupon deleted"),L(he=>he.filter(Pe=>Pe!==String($._id)))}catch(he){const Pe=(he==null?void 0:he.message)||"Unable to delete coupon. Please try again.";ge.error(Pe)}},v=n.useCallback(()=>{L($=>b?[]:[...z])},[b,z]),q=n.useCallback($=>{if(!$)return;const ce=String($);L(he=>he.includes(ce)?he.filter(Pe=>Pe!==ce):[...he,ce])},[]),J=n.useCallback(async()=>{if(!(!B||!window.confirm(`Delete ${C} selected coupon${C>1?"s":""}? This action cannot be undone.`)))try{await t(aa(W)).unwrap(),ge.success("Selected coupons deleted"),L([])}catch(ce){const he=(ce==null?void 0:ce.message)||"Failed to delete selected coupons. Please retry.";ge.error(he)}},[t,B,C,W,r]),xe=()=>{t(ss())},je=n.useCallback(()=>{if(!Array.isArray(y)||y.length===0){ge.error("No coupons available to export");return}try{const $=wd(y);if(!$.length){ge.error("No coupons available to export");return}const ce=es.json_to_sheet($),he=es.book_new();es.book_append_sheet(he,ce,"Coupons");const Pe=new Date,$e=Pe.toISOString().slice(0,10),Me=Pe.toISOString().slice(11,19).replace(/:/g,""),qe=`coupons-${$e}-${Me}.xlsx`;rl(he,qe),ge.success("Coupons exported successfully")}catch($){console.error("Failed to export coupons",$),ge.error("Unable to export coupons. Please try again.")}},[l]),we=$=>{const ce=$.isActive!==!1,he=ce?"bg-emerald-50 text-emerald-600":"bg-slate-200 text-slate-600";return e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${he}`,children:ce?"Active":"Inactive"})},_=$=>{const ce=!!$.isFullyRedeemed,he=ce?"bg-rose-50 text-rose-600":"bg-blue-50 text-blue-600";return e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${he}`,children:ce?"Redeemed":"Not Redeemed"})},be=$=>{const ce=$.type==="single",he=ce?"bg-violet-50 text-violet-600":"bg-amber-50 text-amber-600";return e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${he}`,children:ce?"Single Use":"Multi Use"})},ve=$=>$.type==="single"?$.usageCount>=1?"0 of 1":"1 of 1":$.maxRedemptions?`${Math.max($.maxRedemptions-($.usageCount||0),0)} of ${$.maxRedemptions}`:"Unlimited",de=()=>e.jsxs("form",{onSubmit:ie,className:"space-y-5",noValidate:!0,children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3 sm:items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:x?"Update Coupon":"Create Coupon"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Configure single-use and multi-use coupons for promotions."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:xe,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",disabled:ee,children:[e.jsx(tl,{size:16,className:ee?"animate-spin":""}),"Refresh"]}),x&&e.jsxs("button",{type:"button",onClick:k,className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-medium text-rose-600 transition hover:bg-rose-100",disabled:te,children:[e.jsx(Ze,{size:16})," Cancel edit"]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("button",{type:"button",onClick:()=>U("single"),className:`w-full rounded-xl border px-3 py-2 text-sm font-medium transition sm:flex-1 ${d.type==="single"?"border-blue-500 bg-blue-50 text-blue-600":"border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`,children:"Single use"}),e.jsx("button",{type:"button",onClick:()=>U("multi"),className:`w-full rounded-xl border px-3 py-2 text-sm font-medium transition sm:flex-1 ${d.type==="multi"?"border-blue-500 bg-blue-50 text-blue-600":"border-slate-200 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`,children:"Multi use"})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-code",className:"text-sm font-medium text-slate-600",children:"Coupon Code"}),e.jsxs("div",{className:"mt-1 flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx("input",{id:"coupon-code",name:"code",type:"text",value:d.code,onChange:f("code"),className:"flex-1 rounded-xl border border-slate-200 px-3 py-2 text-sm uppercase tracking-wider text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:M?"Auto-generated":"MEGA50",maxLength:20,required:!M,disabled:M}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",disabled:u||te||M,children:[u?e.jsx(Ie,{size:16,className:"animate-spin"}):e.jsx(ft,{size:16}),"Generate"]})]}),M&&e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Codes will be generated automatically for bulk creation."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-description",className:"text-sm font-medium text-slate-600",children:"Description"}),e.jsx("textarea",{id:"coupon-description",name:"description",value:d.description,onChange:f("description"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",rows:2,placeholder:"E.g. 15% off on prepaid orders"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-discount-value",className:"text-sm font-medium text-slate-600",children:"Discount (%)"}),e.jsx("input",{id:"coupon-discount-value",name:"discountValue",type:"number",min:1,max:100,value:d.discountValue,onChange:f("discountValue"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:"10",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-max-discount",className:"text-sm font-medium text-slate-600",children:"Max Discount Amount (optional)"}),e.jsx("input",{id:"coupon-max-discount",name:"maxDiscountAmount",type:"number",min:0,value:d.maxDiscountAmount,onChange:f("maxDiscountAmount"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:"500"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-min-order",className:"text-sm font-medium text-slate-600",children:"Minimum Order Amount"}),e.jsx("input",{id:"coupon-min-order",name:"minOrderAmount",type:"number",min:0,value:d.minOrderAmount,onChange:f("minOrderAmount"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:"1000"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[e.jsx("input",{id:"coupon-active",type:"checkbox",checked:d.isActive,onChange:G("isActive"),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"coupon-active",className:"text-sm text-slate-600",children:"Mark as active immediately"})]})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Usage limits"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Configure how many times the coupon can be redeemed overall and per customer."}),e.jsxs("div",{className:"mt-4 space-y-4",children:[!O&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-count",className:"text-sm font-medium text-slate-600",children:"Number of coupons to generate"}),e.jsx("input",{id:"coupon-count",name:"count",type:"number",min:1,max:200,value:d.count,onChange:f("count"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:"1"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"A unique code will be generated for each coupon when count is greater than 1."})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"coupon-max-redemptions",className:"text-sm font-medium text-slate-600",children:["Total Redemptions",d.type==="multi"?" (leave blank for unlimited)":""]}),e.jsx("input",{id:"coupon-max-redemptions",name:"maxRedemptions",type:"number",min:d.type==="single"?1:0,value:d.maxRedemptions,onChange:f("maxRedemptions"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:d.type==="single"?"1":"Unlimited",disabled:d.type==="single"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"coupon-max-redemptions-per-user",className:"text-sm font-medium text-slate-600",children:["Per Customer Limit",d.type==="multi"?" (leave blank for unlimited)":""]}),e.jsx("input",{id:"coupon-max-redemptions-per-user",name:"maxRedemptionsPerUser",type:"number",min:d.type==="single"?1:0,value:d.maxRedemptionsPerUser,onChange:f("maxRedemptionsPerUser"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none",placeholder:d.type==="single"?"1":"Unlimited",disabled:d.type==="single"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-start-date",className:"text-sm font-medium text-slate-600",children:"Start Date"}),e.jsx("input",{id:"coupon-start-date",name:"startDate",type:"date",value:d.startDate,onChange:f("startDate"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coupon-end-date",className:"text-sm font-medium text-slate-600",children:"End Date"}),e.jsx("input",{id:"coupon-end-date",name:"endDate",type:"date",value:d.endDate,onChange:f("endDate"),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-blue-500 focus:outline-none"})]})]})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap items-center gap-3",children:[e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-md shadow-blue-200 transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:te||u,children:[te?e.jsx(Ie,{size:16,className:"animate-spin"}):e.jsx(ft,{size:16}),x?"Update Coupon":"Create Coupon"]}),e.jsx("button",{type:"button",onClick:k,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",disabled:te,children:"Reset"})]})]})]})]}),pe=()=>e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex flex-col gap-2 border-b border-slate-100 px-4 py-4 sm:flex-row sm:flex-wrap sm:items-center sm:justify-between sm:px-5",children:[e.jsx("div",{className:"space-y-1",children:e.jsx("h3",{className:"text-base font-semibold text-slate-900",children:"Coupons"})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 shadow-sm",children:[e.jsx(Mr,{value:j,onValueChange:m,options:[{value:"all",label:"All types"},{value:"single",label:"Single use"},{value:"multi",label:"Multi use"}],ariaLabel:"Filter coupons by type"}),e.jsx(Mr,{value:S,onValueChange:P,options:[{value:"all",label:"All statuses"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"redeemed",label:"Redeemed"},{value:"not-redeemed",label:"Not redeemed"}],ariaLabel:"Filter coupons by status"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{htmlFor:"filter-discount-min",className:"sr-only",children:"Minimum discount percentage"}),e.jsx("input",{id:"filter-discount-min",name:"filterDiscountMin",type:"number",min:0,max:100,value:H,onChange:$=>E($.target.value),className:"w-20 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-600 transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100",placeholder:"Min %","aria-label":"Minimum discount percentage"}),e.jsx("span",{className:"text-xs font-medium text-slate-400",children:"-"}),e.jsx("label",{htmlFor:"filter-discount-max",className:"sr-only",children:"Maximum discount percentage"}),e.jsx("input",{id:"filter-discount-max",name:"filterDiscountMax",type:"number",min:0,max:100,value:w,onChange:$=>A($.target.value),className:"w-20 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-600 transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100",placeholder:"Max %","aria-label":"Maximum discount percentage"})]}),e.jsx("button",{type:"button",onClick:X,className:"text-xs font-semibold text-slate-500 transition hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-50",disabled:!re,children:"Reset"})]}),e.jsxs("button",{type:"button",onClick:J,className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs font-medium text-rose-600 transition hover:bg-rose-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:!B||te,children:[e.jsx(Je,{size:14})," Delete selected"]}),e.jsxs("button",{type:"button",onClick:je,className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-60",disabled:ee||l.length===0,children:[e.jsx(jt,{size:14})," Export"]})]})]}),c&&e.jsx("div",{className:"border-b border-amber-100 bg-amber-50 px-4 py-3 text-sm text-amber-700 sm:px-5",children:c}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3",children:e.jsx("input",{ref:K,type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500",checked:b&&B,onChange:v,"aria-label":b?"Deselect all coupons":"Select all coupons"})}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Code"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Type"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Discount"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Min Order"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Usage"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Date Range"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-5 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[ee&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-6 text-center text-slate-500 sm:px-5",children:e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm",children:[e.jsx(Ie,{size:16,className:"animate-spin text-blue-500"}),"Loading coupons..."]})})}),!ee&&y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-6 text-center text-slate-500 sm:px-5",children:se})}),!ee&&y.map($=>e.jsxs("tr",{className:"hover:bg-slate-50/60",children:[e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500",checked:W.includes(String($._id)),onChange:()=>q($._id),"aria-label":`Select coupon ${$.code}`})}),e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:$.code}),$.description&&e.jsx("p",{className:"text-xs text-slate-500",children:$.description})]})}),e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[be($),e.jsx("p",{className:"text-xs text-slate-500",children:$.type==="single"?"One-time use":"Reusable with limits"})]})}),e.jsxs("td",{className:"px-4 py-4 align-top sm:px-5",children:[e.jsxs("p",{className:"font-medium text-slate-900",children:[$.discountValue,"%"]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Cap: ",ma($.maxDiscountAmount)]})]}),e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsx("p",{className:"font-medium text-slate-900",children:ma($.minOrderAmount)})}),e.jsxs("td",{className:"px-4 py-4 align-top sm:px-5",children:[e.jsx("p",{className:"font-medium text-slate-900",children:ve($)}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Used ",$.usageCount||0," times"]})]}),e.jsxs("td",{className:"px-4 py-4 align-top sm:px-5",children:[e.jsx("p",{className:"font-medium text-slate-900",children:$.startDate?da($.startDate):"Immediately"}),e.jsx("p",{className:"text-xs text-slate-500",children:$.endDate?da($.endDate):"No end date"})]}),e.jsx("td",{className:"px-4 py-4 align-top sm:px-5",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[we($),_($)]})}),e.jsx("td",{className:"px-4 py-4 align-top text-right sm:px-5",children:e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>N($),className:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-medium text-slate-600 transition hover:border-blue-200 hover:text-blue-600",children:e.jsx(Cs,{size:14})}),e.jsx("button",{type:"button",onClick:()=>V($),className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs font-medium text-rose-600 transition hover:bg-rose-100",disabled:te,children:e.jsx(Je,{size:14})})]})})]},$._id))]})]})})]});return e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(Ue,{active:"Coupons",className:"hidden lg:flex lg:w-64 lg:flex-none",onNavigate:()=>R(!1)}),e.jsx(ze,{children:g&&e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex md:hidden",children:[e.jsx(Q.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(Ue,{active:"Coupons",className:"flex w-full",onNavigate:()=>R(!1)})}),e.jsx("button",{type:"button",onClick:()=>R(!1),className:"flex-1 bg-black/30","aria-label":"Close sidebar"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(nt,{onToggleSidebar:()=>R($=>!$),activeRange:"All Date",onSelectRange:()=>{},adminName:(s==null?void 0:s.name)||(s==null?void 0:s.username)||"Admin",adminRole:(s==null?void 0:s.role)==="admin"?"Administrator":s==null?void 0:s.role,notifications:null,showRangeSelector:!1,showNotifications:!1,onLogout:a}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-4 py-6 md:px-8 space-y-6",children:[e.jsx("section",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-4",children:F.map(({key:$,label:ce,value:he,icon:Pe,badgeClass:$e})=>e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-slate-500",children:ce}),e.jsx("span",{className:`inline-flex items-center justify-center rounded-full px-3 py-1 text-xs font-semibold ${$e}`,children:e.jsx(Pe,{size:16})})]}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:he})]},$))}),e.jsx("section",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:de()}),e.jsx("section",{children:pe()})]})]})]})})},Cd=72,Us=(t="")=>t.toString().trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").replace(/-{2,}/g,"-"),kd=()=>{const{user:t,logout:s}=Qe(),[a,l]=n.useState([]),[r,c]=n.useState([]),[o,i]=n.useState(!1),[d,p]=n.useState(!1),[x,D]=n.useState(!1),[g,R]=n.useState(!1),[u,I]=n.useState(!1),[j,m]=n.useState({}),[S,P]=n.useState({name:"",slug:"",isVisible:!0,priority:0}),H=n.useMemo(()=>new Set(a.map(y=>y.slug)),[a]),E=n.useMemo(()=>r.length?r.filter(y=>y.slug&&!H.has(y.slug)):[],[r,H]),w=async(y=!0)=>{y?p(!0):D(!0);try{const z=await zi(),b=Array.isArray(z.data)?z.data:[];l(b),m({})}catch(z){console.error("Failed to load footer categories",z),ge.error(z.message||"Failed to load footer categories")}finally{p(!1),D(!1)}},A=async()=>{try{const y=await Oi();c(Array.isArray(y.data)?y.data:[])}catch(y){console.error("Failed to load available categories",y),ge.error(y.message||"Failed to load available categories")}};n.useEffect(()=>{w(),A()},[]),n.useEffect(()=>{P(y=>{if(y.name)return y;const z=E[0];return z?{...y,name:z.name,slug:z.slug}:y})},[E]);const W=(y,z)=>{m(b=>({...b,[y]:{...b[y],...z}}))},L=y=>{const z=j[y._id];return z?{priority:z.priority!==void 0?z.priority:y.priority??0,isVisible:z.isVisible!==void 0?z.isVisible:y.isVisible!==!1,slug:z.slug!==void 0?z.slug:y.slug||""}:{priority:y.priority??0,isVisible:y.isVisible!==!1,slug:y.slug||""}},K=y=>{if(!j[y._id])return!1;const b=L(y);return b.priority!==(y.priority??0)||b.isVisible!==(y.isVisible!==!1)||b.slug!==(y.slug||"")},O=y=>{m(z=>{if(!z[y])return z;const b={...z};return delete b[y],b})},Y=async y=>{if(y.preventDefault(),!S.name){ge.error("Select a category to add");return}const z={name:S.name,slug:S.slug||Us(S.name),isVisible:!!S.isVisible,priority:Number.isFinite(Number(S.priority))?Number(S.priority):0};R(!0);try{const b=await Ti(z),C=b.data||b;ge.success("Footer category added"),l(B=>[...B,C].sort((re,se)=>(re.priority??0)-(se.priority??0))),P({name:"",slug:"",isVisible:!0,priority:0}),await A()}catch(b){console.error("Failed to create footer category",b),ge.error(b.message||"Failed to create footer category")}finally{R(!1)}},M=async y=>{const z=L(y);try{const b=await $i(y._id,{slug:z.slug,isVisible:z.isVisible,priority:z.priority}),C=b.data||b;ge.success("Category updated"),l(B=>B.map(re=>re._id===C._id?C:re).sort((re,se)=>(re.priority??0)-(se.priority??0))),O(y._id)}catch(b){console.error("Failed to update footer category",b),ge.error(b.message||"Failed to update category")}},ee=async y=>{if(window.confirm("Remove this category from the footer?"))try{await _i(y),ge.success("Category removed"),l(z=>z.filter(b=>b._id!==y)),await A()}catch(z){console.error("Failed to delete footer category",z),ge.error(z.message||"Failed to delete category")}},te=async(y,z)=>{const b=a.findIndex(se=>se._id===y);if(b<0)return;const C=z==="up"?b-1:b+1;if(C<0||C>=a.length)return;const B=[...a],[re]=B.splice(b,1);B.splice(C,0,re),I(!0);try{const se=await Mi(B.map(F=>F._id)),X=Array.isArray(se.data)?se.data:B;l(X),ge.success("Category order updated")}catch(se){console.error("Failed to reorder categories",se),ge.error(se.message||"Failed to reorder categories")}finally{I(!1)}};return e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:e.jsxs("div",{className:"flex min-h-screen",children:[e.jsx(Ue,{active:"Footer Categories",className:"hidden lg:flex lg:w-64 lg:flex-none",onNavigate:()=>i(!1)}),e.jsx(ze,{children:o&&e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex lg:hidden",children:[e.jsx(Q.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",stiffness:220,damping:24},className:"bg-white w-72 max-w-sm h-full shadow-xl",children:e.jsx(Ue,{active:"Footer Categories",className:"flex w-full",onNavigate:()=>i(!1)})}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"flex-1 bg-black/30","aria-label":"Close navigation"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(nt,{onToggleSidebar:()=>i(y=>!y),adminName:(t==null?void 0:t.name)||(t==null?void 0:t.username)||"Admin",adminRole:(t==null?void 0:t.role)==="admin"?"Administrator":t==null?void 0:t.role,onLogout:s,activeRange:"All Date",onSelectRange:()=>{},showRangeSelector:!1,showNotifications:!1}),e.jsx("main",{className:"flex-1 overflow-y-auto",style:{maxHeight:`calc(100vh - ${Cd}px)`},children:e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 space-y-6",children:[e.jsxs("header",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Footer Categories"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Control which categories appear in the storefront footer and set their display priority."})]}),e.jsxs("button",{onClick:()=>w(!1),className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-200 text-sm font-medium text-slate-600 hover:border-blue-200 hover:text-blue-600 transition",disabled:x,children:[x?e.jsx(Ie,{size:16,className:"animate-spin"}):null,"Refresh"]})]}),e.jsxs("section",{className:"bg-white border border-slate-200 rounded-2xl shadow-sm",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-slate-100 flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-slate-600",children:"Active Categories"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Reorder to change priority. Lower numbers appear first in the footer."})]}),(d||u)&&e.jsx(Ie,{size:18,className:"animate-spin text-slate-400"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{className:"text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:[e.jsx("th",{className:"px-6 py-3",children:"Category"}),e.jsx("th",{className:"px-6 py-3",children:"Slug"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Priority"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Visible"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 text-sm",children:d?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-slate-500",children:e.jsxs("div",{className:"inline-flex items-center gap-3",children:[e.jsx(Ie,{size:20,className:"animate-spin"}),"Loading categories…"]})})}):a.length?a.map((y,z)=>{const b=L(y),C=K(y),B=z===0||u,re=z===a.length-1||u;return e.jsxs("tr",{className:"hover:bg-slate-50/60 transition",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-semibold text-slate-800",children:y.name}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Created"," ",new Date(y.createdAt).toLocaleDateString()]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"text",value:b.slug,onChange:se=>W(y._id,{slug:Us(se.target.value)}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"category-slug"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"number",min:0,value:b.priority,onChange:se=>W(y._id,{priority:Number(se.target.value)}),className:"w-24 px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200 mx-auto"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:b.isVisible,onChange:se=>W(y._id,{isVisible:se.target.checked}),className:"h-4 w-4 text-blue-600 border-slate-300 rounded"}),e.jsx("span",{className:"text-xs text-slate-500",children:b.isVisible?"Shown":"Hidden"})]})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>te(y._id,"up"),disabled:B,className:"p-2 rounded-lg border border-slate-200 text-slate-500 hover:text-blue-600 hover:border-blue-200 disabled:opacity-40 disabled:cursor-not-allowed","aria-label":"Move up",children:e.jsx(Pn,{size:16})}),e.jsx("button",{type:"button",onClick:()=>te(y._id,"down"),disabled:re,className:"p-2 rounded-lg border border-slate-200 text-slate-500 hover:text-blue-600 hover:border-blue-200 disabled:opacity-40 disabled:cursor-not-allowed","aria-label":"Move down",children:e.jsx(Dn,{size:16})}),e.jsx("button",{type:"button",onClick:()=>ee(y._id),className:"p-2 rounded-lg border border-rose-100 text-rose-500 hover:bg-rose-50","aria-label":"Delete category",children:e.jsx(Je,{size:16})}),e.jsxs("button",{type:"button",onClick:()=>M(y),disabled:!C,className:"inline-flex items-center gap-1 px-3 py-2 rounded-lg bg-blue-600 text-white text-xs font-semibold hover:bg-blue-700 disabled:opacity-40",children:[e.jsx(Ua,{size:14})," Save"]})]})})]},y._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-slate-500",children:"No footer categories configured yet."})})})]})})]}),e.jsxs("section",{className:"bg-white border border-slate-200 rounded-2xl shadow-sm p-6 space-y-6",children:[e.jsx("header",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-slate-600",children:"Add category to footer"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Pick a product category and configure its footer visibility."})]})}),e.jsxs("form",{onSubmit:Y,className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Category"}),e.jsxs("select",{value:S.name,onChange:y=>{const z=E.find(b=>b.name===y.target.value);P(b=>({...b,name:(z==null?void 0:z.name)||"",slug:(z==null?void 0:z.slug)||Us(y.target.value)}))},className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",children:[e.jsx("option",{value:"",disabled:!0,children:E.length?"Select category":"No categories available"}),E.map(y=>e.jsx("option",{value:y.name,children:y.name},y.slug))]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Slug"}),e.jsx("input",{type:"text",value:S.slug,onChange:y=>P(z=>({...z,slug:Us(y.target.value)})),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200",placeholder:"category-slug"}),e.jsx("span",{className:"text-[11px] text-slate-400",children:"Used for footer links. Lowercase alphanumeric and hyphen only."})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Priority"}),e.jsx("input",{type:"number",min:0,value:S.priority,onChange:y=>P(z=>({...z,priority:Number(y.target.value)})),className:"px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200"}),e.jsx("span",{className:"text-[11px] text-slate-400",children:"Lower numbers display earlier. Defaults to 0."})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:S.isVisible,onChange:y=>P(z=>({...z,isVisible:y.target.checked})),className:"h-4 w-4 text-blue-600 border-slate-300 rounded"}),e.jsx("span",{className:"text-sm text-slate-600",children:"Show in footer"})]}),e.jsx("div",{className:"md:col-span-2 lg:col-span-3 flex justify-end",children:e.jsxs("button",{type:"submit",disabled:g||!S.name,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-semibold shadow-sm hover:bg-blue-700 disabled:opacity-50",children:[g?e.jsx(Ie,{size:16,className:"animate-spin"}):e.jsx(ft,{size:16}),g?"Adding":"Add Category"]})})]})]})]})})]})]})})},Ke=({children:t,requireAdmin:s=!1})=>{const{isAuthenticated:a,loading:l,isAdmin:r}=Qe(),c=ut();return l?e.jsx("div",{children:"Loading..."}):a?s&&!r?e.jsx(rr,{to:"/",replace:!0}):t:e.jsx(rr,{to:"/login",state:{from:c},replace:!0})};Ke.propTypes={children:me.node.isRequired,requireAdmin:me.bool};Ke.defaultProps={requireAdmin:!1};const Ad=()=>{const{pathname:t}=ut();return n.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[t]),null};function Pd(){return e.jsxs(vi,{children:[e.jsx(Ad,{}),e.jsxs(Rn,{children:[e.jsxs(ke,{path:"/",element:e.jsx(Bi,{}),children:[e.jsx(ke,{index:!0,element:e.jsx(Xi,{})}),e.jsx(ke,{path:"shop",element:e.jsx(Zi,{})}),e.jsx(ke,{path:"search",element:e.jsx(tc,{})}),e.jsx(ke,{path:"product/:id",element:e.jsx(eo,{})}),e.jsx(ke,{path:"category/:slug",element:e.jsx(to,{})}),e.jsx(ke,{path:"brand/:slug",element:e.jsx(so,{})}),e.jsx(ke,{path:"cart",element:e.jsx(ao,{})}),e.jsx(ke,{path:"login",element:e.jsx(zo,{})}),e.jsx(ke,{path:"signup",element:e.jsx(Oo,{})}),e.jsx(ke,{path:"forgot-password",element:e.jsx(To,{})}),e.jsx(ke,{path:"reset-password-otp",element:e.jsx($o,{})}),e.jsx(ke,{path:"verify-email",element:e.jsx(_o,{})}),e.jsx(ke,{path:"about",element:e.jsx(Vo,{})}),e.jsx(ke,{path:"contact",element:e.jsx(Ho,{})}),e.jsx(ke,{path:"help-support",element:e.jsx(Jo,{})}),e.jsx(ke,{path:"legal/privacy",element:e.jsx(Xo,{})}),e.jsx(ke,{path:"legal/terms",element:e.jsx(Zo,{})}),e.jsx(ke,{path:"legal/returns",element:e.jsx(ec,{})}),e.jsxs(ke,{path:"checkout",element:e.jsx(Ke,{children:e.jsx(ro,{})}),children:[e.jsx(ke,{index:!0,element:e.jsx(cr,{})}),e.jsx(ke,{path:"order",element:e.jsx(cr,{})}),e.jsx(ke,{path:"address",element:e.jsx(No,{})}),e.jsx(ke,{path:"payment",element:e.jsx(ko,{})}),e.jsx(ke,{path:"confirmation",element:e.jsx(br,{})}),e.jsx(ke,{path:"confirmation/:orderId",element:e.jsx(br,{})})]}),e.jsx(ke,{path:"orders",element:e.jsx(Ke,{children:e.jsx(Ro,{})})}),e.jsx(ke,{path:"orders/:orderId",element:e.jsx(Ke,{children:e.jsx(Fo,{})})}),e.jsx(ke,{path:"profile",element:e.jsx(Ke,{children:e.jsx(Bo,{})})}),e.jsx(ke,{path:"*",element:e.jsx(sc,{})})]}),e.jsx(ke,{path:"/admin",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(oc,{})})}),e.jsx(ke,{path:"/admin/products",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(Ac,{})})}),e.jsx(ke,{path:"/admin/orders",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(Qc,{})})}),e.jsx(ke,{path:"/admin/coupons",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(Sd,{})})}),e.jsx(ke,{path:"/admin/footer-categories",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(kd,{})})}),e.jsx(ke,{path:"/admin/customers",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(pd,{})})}),e.jsx(ke,{path:"/admin/help-support",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(Xc,{})})}),e.jsx(ke,{path:"/admin/hero-carousel",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(ud,{})})}),e.jsx(ke,{path:"/admin/orders/:orderId",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(Jc,{})})}),e.jsx(ke,{path:"/admin/products/new",element:e.jsx(Ke,{requireAdmin:!0,children:e.jsx(Lc,{})})})]})]})}const Dd={items:[],status:"idle",error:null,saving:!1,deletingId:null,reorderStatus:"idle"},Rd=Ft({name:"adminHeroCarousel",initialState:Dd,reducers:{},extraReducers:t=>{t.addCase(Ws.pending,s=>{s.status="loading",s.error=null}).addCase(Ws.fulfilled,(s,a)=>{s.status="succeeded",s.items=Array.isArray(a.payload)?a.payload:[]}).addCase(Ws.rejected,(s,a)=>{var l;s.status="failed",s.error=a.payload||((l=a.error)==null?void 0:l.message)||null}).addCase(Ys.pending,s=>{s.saving=!0,s.error=null}).addCase(Ys.fulfilled,(s,a)=>{s.saving=!1,a.payload&&(s.items=[...s.items,a.payload].sort((l,r)=>(l.order??0)-(r.order??0)))}).addCase(Ys.rejected,(s,a)=>{var l;s.saving=!1,s.error=a.payload||((l=a.error)==null?void 0:l.message)||null}).addCase(Ks.pending,s=>{s.saving=!0,s.error=null}).addCase(Ks.fulfilled,(s,a)=>{s.saving=!1;const l=a.payload;l!=null&&l._id&&(s.items=s.items.map(r=>r._id===l._id?l:r).sort((r,c)=>(r.order??0)-(c.order??0)))}).addCase(Ks.rejected,(s,a)=>{var l;s.saving=!1,s.error=a.payload||((l=a.error)==null?void 0:l.message)||null}).addCase(Js.pending,(s,a)=>{s.deletingId=a.meta.arg,s.error=null}).addCase(Js.fulfilled,(s,a)=>{s.deletingId=null;const l=a.payload;l!=null&&l._id&&(s.items=s.items.filter(r=>r._id!==l._id))}).addCase(Js.rejected,(s,a)=>{var l;s.deletingId=null,s.error=a.payload||((l=a.error)==null?void 0:l.message)||null}).addCase(Xs.pending,s=>{s.reorderStatus="loading",s.error=null}).addCase(Xs.fulfilled,(s,a)=>{s.reorderStatus="succeeded",s.items=Array.isArray(a.payload)?a.payload:s.items}).addCase(Xs.rejected,(s,a)=>{var l;s.reorderStatus="failed",s.error=a.payload||((l=a.error)==null?void 0:l.message)||null})}}),Id=Rd.reducer,qs=(t=[])=>[...t].sort((s,a)=>{const l=s!=null&&s.createdAt?new Date(s.createdAt).getTime():0;return(a!=null&&a.createdAt?new Date(a.createdAt).getTime():0)-l}),Ur={items:[],status:"idle",error:"",mutationStatus:"idle",mutationError:""},Ql=Ft({name:"adminCoupons",initialState:Ur,reducers:{resetAdminCouponsState:()=>({...Ur})},extraReducers:t=>{t.addCase(ss.pending,s=>{s.status="loading",s.error=""}).addCase(ss.fulfilled,(s,a)=>{s.status="succeeded",s.items=Array.isArray(a.payload)?qs(a.payload):[]}).addCase(ss.rejected,(s,a)=>{var l;s.status="failed",s.error=a.payload||((l=a.error)==null?void 0:l.message)||"Failed to load coupons"}).addCase(Zs.pending,s=>{s.mutationStatus="loading",s.mutationError=""}).addCase(Zs.fulfilled,(s,a)=>{s.mutationStatus="succeeded",a.payload&&(s.items=qs([a.payload,...s.items]))}).addCase(Zs.rejected,(s,a)=>{var l;s.mutationStatus="failed",s.mutationError=a.payload||((l=a.error)==null?void 0:l.message)||"Failed to create coupon"}).addCase(ea.pending,s=>{s.mutationStatus="loading",s.mutationError=""}).addCase(ea.fulfilled,(s,a)=>{s.mutationStatus="succeeded",Array.isArray(a.payload)&&a.payload.length&&(s.items=qs([...a.payload,...s.items]))}).addCase(ea.rejected,(s,a)=>{var l;s.mutationStatus="failed",s.mutationError=a.payload||((l=a.error)==null?void 0:l.message)||"Failed to create coupons"}).addCase(ta.pending,s=>{s.mutationStatus="loading",s.mutationError=""}).addCase(ta.fulfilled,(s,a)=>{var l;s.mutationStatus="succeeded",(l=a.payload)!=null&&l._id&&(s.items=qs(s.items.map(r=>r._id===a.payload._id?a.payload:r)))}).addCase(ta.rejected,(s,a)=>{var l;s.mutationStatus="failed",s.mutationError=a.payload||((l=a.error)==null?void 0:l.message)||"Failed to update coupon"}).addCase(sa.pending,s=>{s.mutationStatus="loading",s.mutationError=""}).addCase(sa.fulfilled,(s,a)=>{var r,c;s.mutationStatus="succeeded";const l=((r=a.payload)==null?void 0:r._id)||((c=a.meta)==null?void 0:c.arg);l&&(s.items=s.items.filter(o=>o._id!==l))}).addCase(sa.rejected,(s,a)=>{var l;s.mutationStatus="failed",s.mutationError=a.payload||((l=a.error)==null?void 0:l.message)||"Failed to delete coupon"}).addCase(aa.pending,s=>{s.mutationStatus="loading",s.mutationError=""}).addCase(aa.fulfilled,(s,a)=>{s.mutationStatus="succeeded";const l=Array.isArray(a.payload)?a.payload:[];if(l.length){const r=new Set(l.map(String));s.items=s.items.filter(c=>!r.has(String(c._id)))}}).addCase(aa.rejected,(s,a)=>{var l;s.mutationStatus="failed",s.mutationError=a.payload||((l=a.error)==null?void 0:l.message)||"Failed to delete selected coupons"})}}),{resetAdminCouponsState:Kd}=Ql.actions,Fd=Ql.reducer,Ed=()=>{if(!(typeof window>"u"))try{const t=window.localStorage.getItem("checkoutState");if(!t)return;const s=JSON.parse(t);return!s||typeof s!="object"?void 0:{checkout:s}}catch(t){console.warn("Failed to load checkout state from storage",t);return}},Ld=t=>{if(!(typeof window>"u"))try{const s=JSON.stringify(t);window.localStorage.setItem("checkoutState",s)}catch(s){console.warn("Failed to save checkout state to storage",s)}},zd=()=>{if(!(typeof window>"u"))try{window.localStorage.removeItem("checkoutState")}catch(t){console.warn("Failed to clear checkout state from storage",t)}},Od=Ed(),Oa=Un({reducer:{checkout:Ei,address:Pi,orders:Do,adminProducts:wc,adminOrders:Vc,adminHeroCarousel:Id,adminCoupons:Fd,coupon:wo},middleware:t=>t({serializableCheck:!1}),preloadedState:Od});Oa.subscribe(()=>{var a;const s=Oa.getState().checkout;if(!((a=s==null?void 0:s.items)!=null&&a.length)){zd();return}Ld(s)});In.createRoot(document.getElementById("root")).render(e.jsx(Wr.StrictMode,{children:e.jsx(Fn,{children:e.jsx(En,{store:Oa,children:e.jsx(Ci,{children:e.jsxs(ki,{children:[e.jsx(Pd,{}),e.jsx(Ln,{position:"top-right",toastOptions:{duration:1e3,success:{duration:1e3},error:{duration:1e3}}}),e.jsx(zn,{position:"bottom-right",autoClose:1e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]})})})})}));
